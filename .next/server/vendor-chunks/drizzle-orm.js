"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "vendor-chunks/drizzle-orm";
exports.ids = ["vendor-chunks/drizzle-orm"];
exports.modules = {

/***/ "(rsc)/./node_modules/drizzle-orm/alias-cf8e03cd.mjs":
/*!*****************************************************!*\
  !*** ./node_modules/drizzle-orm/alias-cf8e03cd.mjs ***!
  \*****************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   $: () => (/* binding */ PgArrayBuilder),\n/* harmony export */   A: () => (/* binding */ getOrderByOperators),\n/* harmony export */   B: () => (/* binding */ normalizeRelation),\n/* harmony export */   C: () => (/* binding */ ColumnBuilder),\n/* harmony export */   D: () => (/* binding */ DrizzleError),\n/* harmony export */   E: () => (/* binding */ and),\n/* harmony export */   F: () => (/* binding */ eq),\n/* harmony export */   G: () => (/* binding */ aliasedTable),\n/* harmony export */   H: () => (/* binding */ applyMixins),\n/* harmony export */   I: () => (/* binding */ getTableColumns),\n/* harmony export */   J: () => (/* binding */ TypedQueryBuilder),\n/* harmony export */   K: () => (/* binding */ getTableLikeName),\n/* harmony export */   L: () => (/* binding */ PgColumnBuilder),\n/* harmony export */   M: () => (/* binding */ Many),\n/* harmony export */   N: () => (/* binding */ PgColumn),\n/* harmony export */   O: () => (/* binding */ One),\n/* harmony export */   P: () => (/* binding */ PgDialect),\n/* harmony export */   Q: () => (/* binding */ QueryPromise),\n/* harmony export */   R: () => (/* binding */ pgTableWithSchema),\n/* harmony export */   S: () => (/* binding */ SQL),\n/* harmony export */   T: () => (/* binding */ Table),\n/* harmony export */   U: () => (/* binding */ pgViewWithSchema),\n/* harmony export */   V: () => (/* binding */ ViewBaseConfig),\n/* harmony export */   W: () => (/* binding */ WithSubquery),\n/* harmony export */   X: () => (/* binding */ pgMaterializedViewWithSchema),\n/* harmony export */   Y: () => (/* binding */ CheckBuilder),\n/* harmony export */   Z: () => (/* binding */ Check),\n/* harmony export */   _: () => (/* binding */ check),\n/* harmony export */   a: () => (/* binding */ extractTablesRelationalConfig),\n/* harmony export */   a$: () => (/* binding */ PgView),\n/* harmony export */   a0: () => (/* binding */ PgArray),\n/* harmony export */   a1: () => (/* binding */ PgDateBuilder),\n/* harmony export */   a2: () => (/* binding */ PgDate),\n/* harmony export */   a3: () => (/* binding */ PgDateStringBuilder),\n/* harmony export */   a4: () => (/* binding */ PgDateString),\n/* harmony export */   a5: () => (/* binding */ date),\n/* harmony export */   a6: () => (/* binding */ PgJsonBuilder),\n/* harmony export */   a7: () => (/* binding */ PgJson),\n/* harmony export */   a8: () => (/* binding */ json),\n/* harmony export */   a9: () => (/* binding */ PgJsonbBuilder),\n/* harmony export */   aA: () => (/* binding */ PrimaryKeyBuilder),\n/* harmony export */   aB: () => (/* binding */ PrimaryKey),\n/* harmony export */   aC: () => (/* binding */ PgSelectQueryBuilder),\n/* harmony export */   aD: () => (/* binding */ PgSelect),\n/* harmony export */   aE: () => (/* binding */ InlineForeignKeys),\n/* harmony export */   aF: () => (/* binding */ PgTable),\n/* harmony export */   aG: () => (/* binding */ pgTable),\n/* harmony export */   aH: () => (/* binding */ pgTableCreator),\n/* harmony export */   aI: () => (/* binding */ unique),\n/* harmony export */   aJ: () => (/* binding */ uniqueKeyName),\n/* harmony export */   aK: () => (/* binding */ UniqueConstraintBuilder),\n/* harmony export */   aL: () => (/* binding */ UniqueOnConstraintBuilder),\n/* harmony export */   aM: () => (/* binding */ UniqueConstraint),\n/* harmony export */   aN: () => (/* binding */ getTableConfig),\n/* harmony export */   aO: () => (/* binding */ getViewConfig),\n/* harmony export */   aP: () => (/* binding */ getMaterializedViewConfig),\n/* harmony export */   aQ: () => (/* binding */ parsePgNestedArray),\n/* harmony export */   aR: () => (/* binding */ parsePgArray),\n/* harmony export */   aS: () => (/* binding */ makePgArray),\n/* harmony export */   aT: () => (/* binding */ DefaultViewBuilderCore),\n/* harmony export */   aU: () => (/* binding */ ViewBuilder),\n/* harmony export */   aV: () => (/* binding */ ManualViewBuilder),\n/* harmony export */   aW: () => (/* binding */ MaterializedViewBuilderCore),\n/* harmony export */   aX: () => (/* binding */ MaterializedViewBuilder),\n/* harmony export */   aY: () => (/* binding */ ManualMaterializedViewBuilder),\n/* harmony export */   aZ: () => (/* binding */ PgViewBase),\n/* harmony export */   a_: () => (/* binding */ PgViewConfig),\n/* harmony export */   aa: () => (/* binding */ PgJsonb),\n/* harmony export */   ab: () => (/* binding */ jsonb),\n/* harmony export */   ac: () => (/* binding */ PgNumericBuilder),\n/* harmony export */   ad: () => (/* binding */ PgNumeric),\n/* harmony export */   ae: () => (/* binding */ numeric),\n/* harmony export */   af: () => (/* binding */ decimal),\n/* harmony export */   ag: () => (/* binding */ PgTimeBuilder),\n/* harmony export */   ah: () => (/* binding */ PgTime),\n/* harmony export */   ai: () => (/* binding */ time),\n/* harmony export */   aj: () => (/* binding */ PgTimestampBuilder),\n/* harmony export */   ak: () => (/* binding */ PgTimestamp),\n/* harmony export */   al: () => (/* binding */ PgTimestampStringBuilder),\n/* harmony export */   am: () => (/* binding */ PgTimestampString),\n/* harmony export */   an: () => (/* binding */ timestamp),\n/* harmony export */   ao: () => (/* binding */ PgUUIDBuilder),\n/* harmony export */   ap: () => (/* binding */ PgUUID),\n/* harmony export */   aq: () => (/* binding */ uuid),\n/* harmony export */   ar: () => (/* binding */ ForeignKeyBuilder),\n/* harmony export */   as: () => (/* binding */ ForeignKey),\n/* harmony export */   at: () => (/* binding */ foreignKey),\n/* harmony export */   au: () => (/* binding */ IndexBuilderOn),\n/* harmony export */   av: () => (/* binding */ IndexBuilder),\n/* harmony export */   aw: () => (/* binding */ Index),\n/* harmony export */   ax: () => (/* binding */ index),\n/* harmony export */   ay: () => (/* binding */ uniqueIndex),\n/* harmony export */   az: () => (/* binding */ primaryKey),\n/* harmony export */   b: () => (/* binding */ Param),\n/* harmony export */   b0: () => (/* binding */ PgMaterializedViewConfig),\n/* harmony export */   b1: () => (/* binding */ PgMaterializedView),\n/* harmony export */   b2: () => (/* binding */ pgView),\n/* harmony export */   b3: () => (/* binding */ pgMaterializedView),\n/* harmony export */   b4: () => (/* binding */ ColumnAliasProxyHandler),\n/* harmony export */   b5: () => (/* binding */ RelationTableAliasProxyHandler),\n/* harmony export */   b6: () => (/* binding */ aliasedRelation),\n/* harmony export */   b7: () => (/* binding */ hasOwnEntityKind),\n/* harmony export */   b8: () => (/* binding */ bindIfParam),\n/* harmony export */   b9: () => (/* binding */ ne),\n/* harmony export */   bA: () => (/* binding */ createOne),\n/* harmony export */   bB: () => (/* binding */ createMany),\n/* harmony export */   bC: () => (/* binding */ FakePrimitiveParam),\n/* harmony export */   bD: () => (/* binding */ isSQLWrapper),\n/* harmony export */   bE: () => (/* binding */ StringChunk),\n/* harmony export */   bF: () => (/* binding */ Name),\n/* harmony export */   bG: () => (/* binding */ name),\n/* harmony export */   bH: () => (/* binding */ isDriverValueEncoder),\n/* harmony export */   bI: () => (/* binding */ noopDecoder),\n/* harmony export */   bJ: () => (/* binding */ noopEncoder),\n/* harmony export */   bK: () => (/* binding */ noopMapper),\n/* harmony export */   bL: () => (/* binding */ param),\n/* harmony export */   bM: () => (/* binding */ Placeholder),\n/* harmony export */   bN: () => (/* binding */ placeholder),\n/* harmony export */   bO: () => (/* binding */ TableName),\n/* harmony export */   bP: () => (/* binding */ Schema),\n/* harmony export */   bQ: () => (/* binding */ Columns),\n/* harmony export */   bR: () => (/* binding */ OriginalName),\n/* harmony export */   bS: () => (/* binding */ BaseName),\n/* harmony export */   bT: () => (/* binding */ IsAlias),\n/* harmony export */   bU: () => (/* binding */ ExtraConfigBuilder),\n/* harmony export */   bV: () => (/* binding */ isTable),\n/* harmony export */   bW: () => (/* binding */ iife),\n/* harmony export */   ba: () => (/* binding */ or),\n/* harmony export */   bb: () => (/* binding */ not),\n/* harmony export */   bc: () => (/* binding */ gt),\n/* harmony export */   bd: () => (/* binding */ gte),\n/* harmony export */   be: () => (/* binding */ lt),\n/* harmony export */   bf: () => (/* binding */ lte),\n/* harmony export */   bg: () => (/* binding */ inArray),\n/* harmony export */   bh: () => (/* binding */ notInArray),\n/* harmony export */   bi: () => (/* binding */ isNull),\n/* harmony export */   bj: () => (/* binding */ isNotNull),\n/* harmony export */   bk: () => (/* binding */ exists),\n/* harmony export */   bl: () => (/* binding */ notExists),\n/* harmony export */   bm: () => (/* binding */ between),\n/* harmony export */   bn: () => (/* binding */ notBetween),\n/* harmony export */   bo: () => (/* binding */ like),\n/* harmony export */   bp: () => (/* binding */ notLike),\n/* harmony export */   bq: () => (/* binding */ ilike),\n/* harmony export */   br: () => (/* binding */ notIlike),\n/* harmony export */   bs: () => (/* binding */ arrayContains),\n/* harmony export */   bt: () => (/* binding */ arrayContained),\n/* harmony export */   bu: () => (/* binding */ arrayOverlaps),\n/* harmony export */   bv: () => (/* binding */ asc),\n/* harmony export */   bw: () => (/* binding */ desc),\n/* harmony export */   bx: () => (/* binding */ Relation),\n/* harmony export */   by: () => (/* binding */ Relations),\n/* harmony export */   bz: () => (/* binding */ relations),\n/* harmony export */   c: () => (/* binding */ createTableRelationsHelpers),\n/* harmony export */   d: () => (/* binding */ mapUpdateSet),\n/* harmony export */   e: () => (/* binding */ entityKind),\n/* harmony export */   f: () => (/* binding */ fillPlaceholders),\n/* harmony export */   g: () => (/* binding */ mapRelationalRow),\n/* harmony export */   h: () => (/* binding */ QueryBuilder),\n/* harmony export */   i: () => (/* binding */ is),\n/* harmony export */   j: () => (/* binding */ SelectionProxyHandler),\n/* harmony export */   k: () => (/* binding */ PgSelectBuilder),\n/* harmony export */   l: () => (/* binding */ TransactionRollbackError),\n/* harmony export */   m: () => (/* binding */ mapResultRow),\n/* harmony export */   n: () => (/* binding */ TableAliasProxyHandler),\n/* harmony export */   o: () => (/* binding */ orderSelectedFields),\n/* harmony export */   p: () => (/* binding */ Column),\n/* harmony export */   q: () => (/* binding */ getTableName),\n/* harmony export */   r: () => (/* binding */ Subquery),\n/* harmony export */   s: () => (/* binding */ sql),\n/* harmony export */   t: () => (/* binding */ tracer),\n/* harmony export */   u: () => (/* binding */ SubqueryConfig),\n/* harmony export */   v: () => (/* binding */ View),\n/* harmony export */   w: () => (/* binding */ aliasedTableColumn),\n/* harmony export */   x: () => (/* binding */ getOperators),\n/* harmony export */   y: () => (/* binding */ mapColumnsInSQLToAlias),\n/* harmony export */   z: () => (/* binding */ mapColumnsInAliasedSQLToAlias)\n/* harmony export */ });\nconst entityKind = Symbol.for('drizzle:entityKind');\nconst hasOwnEntityKind = Symbol.for('drizzle:hasOwnEntityKind');\nfunction is(value, type) {\n    if (!value || typeof value !== 'object') {\n        return false;\n    }\n    if (value instanceof type) { // eslint-disable-line no-instanceof/no-instanceof\n        return true;\n    }\n    if (!Object.prototype.hasOwnProperty.call(type, entityKind)) {\n        throw new Error(`Class \"${type.name ?? '<unknown>'}\" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);\n    }\n    let cls = value.constructor;\n    if (cls) {\n        // Traverse the prototype chain to find the entityKind\n        while (cls) {\n            if (entityKind in cls && cls[entityKind] === type[entityKind]) {\n                return true;\n            }\n            cls = Object.getPrototypeOf(cls);\n        }\n    }\n    return false;\n}\n\n/*\n    `Column` only accepts a full `ColumnConfig` as its generic.\n    To infer parts of the config, use `AnyColumn` that accepts a partial config.\n    See `GetColumnData` for example usage of inferring.\n*/\nclass Column {\n    table;\n    static [entityKind] = 'Column';\n    name;\n    primary;\n    notNull;\n    default;\n    defaultFn;\n    hasDefault;\n    isUnique;\n    uniqueName;\n    uniqueType;\n    dataType;\n    columnType;\n    enumValues = undefined;\n    config;\n    constructor(table, config) {\n        this.table = table;\n        this.config = config;\n        this.name = config.name;\n        this.notNull = config.notNull;\n        this.default = config.default;\n        this.defaultFn = config.defaultFn;\n        this.hasDefault = config.hasDefault;\n        this.primary = config.primaryKey;\n        this.isUnique = config.isUnique;\n        this.uniqueName = config.uniqueName;\n        this.uniqueType = config.uniqueType;\n        this.dataType = config.dataType;\n        this.columnType = config.columnType;\n    }\n    mapFromDriverValue(value) {\n        return value;\n    }\n    mapToDriverValue(value) {\n        return value;\n    }\n}\n\nconst ViewBaseConfig = Symbol.for('drizzle:ViewBaseConfig');\nclass View {\n    static [entityKind] = 'View';\n    /** @internal */\n    [ViewBaseConfig];\n    constructor({ name, schema, selectedFields, query }) {\n        this[ViewBaseConfig] = {\n            name,\n            originalName: name,\n            schema,\n            selectedFields,\n            query: query,\n            isExisting: !query,\n            isAlias: false,\n        };\n    }\n    getSQL() {\n        return new SQL([this]);\n    }\n}\n\nconst SubqueryConfig = Symbol.for('drizzle:SubqueryConfig');\nclass Subquery {\n    static [entityKind] = 'Subquery';\n    /** @internal */\n    [SubqueryConfig];\n    constructor(sql, selection, alias, isWith = false) {\n        this[SubqueryConfig] = {\n            sql,\n            selection,\n            alias,\n            isWith,\n        };\n    }\n    getSQL() {\n        return new SQL([this]);\n    }\n}\nclass WithSubquery extends Subquery {\n    static [entityKind] = 'WithSubquery';\n}\nclass SelectionProxyHandler {\n    static [entityKind] = 'SelectionProxyHandler';\n    config;\n    constructor(config) {\n        this.config = { ...config };\n    }\n    get(subquery, prop) {\n        if (prop === SubqueryConfig) {\n            return {\n                ...subquery[SubqueryConfig],\n                selection: new Proxy(subquery[SubqueryConfig].selection, this),\n            };\n        }\n        if (prop === ViewBaseConfig) {\n            return {\n                ...subquery[ViewBaseConfig],\n                selectedFields: new Proxy(subquery[ViewBaseConfig].selectedFields, this),\n            };\n        }\n        if (typeof prop === 'symbol') {\n            return subquery[prop];\n        }\n        const columns = is(subquery, Subquery)\n            ? subquery[SubqueryConfig].selection\n            : is(subquery, View)\n                ? subquery[ViewBaseConfig].selectedFields\n                : subquery;\n        const value = columns[prop];\n        if (is(value, SQL.Aliased)) {\n            // Never return the underlying SQL expression for a field previously selected in a subquery\n            if (this.config.sqlAliasedBehavior === 'sql' && !value.isSelectionField) {\n                return value.sql;\n            }\n            const newValue = value.clone();\n            newValue.isSelectionField = true;\n            return newValue;\n        }\n        if (is(value, SQL)) {\n            if (this.config.sqlBehavior === 'sql') {\n                return value;\n            }\n            throw new Error(`You tried to reference \"${prop}\" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using \".as('alias')\" method.`);\n        }\n        if (is(value, Column)) {\n            if (this.config.alias) {\n                return new Proxy(value, new ColumnAliasProxyHandler(new Proxy(value.table, new TableAliasProxyHandler(this.config.alias, this.config.replaceOriginalName ?? false))));\n            }\n            return value;\n        }\n        if (typeof value !== 'object' || value === null) {\n            return value;\n        }\n        return new Proxy(value, new SelectionProxyHandler(this.config));\n    }\n}\n\n/** @internal */\nfunction mapResultRow(columns, row, joinsNotNullableMap) {\n    // Key -> nested object key, value -> table name if all fields in the nested object are from the same table, false otherwise\n    const nullifyMap = {};\n    const result = columns.reduce((result, { path, field }, columnIndex) => {\n        let decoder;\n        if (is(field, Column)) {\n            decoder = field;\n        }\n        else if (is(field, SQL)) {\n            decoder = field.decoder;\n        }\n        else {\n            decoder = field.sql.decoder;\n        }\n        let node = result;\n        for (const [pathChunkIndex, pathChunk] of path.entries()) {\n            if (pathChunkIndex < path.length - 1) {\n                if (!(pathChunk in node)) {\n                    node[pathChunk] = {};\n                }\n                node = node[pathChunk];\n            }\n            else {\n                const rawValue = row[columnIndex];\n                const value = node[pathChunk] = rawValue === null ? null : decoder.mapFromDriverValue(rawValue);\n                if (joinsNotNullableMap && is(field, Column) && path.length === 2) {\n                    const objectName = path[0];\n                    if (!(objectName in nullifyMap)) {\n                        nullifyMap[objectName] = value === null ? getTableName(field.table) : false;\n                    }\n                    else if (typeof nullifyMap[objectName] === 'string' && nullifyMap[objectName] !== getTableName(field.table)) {\n                        nullifyMap[objectName] = false;\n                    }\n                }\n            }\n        }\n        return result;\n    }, {});\n    // Nullify all nested objects from nullifyMap that are nullable\n    if (joinsNotNullableMap && Object.keys(nullifyMap).length > 0) {\n        for (const [objectName, tableName] of Object.entries(nullifyMap)) {\n            if (typeof tableName === 'string' && !joinsNotNullableMap[tableName]) {\n                result[objectName] = null;\n            }\n        }\n    }\n    return result;\n}\n/** @internal */\nfunction orderSelectedFields(fields, pathPrefix) {\n    return Object.entries(fields).reduce((result, [name, field]) => {\n        if (typeof name !== 'string') {\n            return result;\n        }\n        const newPath = pathPrefix ? [...pathPrefix, name] : [name];\n        if (is(field, Column) || is(field, SQL) || is(field, SQL.Aliased)) {\n            result.push({ path: newPath, field });\n        }\n        else if (is(field, Table)) {\n            result.push(...orderSelectedFields(field[Table.Symbol.Columns], newPath));\n        }\n        else {\n            result.push(...orderSelectedFields(field, newPath));\n        }\n        return result;\n    }, []);\n}\n/** @internal */\nfunction mapUpdateSet(table, values) {\n    const entries = Object.entries(values)\n        .filter(([, value]) => value !== undefined)\n        .map(([key, value]) => {\n        // eslint-disable-next-line unicorn/prefer-ternary\n        if (is(value, SQL)) {\n            return [key, value];\n        }\n        else {\n            return [key, new Param(value, table[Table.Symbol.Columns][key])];\n        }\n    });\n    if (entries.length === 0) {\n        throw new Error('No values to set');\n    }\n    return Object.fromEntries(entries);\n}\n/** @internal */\nfunction applyMixins(baseClass, extendedClasses) {\n    for (const extendedClass of extendedClasses) {\n        for (const name of Object.getOwnPropertyNames(extendedClass.prototype)) {\n            Object.defineProperty(baseClass.prototype, name, Object.getOwnPropertyDescriptor(extendedClass.prototype, name) || Object.create(null));\n        }\n    }\n}\nfunction getTableColumns(table) {\n    return table[Table.Symbol.Columns];\n}\n/** @internal */\nfunction getTableLikeName(table) {\n    return is(table, Subquery)\n        ? table[SubqueryConfig].alias\n        : is(table, View)\n            ? table[ViewBaseConfig].name\n            : is(table, SQL)\n                ? undefined\n                : table[Table.Symbol.IsAlias]\n                    ? table[Table.Symbol.Name]\n                    : table[Table.Symbol.BaseName];\n}\nfunction iife(fn, ...args) {\n    return fn(...args);\n}\n\n/** @internal */\nconst TableName = Symbol.for('drizzle:Name');\n/** @internal */\nconst Schema = Symbol.for('drizzle:Schema');\n/** @internal */\nconst Columns = Symbol.for('drizzle:Columns');\n/** @internal */\nconst OriginalName = Symbol.for('drizzle:OriginalName');\n/** @internal */\nconst BaseName = Symbol.for('drizzle:BaseName');\n/** @internal */\nconst IsAlias = Symbol.for('drizzle:IsAlias');\n/** @internal */\nconst ExtraConfigBuilder = Symbol.for('drizzle:ExtraConfigBuilder');\nconst IsDrizzleTable = Symbol.for('drizzle:IsDrizzleTable');\nclass Table {\n    static [entityKind] = 'Table';\n    /** @internal */\n    static Symbol = {\n        Name: TableName,\n        Schema: Schema,\n        OriginalName: OriginalName,\n        Columns: Columns,\n        BaseName: BaseName,\n        IsAlias: IsAlias,\n        ExtraConfigBuilder: ExtraConfigBuilder,\n    };\n    /**\n     * @internal\n     * Can be changed if the table is aliased.\n     */\n    [TableName];\n    /**\n     * @internal\n     * Used to store the original name of the table, before any aliasing.\n     */\n    [OriginalName];\n    /** @internal */\n    [Schema];\n    /** @internal */\n    [Columns];\n    /**\n     *  @internal\n     * Used to store the table name before the transformation via the `tableCreator` functions.\n     */\n    [BaseName];\n    /** @internal */\n    [IsAlias] = false;\n    /** @internal */\n    [ExtraConfigBuilder] = undefined;\n    [IsDrizzleTable] = true;\n    constructor(name, schema, baseName) {\n        this[TableName] = this[OriginalName] = name;\n        this[Schema] = schema;\n        this[BaseName] = baseName;\n    }\n    getSQL() {\n        return new SQL([this]);\n    }\n}\nfunction isTable(table) {\n    return typeof table === 'object' && table !== null && IsDrizzleTable in table;\n}\nfunction getTableName(table) {\n    return table[TableName];\n}\n\nclass QueryPromise {\n    static [entityKind] = 'QueryPromise';\n    [Symbol.toStringTag] = 'QueryPromise';\n    catch(onRejected) {\n        return this.then(undefined, onRejected);\n    }\n    finally(onFinally) {\n        return this.then((value) => {\n            onFinally?.();\n            return value;\n        }, (reason) => {\n            onFinally?.();\n            throw reason;\n        });\n    }\n    then(onFulfilled, onRejected) {\n        return this.execute().then(onFulfilled, onRejected);\n    }\n}\n\n/** @internal */\nconst tracer = {\n    startActiveSpan(name, fn) {\n        {\n            return fn();\n        }\n    },\n};\n\nclass DrizzleError extends Error {\n    static [entityKind] = 'DrizzleError';\n    constructor(message) {\n        super(message);\n        this.name = 'DrizzleError';\n    }\n    static wrap(error, message) {\n        return error instanceof Error // eslint-disable-line no-instanceof/no-instanceof\n            ? new DrizzleError(message ? `${message}: ${error.message}` : error.message)\n            : new DrizzleError(message ?? String(error));\n    }\n}\nclass TransactionRollbackError extends DrizzleError {\n    static [entityKind] = 'TransactionRollbackError';\n    constructor() {\n        super('Rollback');\n    }\n}\n\n/** @internal */\nconst InlineForeignKeys = Symbol.for('drizzle:PgInlineForeignKeys');\nclass PgTable extends Table {\n    static [entityKind] = 'PgTable';\n    /** @internal */\n    static Symbol = Object.assign({}, Table.Symbol, {\n        InlineForeignKeys: InlineForeignKeys,\n    });\n    /**@internal */\n    [InlineForeignKeys] = [];\n    /** @internal */\n    [Table.Symbol.ExtraConfigBuilder] = undefined;\n}\n/** @internal */\nfunction pgTableWithSchema(name, columns, extraConfig, schema, baseName = name) {\n    const rawTable = new PgTable(name, schema, baseName);\n    const builtColumns = Object.fromEntries(Object.entries(columns).map(([name, colBuilderBase]) => {\n        const colBuilder = colBuilderBase;\n        const column = colBuilder.build(rawTable);\n        rawTable[InlineForeignKeys].push(...colBuilder.buildForeignKeys(column, rawTable));\n        return [name, column];\n    }));\n    const table = Object.assign(rawTable, builtColumns);\n    table[Table.Symbol.Columns] = builtColumns;\n    if (extraConfig) {\n        table[PgTable.Symbol.ExtraConfigBuilder] = extraConfig;\n    }\n    return table;\n}\nconst pgTable = (name, columns, extraConfig) => {\n    return pgTableWithSchema(name, columns, extraConfig, undefined);\n};\nfunction pgTableCreator(customizeTableName) {\n    return (name, columns, extraConfig) => {\n        return pgTableWithSchema(customizeTableName(name), columns, extraConfig, undefined, name);\n    };\n}\n\nclass CheckBuilder {\n    name;\n    value;\n    static [entityKind] = 'PgCheckBuilder';\n    brand;\n    constructor(name, value) {\n        this.name = name;\n        this.value = value;\n    }\n    /** @internal */\n    build(table) {\n        return new Check(table, this);\n    }\n}\nclass Check {\n    table;\n    static [entityKind] = 'PgCheck';\n    name;\n    value;\n    constructor(table, builder) {\n        this.table = table;\n        this.name = builder.name;\n        this.value = builder.value;\n    }\n}\nfunction check(name, value) {\n    return new CheckBuilder(name, value);\n}\n\nclass ForeignKeyBuilder {\n    static [entityKind] = 'PgForeignKeyBuilder';\n    /** @internal */\n    reference;\n    /** @internal */\n    _onUpdate = 'no action';\n    /** @internal */\n    _onDelete = 'no action';\n    constructor(config, actions) {\n        this.reference = () => {\n            const { columns, foreignColumns } = config();\n            return { columns, foreignTable: foreignColumns[0].table, foreignColumns };\n        };\n        if (actions) {\n            this._onUpdate = actions.onUpdate;\n            this._onDelete = actions.onDelete;\n        }\n    }\n    onUpdate(action) {\n        this._onUpdate = action === undefined ? 'no action' : action;\n        return this;\n    }\n    onDelete(action) {\n        this._onDelete = action === undefined ? 'no action' : action;\n        return this;\n    }\n    /** @internal */\n    build(table) {\n        return new ForeignKey(table, this);\n    }\n}\nclass ForeignKey {\n    table;\n    static [entityKind] = 'PgForeignKey';\n    reference;\n    onUpdate;\n    onDelete;\n    constructor(table, builder) {\n        this.table = table;\n        this.reference = builder.reference;\n        this.onUpdate = builder._onUpdate;\n        this.onDelete = builder._onDelete;\n    }\n    getName() {\n        const { columns, foreignColumns } = this.reference();\n        const columnNames = columns.map((column) => column.name);\n        const foreignColumnNames = foreignColumns.map((column) => column.name);\n        const chunks = [\n            this.table[PgTable.Symbol.Name],\n            ...columnNames,\n            foreignColumns[0].table[PgTable.Symbol.Name],\n            ...foreignColumnNames,\n        ];\n        return `${chunks.join('_')}_fk`;\n    }\n}\nfunction foreignKey(config) {\n    function mappedConfig() {\n        const { columns, foreignColumns } = config;\n        return {\n            columns,\n            foreignColumns,\n        };\n    }\n    return new ForeignKeyBuilder(mappedConfig);\n}\n\nclass IndexBuilderOn {\n    unique;\n    name;\n    static [entityKind] = 'PgIndexBuilderOn';\n    constructor(unique, name) {\n        this.unique = unique;\n        this.name = name;\n    }\n    on(...columns) {\n        return new IndexBuilder(columns, this.unique, false, this.name);\n    }\n    onOnly(...columns) {\n        return new IndexBuilder(columns, this.unique, true, this.name);\n    }\n}\nclass IndexBuilder {\n    static [entityKind] = 'PgIndexBuilder';\n    /** @internal */\n    config;\n    constructor(columns, unique, only, name) {\n        this.config = {\n            name,\n            columns,\n            unique,\n            only,\n        };\n    }\n    concurrently() {\n        this.config.concurrently = true;\n        return this;\n    }\n    using(method) {\n        this.config.using = method;\n        return this;\n    }\n    asc() {\n        this.config.order = 'asc';\n        return this;\n    }\n    desc() {\n        this.config.order = 'desc';\n        return this;\n    }\n    nullsFirst() {\n        this.config.nulls = 'first';\n        return this;\n    }\n    nullsLast() {\n        this.config.nulls = 'last';\n        return this;\n    }\n    where(condition) {\n        this.config.where = condition;\n        return this;\n    }\n    /** @internal */\n    build(table) {\n        return new Index(this.config, table);\n    }\n}\nclass Index {\n    static [entityKind] = 'PgIndex';\n    config;\n    constructor(config, table) {\n        this.config = { ...config, table };\n    }\n}\nfunction index(name) {\n    return new IndexBuilderOn(false, name);\n}\nfunction uniqueIndex(name) {\n    return new IndexBuilderOn(true, name);\n}\n\nfunction primaryKey(...columns) {\n    return new PrimaryKeyBuilder(columns);\n}\nclass PrimaryKeyBuilder {\n    static [entityKind] = 'PgPrimaryKeyBuilder';\n    /** @internal */\n    columns;\n    constructor(columns) {\n        this.columns = columns;\n    }\n    /** @internal */\n    build(table) {\n        return new PrimaryKey(table, this.columns);\n    }\n}\nclass PrimaryKey {\n    table;\n    static [entityKind] = 'PgPrimaryKey';\n    columns;\n    constructor(table, columns) {\n        this.table = table;\n        this.columns = columns;\n    }\n    getName() {\n        return `${this.table[PgTable.Symbol.Name]}_${this.columns.map((column) => column.name).join('_')}_pk`;\n    }\n}\n\nfunction unique(name) {\n    return new UniqueOnConstraintBuilder(name);\n}\nfunction uniqueKeyName(table, columns) {\n    return `${table[PgTable.Symbol.Name]}_${columns.join('_')}_unique`;\n}\nclass UniqueConstraintBuilder {\n    name;\n    static [entityKind] = 'PgUniqueConstraintBuilder';\n    /** @internal */\n    columns;\n    /** @internal */\n    nullsNotDistinctConfig = false;\n    constructor(columns, name) {\n        this.name = name;\n        this.columns = columns;\n    }\n    nullsNotDistinct() {\n        this.nullsNotDistinctConfig = true;\n        return this;\n    }\n    /** @internal */\n    build(table) {\n        return new UniqueConstraint(table, this.columns, this.nullsNotDistinctConfig, this.name);\n    }\n}\nclass UniqueOnConstraintBuilder {\n    static [entityKind] = 'PgUniqueOnConstraintBuilder';\n    /** @internal */\n    name;\n    constructor(name) {\n        this.name = name;\n    }\n    on(...columns) {\n        return new UniqueConstraintBuilder(columns, this.name);\n    }\n}\nclass UniqueConstraint {\n    table;\n    static [entityKind] = 'PgUniqueConstraint';\n    columns;\n    name;\n    nullsNotDistinct = false;\n    constructor(table, columns, nullsNotDistinct, name) {\n        this.table = table;\n        this.columns = columns;\n        this.name = name ?? uniqueKeyName(this.table, this.columns.map((column) => column.name));\n        this.nullsNotDistinct = nullsNotDistinct;\n    }\n    getName() {\n        return this.name;\n    }\n}\n\nfunction getTableConfig(table) {\n    const columns = Object.values(table[Table.Symbol.Columns]);\n    const indexes = [];\n    const checks = [];\n    const primaryKeys = [];\n    const foreignKeys = Object.values(table[PgTable.Symbol.InlineForeignKeys]);\n    const uniqueConstraints = [];\n    const name = table[Table.Symbol.Name];\n    const schema = table[Table.Symbol.Schema];\n    const extraConfigBuilder = table[PgTable.Symbol.ExtraConfigBuilder];\n    if (extraConfigBuilder !== undefined) {\n        const extraConfig = extraConfigBuilder(table[Table.Symbol.Columns]);\n        for (const builder of Object.values(extraConfig)) {\n            if (is(builder, IndexBuilder)) {\n                indexes.push(builder.build(table));\n            }\n            else if (is(builder, CheckBuilder)) {\n                checks.push(builder.build(table));\n            }\n            else if (is(builder, UniqueConstraintBuilder)) {\n                uniqueConstraints.push(builder.build(table));\n            }\n            else if (is(builder, PrimaryKeyBuilder)) {\n                primaryKeys.push(builder.build(table));\n            }\n            else if (is(builder, ForeignKeyBuilder)) {\n                foreignKeys.push(builder.build(table));\n            }\n        }\n    }\n    return {\n        columns,\n        indexes,\n        foreignKeys,\n        checks,\n        primaryKeys,\n        uniqueConstraints,\n        name,\n        schema,\n    };\n}\nfunction getViewConfig(view) {\n    return {\n        ...view[ViewBaseConfig],\n        ...view[PgViewConfig],\n    };\n}\nfunction getMaterializedViewConfig(view) {\n    return {\n        ...view[ViewBaseConfig],\n        ...view[PgMaterializedViewConfig],\n    };\n}\nfunction parsePgArrayValue(arrayString, startFrom, inQuotes) {\n    for (let i = startFrom; i < arrayString.length; i++) {\n        const char = arrayString[i];\n        if (char === '\\\\') {\n            i++;\n            continue;\n        }\n        if (char === '\"') {\n            return [arrayString.slice(startFrom, i).replace(/\\\\/g, ''), i + 1];\n        }\n        if (inQuotes) {\n            continue;\n        }\n        if (char === ',' || char === '}') {\n            return [arrayString.slice(startFrom, i).replace(/\\\\/g, ''), i];\n        }\n    }\n    return [arrayString.slice(startFrom).replace(/\\\\/g, ''), arrayString.length];\n}\nfunction parsePgNestedArray(arrayString, startFrom = 0) {\n    const result = [];\n    let i = startFrom;\n    let lastCharIsComma = false;\n    while (i < arrayString.length) {\n        const char = arrayString[i];\n        if (char === ',') {\n            if (lastCharIsComma || i === startFrom) {\n                result.push('');\n            }\n            lastCharIsComma = true;\n            i++;\n            continue;\n        }\n        lastCharIsComma = false;\n        if (char === '\\\\') {\n            i += 2;\n            continue;\n        }\n        if (char === '\"') {\n            const [value, startFrom] = parsePgArrayValue(arrayString, i + 1, true);\n            result.push(value);\n            i = startFrom;\n            continue;\n        }\n        if (char === '}') {\n            return [result, i + 1];\n        }\n        if (char === '{') {\n            const [value, startFrom] = parsePgNestedArray(arrayString, i + 1);\n            result.push(value);\n            i = startFrom;\n            continue;\n        }\n        const [value, newStartFrom] = parsePgArrayValue(arrayString, i, false);\n        result.push(value);\n        i = newStartFrom;\n    }\n    return [result, i];\n}\nfunction parsePgArray(arrayString) {\n    const [result] = parsePgNestedArray(arrayString, 1);\n    return result;\n}\nfunction makePgArray(array) {\n    return `{${array.map((item) => {\n        if (Array.isArray(item)) {\n            return makePgArray(item);\n        }\n        if (typeof item === 'string' && item.includes(',')) {\n            return `\"${item.replace(/\"/g, '\\\\\"')}\"`;\n        }\n        return `${item}`;\n    }).join(',')}}`;\n}\n\n// To understand how to use `ColumnBuilder` and `AnyColumnBuilder`, see `Column` and `AnyColumn` documentation.\nclass ColumnBuilder {\n    static [entityKind] = 'ColumnBuilder';\n    config;\n    constructor(name, dataType, columnType) {\n        this.config = {\n            name,\n            notNull: false,\n            default: undefined,\n            hasDefault: false,\n            primaryKey: false,\n            isUnique: false,\n            uniqueName: undefined,\n            uniqueType: undefined,\n            dataType,\n            columnType,\n        };\n    }\n    /**\n     * Changes the data type of the column. Commonly used with `json` columns. Also, useful for branded types.\n     *\n     * @example\n     * ```ts\n     * const users = pgTable('users', {\n     * \tid: integer('id').$type<UserId>().primaryKey(),\n     * \tdetails: json('details').$type<UserDetails>().notNull(),\n     * });\n     * ```\n     */\n    $type() {\n        return this;\n    }\n    /**\n     * Adds a `not null` clause to the column definition.\n     *\n     * Affects the `select` model of the table - columns *without* `not null` will be nullable on select.\n     */\n    notNull() {\n        this.config.notNull = true;\n        return this;\n    }\n    /**\n     * Adds a `default <value>` clause to the column definition.\n     *\n     * Affects the `insert` model of the table - columns *with* `default` are optional on insert.\n     *\n     * If you need to set a dynamic default value, use {@link $defaultFn} instead.\n     */\n    default(value) {\n        this.config.default = value;\n        this.config.hasDefault = true;\n        return this;\n    }\n    /**\n     * Adds a dynamic default value to the column.\n     * The function will be called when the row is inserted, and the returned value will be used as the column value.\n     *\n     * **Note:** This value does not affect the `drizzle-kit` behavior, it is only used at runtime in `drizzle-orm`.\n     */\n    $defaultFn(fn) {\n        this.config.defaultFn = fn;\n        this.config.hasDefault = true;\n        return this;\n    }\n    /**\n     * Alias for {@link $defaultFn}.\n     */\n    $default = this.$defaultFn;\n    /**\n     * Adds a `primary key` clause to the column definition. This implicitly makes the column `not null`.\n     *\n     * In SQLite, `integer primary key` implicitly makes the column auto-incrementing.\n     */\n    primaryKey() {\n        this.config.primaryKey = true;\n        this.config.notNull = true;\n        return this;\n    }\n}\n\nclass PgColumnBuilder extends ColumnBuilder {\n    foreignKeyConfigs = [];\n    static [entityKind] = 'PgColumnBuilder';\n    array(size) {\n        return new PgArrayBuilder(this.config.name, this, size);\n    }\n    references(ref, actions = {}) {\n        this.foreignKeyConfigs.push({ ref, actions });\n        return this;\n    }\n    unique(name, config) {\n        this.config.isUnique = true;\n        this.config.uniqueName = name;\n        this.config.uniqueType = config?.nulls;\n        return this;\n    }\n    /** @internal */\n    buildForeignKeys(column, table) {\n        return this.foreignKeyConfigs.map(({ ref, actions }) => {\n            return iife((ref, actions) => {\n                const builder = new ForeignKeyBuilder(() => {\n                    const foreignColumn = ref();\n                    return { columns: [column], foreignColumns: [foreignColumn] };\n                });\n                if (actions.onUpdate) {\n                    builder.onUpdate(actions.onUpdate);\n                }\n                if (actions.onDelete) {\n                    builder.onDelete(actions.onDelete);\n                }\n                return builder.build(table);\n            }, ref, actions);\n        });\n    }\n}\n// To understand how to use `PgColumn` and `PgColumn`, see `Column` and `AnyColumn` documentation.\nclass PgColumn extends Column {\n    table;\n    static [entityKind] = 'PgColumn';\n    constructor(table, config) {\n        if (!config.uniqueName) {\n            config.uniqueName = uniqueKeyName(table, [config.name]);\n        }\n        super(table, config);\n        this.table = table;\n    }\n}\n\nclass PgArrayBuilder extends PgColumnBuilder {\n    static [entityKind] = 'PgArrayBuilder';\n    constructor(name, baseBuilder, size) {\n        super(name, 'array', 'PgArray');\n        this.config.baseBuilder = baseBuilder;\n        this.config.size = size;\n    }\n    /** @internal */\n    build(table) {\n        const baseColumn = this.config.baseBuilder.build(table);\n        return new PgArray(table, this.config, baseColumn);\n    }\n}\nclass PgArray extends PgColumn {\n    baseColumn;\n    range;\n    size;\n    static [entityKind] = 'PgArray';\n    constructor(table, config, baseColumn, range) {\n        super(table, config);\n        this.baseColumn = baseColumn;\n        this.range = range;\n        this.size = config.size;\n    }\n    getSQLType() {\n        return `${this.baseColumn.getSQLType()}[${typeof this.size === 'number' ? this.size : ''}]`;\n    }\n    mapFromDriverValue(value) {\n        if (typeof value === 'string') {\n            // Thank you node-postgres for not parsing enum arrays\n            value = parsePgArray(value);\n        }\n        return value.map((v) => this.baseColumn.mapFromDriverValue(v));\n    }\n    mapToDriverValue(value, isNestedArray = false) {\n        const a = value.map((v) => v === null\n            ? null\n            : is(this.baseColumn, PgArray)\n                ? this.baseColumn.mapToDriverValue(v, true)\n                : this.baseColumn.mapToDriverValue(v));\n        if (isNestedArray)\n            return a;\n        return makePgArray(a);\n    }\n}\n\nclass PgDateColumnBaseBuilder extends PgColumnBuilder {\n    static [entityKind] = 'PgDateColumnBaseBuilder';\n    defaultNow() {\n        return this.default(sql `now()`);\n    }\n}\n\nclass PgDateBuilder extends PgDateColumnBaseBuilder {\n    static [entityKind] = 'PgDateBuilder';\n    constructor(name) {\n        super(name, 'date', 'PgDate');\n    }\n    /** @internal */\n    build(table) {\n        return new PgDate(table, this.config);\n    }\n}\nclass PgDate extends PgColumn {\n    static [entityKind] = 'PgDate';\n    getSQLType() {\n        return 'date';\n    }\n    mapFromDriverValue(value) {\n        return new Date(value);\n    }\n    mapToDriverValue(value) {\n        return value.toISOString();\n    }\n}\nclass PgDateStringBuilder extends PgDateColumnBaseBuilder {\n    static [entityKind] = 'PgDateStringBuilder';\n    constructor(name) {\n        super(name, 'string', 'PgDateString');\n    }\n    /** @internal */\n    build(table) {\n        return new PgDateString(table, this.config);\n    }\n}\nclass PgDateString extends PgColumn {\n    static [entityKind] = 'PgDateString';\n    getSQLType() {\n        return 'date';\n    }\n}\nfunction date(name, config) {\n    if (config?.mode === 'date') {\n        return new PgDateBuilder(name);\n    }\n    return new PgDateStringBuilder(name);\n}\n\nclass PgJsonBuilder extends PgColumnBuilder {\n    static [entityKind] = 'PgJsonBuilder';\n    constructor(name) {\n        super(name, 'json', 'PgJson');\n    }\n    /** @internal */\n    build(table) {\n        return new PgJson(table, this.config);\n    }\n}\nclass PgJson extends PgColumn {\n    static [entityKind] = 'PgJson';\n    constructor(table, config) {\n        super(table, config);\n    }\n    getSQLType() {\n        return 'json';\n    }\n    mapToDriverValue(value) {\n        return JSON.stringify(value);\n    }\n    mapFromDriverValue(value) {\n        if (typeof value === 'string') {\n            try {\n                return JSON.parse(value);\n            }\n            catch {\n                return value;\n            }\n        }\n        return value;\n    }\n}\nfunction json(name) {\n    return new PgJsonBuilder(name);\n}\n\nclass PgJsonbBuilder extends PgColumnBuilder {\n    static [entityKind] = 'PgJsonbBuilder';\n    constructor(name) {\n        super(name, 'json', 'PgJsonb');\n    }\n    /** @internal */\n    build(table) {\n        return new PgJsonb(table, this.config);\n    }\n}\nclass PgJsonb extends PgColumn {\n    static [entityKind] = 'PgJsonb';\n    constructor(table, config) {\n        super(table, config);\n    }\n    getSQLType() {\n        return 'jsonb';\n    }\n    mapToDriverValue(value) {\n        return JSON.stringify(value);\n    }\n    mapFromDriverValue(value) {\n        if (typeof value === 'string') {\n            try {\n                return JSON.parse(value);\n            }\n            catch {\n                return value;\n            }\n        }\n        return value;\n    }\n}\nfunction jsonb(name) {\n    return new PgJsonbBuilder(name);\n}\n\nclass PgNumericBuilder extends PgColumnBuilder {\n    static [entityKind] = 'PgNumericBuilder';\n    constructor(name, precision, scale) {\n        super(name, 'string', 'PgNumeric');\n        this.config.precision = precision;\n        this.config.scale = scale;\n    }\n    /** @internal */\n    build(table) {\n        return new PgNumeric(table, this.config);\n    }\n}\nclass PgNumeric extends PgColumn {\n    static [entityKind] = 'PgNumeric';\n    precision;\n    scale;\n    constructor(table, config) {\n        super(table, config);\n        this.precision = config.precision;\n        this.scale = config.scale;\n    }\n    getSQLType() {\n        if (this.precision !== undefined && this.scale !== undefined) {\n            return `numeric(${this.precision}, ${this.scale})`;\n        }\n        else if (this.precision === undefined) {\n            return 'numeric';\n        }\n        else {\n            return `numeric(${this.precision})`;\n        }\n    }\n}\nfunction numeric(name, config) {\n    return new PgNumericBuilder(name, config?.precision, config?.scale);\n}\nconst decimal = numeric;\n\nclass PgTimeBuilder extends PgDateColumnBaseBuilder {\n    withTimezone;\n    precision;\n    static [entityKind] = 'PgTimeBuilder';\n    constructor(name, withTimezone, precision) {\n        super(name, 'string', 'PgTime');\n        this.withTimezone = withTimezone;\n        this.precision = precision;\n        this.config.withTimezone = withTimezone;\n        this.config.precision = precision;\n    }\n    /** @internal */\n    build(table) {\n        return new PgTime(table, this.config);\n    }\n}\nclass PgTime extends PgColumn {\n    static [entityKind] = 'PgTime';\n    withTimezone;\n    precision;\n    constructor(table, config) {\n        super(table, config);\n        this.withTimezone = config.withTimezone;\n        this.precision = config.precision;\n    }\n    getSQLType() {\n        const precision = this.precision === undefined ? '' : `(${this.precision})`;\n        return `time${precision}${this.withTimezone ? ' with time zone' : ''}`;\n    }\n}\nfunction time(name, config = {}) {\n    return new PgTimeBuilder(name, config.withTimezone ?? false, config.precision);\n}\n\nclass PgTimestampBuilder extends PgDateColumnBaseBuilder {\n    static [entityKind] = 'PgTimestampBuilder';\n    constructor(name, withTimezone, precision) {\n        super(name, 'date', 'PgTimestamp');\n        this.config.withTimezone = withTimezone;\n        this.config.precision = precision;\n    }\n    /** @internal */\n    build(table) {\n        return new PgTimestamp(table, this.config);\n    }\n}\nclass PgTimestamp extends PgColumn {\n    static [entityKind] = 'PgTimestamp';\n    withTimezone;\n    precision;\n    constructor(table, config) {\n        super(table, config);\n        this.withTimezone = config.withTimezone;\n        this.precision = config.precision;\n    }\n    getSQLType() {\n        const precision = this.precision === undefined ? '' : ` (${this.precision})`;\n        return `timestamp${precision}${this.withTimezone ? ' with time zone' : ''}`;\n    }\n    mapFromDriverValue = (value) => {\n        return new Date(this.withTimezone ? value : value + '+0000');\n    };\n    mapToDriverValue = (value) => {\n        return this.withTimezone ? value.toUTCString() : value.toISOString();\n    };\n}\nclass PgTimestampStringBuilder extends PgDateColumnBaseBuilder {\n    static [entityKind] = 'PgTimestampStringBuilder';\n    constructor(name, withTimezone, precision) {\n        super(name, 'string', 'PgTimestampString');\n        this.config.withTimezone = withTimezone;\n        this.config.precision = precision;\n    }\n    /** @internal */\n    build(table) {\n        return new PgTimestampString(table, this.config);\n    }\n}\nclass PgTimestampString extends PgColumn {\n    static [entityKind] = 'PgTimestampString';\n    withTimezone;\n    precision;\n    constructor(table, config) {\n        super(table, config);\n        this.withTimezone = config.withTimezone;\n        this.precision = config.precision;\n    }\n    getSQLType() {\n        const precision = this.precision === undefined ? '' : `(${this.precision})`;\n        return `timestamp${precision}${this.withTimezone ? ' with time zone' : ''}`;\n    }\n}\nfunction timestamp(name, config = {}) {\n    if (config.mode === 'string') {\n        return new PgTimestampStringBuilder(name, config.withTimezone ?? false, config.precision);\n    }\n    return new PgTimestampBuilder(name, config.withTimezone ?? false, config.precision);\n}\n\nclass PgUUIDBuilder extends PgColumnBuilder {\n    static [entityKind] = 'PgUUIDBuilder';\n    constructor(name) {\n        super(name, 'string', 'PgUUID');\n    }\n    /**\n     * Adds `default gen_random_uuid()` to the column definition.\n     */\n    defaultRandom() {\n        return this.default(sql `gen_random_uuid()`);\n    }\n    /** @internal */\n    build(table) {\n        return new PgUUID(table, this.config);\n    }\n}\nclass PgUUID extends PgColumn {\n    static [entityKind] = 'PgUUID';\n    getSQLType() {\n        return 'uuid';\n    }\n}\nfunction uuid(name) {\n    return new PgUUIDBuilder(name);\n}\n\nclass PgDialect {\n    static [entityKind] = 'PgDialect';\n    async migrate(migrations, session) {\n        const migrationTableCreate = sql `\n\t\t\tCREATE TABLE IF NOT EXISTS \"drizzle\".\"__drizzle_migrations\" (\n\t\t\t\tid SERIAL PRIMARY KEY,\n\t\t\t\thash text NOT NULL,\n\t\t\t\tcreated_at bigint\n\t\t\t)\n\t\t`;\n        await session.execute(sql `CREATE SCHEMA IF NOT EXISTS \"drizzle\"`);\n        await session.execute(migrationTableCreate);\n        const dbMigrations = await session.all(sql `select id, hash, created_at from \"drizzle\".\"__drizzle_migrations\" order by created_at desc limit 1`);\n        const lastDbMigration = dbMigrations[0];\n        await session.transaction(async (tx) => {\n            for await (const migration of migrations) {\n                if (!lastDbMigration\n                    || Number(lastDbMigration.created_at) < migration.folderMillis) {\n                    for (const stmt of migration.sql) {\n                        await tx.execute(sql.raw(stmt));\n                    }\n                    await tx.execute(sql `insert into \"drizzle\".\"__drizzle_migrations\" (\"hash\", \"created_at\") values(${migration.hash}, ${migration.folderMillis})`);\n                }\n            }\n        });\n    }\n    escapeName(name) {\n        return `\"${name}\"`;\n    }\n    escapeParam(num) {\n        return `$${num + 1}`;\n    }\n    escapeString(str) {\n        return `'${str.replace(/'/g, \"''\")}'`;\n    }\n    buildDeleteQuery({ table, where, returning }) {\n        const returningSql = returning\n            ? sql ` returning ${this.buildSelection(returning, { isSingleTable: true })}`\n            : undefined;\n        const whereSql = where ? sql ` where ${where}` : undefined;\n        return sql `delete from ${table}${whereSql}${returningSql}`;\n    }\n    buildUpdateSet(table, set) {\n        const setEntries = Object.entries(set);\n        const setSize = setEntries.length;\n        return sql.join(setEntries\n            .flatMap(([colName, value], i) => {\n            const col = table[Table.Symbol.Columns][colName];\n            const res = sql `${sql.identifier(col.name)} = ${value}`;\n            if (i < setSize - 1) {\n                return [res, sql.raw(', ')];\n            }\n            return [res];\n        }));\n    }\n    buildUpdateQuery({ table, set, where, returning }) {\n        const setSql = this.buildUpdateSet(table, set);\n        const returningSql = returning\n            ? sql ` returning ${this.buildSelection(returning, { isSingleTable: true })}`\n            : undefined;\n        const whereSql = where ? sql ` where ${where}` : undefined;\n        return sql `update ${table} set ${setSql}${whereSql}${returningSql}`;\n    }\n    /**\n     * Builds selection SQL with provided fields/expressions\n     *\n     * Examples:\n     *\n     * `select <selection> from`\n     *\n     * `insert ... returning <selection>`\n     *\n     * If `isSingleTable` is true, then columns won't be prefixed with table name\n     */\n    buildSelection(fields, { isSingleTable = false } = {}) {\n        const columnsLen = fields.length;\n        const chunks = fields\n            .flatMap(({ field }, i) => {\n            const chunk = [];\n            if (is(field, SQL.Aliased) && field.isSelectionField) {\n                chunk.push(sql.identifier(field.fieldAlias));\n            }\n            else if (is(field, SQL.Aliased) || is(field, SQL)) {\n                const query = is(field, SQL.Aliased) ? field.sql : field;\n                if (isSingleTable) {\n                    chunk.push(new SQL(query.queryChunks.map((c) => {\n                        if (is(c, PgColumn)) {\n                            return sql.identifier(c.name);\n                        }\n                        return c;\n                    })));\n                }\n                else {\n                    chunk.push(query);\n                }\n                if (is(field, SQL.Aliased)) {\n                    chunk.push(sql ` as ${sql.identifier(field.fieldAlias)}`);\n                }\n            }\n            else if (is(field, Column)) {\n                if (isSingleTable) {\n                    chunk.push(sql.identifier(field.name));\n                }\n                else {\n                    chunk.push(field);\n                }\n            }\n            if (i < columnsLen - 1) {\n                chunk.push(sql `, `);\n            }\n            return chunk;\n        });\n        return sql.join(chunks);\n    }\n    buildSelectQuery({ withList, fields, fieldsFlat, where, having, table, joins, orderBy, groupBy, limit, offset, lockingClauses, distinct, }) {\n        const fieldsList = fieldsFlat ?? orderSelectedFields(fields);\n        for (const f of fieldsList) {\n            if (is(f.field, Column)\n                && getTableName(f.field.table)\n                    !== (is(table, Subquery)\n                        ? table[SubqueryConfig].alias\n                        : is(table, PgViewBase)\n                            ? table[ViewBaseConfig].name\n                            : is(table, SQL)\n                                ? undefined\n                                : getTableName(table))\n                && !((table) => joins?.some(({ alias }) => alias === (table[Table.Symbol.IsAlias] ? getTableName(table) : table[Table.Symbol.BaseName])))(f.field.table)) {\n                const tableName = getTableName(f.field.table);\n                throw new Error(`Your \"${f.path.join('->')}\" field references a column \"${tableName}\".\"${f.field.name}\", but the table \"${tableName}\" is not part of the query! Did you forget to join it?`);\n            }\n        }\n        const isSingleTable = !joins || joins.length === 0;\n        let withSql;\n        if (withList?.length) {\n            const withSqlChunks = [sql `with `];\n            for (const [i, w] of withList.entries()) {\n                withSqlChunks.push(sql `${sql.identifier(w[SubqueryConfig].alias)} as (${w[SubqueryConfig].sql})`);\n                if (i < withList.length - 1) {\n                    withSqlChunks.push(sql `, `);\n                }\n            }\n            withSqlChunks.push(sql ` `);\n            withSql = sql.join(withSqlChunks);\n        }\n        let distinctSql;\n        if (distinct) {\n            distinctSql = distinct === true ? sql ` distinct` : sql ` distinct on (${sql.join(distinct.on, ', ')})`;\n        }\n        const selection = this.buildSelection(fieldsList, { isSingleTable });\n        const tableSql = (() => {\n            if (is(table, Table) && table[Table.Symbol.OriginalName] !== table[Table.Symbol.Name]) {\n                let fullName = sql `${sql.identifier(table[Table.Symbol.OriginalName])}`;\n                if (table[Table.Symbol.Schema]) {\n                    fullName = sql `${sql.identifier(table[Table.Symbol.Schema])}.${fullName}`;\n                }\n                return sql `${fullName} ${sql.identifier(table[Table.Symbol.Name])}`;\n            }\n            return table;\n        })();\n        const joinsArray = [];\n        if (joins) {\n            for (const [index, joinMeta] of joins.entries()) {\n                if (index === 0) {\n                    joinsArray.push(sql ` `);\n                }\n                const table = joinMeta.table;\n                const lateralSql = joinMeta.lateral ? sql ` lateral` : undefined;\n                if (is(table, PgTable)) {\n                    const tableName = table[PgTable.Symbol.Name];\n                    const tableSchema = table[PgTable.Symbol.Schema];\n                    const origTableName = table[PgTable.Symbol.OriginalName];\n                    const alias = tableName === origTableName ? undefined : joinMeta.alias;\n                    joinsArray.push(sql `${sql.raw(joinMeta.joinType)} join${lateralSql} ${tableSchema ? sql `${sql.identifier(tableSchema)}.` : undefined}${sql.identifier(origTableName)}${alias && sql ` ${sql.identifier(alias)}`} on ${joinMeta.on}`);\n                }\n                else if (is(table, View)) {\n                    const viewName = table[ViewBaseConfig].name;\n                    const viewSchema = table[ViewBaseConfig].schema;\n                    const origViewName = table[ViewBaseConfig].originalName;\n                    const alias = viewName === origViewName ? undefined : joinMeta.alias;\n                    joinsArray.push(sql `${sql.raw(joinMeta.joinType)} join${lateralSql} ${viewSchema ? sql `${sql.identifier(viewSchema)}.` : undefined}${sql.identifier(origViewName)}${alias && sql ` ${sql.identifier(alias)}`} on ${joinMeta.on}`);\n                }\n                else {\n                    joinsArray.push(sql `${sql.raw(joinMeta.joinType)} join${lateralSql} ${table} on ${joinMeta.on}`);\n                }\n                if (index < joins.length - 1) {\n                    joinsArray.push(sql ` `);\n                }\n            }\n        }\n        const joinsSql = sql.join(joinsArray);\n        const whereSql = where ? sql ` where ${where}` : undefined;\n        const havingSql = having ? sql ` having ${having}` : undefined;\n        let orderBySql;\n        if (orderBy && orderBy.length > 0) {\n            orderBySql = sql ` order by ${sql.join(orderBy, sql `, `)}`;\n        }\n        let groupBySql;\n        if (groupBy && groupBy.length > 0) {\n            groupBySql = sql ` group by ${sql.join(groupBy, sql `, `)}`;\n        }\n        const limitSql = limit ? sql ` limit ${limit}` : undefined;\n        const offsetSql = offset ? sql ` offset ${offset}` : undefined;\n        const lockingClausesSql = sql.empty();\n        if (lockingClauses) {\n            for (const { strength, config } of lockingClauses) {\n                const clauseSql = sql ` for ${sql.raw(strength)}`;\n                if (config.of) {\n                    clauseSql.append(sql ` of ${config.of}`);\n                }\n                if (config.noWait) {\n                    clauseSql.append(sql ` no wait`);\n                }\n                else if (config.skipLocked) {\n                    clauseSql.append(sql ` skip locked`);\n                }\n                lockingClausesSql.append(clauseSql);\n            }\n        }\n        return sql `${withSql}select${distinctSql} ${selection} from ${tableSql}${joinsSql}${whereSql}${groupBySql}${havingSql}${orderBySql}${limitSql}${offsetSql}${lockingClausesSql}`;\n    }\n    buildInsertQuery({ table, values, onConflict, returning }) {\n        const valuesSqlList = [];\n        const columns = table[Table.Symbol.Columns];\n        const colEntries = Object.entries(columns);\n        const insertOrder = colEntries.map(([, column]) => sql.identifier(column.name));\n        for (const [valueIndex, value] of values.entries()) {\n            const valueList = [];\n            for (const [fieldName, col] of colEntries) {\n                const colValue = value[fieldName];\n                if (colValue === undefined || (is(colValue, Param) && colValue.value === undefined)) {\n                    // eslint-disable-next-line unicorn/no-negated-condition\n                    if (col.defaultFn !== undefined) {\n                        const defaultFnResult = col.defaultFn();\n                        const defaultValue = is(defaultFnResult, SQL) ? defaultFnResult : sql.param(defaultFnResult, col);\n                        valueList.push(defaultValue);\n                    }\n                    else {\n                        valueList.push(sql `default`);\n                    }\n                }\n                else {\n                    valueList.push(colValue);\n                }\n            }\n            valuesSqlList.push(valueList);\n            if (valueIndex < values.length - 1) {\n                valuesSqlList.push(sql `, `);\n            }\n        }\n        const valuesSql = sql.join(valuesSqlList);\n        const returningSql = returning\n            ? sql ` returning ${this.buildSelection(returning, { isSingleTable: true })}`\n            : undefined;\n        const onConflictSql = onConflict ? sql ` on conflict ${onConflict}` : undefined;\n        return sql `insert into ${table} ${insertOrder} values ${valuesSql}${onConflictSql}${returningSql}`;\n    }\n    buildRefreshMaterializedViewQuery({ view, concurrently, withNoData }) {\n        const concurrentlySql = concurrently ? sql ` concurrently` : undefined;\n        const withNoDataSql = withNoData ? sql ` with no data` : undefined;\n        return sql `refresh materialized view${concurrentlySql} ${view}${withNoDataSql}`;\n    }\n    prepareTyping(encoder) {\n        if (is(encoder, PgJsonb) || is(encoder, PgJson)) {\n            return 'json';\n        }\n        else if (is(encoder, PgNumeric)) {\n            return 'decimal';\n        }\n        else if (is(encoder, PgTime)) {\n            return 'time';\n        }\n        else if (is(encoder, PgTimestamp)) {\n            return 'timestamp';\n        }\n        else if (is(encoder, PgDate)) {\n            return 'date';\n        }\n        else if (is(encoder, PgUUID)) {\n            return 'uuid';\n        }\n        else {\n            return 'none';\n        }\n    }\n    sqlToQuery(sql) {\n        return sql.toQuery({\n            escapeName: this.escapeName,\n            escapeParam: this.escapeParam,\n            escapeString: this.escapeString,\n            prepareTyping: this.prepareTyping,\n        });\n    }\n    // buildRelationalQueryWithPK({\n    // \tfullSchema,\n    // \tschema,\n    // \ttableNamesMap,\n    // \ttable,\n    // \ttableConfig,\n    // \tqueryConfig: config,\n    // \ttableAlias,\n    // \tisRoot = false,\n    // \tjoinOn,\n    // }: {\n    // \tfullSchema: Record<string, unknown>;\n    // \tschema: TablesRelationalConfig;\n    // \ttableNamesMap: Record<string, string>;\n    // \ttable: PgTable;\n    // \ttableConfig: TableRelationalConfig;\n    // \tqueryConfig: true | DBQueryConfig<'many', true>;\n    // \ttableAlias: string;\n    // \tisRoot?: boolean;\n    // \tjoinOn?: SQL;\n    // }): BuildRelationalQueryResult<PgTable, PgColumn> {\n    // \t// For { \"<relation>\": true }, return a table with selection of all columns\n    // \tif (config === true) {\n    // \t\tconst selectionEntries = Object.entries(tableConfig.columns);\n    // \t\tconst selection: BuildRelationalQueryResult<PgTable, PgColumn>['selection'] = selectionEntries.map((\n    // \t\t\t[key, value],\n    // \t\t) => ({\n    // \t\t\tdbKey: value.name,\n    // \t\t\ttsKey: key,\n    // \t\t\tfield: value as PgColumn,\n    // \t\t\trelationTableTsKey: undefined,\n    // \t\t\tisJson: false,\n    // \t\t\tselection: [],\n    // \t\t}));\n    // \t\treturn {\n    // \t\t\ttableTsKey: tableConfig.tsName,\n    // \t\t\tsql: table,\n    // \t\t\tselection,\n    // \t\t};\n    // \t}\n    // \t// let selection: BuildRelationalQueryResult<PgTable, PgColumn>['selection'] = [];\n    // \t// let selectionForBuild = selection;\n    // \tconst aliasedColumns = Object.fromEntries(\n    // \t\tObject.entries(tableConfig.columns).map(([key, value]) => [key, aliasedTableColumn(value, tableAlias)]),\n    // \t);\n    // \tconst aliasedRelations = Object.fromEntries(\n    // \t\tObject.entries(tableConfig.relations).map(([key, value]) => [key, aliasedRelation(value, tableAlias)]),\n    // \t);\n    // \tconst aliasedFields = Object.assign({}, aliasedColumns, aliasedRelations);\n    // \tlet where, hasUserDefinedWhere;\n    // \tif (config.where) {\n    // \t\tconst whereSql = typeof config.where === 'function' ? config.where(aliasedFields, operators) : config.where;\n    // \t\twhere = whereSql && mapColumnsInSQLToAlias(whereSql, tableAlias);\n    // \t\thasUserDefinedWhere = !!where;\n    // \t}\n    // \twhere = and(joinOn, where);\n    // \t// const fieldsSelection: { tsKey: string; value: PgColumn | SQL.Aliased; isExtra?: boolean }[] = [];\n    // \tlet joins: Join[] = [];\n    // \tlet selectedColumns: string[] = [];\n    // \t// Figure out which columns to select\n    // \tif (config.columns) {\n    // \t\tlet isIncludeMode = false;\n    // \t\tfor (const [field, value] of Object.entries(config.columns)) {\n    // \t\t\tif (value === undefined) {\n    // \t\t\t\tcontinue;\n    // \t\t\t}\n    // \t\t\tif (field in tableConfig.columns) {\n    // \t\t\t\tif (!isIncludeMode && value === true) {\n    // \t\t\t\t\tisIncludeMode = true;\n    // \t\t\t\t}\n    // \t\t\t\tselectedColumns.push(field);\n    // \t\t\t}\n    // \t\t}\n    // \t\tif (selectedColumns.length > 0) {\n    // \t\t\tselectedColumns = isIncludeMode\n    // \t\t\t\t? selectedColumns.filter((c) => config.columns?.[c] === true)\n    // \t\t\t\t: Object.keys(tableConfig.columns).filter((key) => !selectedColumns.includes(key));\n    // \t\t}\n    // \t} else {\n    // \t\t// Select all columns if selection is not specified\n    // \t\tselectedColumns = Object.keys(tableConfig.columns);\n    // \t}\n    // \t// for (const field of selectedColumns) {\n    // \t// \tconst column = tableConfig.columns[field]! as PgColumn;\n    // \t// \tfieldsSelection.push({ tsKey: field, value: column });\n    // \t// }\n    // \tlet initiallySelectedRelations: {\n    // \t\ttsKey: string;\n    // \t\tqueryConfig: true | DBQueryConfig<'many', false>;\n    // \t\trelation: Relation;\n    // \t}[] = [];\n    // \t// let selectedRelations: BuildRelationalQueryResult<PgTable, PgColumn>['selection'] = [];\n    // \t// Figure out which relations to select\n    // \tif (config.with) {\n    // \t\tinitiallySelectedRelations = Object.entries(config.with)\n    // \t\t\t.filter((entry): entry is [typeof entry[0], NonNullable<typeof entry[1]>] => !!entry[1])\n    // \t\t\t.map(([tsKey, queryConfig]) => ({ tsKey, queryConfig, relation: tableConfig.relations[tsKey]! }));\n    // \t}\n    // \tconst manyRelations = initiallySelectedRelations.filter((r) =>\n    // \t\tis(r.relation, Many)\n    // \t\t&& (schema[tableNamesMap[r.relation.referencedTable[Table.Symbol.Name]]!]?.primaryKey.length ?? 0) > 0\n    // \t);\n    // \t// If this is the last Many relation (or there are no Many relations), we are on the innermost subquery level\n    // \tconst isInnermostQuery = manyRelations.length < 2;\n    // \tconst selectedExtras: {\n    // \t\ttsKey: string;\n    // \t\tvalue: SQL.Aliased;\n    // \t}[] = [];\n    // \t// Figure out which extras to select\n    // \tif (isInnermostQuery && config.extras) {\n    // \t\tconst extras = typeof config.extras === 'function'\n    // \t\t\t? config.extras(aliasedFields, { sql })\n    // \t\t\t: config.extras;\n    // \t\tfor (const [tsKey, value] of Object.entries(extras)) {\n    // \t\t\tselectedExtras.push({\n    // \t\t\t\ttsKey,\n    // \t\t\t\tvalue: mapColumnsInAliasedSQLToAlias(value, tableAlias),\n    // \t\t\t});\n    // \t\t}\n    // \t}\n    // \t// Transform `fieldsSelection` into `selection`\n    // \t// `fieldsSelection` shouldn't be used after this point\n    // \t// for (const { tsKey, value, isExtra } of fieldsSelection) {\n    // \t// \tselection.push({\n    // \t// \t\tdbKey: is(value, SQL.Aliased) ? value.fieldAlias : tableConfig.columns[tsKey]!.name,\n    // \t// \t\ttsKey,\n    // \t// \t\tfield: is(value, Column) ? aliasedTableColumn(value, tableAlias) : value,\n    // \t// \t\trelationTableTsKey: undefined,\n    // \t// \t\tisJson: false,\n    // \t// \t\tisExtra,\n    // \t// \t\tselection: [],\n    // \t// \t});\n    // \t// }\n    // \tlet orderByOrig = typeof config.orderBy === 'function'\n    // \t\t? config.orderBy(aliasedFields, orderByOperators)\n    // \t\t: config.orderBy ?? [];\n    // \tif (!Array.isArray(orderByOrig)) {\n    // \t\torderByOrig = [orderByOrig];\n    // \t}\n    // \tconst orderBy = orderByOrig.map((orderByValue) => {\n    // \t\tif (is(orderByValue, Column)) {\n    // \t\t\treturn aliasedTableColumn(orderByValue, tableAlias) as PgColumn;\n    // \t\t}\n    // \t\treturn mapColumnsInSQLToAlias(orderByValue, tableAlias);\n    // \t});\n    // \tconst limit = isInnermostQuery ? config.limit : undefined;\n    // \tconst offset = isInnermostQuery ? config.offset : undefined;\n    // \t// For non-root queries without additional config except columns, return a table with selection\n    // \tif (\n    // \t\t!isRoot\n    // \t\t&& initiallySelectedRelations.length === 0\n    // \t\t&& selectedExtras.length === 0\n    // \t\t&& !where\n    // \t\t&& orderBy.length === 0\n    // \t\t&& limit === undefined\n    // \t\t&& offset === undefined\n    // \t) {\n    // \t\treturn {\n    // \t\t\ttableTsKey: tableConfig.tsName,\n    // \t\t\tsql: table,\n    // \t\t\tselection: selectedColumns.map((key) => ({\n    // \t\t\t\tdbKey: tableConfig.columns[key]!.name,\n    // \t\t\t\ttsKey: key,\n    // \t\t\t\tfield: tableConfig.columns[key] as PgColumn,\n    // \t\t\t\trelationTableTsKey: undefined,\n    // \t\t\t\tisJson: false,\n    // \t\t\t\tselection: [],\n    // \t\t\t})),\n    // \t\t};\n    // \t}\n    // \tconst selectedRelationsWithoutPK:\n    // \t// Process all relations without primary keys, because they need to be joined differently and will all be on the same query level\n    // \tfor (\n    // \t\tconst {\n    // \t\t\ttsKey: selectedRelationTsKey,\n    // \t\t\tqueryConfig: selectedRelationConfigValue,\n    // \t\t\trelation,\n    // \t\t} of initiallySelectedRelations\n    // \t) {\n    // \t\tconst normalizedRelation = normalizeRelation(schema, tableNamesMap, relation);\n    // \t\tconst relationTableName = relation.referencedTable[Table.Symbol.Name];\n    // \t\tconst relationTableTsName = tableNamesMap[relationTableName]!;\n    // \t\tconst relationTable = schema[relationTableTsName]!;\n    // \t\tif (relationTable.primaryKey.length > 0) {\n    // \t\t\tcontinue;\n    // \t\t}\n    // \t\tconst relationTableAlias = `${tableAlias}_${selectedRelationTsKey}`;\n    // \t\tconst joinOn = and(\n    // \t\t\t...normalizedRelation.fields.map((field, i) =>\n    // \t\t\t\teq(\n    // \t\t\t\t\taliasedTableColumn(normalizedRelation.references[i]!, relationTableAlias),\n    // \t\t\t\t\taliasedTableColumn(field, tableAlias),\n    // \t\t\t\t)\n    // \t\t\t),\n    // \t\t);\n    // \t\tconst builtRelation = this.buildRelationalQueryWithoutPK({\n    // \t\t\tfullSchema,\n    // \t\t\tschema,\n    // \t\t\ttableNamesMap,\n    // \t\t\ttable: fullSchema[relationTableTsName] as PgTable,\n    // \t\t\ttableConfig: schema[relationTableTsName]!,\n    // \t\t\tqueryConfig: selectedRelationConfigValue,\n    // \t\t\ttableAlias: relationTableAlias,\n    // \t\t\tjoinOn,\n    // \t\t\tnestedQueryRelation: relation,\n    // \t\t});\n    // \t\tconst field = sql`${sql.identifier(relationTableAlias)}.${sql.identifier('data')}`.as(selectedRelationTsKey);\n    // \t\tjoins.push({\n    // \t\t\ton: sql`true`,\n    // \t\t\ttable: new Subquery(builtRelation.sql as SQL, {}, relationTableAlias),\n    // \t\t\talias: relationTableAlias,\n    // \t\t\tjoinType: 'left',\n    // \t\t\tlateral: true,\n    // \t\t});\n    // \t\tselectedRelations.push({\n    // \t\t\tdbKey: selectedRelationTsKey,\n    // \t\t\ttsKey: selectedRelationTsKey,\n    // \t\t\tfield,\n    // \t\t\trelationTableTsKey: relationTableTsName,\n    // \t\t\tisJson: true,\n    // \t\t\tselection: builtRelation.selection,\n    // \t\t});\n    // \t}\n    // \tconst oneRelations = initiallySelectedRelations.filter((r): r is typeof r & { relation: One } =>\n    // \t\tis(r.relation, One)\n    // \t);\n    // \t// Process all One relations with PKs, because they can all be joined on the same level\n    // \tfor (\n    // \t\tconst {\n    // \t\t\ttsKey: selectedRelationTsKey,\n    // \t\t\tqueryConfig: selectedRelationConfigValue,\n    // \t\t\trelation,\n    // \t\t} of oneRelations\n    // \t) {\n    // \t\tconst normalizedRelation = normalizeRelation(schema, tableNamesMap, relation);\n    // \t\tconst relationTableName = relation.referencedTable[Table.Symbol.Name];\n    // \t\tconst relationTableTsName = tableNamesMap[relationTableName]!;\n    // \t\tconst relationTableAlias = `${tableAlias}_${selectedRelationTsKey}`;\n    // \t\tconst relationTable = schema[relationTableTsName]!;\n    // \t\tif (relationTable.primaryKey.length === 0) {\n    // \t\t\tcontinue;\n    // \t\t}\n    // \t\tconst joinOn = and(\n    // \t\t\t...normalizedRelation.fields.map((field, i) =>\n    // \t\t\t\teq(\n    // \t\t\t\t\taliasedTableColumn(normalizedRelation.references[i]!, relationTableAlias),\n    // \t\t\t\t\taliasedTableColumn(field, tableAlias),\n    // \t\t\t\t)\n    // \t\t\t),\n    // \t\t);\n    // \t\tconst builtRelation = this.buildRelationalQueryWithPK({\n    // \t\t\tfullSchema,\n    // \t\t\tschema,\n    // \t\t\ttableNamesMap,\n    // \t\t\ttable: fullSchema[relationTableTsName] as PgTable,\n    // \t\t\ttableConfig: schema[relationTableTsName]!,\n    // \t\t\tqueryConfig: selectedRelationConfigValue,\n    // \t\t\ttableAlias: relationTableAlias,\n    // \t\t\tjoinOn,\n    // \t\t});\n    // \t\tconst field = sql`case when ${sql.identifier(relationTableAlias)} is null then null else json_build_array(${\n    // \t\t\tsql.join(\n    // \t\t\t\tbuiltRelation.selection.map(({ field }) =>\n    // \t\t\t\t\tis(field, SQL.Aliased)\n    // \t\t\t\t\t\t? sql`${sql.identifier(relationTableAlias)}.${sql.identifier(field.fieldAlias)}`\n    // \t\t\t\t\t\t: is(field, Column)\n    // \t\t\t\t\t\t? aliasedTableColumn(field, relationTableAlias)\n    // \t\t\t\t\t\t: field\n    // \t\t\t\t),\n    // \t\t\t\tsql`, `,\n    // \t\t\t)\n    // \t\t}) end`.as(selectedRelationTsKey);\n    // \t\tconst isLateralJoin = is(builtRelation.sql, SQL);\n    // \t\tjoins.push({\n    // \t\t\ton: isLateralJoin ? sql`true` : joinOn,\n    // \t\t\ttable: is(builtRelation.sql, SQL)\n    // \t\t\t\t? new Subquery(builtRelation.sql, {}, relationTableAlias)\n    // \t\t\t\t: aliasedTable(builtRelation.sql, relationTableAlias),\n    // \t\t\talias: relationTableAlias,\n    // \t\t\tjoinType: 'left',\n    // \t\t\tlateral: is(builtRelation.sql, SQL),\n    // \t\t});\n    // \t\tselectedRelations.push({\n    // \t\t\tdbKey: selectedRelationTsKey,\n    // \t\t\ttsKey: selectedRelationTsKey,\n    // \t\t\tfield,\n    // \t\t\trelationTableTsKey: relationTableTsName,\n    // \t\t\tisJson: true,\n    // \t\t\tselection: builtRelation.selection,\n    // \t\t});\n    // \t}\n    // \tlet distinct: PgSelectConfig['distinct'];\n    // \tlet tableFrom: PgTable | Subquery = table;\n    // \t// Process first Many relation - each one requires a nested subquery\n    // \tconst manyRelation = manyRelations[0];\n    // \tif (manyRelation) {\n    // \t\tconst {\n    // \t\t\ttsKey: selectedRelationTsKey,\n    // \t\t\tqueryConfig: selectedRelationQueryConfig,\n    // \t\t\trelation,\n    // \t\t} = manyRelation;\n    // \t\tdistinct = {\n    // \t\t\ton: tableConfig.primaryKey.map((c) => aliasedTableColumn(c as PgColumn, tableAlias)),\n    // \t\t};\n    // \t\tconst normalizedRelation = normalizeRelation(schema, tableNamesMap, relation);\n    // \t\tconst relationTableName = relation.referencedTable[Table.Symbol.Name];\n    // \t\tconst relationTableTsName = tableNamesMap[relationTableName]!;\n    // \t\tconst relationTableAlias = `${tableAlias}_${selectedRelationTsKey}`;\n    // \t\tconst joinOn = and(\n    // \t\t\t...normalizedRelation.fields.map((field, i) =>\n    // \t\t\t\teq(\n    // \t\t\t\t\taliasedTableColumn(normalizedRelation.references[i]!, relationTableAlias),\n    // \t\t\t\t\taliasedTableColumn(field, tableAlias),\n    // \t\t\t\t)\n    // \t\t\t),\n    // \t\t);\n    // \t\tconst builtRelationJoin = this.buildRelationalQueryWithPK({\n    // \t\t\tfullSchema,\n    // \t\t\tschema,\n    // \t\t\ttableNamesMap,\n    // \t\t\ttable: fullSchema[relationTableTsName] as PgTable,\n    // \t\t\ttableConfig: schema[relationTableTsName]!,\n    // \t\t\tqueryConfig: selectedRelationQueryConfig,\n    // \t\t\ttableAlias: relationTableAlias,\n    // \t\t\tjoinOn,\n    // \t\t});\n    // \t\tconst builtRelationSelectionField = sql`case when ${\n    // \t\t\tsql.identifier(relationTableAlias)\n    // \t\t} is null then '[]' else json_agg(json_build_array(${\n    // \t\t\tsql.join(\n    // \t\t\t\tbuiltRelationJoin.selection.map(({ field }) =>\n    // \t\t\t\t\tis(field, SQL.Aliased)\n    // \t\t\t\t\t\t? sql`${sql.identifier(relationTableAlias)}.${sql.identifier(field.fieldAlias)}`\n    // \t\t\t\t\t\t: is(field, Column)\n    // \t\t\t\t\t\t? aliasedTableColumn(field, relationTableAlias)\n    // \t\t\t\t\t\t: field\n    // \t\t\t\t),\n    // \t\t\t\tsql`, `,\n    // \t\t\t)\n    // \t\t})) over (partition by ${sql.join(distinct.on, sql`, `)}) end`.as(selectedRelationTsKey);\n    // \t\tconst isLateralJoin = is(builtRelationJoin.sql, SQL);\n    // \t\tjoins.push({\n    // \t\t\ton: isLateralJoin ? sql`true` : joinOn,\n    // \t\t\ttable: isLateralJoin\n    // \t\t\t\t? new Subquery(builtRelationJoin.sql as SQL, {}, relationTableAlias)\n    // \t\t\t\t: aliasedTable(builtRelationJoin.sql as PgTable, relationTableAlias),\n    // \t\t\talias: relationTableAlias,\n    // \t\t\tjoinType: 'left',\n    // \t\t\tlateral: isLateralJoin,\n    // \t\t});\n    // \t\t// Build the \"from\" subquery with the remaining Many relations\n    // \t\tconst builtTableFrom = this.buildRelationalQueryWithPK({\n    // \t\t\tfullSchema,\n    // \t\t\tschema,\n    // \t\t\ttableNamesMap,\n    // \t\t\ttable,\n    // \t\t\ttableConfig,\n    // \t\t\tqueryConfig: {\n    // \t\t\t\t...config,\n    // \t\t\t\twhere: undefined,\n    // \t\t\t\torderBy: undefined,\n    // \t\t\t\tlimit: undefined,\n    // \t\t\t\toffset: undefined,\n    // \t\t\t\twith: manyRelations.slice(1).reduce<NonNullable<typeof config['with']>>(\n    // \t\t\t\t\t(result, { tsKey, queryConfig: configValue }) => {\n    // \t\t\t\t\t\tresult[tsKey] = configValue;\n    // \t\t\t\t\t\treturn result;\n    // \t\t\t\t\t},\n    // \t\t\t\t\t{},\n    // \t\t\t\t),\n    // \t\t\t},\n    // \t\t\ttableAlias,\n    // \t\t});\n    // \t\tselectedRelations.push({\n    // \t\t\tdbKey: selectedRelationTsKey,\n    // \t\t\ttsKey: selectedRelationTsKey,\n    // \t\t\tfield: builtRelationSelectionField,\n    // \t\t\trelationTableTsKey: relationTableTsName,\n    // \t\t\tisJson: true,\n    // \t\t\tselection: builtRelationJoin.selection,\n    // \t\t});\n    // \t\t// selection = builtTableFrom.selection.map((item) =>\n    // \t\t// \tis(item.field, SQL.Aliased)\n    // \t\t// \t\t? { ...item, field: sql`${sql.identifier(tableAlias)}.${sql.identifier(item.field.fieldAlias)}` }\n    // \t\t// \t\t: item\n    // \t\t// );\n    // \t\t// selectionForBuild = [{\n    // \t\t// \tdbKey: '*',\n    // \t\t// \ttsKey: '*',\n    // \t\t// \tfield: sql`${sql.identifier(tableAlias)}.*`,\n    // \t\t// \tselection: [],\n    // \t\t// \tisJson: false,\n    // \t\t// \trelationTableTsKey: undefined,\n    // \t\t// }];\n    // \t\t// const newSelectionItem: (typeof selection)[number] = {\n    // \t\t// \tdbKey: selectedRelationTsKey,\n    // \t\t// \ttsKey: selectedRelationTsKey,\n    // \t\t// \tfield,\n    // \t\t// \trelationTableTsKey: relationTableTsName,\n    // \t\t// \tisJson: true,\n    // \t\t// \tselection: builtRelationJoin.selection,\n    // \t\t// };\n    // \t\t// selection.push(newSelectionItem);\n    // \t\t// selectionForBuild.push(newSelectionItem);\n    // \t\ttableFrom = is(builtTableFrom.sql, PgTable)\n    // \t\t\t? builtTableFrom.sql\n    // \t\t\t: new Subquery(builtTableFrom.sql, {}, tableAlias);\n    // \t}\n    // \tif (selectedColumns.length === 0 && selectedRelations.length === 0 && selectedExtras.length === 0) {\n    // \t\tthrow new DrizzleError(`No fields selected for table \"${tableConfig.tsName}\" (\"${tableAlias}\")`);\n    // \t}\n    // \tlet selection: BuildRelationalQueryResult<PgTable, PgColumn>['selection'];\n    // \tfunction prepareSelectedColumns() {\n    // \t\treturn selectedColumns.map((key) => ({\n    // \t\t\tdbKey: tableConfig.columns[key]!.name,\n    // \t\t\ttsKey: key,\n    // \t\t\tfield: tableConfig.columns[key] as PgColumn,\n    // \t\t\trelationTableTsKey: undefined,\n    // \t\t\tisJson: false,\n    // \t\t\tselection: [],\n    // \t\t}));\n    // \t}\n    // \tfunction prepareSelectedExtras() {\n    // \t\treturn selectedExtras.map((item) => ({\n    // \t\t\tdbKey: item.value.fieldAlias,\n    // \t\t\ttsKey: item.tsKey,\n    // \t\t\tfield: item.value,\n    // \t\t\trelationTableTsKey: undefined,\n    // \t\t\tisJson: false,\n    // \t\t\tselection: [],\n    // \t\t}));\n    // \t}\n    // \tif (isRoot) {\n    // \t\tselection = [\n    // \t\t\t...prepareSelectedColumns(),\n    // \t\t\t...prepareSelectedExtras(),\n    // \t\t];\n    // \t}\n    // \tif (hasUserDefinedWhere || orderBy.length > 0) {\n    // \t\ttableFrom = new Subquery(\n    // \t\t\tthis.buildSelectQuery({\n    // \t\t\t\ttable: is(tableFrom, PgTable) ? aliasedTable(tableFrom, tableAlias) : tableFrom,\n    // \t\t\t\tfields: {},\n    // \t\t\t\tfieldsFlat: selectionForBuild.map(({ field }) => ({\n    // \t\t\t\t\tpath: [],\n    // \t\t\t\t\tfield: is(field, Column) ? aliasedTableColumn(field, tableAlias) : field,\n    // \t\t\t\t})),\n    // \t\t\t\tjoins,\n    // \t\t\t\tdistinct,\n    // \t\t\t}),\n    // \t\t\t{},\n    // \t\t\ttableAlias,\n    // \t\t);\n    // \t\tselectionForBuild = selection.map((item) =>\n    // \t\t\tis(item.field, SQL.Aliased)\n    // \t\t\t\t? { ...item, field: sql`${sql.identifier(tableAlias)}.${sql.identifier(item.field.fieldAlias)}` }\n    // \t\t\t\t: item\n    // \t\t);\n    // \t\tjoins = [];\n    // \t\tdistinct = undefined;\n    // \t}\n    // \tconst result = this.buildSelectQuery({\n    // \t\ttable: is(tableFrom, PgTable) ? aliasedTable(tableFrom, tableAlias) : tableFrom,\n    // \t\tfields: {},\n    // \t\tfieldsFlat: selectionForBuild.map(({ field }) => ({\n    // \t\t\tpath: [],\n    // \t\t\tfield: is(field, Column) ? aliasedTableColumn(field, tableAlias) : field,\n    // \t\t})),\n    // \t\twhere,\n    // \t\tlimit,\n    // \t\toffset,\n    // \t\tjoins,\n    // \t\torderBy,\n    // \t\tdistinct,\n    // \t});\n    // \treturn {\n    // \t\ttableTsKey: tableConfig.tsName,\n    // \t\tsql: result,\n    // \t\tselection,\n    // \t};\n    // }\n    buildRelationalQueryWithoutPK({ fullSchema, schema, tableNamesMap, table, tableConfig, queryConfig: config, tableAlias, nestedQueryRelation, joinOn, }) {\n        let selection = [];\n        let limit, offset, orderBy = [], where;\n        const joins = [];\n        if (config === true) {\n            const selectionEntries = Object.entries(tableConfig.columns);\n            selection = selectionEntries.map(([key, value]) => ({\n                dbKey: value.name,\n                tsKey: key,\n                field: aliasedTableColumn(value, tableAlias),\n                relationTableTsKey: undefined,\n                isJson: false,\n                selection: [],\n            }));\n        }\n        else {\n            const aliasedColumns = Object.fromEntries(Object.entries(tableConfig.columns).map(([key, value]) => [key, aliasedTableColumn(value, tableAlias)]));\n            if (config.where) {\n                const whereSql = typeof config.where === 'function'\n                    ? config.where(aliasedColumns, getOperators())\n                    : config.where;\n                where = whereSql && mapColumnsInSQLToAlias(whereSql, tableAlias);\n            }\n            const fieldsSelection = [];\n            let selectedColumns = [];\n            // Figure out which columns to select\n            if (config.columns) {\n                let isIncludeMode = false;\n                for (const [field, value] of Object.entries(config.columns)) {\n                    if (value === undefined) {\n                        continue;\n                    }\n                    if (field in tableConfig.columns) {\n                        if (!isIncludeMode && value === true) {\n                            isIncludeMode = true;\n                        }\n                        selectedColumns.push(field);\n                    }\n                }\n                if (selectedColumns.length > 0) {\n                    selectedColumns = isIncludeMode\n                        ? selectedColumns.filter((c) => config.columns?.[c] === true)\n                        : Object.keys(tableConfig.columns).filter((key) => !selectedColumns.includes(key));\n                }\n            }\n            else {\n                // Select all columns if selection is not specified\n                selectedColumns = Object.keys(tableConfig.columns);\n            }\n            for (const field of selectedColumns) {\n                const column = tableConfig.columns[field];\n                fieldsSelection.push({ tsKey: field, value: column });\n            }\n            let selectedRelations = [];\n            // Figure out which relations to select\n            if (config.with) {\n                selectedRelations = Object.entries(config.with)\n                    .filter((entry) => !!entry[1])\n                    .map(([tsKey, queryConfig]) => ({ tsKey, queryConfig, relation: tableConfig.relations[tsKey] }));\n            }\n            let extras;\n            // Figure out which extras to select\n            if (config.extras) {\n                extras = typeof config.extras === 'function'\n                    ? config.extras(aliasedColumns, { sql })\n                    : config.extras;\n                for (const [tsKey, value] of Object.entries(extras)) {\n                    fieldsSelection.push({\n                        tsKey,\n                        value: mapColumnsInAliasedSQLToAlias(value, tableAlias),\n                    });\n                }\n            }\n            // Transform `fieldsSelection` into `selection`\n            // `fieldsSelection` shouldn't be used after this point\n            for (const { tsKey, value } of fieldsSelection) {\n                selection.push({\n                    dbKey: is(value, SQL.Aliased) ? value.fieldAlias : tableConfig.columns[tsKey].name,\n                    tsKey,\n                    field: is(value, Column) ? aliasedTableColumn(value, tableAlias) : value,\n                    relationTableTsKey: undefined,\n                    isJson: false,\n                    selection: [],\n                });\n            }\n            let orderByOrig = typeof config.orderBy === 'function'\n                ? config.orderBy(aliasedColumns, getOrderByOperators())\n                : config.orderBy ?? [];\n            if (!Array.isArray(orderByOrig)) {\n                orderByOrig = [orderByOrig];\n            }\n            orderBy = orderByOrig.map((orderByValue) => {\n                if (is(orderByValue, Column)) {\n                    return aliasedTableColumn(orderByValue, tableAlias);\n                }\n                return mapColumnsInSQLToAlias(orderByValue, tableAlias);\n            });\n            limit = config.limit;\n            offset = config.offset;\n            // Process all relations\n            for (const { tsKey: selectedRelationTsKey, queryConfig: selectedRelationConfigValue, relation, } of selectedRelations) {\n                const normalizedRelation = normalizeRelation(schema, tableNamesMap, relation);\n                const relationTableName = relation.referencedTable[Table.Symbol.Name];\n                const relationTableTsName = tableNamesMap[relationTableName];\n                const relationTableAlias = `${tableAlias}_${selectedRelationTsKey}`;\n                const joinOn = and(...normalizedRelation.fields.map((field, i) => eq(aliasedTableColumn(normalizedRelation.references[i], relationTableAlias), aliasedTableColumn(field, tableAlias))));\n                const builtRelation = this.buildRelationalQueryWithoutPK({\n                    fullSchema,\n                    schema,\n                    tableNamesMap,\n                    table: fullSchema[relationTableTsName],\n                    tableConfig: schema[relationTableTsName],\n                    queryConfig: is(relation, One)\n                        ? (selectedRelationConfigValue === true\n                            ? { limit: 1 }\n                            : { ...selectedRelationConfigValue, limit: 1 })\n                        : selectedRelationConfigValue,\n                    tableAlias: relationTableAlias,\n                    joinOn,\n                    nestedQueryRelation: relation,\n                });\n                const field = sql `${sql.identifier(relationTableAlias)}.${sql.identifier('data')}`.as(selectedRelationTsKey);\n                joins.push({\n                    on: sql `true`,\n                    table: new Subquery(builtRelation.sql, {}, relationTableAlias),\n                    alias: relationTableAlias,\n                    joinType: 'left',\n                    lateral: true,\n                });\n                selection.push({\n                    dbKey: selectedRelationTsKey,\n                    tsKey: selectedRelationTsKey,\n                    field,\n                    relationTableTsKey: relationTableTsName,\n                    isJson: true,\n                    selection: builtRelation.selection,\n                });\n            }\n        }\n        if (selection.length === 0) {\n            throw new DrizzleError(`No fields selected for table \"${tableConfig.tsName}\" (\"${tableAlias}\")`);\n        }\n        let result;\n        where = and(joinOn, where);\n        if (nestedQueryRelation) {\n            let field = sql `json_build_array(${sql.join(selection.map(({ field, tsKey, isJson }) => isJson\n                ? sql `${sql.identifier(`${tableAlias}_${tsKey}`)}.${sql.identifier('data')}`\n                : is(field, SQL.Aliased)\n                    ? field.sql\n                    : field), sql `, `)})`;\n            if (is(nestedQueryRelation, Many)) {\n                field = sql `coalesce(json_agg(${field}${orderBy.length > 0 ? sql ` order by ${sql.join(orderBy, sql `, `)}` : undefined}), '[]'::json)`;\n                // orderBy = [];\n            }\n            const nestedSelection = [{\n                    dbKey: 'data',\n                    tsKey: 'data',\n                    field: field.as('data'),\n                    isJson: true,\n                    relationTableTsKey: tableConfig.tsName,\n                    selection,\n                }];\n            const needsSubquery = limit !== undefined || offset !== undefined || orderBy.length > 0;\n            if (needsSubquery) {\n                result = this.buildSelectQuery({\n                    table: aliasedTable(table, tableAlias),\n                    fields: {},\n                    fieldsFlat: [{\n                            path: [],\n                            field: sql.raw('*'),\n                        }],\n                    where,\n                    limit,\n                    offset,\n                    orderBy,\n                });\n                where = undefined;\n                limit = undefined;\n                offset = undefined;\n                orderBy = [];\n            }\n            else {\n                result = aliasedTable(table, tableAlias);\n            }\n            result = this.buildSelectQuery({\n                table: is(result, PgTable) ? result : new Subquery(result, {}, tableAlias),\n                fields: {},\n                fieldsFlat: nestedSelection.map(({ field }) => ({\n                    path: [],\n                    field: is(field, Column) ? aliasedTableColumn(field, tableAlias) : field,\n                })),\n                joins,\n                where,\n                limit,\n                offset,\n                orderBy,\n            });\n        }\n        else {\n            result = this.buildSelectQuery({\n                table: aliasedTable(table, tableAlias),\n                fields: {},\n                fieldsFlat: selection.map(({ field }) => ({\n                    path: [],\n                    field: is(field, Column) ? aliasedTableColumn(field, tableAlias) : field,\n                })),\n                joins,\n                where,\n                limit,\n                offset,\n                orderBy,\n            });\n        }\n        return {\n            tableTsKey: tableConfig.tsName,\n            sql: result,\n            selection,\n        };\n    }\n}\n\nclass TypedQueryBuilder {\n    static [entityKind] = 'TypedQueryBuilder';\n    /** @internal */\n    getSelectedFields() {\n        return this._.selectedFields;\n    }\n}\n\nclass PgSelectBuilder {\n    static [entityKind] = 'PgSelectBuilder';\n    fields;\n    session;\n    dialect;\n    withList = [];\n    distinct;\n    constructor(config) {\n        this.fields = config.fields;\n        this.session = config.session;\n        this.dialect = config.dialect;\n        if (config.withList) {\n            this.withList = config.withList;\n        }\n        this.distinct = config.distinct;\n    }\n    /**\n     * Specify the table, subquery, or other target that you're\n     * building a select query against.\n     *\n     * {@link https://www.postgresql.org/docs/current/sql-select.html#SQL-FROM|Postgres from documentation}\n     */\n    from(source) {\n        const isPartialSelect = !!this.fields;\n        let fields;\n        if (this.fields) {\n            fields = this.fields;\n        }\n        else if (is(source, Subquery)) {\n            // This is required to use the proxy handler to get the correct field values from the subquery\n            fields = Object.fromEntries(Object.keys(source[SubqueryConfig].selection).map((key) => [key, source[key]]));\n        }\n        else if (is(source, PgViewBase)) {\n            fields = source[ViewBaseConfig].selectedFields;\n        }\n        else if (is(source, SQL)) {\n            fields = {};\n        }\n        else {\n            fields = getTableColumns(source);\n        }\n        return new PgSelect({\n            table: source,\n            fields,\n            isPartialSelect,\n            session: this.session,\n            dialect: this.dialect,\n            withList: this.withList,\n            distinct: this.distinct,\n        });\n    }\n}\nclass PgSelectQueryBuilder extends TypedQueryBuilder {\n    static [entityKind] = 'PgSelectQueryBuilder';\n    _;\n    config;\n    joinsNotNullableMap;\n    tableName;\n    isPartialSelect;\n    session;\n    dialect;\n    constructor({ table, fields, isPartialSelect, session, dialect, withList, distinct }) {\n        super();\n        this.config = {\n            withList,\n            table,\n            fields: { ...fields },\n            distinct,\n        };\n        this.isPartialSelect = isPartialSelect;\n        this.session = session;\n        this.dialect = dialect;\n        this._ = {\n            selectedFields: fields,\n        };\n        this.tableName = getTableLikeName(table);\n        this.joinsNotNullableMap = typeof this.tableName === 'string' ? { [this.tableName]: true } : {};\n    }\n    createJoin(joinType) {\n        return (table, on) => {\n            const baseTableName = this.tableName;\n            const tableName = getTableLikeName(table);\n            if (typeof tableName === 'string' && this.config.joins?.some((join) => join.alias === tableName)) {\n                throw new Error(`Alias \"${tableName}\" is already used in this query`);\n            }\n            if (!this.isPartialSelect) {\n                // If this is the first join and this is not a partial select and we're not selecting from raw SQL, \"move\" the fields from the main table to the nested object\n                if (Object.keys(this.joinsNotNullableMap).length === 1 && typeof baseTableName === 'string') {\n                    this.config.fields = {\n                        [baseTableName]: this.config.fields,\n                    };\n                }\n                if (typeof tableName === 'string' && !is(table, SQL)) {\n                    const selection = is(table, Subquery)\n                        ? table[SubqueryConfig].selection\n                        : is(table, View)\n                            ? table[ViewBaseConfig].selectedFields\n                            : table[Table.Symbol.Columns];\n                    this.config.fields[tableName] = selection;\n                }\n            }\n            if (typeof on === 'function') {\n                on = on(new Proxy(this.config.fields, new SelectionProxyHandler({ sqlAliasedBehavior: 'sql', sqlBehavior: 'sql' })));\n            }\n            if (!this.config.joins) {\n                this.config.joins = [];\n            }\n            this.config.joins.push({ on, table, joinType, alias: tableName });\n            if (typeof tableName === 'string') {\n                switch (joinType) {\n                    case 'left': {\n                        this.joinsNotNullableMap[tableName] = false;\n                        break;\n                    }\n                    case 'right': {\n                        this.joinsNotNullableMap = Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([key]) => [key, false]));\n                        this.joinsNotNullableMap[tableName] = true;\n                        break;\n                    }\n                    case 'inner': {\n                        this.joinsNotNullableMap[tableName] = true;\n                        break;\n                    }\n                    case 'full': {\n                        this.joinsNotNullableMap = Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([key]) => [key, false]));\n                        this.joinsNotNullableMap[tableName] = false;\n                        break;\n                    }\n                }\n            }\n            return this;\n        };\n    }\n    /**\n     * For each row of the table, include\n     * values from a matching row of the joined\n     * table, if there is a matching row. If not,\n     * all of the columns of the joined table\n     * will be set to null.\n     */\n    leftJoin = this.createJoin('left');\n    /**\n     * Includes all of the rows of the joined table.\n     * If there is no matching row in the main table,\n     * all the columns of the main table will be\n     * set to null.\n     */\n    rightJoin = this.createJoin('right');\n    /**\n     * This is the default type of join.\n     *\n     * For each row of the table, the joined table\n     * needs to have a matching row, or it will\n     * be excluded from results.\n     */\n    innerJoin = this.createJoin('inner');\n    /**\n     * Rows from both the main & joined are included,\n     * regardless of whether or not they have matching\n     * rows in the other table.\n     */\n    fullJoin = this.createJoin('full');\n    /**\n     * Specify a condition to narrow the result set. Multiple\n     * conditions can be combined with the `and` and `or`\n     * functions.\n     *\n     * ## Examples\n     *\n     * ```ts\n     * // Find cars made in the year 2000\n     * db.select().from(cars).where(eq(cars.year, 2000));\n     * ```\n     */\n    where(where) {\n        if (typeof where === 'function') {\n            where = where(new Proxy(this.config.fields, new SelectionProxyHandler({ sqlAliasedBehavior: 'sql', sqlBehavior: 'sql' })));\n        }\n        this.config.where = where;\n        return this;\n    }\n    /**\n     * Sets the HAVING clause of this query, which often\n     * used with GROUP BY and filters rows after they've been\n     * grouped together and combined.\n     *\n     * {@link https://www.postgresql.org/docs/current/sql-select.html#SQL-HAVING|Postgres having clause documentation}\n     */\n    having(having) {\n        if (typeof having === 'function') {\n            having = having(new Proxy(this.config.fields, new SelectionProxyHandler({ sqlAliasedBehavior: 'sql', sqlBehavior: 'sql' })));\n        }\n        this.config.having = having;\n        return this;\n    }\n    groupBy(...columns) {\n        if (typeof columns[0] === 'function') {\n            const groupBy = columns[0](new Proxy(this.config.fields, new SelectionProxyHandler({ sqlAliasedBehavior: 'alias', sqlBehavior: 'sql' })));\n            this.config.groupBy = Array.isArray(groupBy) ? groupBy : [groupBy];\n        }\n        else {\n            this.config.groupBy = columns;\n        }\n        return this;\n    }\n    orderBy(...columns) {\n        if (typeof columns[0] === 'function') {\n            const orderBy = columns[0](new Proxy(this.config.fields, new SelectionProxyHandler({ sqlAliasedBehavior: 'alias', sqlBehavior: 'sql' })));\n            this.config.orderBy = Array.isArray(orderBy) ? orderBy : [orderBy];\n        }\n        else {\n            this.config.orderBy = columns;\n        }\n        return this;\n    }\n    /**\n     * Set the maximum number of rows that will be\n     * returned by this query.\n     *\n     * ## Examples\n     *\n     * ```ts\n     * // Get the first 10 people from this query.\n     * db.select().from(people).limit(10);\n     * ```\n     *\n     * {@link https://www.postgresql.org/docs/current/sql-select.html#SQL-LIMIT|Postgres LIMIT documentation}\n     */\n    limit(limit) {\n        this.config.limit = limit;\n        return this;\n    }\n    /**\n     * Skip a number of rows when returning results\n     * from this query.\n     *\n     * ## Examples\n     *\n     * ```ts\n     * // Get the 10th-20th people from this query.\n     * db.select().from(people).offset(10).limit(10);\n     * ```\n     */\n    offset(offset) {\n        this.config.offset = offset;\n        return this;\n    }\n    /**\n     * The FOR clause specifies a lock strength for this query\n     * that controls how strictly it acquires exclusive access to\n     * the rows being queried.\n     *\n     * {@link https://www.postgresql.org/docs/current/sql-select.html#SQL-FOR-UPDATE-SHARE|Postgres locking clause documentation}\n     */\n    for(strength, config = {}) {\n        if (!this.config.lockingClauses) {\n            this.config.lockingClauses = [];\n        }\n        this.config.lockingClauses.push({ strength, config });\n        return this;\n    }\n    /** @internal */\n    getSQL() {\n        return this.dialect.buildSelectQuery(this.config);\n    }\n    toSQL() {\n        const { typings: _typings, ...rest } = this.dialect.sqlToQuery(this.getSQL());\n        return rest;\n    }\n    as(alias) {\n        return new Proxy(new Subquery(this.getSQL(), this.config.fields, alias), new SelectionProxyHandler({ alias, sqlAliasedBehavior: 'alias', sqlBehavior: 'error' }));\n    }\n}\nclass PgSelect extends PgSelectQueryBuilder {\n    static [entityKind] = 'PgSelect';\n    _prepare(name) {\n        const { session, config, dialect, joinsNotNullableMap } = this;\n        if (!session) {\n            throw new Error('Cannot execute a query on a query builder. Please use a database instance instead.');\n        }\n        return tracer.startActiveSpan('drizzle.prepareQuery', () => {\n            const fieldsList = orderSelectedFields(config.fields);\n            const query = session.prepareQuery(dialect.sqlToQuery(this.getSQL()), fieldsList, name);\n            query.joinsNotNullableMap = joinsNotNullableMap;\n            return query;\n        });\n    }\n    /**\n     * Create a prepared statement for this query. This allows\n     * the database to remember this query for the given session\n     * and call it by name, rather than specifying the full query.\n     *\n     * {@link https://www.postgresql.org/docs/current/sql-prepare.html|Postgres prepare documentation}\n     */\n    prepare(name) {\n        return this._prepare(name);\n    }\n    execute = (placeholderValues) => {\n        return tracer.startActiveSpan('drizzle.operation', () => {\n            return this._prepare().execute(placeholderValues);\n        });\n    };\n}\napplyMixins(PgSelect, [QueryPromise]);\n\nclass QueryBuilder {\n    static [entityKind] = 'PgQueryBuilder';\n    dialect;\n    $with(alias) {\n        const queryBuilder = this;\n        return {\n            as(qb) {\n                if (typeof qb === 'function') {\n                    qb = qb(queryBuilder);\n                }\n                return new Proxy(new WithSubquery(qb.getSQL(), qb.getSelectedFields(), alias, true), new SelectionProxyHandler({ alias, sqlAliasedBehavior: 'alias', sqlBehavior: 'error' }));\n            },\n        };\n    }\n    with(...queries) {\n        const self = this;\n        function select(fields) {\n            return new PgSelectBuilder({\n                fields: fields ?? undefined,\n                session: undefined,\n                dialect: self.getDialect(),\n                withList: queries,\n            });\n        }\n        function selectDistinct(fields) {\n            return new PgSelectBuilder({\n                fields: fields ?? undefined,\n                session: undefined,\n                dialect: self.getDialect(),\n                distinct: true,\n            });\n        }\n        function selectDistinctOn(on, fields) {\n            return new PgSelectBuilder({\n                fields: fields ?? undefined,\n                session: undefined,\n                dialect: self.getDialect(),\n                distinct: { on },\n            });\n        }\n        return { select, selectDistinct, selectDistinctOn };\n    }\n    select(fields) {\n        return new PgSelectBuilder({\n            fields: fields ?? undefined,\n            session: undefined,\n            dialect: this.getDialect(),\n        });\n    }\n    selectDistinct(fields) {\n        return new PgSelectBuilder({\n            fields: fields ?? undefined,\n            session: undefined,\n            dialect: this.getDialect(),\n            distinct: true,\n        });\n    }\n    selectDistinctOn(on, fields) {\n        return new PgSelectBuilder({\n            fields: fields ?? undefined,\n            session: undefined,\n            dialect: this.getDialect(),\n            distinct: { on },\n        });\n    }\n    // Lazy load dialect to avoid circular dependency\n    getDialect() {\n        if (!this.dialect) {\n            this.dialect = new PgDialect();\n        }\n        return this.dialect;\n    }\n}\n\nclass DefaultViewBuilderCore {\n    name;\n    schema;\n    static [entityKind] = 'PgDefaultViewBuilderCore';\n    constructor(name, schema) {\n        this.name = name;\n        this.schema = schema;\n    }\n    config = {};\n    with(config) {\n        this.config.with = config;\n        return this;\n    }\n}\nclass ViewBuilder extends DefaultViewBuilderCore {\n    static [entityKind] = 'PgViewBuilder';\n    as(qb) {\n        if (typeof qb === 'function') {\n            qb = qb(new QueryBuilder());\n        }\n        const selectionProxy = new SelectionProxyHandler({\n            alias: this.name,\n            sqlBehavior: 'error',\n            sqlAliasedBehavior: 'alias',\n            replaceOriginalName: true,\n        });\n        const aliasedSelection = new Proxy(qb.getSelectedFields(), selectionProxy);\n        return new Proxy(new PgView({\n            pgConfig: this.config,\n            config: {\n                name: this.name,\n                schema: this.schema,\n                selectedFields: aliasedSelection,\n                query: qb.getSQL().inlineParams(),\n            },\n        }), selectionProxy);\n    }\n}\nclass ManualViewBuilder extends DefaultViewBuilderCore {\n    static [entityKind] = 'PgManualViewBuilder';\n    columns;\n    constructor(name, columns, schema) {\n        super(name, schema);\n        this.columns = getTableColumns(pgTable(name, columns));\n    }\n    existing() {\n        return new Proxy(new PgView({\n            pgConfig: undefined,\n            config: {\n                name: this.name,\n                schema: this.schema,\n                selectedFields: this.columns,\n                query: undefined,\n            },\n        }), new SelectionProxyHandler({\n            alias: this.name,\n            sqlBehavior: 'error',\n            sqlAliasedBehavior: 'alias',\n            replaceOriginalName: true,\n        }));\n    }\n    as(query) {\n        return new Proxy(new PgView({\n            pgConfig: this.config,\n            config: {\n                name: this.name,\n                schema: this.schema,\n                selectedFields: this.columns,\n                query: query.inlineParams(),\n            },\n        }), new SelectionProxyHandler({\n            alias: this.name,\n            sqlBehavior: 'error',\n            sqlAliasedBehavior: 'alias',\n            replaceOriginalName: true,\n        }));\n    }\n}\nclass MaterializedViewBuilderCore {\n    name;\n    schema;\n    static [entityKind] = 'PgMaterializedViewBuilderCore';\n    constructor(name, schema) {\n        this.name = name;\n        this.schema = schema;\n    }\n    config = {};\n    using(using) {\n        this.config.using = using;\n        return this;\n    }\n    with(config) {\n        this.config.with = config;\n        return this;\n    }\n    tablespace(tablespace) {\n        this.config.tablespace = tablespace;\n        return this;\n    }\n    withNoData() {\n        this.config.withNoData = true;\n        return this;\n    }\n}\nclass MaterializedViewBuilder extends MaterializedViewBuilderCore {\n    static [entityKind] = 'PgMaterializedViewBuilder';\n    as(qb) {\n        if (typeof qb === 'function') {\n            qb = qb(new QueryBuilder());\n        }\n        const selectionProxy = new SelectionProxyHandler({\n            alias: this.name,\n            sqlBehavior: 'error',\n            sqlAliasedBehavior: 'alias',\n            replaceOriginalName: true,\n        });\n        const aliasedSelection = new Proxy(qb.getSelectedFields(), selectionProxy);\n        return new Proxy(new PgMaterializedView({\n            pgConfig: {\n                with: this.config.with,\n                using: this.config.using,\n                tablespace: this.config.tablespace,\n                withNoData: this.config.withNoData,\n            },\n            config: {\n                name: this.name,\n                schema: this.schema,\n                selectedFields: aliasedSelection,\n                query: qb.getSQL().inlineParams(),\n            },\n        }), selectionProxy);\n    }\n}\nclass ManualMaterializedViewBuilder extends MaterializedViewBuilderCore {\n    static [entityKind] = 'PgManualMaterializedViewBuilder';\n    columns;\n    constructor(name, columns, schema) {\n        super(name, schema);\n        this.columns = getTableColumns(pgTable(name, columns));\n    }\n    existing() {\n        return new Proxy(new PgMaterializedView({\n            pgConfig: undefined,\n            config: {\n                name: this.name,\n                schema: this.schema,\n                selectedFields: this.columns,\n                query: undefined,\n            },\n        }), new SelectionProxyHandler({\n            alias: this.name,\n            sqlBehavior: 'error',\n            sqlAliasedBehavior: 'alias',\n            replaceOriginalName: true,\n        }));\n    }\n    as(query) {\n        return new Proxy(new PgMaterializedView({\n            pgConfig: undefined,\n            config: {\n                name: this.name,\n                schema: this.schema,\n                selectedFields: this.columns,\n                query: query.inlineParams(),\n            },\n        }), new SelectionProxyHandler({\n            alias: this.name,\n            sqlBehavior: 'error',\n            sqlAliasedBehavior: 'alias',\n            replaceOriginalName: true,\n        }));\n    }\n}\nclass PgViewBase extends View {\n    static [entityKind] = 'PgViewBase';\n}\nconst PgViewConfig = Symbol.for('drizzle:PgViewConfig');\nclass PgView extends PgViewBase {\n    static [entityKind] = 'PgView';\n    [PgViewConfig];\n    constructor({ pgConfig, config }) {\n        super(config);\n        if (pgConfig) {\n            this[PgViewConfig] = {\n                with: pgConfig.with,\n            };\n        }\n    }\n}\nconst PgMaterializedViewConfig = Symbol.for('drizzle:PgMaterializedViewConfig');\nclass PgMaterializedView extends PgViewBase {\n    static [entityKind] = 'PgMaterializedView';\n    [PgMaterializedViewConfig];\n    constructor({ pgConfig, config }) {\n        super(config);\n        this[PgMaterializedViewConfig] = {\n            with: pgConfig?.with,\n            using: pgConfig?.using,\n            tablespace: pgConfig?.tablespace,\n            withNoData: pgConfig?.withNoData,\n        };\n    }\n}\n/** @internal */\nfunction pgViewWithSchema(name, selection, schema) {\n    if (selection) {\n        return new ManualViewBuilder(name, selection, schema);\n    }\n    return new ViewBuilder(name, schema);\n}\n/** @internal */\nfunction pgMaterializedViewWithSchema(name, selection, schema) {\n    if (selection) {\n        return new ManualMaterializedViewBuilder(name, selection, schema);\n    }\n    return new MaterializedViewBuilder(name, schema);\n}\nfunction pgView(name, columns) {\n    return pgViewWithSchema(name, columns, undefined);\n}\nfunction pgMaterializedView(name, columns) {\n    return pgMaterializedViewWithSchema(name, columns, undefined);\n}\n\nclass Relation {\n    sourceTable;\n    referencedTable;\n    relationName;\n    static [entityKind] = 'Relation';\n    referencedTableName;\n    fieldName;\n    constructor(sourceTable, referencedTable, relationName) {\n        this.sourceTable = sourceTable;\n        this.referencedTable = referencedTable;\n        this.relationName = relationName;\n        this.referencedTableName = referencedTable[Table.Symbol.Name];\n    }\n}\nclass Relations {\n    table;\n    config;\n    static [entityKind] = 'Relations';\n    constructor(table, config) {\n        this.table = table;\n        this.config = config;\n    }\n}\nclass One extends Relation {\n    config;\n    isNullable;\n    static [entityKind] = 'One';\n    constructor(sourceTable, referencedTable, config, isNullable) {\n        super(sourceTable, referencedTable, config?.relationName);\n        this.config = config;\n        this.isNullable = isNullable;\n    }\n    withFieldName(fieldName) {\n        const relation = new One(this.sourceTable, this.referencedTable, this.config, this.isNullable);\n        relation.fieldName = fieldName;\n        return relation;\n    }\n}\nclass Many extends Relation {\n    config;\n    static [entityKind] = 'Many';\n    constructor(sourceTable, referencedTable, config) {\n        super(sourceTable, referencedTable, config?.relationName);\n        this.config = config;\n    }\n    withFieldName(fieldName) {\n        const relation = new Many(this.sourceTable, this.referencedTable, this.config);\n        relation.fieldName = fieldName;\n        return relation;\n    }\n}\nfunction getOperators() {\n    return {\n        and,\n        between,\n        eq,\n        exists,\n        gt,\n        gte,\n        ilike,\n        inArray,\n        isNull,\n        isNotNull,\n        like,\n        lt,\n        lte,\n        ne,\n        not,\n        notBetween,\n        notExists,\n        notLike,\n        notIlike,\n        notInArray,\n        or,\n        sql,\n    };\n}\nfunction getOrderByOperators() {\n    return {\n        sql,\n        asc,\n        desc,\n    };\n}\nfunction extractTablesRelationalConfig(schema, configHelpers) {\n    if (Object.keys(schema).length === 1\n        && 'default' in schema\n        && !is(schema['default'], Table)) {\n        schema = schema['default'];\n    }\n    // table DB name -> schema table key\n    const tableNamesMap = {};\n    // Table relations found before their tables - need to buffer them until we know the schema table key\n    const relationsBuffer = {};\n    const tablesConfig = {};\n    for (const [key, value] of Object.entries(schema)) {\n        if (isTable(value)) {\n            const dbName = value[Table.Symbol.Name];\n            const bufferedRelations = relationsBuffer[dbName];\n            tableNamesMap[dbName] = key;\n            tablesConfig[key] = {\n                tsName: key,\n                dbName: value[Table.Symbol.Name],\n                columns: value[Table.Symbol.Columns],\n                relations: bufferedRelations?.relations ?? {},\n                primaryKey: bufferedRelations?.primaryKey ?? [],\n            };\n            // Fill in primary keys\n            for (const column of Object.values(value[Table.Symbol.Columns])) {\n                if (column.primary) {\n                    tablesConfig[key].primaryKey.push(column);\n                }\n            }\n            const extraConfig = value[Table.Symbol.ExtraConfigBuilder]?.(value);\n            if (extraConfig) {\n                for (const configEntry of Object.values(extraConfig)) {\n                    if (is(configEntry, PrimaryKeyBuilder)) {\n                        tablesConfig[key].primaryKey.push(...configEntry.columns);\n                    }\n                }\n            }\n        }\n        else if (is(value, Relations)) {\n            const dbName = value.table[Table.Symbol.Name];\n            const tableName = tableNamesMap[dbName];\n            const relations = value.config(configHelpers(value.table));\n            let primaryKey;\n            for (const [relationName, relation] of Object.entries(relations)) {\n                if (tableName) {\n                    const tableConfig = tablesConfig[tableName];\n                    tableConfig.relations[relationName] = relation;\n                }\n                else {\n                    if (!(dbName in relationsBuffer)) {\n                        relationsBuffer[dbName] = {\n                            relations: {},\n                            primaryKey,\n                        };\n                    }\n                    relationsBuffer[dbName].relations[relationName] = relation;\n                }\n            }\n        }\n    }\n    return { tables: tablesConfig, tableNamesMap };\n}\nfunction relations(table, relations) {\n    return new Relations(table, (helpers) => Object.fromEntries(Object.entries(relations(helpers)).map(([key, value]) => [\n        key,\n        value.withFieldName(key),\n    ])));\n}\nfunction createOne(sourceTable) {\n    return function one(table, config) {\n        return new One(sourceTable, table, config, (config?.fields.reduce((res, f) => res && f.notNull, true)\n            ?? false));\n    };\n}\nfunction createMany(sourceTable) {\n    return function many(referencedTable, config) {\n        return new Many(sourceTable, referencedTable, config);\n    };\n}\nfunction normalizeRelation(schema, tableNamesMap, relation) {\n    if (is(relation, One) && relation.config) {\n        return {\n            fields: relation.config.fields,\n            references: relation.config.references,\n        };\n    }\n    const referencedTableTsName = tableNamesMap[relation.referencedTable[Table.Symbol.Name]];\n    if (!referencedTableTsName) {\n        throw new Error(`Table \"${relation.referencedTable[Table.Symbol.Name]}\" not found in schema`);\n    }\n    const referencedTableConfig = schema[referencedTableTsName];\n    if (!referencedTableConfig) {\n        throw new Error(`Table \"${referencedTableTsName}\" not found in schema`);\n    }\n    const sourceTable = relation.sourceTable;\n    const sourceTableTsName = tableNamesMap[sourceTable[Table.Symbol.Name]];\n    if (!sourceTableTsName) {\n        throw new Error(`Table \"${sourceTable[Table.Symbol.Name]}\" not found in schema`);\n    }\n    const reverseRelations = [];\n    for (const referencedTableRelation of Object.values(referencedTableConfig.relations)) {\n        if ((relation.relationName\n            && relation !== referencedTableRelation\n            && referencedTableRelation.relationName === relation.relationName)\n            || (!relation.relationName\n                && referencedTableRelation.referencedTable === relation.sourceTable)) {\n            reverseRelations.push(referencedTableRelation);\n        }\n    }\n    if (reverseRelations.length > 1) {\n        throw relation.relationName\n            ? new Error(`There are multiple relations with name \"${relation.relationName}\" in table \"${referencedTableTsName}\"`)\n            : new Error(`There are multiple relations between \"${referencedTableTsName}\" and \"${relation.sourceTable[Table.Symbol.Name]}\". Please specify relation name`);\n    }\n    if (reverseRelations[0]\n        && is(reverseRelations[0], One)\n        && reverseRelations[0].config) {\n        return {\n            fields: reverseRelations[0].config.references,\n            references: reverseRelations[0].config.fields,\n        };\n    }\n    throw new Error(`There is not enough information to infer relation \"${sourceTableTsName}.${relation.fieldName}\"`);\n}\nfunction createTableRelationsHelpers(sourceTable) {\n    return {\n        one: createOne(sourceTable),\n        many: createMany(sourceTable),\n    };\n}\nfunction mapRelationalRow(tablesConfig, tableConfig, row, buildQueryResultSelection, mapColumnValue = (value) => value) {\n    const result = {};\n    for (const [selectionItemIndex, selectionItem,] of buildQueryResultSelection.entries()) {\n        if (selectionItem.isJson) {\n            const relation = tableConfig.relations[selectionItem.tsKey];\n            const rawSubRows = row[selectionItemIndex];\n            const subRows = typeof rawSubRows === 'string'\n                ? JSON.parse(rawSubRows)\n                : rawSubRows;\n            result[selectionItem.tsKey] = is(relation, One)\n                ? subRows\n                    && mapRelationalRow(tablesConfig, tablesConfig[selectionItem.relationTableTsKey], subRows, selectionItem.selection, mapColumnValue)\n                : subRows.map((subRow) => mapRelationalRow(tablesConfig, tablesConfig[selectionItem.relationTableTsKey], subRow, selectionItem.selection, mapColumnValue));\n        }\n        else {\n            const value = mapColumnValue(row[selectionItemIndex]);\n            const field = selectionItem.field;\n            let decoder;\n            if (is(field, Column)) {\n                decoder = field;\n            }\n            else if (is(field, SQL)) {\n                decoder = field.decoder;\n            }\n            else {\n                decoder = field.sql.decoder;\n            }\n            result[selectionItem.tsKey] = value === null ? null : decoder.mapFromDriverValue(value);\n        }\n    }\n    return result;\n}\n\nfunction bindIfParam(value, column) {\n    if (isDriverValueEncoder(column)\n        && !isSQLWrapper(value)\n        && !is(value, Param)\n        && !is(value, Placeholder)\n        && !is(value, Column)\n        && !is(value, Table)\n        && !is(value, View)) {\n        return new Param(value, column);\n    }\n    return value;\n}\n/**\n * Test that two values are equal.\n *\n * Remember that the SQL standard dictates that\n * two NULL values are not equal, so if you want to test\n * whether a value is null, you may want to use\n * `isNull` instead.\n *\n * ## Examples\n *\n * ```ts\n * // Select cars made by Ford\n * db.select().from(cars)\n *   .where(eq(cars.make, 'Ford'))\n * ```\n *\n * @see isNull for a way to test equality to NULL.\n */\nconst eq = (left, right) => {\n    return sql `${left} = ${bindIfParam(right, left)}`;\n};\n/**\n * Test that two values are not equal.\n *\n * Remember that the SQL standard dictates that\n * two NULL values are not equal, so if you want to test\n * whether a value is not null, you may want to use\n * `isNotNull` instead.\n *\n * ## Examples\n *\n * ```ts\n * // Select cars not made by Ford\n * db.select().from(cars)\n *   .where(ne(cars.make, 'Ford'))\n * ```\n *\n * @see isNotNull for a way to test whether a value is not null.\n */\nconst ne = (left, right) => {\n    return sql `${left} <> ${bindIfParam(right, left)}`;\n};\nfunction and(...unfilteredConditions) {\n    const conditions = unfilteredConditions.filter((c) => c !== undefined);\n    if (conditions.length === 0) {\n        return undefined;\n    }\n    if (conditions.length === 1) {\n        return new SQL(conditions);\n    }\n    return new SQL([\n        new StringChunk('('),\n        sql.join(conditions, new StringChunk(' and ')),\n        new StringChunk(')'),\n    ]);\n}\nfunction or(...unfilteredConditions) {\n    const conditions = unfilteredConditions.filter((c) => c !== undefined);\n    if (conditions.length === 0) {\n        return undefined;\n    }\n    if (conditions.length === 1) {\n        return new SQL(conditions);\n    }\n    return new SQL([\n        new StringChunk('('),\n        sql.join(conditions, new StringChunk(' or ')),\n        new StringChunk(')'),\n    ]);\n}\n/**\n * Negate the meaning of an expression using the `not` keyword.\n *\n * ## Examples\n *\n * ```ts\n * // Select cars _not_ made by GM or Ford.\n * db.select().from(cars)\n *   .where(not(inArray(cars.make, ['GM', 'Ford'])))\n * ```\n */\nfunction not(condition) {\n    return sql `not ${condition}`;\n}\n/**\n * Test that the first expression passed is greater than\n * the second expression.\n *\n * ## Examples\n *\n * ```ts\n * // Select cars made after 2000.\n * db.select().from(cars)\n *   .where(gt(cars.year, 2000))\n * ```\n *\n * @see gte for greater-than-or-equal\n */\nconst gt = (left, right) => {\n    return sql `${left} > ${bindIfParam(right, left)}`;\n};\n/**\n * Test that the first expression passed is greater than\n * or equal to the second expression. Use `gt` to\n * test whether an expression is strictly greater\n * than another.\n *\n * ## Examples\n *\n * ```ts\n * // Select cars made on or after 2000.\n * db.select().from(cars)\n *   .where(gte(cars.year, 2000))\n * ```\n *\n * @see gt for a strictly greater-than condition\n */\nconst gte = (left, right) => {\n    return sql `${left} >= ${bindIfParam(right, left)}`;\n};\n/**\n * Test that the first expression passed is less than\n * the second expression.\n *\n * ## Examples\n *\n * ```ts\n * // Select cars made before 2000.\n * db.select().from(cars)\n *   .where(lt(cars.year, 2000))\n * ```\n *\n * @see lte for greater-than-or-equal\n */\nconst lt = (left, right) => {\n    return sql `${left} < ${bindIfParam(right, left)}`;\n};\n/**\n * Test that the first expression passed is less than\n * or equal to the second expression.\n *\n * ## Examples\n *\n * ```ts\n * // Select cars made before 2000.\n * db.select().from(cars)\n *   .where(lte(cars.year, 2000))\n * ```\n *\n * @see lt for a strictly less-than condition\n */\nconst lte = (left, right) => {\n    return sql `${left} <= ${bindIfParam(right, left)}`;\n};\nfunction inArray(column, values) {\n    if (Array.isArray(values)) {\n        if (values.length === 0) {\n            throw new Error('inArray requires at least one value');\n        }\n        return sql `${column} in ${values.map((v) => bindIfParam(v, column))}`;\n    }\n    return sql `${column} in ${bindIfParam(values, column)}`;\n}\nfunction notInArray(column, values) {\n    if (Array.isArray(values)) {\n        if (values.length === 0) {\n            throw new Error('notInArray requires at least one value');\n        }\n        return sql `${column} not in ${values.map((v) => bindIfParam(v, column))}`;\n    }\n    return sql `${column} not in ${bindIfParam(values, column)}`;\n}\n/**\n * Test whether an expression is NULL. By the SQL standard,\n * NULL is neither equal nor not equal to itself, so\n * it's recommended to use `isNull` and `notIsNull` for\n * comparisons to NULL.\n *\n * ## Examples\n *\n * ```ts\n * // Select cars that have no discontinuedAt date.\n * db.select().from(cars)\n *   .where(isNull(cars.discontinuedAt))\n * ```\n *\n * @see isNotNull for the inverse of this test\n */\nfunction isNull(value) {\n    return sql `${value} is null`;\n}\n/**\n * Test whether an expression is not NULL. By the SQL standard,\n * NULL is neither equal nor not equal to itself, so\n * it's recommended to use `isNull` and `notIsNull` for\n * comparisons to NULL.\n *\n * ## Examples\n *\n * ```ts\n * // Select cars that have been discontinued.\n * db.select().from(cars)\n *   .where(isNotNull(cars.discontinuedAt))\n * ```\n *\n * @see isNull for the inverse of this test\n */\nfunction isNotNull(value) {\n    return sql `${value} is not null`;\n}\n/**\n * Test whether a subquery evaluates to have any rows.\n *\n * ## Examples\n *\n * ```ts\n * // Users whose `homeCity` column has a match in a cities\n * // table.\n * db\n *   .select()\n *   .from(users)\n *   .where(\n *     exists(db.select()\n *       .from(cities)\n *       .where(eq(users.homeCity, cities.id))),\n *   );\n * ```\n *\n * @see notExists for the inverse of this test\n */\nfunction exists(subquery) {\n    return sql `exists (${subquery})`;\n}\n/**\n * Test whether a subquery doesn't include any result\n * rows.\n *\n * ## Examples\n *\n * ```ts\n * // Users whose `homeCity` column doesn't match\n * // a row in the cities table.\n * db\n *   .select()\n *   .from(users)\n *   .where(\n *     notExists(db.select()\n *       .from(cities)\n *       .where(eq(users.homeCity, cities.id))),\n *   );\n * ```\n *\n * @see exists for the inverse of this test\n */\nfunction notExists(subquery) {\n    return sql `not exists (${subquery})`;\n}\nfunction between(column, min, max) {\n    return sql `${column} between ${bindIfParam(min, column)} and ${bindIfParam(max, column)}`;\n}\nfunction notBetween(column, min, max) {\n    return sql `${column} not between ${bindIfParam(min, column)} and ${bindIfParam(max, column)}`;\n}\n/**\n * Compare a column to a pattern, which can include `%` and `_`\n * characters to match multiple variations. Including `%`\n * in the pattern matches zero or more characters, and including\n * `_` will match a single character.\n *\n * ## Examples\n *\n * ```ts\n * // Select all cars with 'Turbo' in their names.\n * db.select().from(cars)\n *   .where(like(cars.name, '%Turbo%'))\n * ```\n *\n * @see ilike for a case-insensitive version of this condition\n */\nfunction like(column, value) {\n    return sql `${column} like ${value}`;\n}\n/**\n * The inverse of like - this tests that a given column\n * does not match a pattern, which can include `%` and `_`\n * characters to match multiple variations. Including `%`\n * in the pattern matches zero or more characters, and including\n * `_` will match a single character.\n *\n * ## Examples\n *\n * ```ts\n * // Select all cars that don't have \"ROver\" in their name.\n * db.select().from(cars)\n *   .where(notLike(cars.name, '%Rover%'))\n * ```\n *\n * @see like for the inverse condition\n * @see notIlike for a case-insensitive version of this condition\n */\nfunction notLike(column, value) {\n    return sql `${column} not like ${value}`;\n}\n/**\n * Case-insensitively compare a column to a pattern,\n * which can include `%` and `_`\n * characters to match multiple variations. Including `%`\n * in the pattern matches zero or more characters, and including\n * `_` will match a single character.\n *\n * Unlike like, this performs a case-insensitive comparison.\n *\n * ## Examples\n *\n * ```ts\n * // Select all cars with 'Turbo' in their names.\n * db.select().from(cars)\n *   .where(ilike(cars.name, '%Turbo%'))\n * ```\n *\n * @see like for a case-sensitive version of this condition\n */\nfunction ilike(column, value) {\n    return sql `${column} ilike ${value}`;\n}\n/**\n * The inverse of ilike - this case-insensitively tests that a given column\n * does not match a pattern, which can include `%` and `_`\n * characters to match multiple variations. Including `%`\n * in the pattern matches zero or more characters, and including\n * `_` will match a single character.\n *\n * ## Examples\n *\n * ```ts\n * // Select all cars that don't have \"Rover\" in their name.\n * db.select().from(cars)\n *   .where(notLike(cars.name, '%Rover%'))\n * ```\n *\n * @see ilike for the inverse condition\n * @see notLike for a case-sensitive version of this condition\n */\nfunction notIlike(column, value) {\n    return sql `${column} not ilike ${value}`;\n}\nfunction arrayContains(column, values) {\n    if (Array.isArray(values)) {\n        if (values.length === 0) {\n            throw new Error('arrayContains requires at least one value');\n        }\n        const array = sql `${bindIfParam(values, column)}`;\n        return sql `${column} @> ${array}`;\n    }\n    return sql `${column} @> ${bindIfParam(values, column)}`;\n}\nfunction arrayContained(column, values) {\n    if (Array.isArray(values)) {\n        if (values.length === 0) {\n            throw new Error('arrayContained requires at least one value');\n        }\n        const array = sql `${bindIfParam(values, column)}`;\n        return sql `${column} <@ ${array}`;\n    }\n    return sql `${column} <@ ${bindIfParam(values, column)}`;\n}\nfunction arrayOverlaps(column, values) {\n    if (Array.isArray(values)) {\n        if (values.length === 0) {\n            throw new Error('arrayOverlaps requires at least one value');\n        }\n        const array = sql `${bindIfParam(values, column)}`;\n        return sql `${column} && ${array}`;\n    }\n    return sql `${column} && ${bindIfParam(values, column)}`;\n}\n\n/**\n * Used in sorting, this specifies that the given\n * column or expression should be sorted in ascending\n * order. By the SQL standard, ascending order is the\n * default, so it is not usually necessary to specify\n * ascending sort order.\n *\n * ## Examples\n *\n * ```ts\n * // Return cars, starting with the oldest models\n * // and going in ascending order to the newest.\n * db.select().from(cars)\n *   .orderBy(asc(cars.year));\n * ```\n *\n * @see desc to sort in descending order\n */\nfunction asc(column) {\n    return sql `${column} asc`;\n}\n/**\n * Used in sorting, this specifies that the given\n * column or expression should be sorted in descending\n * order.\n *\n * ## Examples\n *\n * ```ts\n * // Select users, with the most recently created\n * // records coming first.\n * db.select().from(users)\n *   .orderBy(desc(users.createdAt));\n * ```\n *\n * @see asc to sort in ascending order\n */\nfunction desc(column) {\n    return sql `${column} desc`;\n}\n\n/**\n * This class is used to indicate a primitive param value that is used in `sql` tag.\n * It is only used on type level and is never instantiated at runtime.\n * If you see a value of this type in the code, its runtime value is actually the primitive param value.\n */\nclass FakePrimitiveParam {\n    static [entityKind] = 'FakePrimitiveParam';\n}\nfunction isSQLWrapper(value) {\n    return typeof value === 'object' && value !== null && 'getSQL' in value\n        && typeof value.getSQL === 'function';\n}\nfunction mergeQueries(queries) {\n    const result = { sql: '', params: [] };\n    for (const query of queries) {\n        result.sql += query.sql;\n        result.params.push(...query.params);\n        if (query.typings?.length) {\n            if (!result.typings) {\n                result.typings = [];\n            }\n            result.typings.push(...query.typings);\n        }\n    }\n    return result;\n}\nclass StringChunk {\n    static [entityKind] = 'StringChunk';\n    value;\n    constructor(value) {\n        this.value = Array.isArray(value) ? value : [value];\n    }\n    getSQL() {\n        return new SQL([this]);\n    }\n}\nclass SQL {\n    queryChunks;\n    static [entityKind] = 'SQL';\n    /** @internal */\n    decoder = noopDecoder;\n    shouldInlineParams = false;\n    constructor(queryChunks) {\n        this.queryChunks = queryChunks;\n    }\n    append(query) {\n        this.queryChunks.push(...query.queryChunks);\n        return this;\n    }\n    toQuery(config) {\n        return tracer.startActiveSpan('drizzle.buildSQL', (span) => {\n            const query = this.buildQueryFromSourceParams(this.queryChunks, config);\n            span?.setAttributes({\n                'drizzle.query.text': query.sql,\n                'drizzle.query.params': JSON.stringify(query.params),\n            });\n            return query;\n        });\n    }\n    buildQueryFromSourceParams(chunks, _config) {\n        const config = Object.assign({}, _config, {\n            inlineParams: _config.inlineParams || this.shouldInlineParams,\n            paramStartIndex: _config.paramStartIndex || { value: 0 },\n        });\n        const { escapeName, escapeParam, prepareTyping, inlineParams, paramStartIndex, } = config;\n        return mergeQueries(chunks.map((chunk) => {\n            if (is(chunk, StringChunk)) {\n                return { sql: chunk.value.join(''), params: [] };\n            }\n            if (is(chunk, Name)) {\n                return { sql: escapeName(chunk.value), params: [] };\n            }\n            if (chunk === undefined) {\n                return { sql: '', params: [] };\n            }\n            if (Array.isArray(chunk)) {\n                const result = [new StringChunk('(')];\n                for (const [i, p] of chunk.entries()) {\n                    result.push(p);\n                    if (i < chunk.length - 1) {\n                        result.push(new StringChunk(', '));\n                    }\n                }\n                result.push(new StringChunk(')'));\n                return this.buildQueryFromSourceParams(result, config);\n            }\n            if (is(chunk, SQL)) {\n                return this.buildQueryFromSourceParams(chunk.queryChunks, {\n                    ...config,\n                    inlineParams: inlineParams || chunk.shouldInlineParams,\n                });\n            }\n            if (is(chunk, Table)) {\n                const schemaName = chunk[Table.Symbol.Schema];\n                const tableName = chunk[Table.Symbol.Name];\n                return {\n                    sql: schemaName === undefined\n                        ? escapeName(tableName)\n                        : escapeName(schemaName) + '.' + escapeName(tableName),\n                    params: [],\n                };\n            }\n            if (is(chunk, Column)) {\n                return { sql: escapeName(chunk.table[Table.Symbol.Name]) + '.' + escapeName(chunk.name), params: [] };\n            }\n            if (is(chunk, View)) {\n                const schemaName = chunk[ViewBaseConfig].schema;\n                const viewName = chunk[ViewBaseConfig].name;\n                return {\n                    sql: schemaName === undefined\n                        ? escapeName(viewName)\n                        : escapeName(schemaName) + '.' + escapeName(viewName),\n                    params: [],\n                };\n            }\n            if (is(chunk, Param)) {\n                const mappedValue = (chunk.value === null) ? null : chunk.encoder.mapToDriverValue(chunk.value);\n                if (is(mappedValue, SQL)) {\n                    return this.buildQueryFromSourceParams([mappedValue], config);\n                }\n                if (inlineParams) {\n                    return { sql: this.mapInlineParam(mappedValue, config), params: [] };\n                }\n                let typings;\n                if (prepareTyping !== undefined) {\n                    typings = [prepareTyping(chunk.encoder)];\n                }\n                return { sql: escapeParam(paramStartIndex.value++, mappedValue), params: [mappedValue], typings };\n            }\n            if (is(chunk, Placeholder)) {\n                return { sql: escapeParam(paramStartIndex.value++, chunk), params: [chunk] };\n            }\n            if (is(chunk, SQL.Aliased) && chunk.fieldAlias !== undefined) {\n                return { sql: escapeName(chunk.fieldAlias), params: [] };\n            }\n            if (is(chunk, Subquery)) {\n                if (chunk[SubqueryConfig].isWith) {\n                    return { sql: escapeName(chunk[SubqueryConfig].alias), params: [] };\n                }\n                return this.buildQueryFromSourceParams([\n                    new StringChunk('('),\n                    chunk[SubqueryConfig].sql,\n                    new StringChunk(') '),\n                    new Name(chunk[SubqueryConfig].alias),\n                ], config);\n            }\n            // if (is(chunk, Placeholder)) {\n            // \treturn {sql: escapeParam}\n            if (isSQLWrapper(chunk)) {\n                return this.buildQueryFromSourceParams([\n                    new StringChunk('('),\n                    chunk.getSQL(),\n                    new StringChunk(')'),\n                ], config);\n            }\n            if (is(chunk, Relation)) {\n                return this.buildQueryFromSourceParams([\n                    chunk.sourceTable,\n                    new StringChunk('.'),\n                    sql.identifier(chunk.fieldName),\n                ], config);\n            }\n            if (inlineParams) {\n                return { sql: this.mapInlineParam(chunk, config), params: [] };\n            }\n            return { sql: escapeParam(paramStartIndex.value++, chunk), params: [chunk] };\n        }));\n    }\n    mapInlineParam(chunk, { escapeString }) {\n        if (chunk === null) {\n            return 'null';\n        }\n        if (typeof chunk === 'number' || typeof chunk === 'boolean') {\n            return chunk.toString();\n        }\n        if (typeof chunk === 'string') {\n            return escapeString(chunk);\n        }\n        if (typeof chunk === 'object') {\n            const mappedValueAsString = chunk.toString();\n            if (mappedValueAsString === '[object Object]') {\n                return escapeString(JSON.stringify(chunk));\n            }\n            return escapeString(mappedValueAsString);\n        }\n        throw new Error('Unexpected param value: ' + chunk);\n    }\n    getSQL() {\n        return this;\n    }\n    as(alias) {\n        // TODO: remove with deprecated overloads\n        if (alias === undefined) {\n            return this;\n        }\n        return new SQL.Aliased(this, alias);\n    }\n    mapWith(decoder) {\n        this.decoder = typeof decoder === 'function' ? { mapFromDriverValue: decoder } : decoder;\n        return this;\n    }\n    inlineParams() {\n        this.shouldInlineParams = true;\n        return this;\n    }\n}\n/**\n * Any DB name (table, column, index etc.)\n */\nclass Name {\n    value;\n    static [entityKind] = 'Name';\n    brand;\n    constructor(value) {\n        this.value = value;\n    }\n    getSQL() {\n        return new SQL([this]);\n    }\n}\n/**\n * Any DB name (table, column, index etc.)\n * @deprecated Use `sql.identifier` instead.\n */\nfunction name(value) {\n    return new Name(value);\n}\nfunction isDriverValueEncoder(value) {\n    return typeof value === 'object' && value !== null && 'mapToDriverValue' in value\n        && typeof value.mapToDriverValue === 'function';\n}\nconst noopDecoder = {\n    mapFromDriverValue: (value) => value,\n};\nconst noopEncoder = {\n    mapToDriverValue: (value) => value,\n};\nconst noopMapper = {\n    ...noopDecoder,\n    ...noopEncoder,\n};\n/** Parameter value that is optionally bound to an encoder (for example, a column). */\nclass Param {\n    value;\n    encoder;\n    static [entityKind] = 'Param';\n    brand;\n    /**\n     * @param value - Parameter value\n     * @param encoder - Encoder to convert the value to a driver parameter\n     */\n    constructor(value, encoder = noopEncoder) {\n        this.value = value;\n        this.encoder = encoder;\n    }\n    getSQL() {\n        return new SQL([this]);\n    }\n}\n/** @deprecated Use `sql.param` instead. */\nfunction param(value, encoder) {\n    return new Param(value, encoder);\n}\n/*\n    The type of `params` is specified as `SQLSourceParam[]`, but that's slightly incorrect -\n    in runtime, users won't pass `FakePrimitiveParam` instances as `params` - they will pass primitive values\n    which will be wrapped in `Param` using `buildChunksFromParam(...)`. That's why the overload\n    specify `params` as `any[]` and not as `SQLSourceParam[]`. This type is used to make our lives easier and\n    the type checker happy.\n*/\nfunction sql(strings, ...params) {\n    const queryChunks = [];\n    if (params.length > 0 || (strings.length > 0 && strings[0] !== '')) {\n        queryChunks.push(new StringChunk(strings[0]));\n    }\n    for (const [paramIndex, param] of params.entries()) {\n        queryChunks.push(param, new StringChunk(strings[paramIndex + 1]));\n    }\n    return new SQL(queryChunks);\n}\n(function (sql) {\n    function empty() {\n        return new SQL([]);\n    }\n    sql.empty = empty;\n    /** @deprecated - use `sql.join()` */\n    function fromList(list) {\n        return new SQL(list);\n    }\n    sql.fromList = fromList;\n    /**\n     * Convenience function to create an SQL query from a raw string.\n     * @param str The raw SQL query string.\n     */\n    function raw(str) {\n        return new SQL([new StringChunk(str)]);\n    }\n    sql.raw = raw;\n    /**\n     * Join a list of SQL chunks with a separator.\n     * @example\n     * ```ts\n     * const query = sql.join([sql`a`, sql`b`, sql`c`]);\n     * // sql`abc`\n     * ```\n     * @example\n     * ```ts\n     * const query = sql.join([sql`a`, sql`b`, sql`c`], sql`, `);\n     * // sql`a, b, c`\n     * ```\n     */\n    function join(chunks, separator) {\n        const result = [];\n        for (const [i, chunk] of chunks.entries()) {\n            if (i > 0 && separator !== undefined) {\n                result.push(separator);\n            }\n            result.push(chunk);\n        }\n        return new SQL(result);\n    }\n    sql.join = join;\n    /**\n     * Create a SQL chunk that represents a DB identifier (table, column, index etc.).\n     * When used in a query, the identifier will be escaped based on the DB engine.\n     * For example, in PostgreSQL, identifiers are escaped with double quotes.\n     *\n     * **WARNING: This function does not offer any protection against SQL injections, so you must validate any user input beforehand.**\n     *\n     * @example ```ts\n     * const query = sql`SELECT * FROM ${sql.identifier('my-table')}`;\n     * // 'SELECT * FROM \"my-table\"'\n     * ```\n     */\n    function identifier(value) {\n        return new Name(value);\n    }\n    sql.identifier = identifier;\n    function placeholder(name) {\n        return new Placeholder(name);\n    }\n    sql.placeholder = placeholder;\n    function param(value, encoder) {\n        return new Param(value, encoder);\n    }\n    sql.param = param;\n})(sql || (sql = {}));\n(function (SQL) {\n    class Aliased {\n        sql;\n        fieldAlias;\n        static [entityKind] = 'SQL.Aliased';\n        /** @internal */\n        isSelectionField = false;\n        constructor(sql, fieldAlias) {\n            this.sql = sql;\n            this.fieldAlias = fieldAlias;\n        }\n        getSQL() {\n            return this.sql;\n        }\n        /** @internal */\n        clone() {\n            return new Aliased(this.sql, this.fieldAlias);\n        }\n    }\n    SQL.Aliased = Aliased;\n})(SQL || (SQL = {}));\nclass Placeholder {\n    name;\n    static [entityKind] = 'Placeholder';\n    constructor(name) {\n        this.name = name;\n    }\n    getSQL() {\n        return new SQL([this]);\n    }\n}\n/** @deprecated Use `sql.placeholder` instead. */\nfunction placeholder(name) {\n    return new Placeholder(name);\n}\nfunction fillPlaceholders(params, values) {\n    return params.map((p) => {\n        if (is(p, Placeholder)) {\n            if (!(p.name in values)) {\n                throw new Error(`No value for placeholder \"${p.name}\" was provided`);\n            }\n            return values[p.name];\n        }\n        return p;\n    });\n}\n// Defined separately from the Column class to resolve circular dependency\nColumn.prototype.getSQL = function () {\n    return new SQL([this]);\n};\n\nclass ColumnAliasProxyHandler {\n    table;\n    static [entityKind] = 'ColumnAliasProxyHandler';\n    constructor(table) {\n        this.table = table;\n    }\n    get(columnObj, prop) {\n        if (prop === 'table') {\n            return this.table;\n        }\n        return columnObj[prop];\n    }\n}\nclass TableAliasProxyHandler {\n    alias;\n    replaceOriginalName;\n    static [entityKind] = 'TableAliasProxyHandler';\n    constructor(alias, replaceOriginalName) {\n        this.alias = alias;\n        this.replaceOriginalName = replaceOriginalName;\n    }\n    get(target, prop) {\n        if (prop === Table.Symbol.IsAlias) {\n            return true;\n        }\n        if (prop === Table.Symbol.Name) {\n            return this.alias;\n        }\n        if (this.replaceOriginalName && prop === Table.Symbol.OriginalName) {\n            return this.alias;\n        }\n        if (prop === ViewBaseConfig) {\n            return {\n                ...target[ViewBaseConfig],\n                name: this.alias,\n                isAlias: true,\n            };\n        }\n        if (prop === Table.Symbol.Columns) {\n            const columns = target[Table.Symbol.Columns];\n            if (!columns) {\n                return columns;\n            }\n            const proxiedColumns = {};\n            Object.keys(columns).map((key) => {\n                proxiedColumns[key] = new Proxy(columns[key], new ColumnAliasProxyHandler(new Proxy(target, this)));\n            });\n            return proxiedColumns;\n        }\n        const value = target[prop];\n        if (is(value, Column)) {\n            return new Proxy(value, new ColumnAliasProxyHandler(new Proxy(target, this)));\n        }\n        return value;\n    }\n}\nclass RelationTableAliasProxyHandler {\n    alias;\n    static [entityKind] = 'RelationTableAliasProxyHandler';\n    constructor(alias) {\n        this.alias = alias;\n    }\n    get(target, prop) {\n        if (prop === 'sourceTable') {\n            return aliasedTable(target.sourceTable, this.alias);\n        }\n        return target[prop];\n    }\n}\nfunction aliasedTable(table, tableAlias) {\n    return new Proxy(table, new TableAliasProxyHandler(tableAlias, false));\n}\nfunction aliasedRelation(relation, tableAlias) {\n    return new Proxy(relation, new RelationTableAliasProxyHandler(tableAlias));\n}\nfunction aliasedTableColumn(column, tableAlias) {\n    return new Proxy(column, new ColumnAliasProxyHandler(new Proxy(column.table, new TableAliasProxyHandler(tableAlias, false))));\n}\nfunction mapColumnsInAliasedSQLToAlias(query, alias) {\n    return new SQL.Aliased(mapColumnsInSQLToAlias(query.sql, alias), query.fieldAlias);\n}\nfunction mapColumnsInSQLToAlias(query, alias) {\n    return sql.join(query.queryChunks.map((c) => {\n        if (is(c, Column)) {\n            return aliasedTableColumn(c, alias);\n        }\n        if (is(c, SQL)) {\n            return mapColumnsInSQLToAlias(c, alias);\n        }\n        if (is(c, SQL.Aliased)) {\n            return mapColumnsInAliasedSQLToAlias(c, alias);\n        }\n        return c;\n    }));\n}\n\n\n//# sourceMappingURL=alias-cf8e03cd.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvZHJpenpsZS1vcm0vYWxpYXMtY2Y4ZTAzY2QubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQztBQUNqQztBQUNBO0FBQ0E7QUFDQSxrQ0FBa0MseUJBQXlCO0FBQzNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IscUNBQXFDO0FBQ3ZEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVEQUF1RCxLQUFLO0FBQzVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkNBQTZDLGFBQWE7QUFDMUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSyxJQUFJO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCLHNCQUFzQjtBQUNoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0Q0FBNEMsUUFBUSxJQUFJLGNBQWM7QUFDdEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0M7QUFDcEM7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7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Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsNkJBQTZCLEdBQUcsK0NBQStDO0FBQ2pHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7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QWdEO0FBQ2hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlJQUFpSSwwREFBMEQ7QUFDM0wsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QixJQUFJO0FBQ2hDLGFBQWE7QUFDYjtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLElBQUk7QUFDNUIsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQixrQkFBa0I7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLGtCQUFrQjtBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2REFBNkQ7QUFDN0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUNBQXlDO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FB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QUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseURBQXlELDhCQUE4QjtBQUN2RjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUNBQXlDLDJCQUEyQjtBQUNwRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDLGtCQUFrQjtBQUNuQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQyxrQkFBa0I7QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkRBQTZELE9BQU87QUFDcEU7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFdzJHO0FBQ3gyRyIsInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxFZGdhciBKIFJvamFzIExcXGRldlxcY2FwcmVzLXdlYlxcbm9kZV9tb2R1bGVzXFxkcml6emxlLW9ybVxcYWxpYXMtY2Y4ZTAzY2QubWpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGVudGl0eUtpbmQgPSBTeW1ib2wuZm9yKCdkcml6emxlOmVudGl0eUtpbmQnKTtcbmNvbnN0IGhhc093bkVudGl0eUtpbmQgPSBTeW1ib2wuZm9yKCdkcml6emxlOmhhc093bkVudGl0eUtpbmQnKTtcbmZ1bmN0aW9uIGlzKHZhbHVlLCB0eXBlKSB7XG4gICAgaWYgKCF2YWx1ZSB8fCB0eXBlb2YgdmFsdWUgIT09ICdvYmplY3QnKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgdHlwZSkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWluc3RhbmNlb2Yvbm8taW5zdGFuY2VvZlxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKCFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwodHlwZSwgZW50aXR5S2luZCkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDbGFzcyBcIiR7dHlwZS5uYW1lID8/ICc8dW5rbm93bj4nfVwiIGRvZXNuJ3QgbG9vayBsaWtlIGEgRHJpenpsZSBlbnRpdHkuIElmIHRoaXMgaXMgaW5jb3JyZWN0IGFuZCB0aGUgY2xhc3MgaXMgcHJvdmlkZWQgYnkgRHJpenpsZSwgcGxlYXNlIHJlcG9ydCB0aGlzIGFzIGEgYnVnLmApO1xuICAgIH1cbiAgICBsZXQgY2xzID0gdmFsdWUuY29uc3RydWN0b3I7XG4gICAgaWYgKGNscykge1xuICAgICAgICAvLyBUcmF2ZXJzZSB0aGUgcHJvdG90eXBlIGNoYWluIHRvIGZpbmQgdGhlIGVudGl0eUtpbmRcbiAgICAgICAgd2hpbGUgKGNscykge1xuICAgICAgICAgICAgaWYgKGVudGl0eUtpbmQgaW4gY2xzICYmIGNsc1tlbnRpdHlLaW5kXSA9PT0gdHlwZVtlbnRpdHlLaW5kXSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2xzID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKGNscyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xufVxuXG4vKlxuICAgIGBDb2x1bW5gIG9ubHkgYWNjZXB0cyBhIGZ1bGwgYENvbHVtbkNvbmZpZ2AgYXMgaXRzIGdlbmVyaWMuXG4gICAgVG8gaW5mZXIgcGFydHMgb2YgdGhlIGNvbmZpZywgdXNlIGBBbnlDb2x1bW5gIHRoYXQgYWNjZXB0cyBhIHBhcnRpYWwgY29uZmlnLlxuICAgIFNlZSBgR2V0Q29sdW1uRGF0YWAgZm9yIGV4YW1wbGUgdXNhZ2Ugb2YgaW5mZXJyaW5nLlxuKi9cbmNsYXNzIENvbHVtbiB7XG4gICAgdGFibGU7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdDb2x1bW4nO1xuICAgIG5hbWU7XG4gICAgcHJpbWFyeTtcbiAgICBub3ROdWxsO1xuICAgIGRlZmF1bHQ7XG4gICAgZGVmYXVsdEZuO1xuICAgIGhhc0RlZmF1bHQ7XG4gICAgaXNVbmlxdWU7XG4gICAgdW5pcXVlTmFtZTtcbiAgICB1bmlxdWVUeXBlO1xuICAgIGRhdGFUeXBlO1xuICAgIGNvbHVtblR5cGU7XG4gICAgZW51bVZhbHVlcyA9IHVuZGVmaW5lZDtcbiAgICBjb25maWc7XG4gICAgY29uc3RydWN0b3IodGFibGUsIGNvbmZpZykge1xuICAgICAgICB0aGlzLnRhYmxlID0gdGFibGU7XG4gICAgICAgIHRoaXMuY29uZmlnID0gY29uZmlnO1xuICAgICAgICB0aGlzLm5hbWUgPSBjb25maWcubmFtZTtcbiAgICAgICAgdGhpcy5ub3ROdWxsID0gY29uZmlnLm5vdE51bGw7XG4gICAgICAgIHRoaXMuZGVmYXVsdCA9IGNvbmZpZy5kZWZhdWx0O1xuICAgICAgICB0aGlzLmRlZmF1bHRGbiA9IGNvbmZpZy5kZWZhdWx0Rm47XG4gICAgICAgIHRoaXMuaGFzRGVmYXVsdCA9IGNvbmZpZy5oYXNEZWZhdWx0O1xuICAgICAgICB0aGlzLnByaW1hcnkgPSBjb25maWcucHJpbWFyeUtleTtcbiAgICAgICAgdGhpcy5pc1VuaXF1ZSA9IGNvbmZpZy5pc1VuaXF1ZTtcbiAgICAgICAgdGhpcy51bmlxdWVOYW1lID0gY29uZmlnLnVuaXF1ZU5hbWU7XG4gICAgICAgIHRoaXMudW5pcXVlVHlwZSA9IGNvbmZpZy51bmlxdWVUeXBlO1xuICAgICAgICB0aGlzLmRhdGFUeXBlID0gY29uZmlnLmRhdGFUeXBlO1xuICAgICAgICB0aGlzLmNvbHVtblR5cGUgPSBjb25maWcuY29sdW1uVHlwZTtcbiAgICB9XG4gICAgbWFwRnJvbURyaXZlclZhbHVlKHZhbHVlKSB7XG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9XG4gICAgbWFwVG9Ecml2ZXJWYWx1ZSh2YWx1ZSkge1xuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgfVxufVxuXG5jb25zdCBWaWV3QmFzZUNvbmZpZyA9IFN5bWJvbC5mb3IoJ2RyaXp6bGU6Vmlld0Jhc2VDb25maWcnKTtcbmNsYXNzIFZpZXcge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnVmlldyc7XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIFtWaWV3QmFzZUNvbmZpZ107XG4gICAgY29uc3RydWN0b3IoeyBuYW1lLCBzY2hlbWEsIHNlbGVjdGVkRmllbGRzLCBxdWVyeSB9KSB7XG4gICAgICAgIHRoaXNbVmlld0Jhc2VDb25maWddID0ge1xuICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgIG9yaWdpbmFsTmFtZTogbmFtZSxcbiAgICAgICAgICAgIHNjaGVtYSxcbiAgICAgICAgICAgIHNlbGVjdGVkRmllbGRzLFxuICAgICAgICAgICAgcXVlcnk6IHF1ZXJ5LFxuICAgICAgICAgICAgaXNFeGlzdGluZzogIXF1ZXJ5LFxuICAgICAgICAgICAgaXNBbGlhczogZmFsc2UsXG4gICAgICAgIH07XG4gICAgfVxuICAgIGdldFNRTCgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTUUwoW3RoaXNdKTtcbiAgICB9XG59XG5cbmNvbnN0IFN1YnF1ZXJ5Q29uZmlnID0gU3ltYm9sLmZvcignZHJpenpsZTpTdWJxdWVyeUNvbmZpZycpO1xuY2xhc3MgU3VicXVlcnkge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnU3VicXVlcnknO1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBbU3VicXVlcnlDb25maWddO1xuICAgIGNvbnN0cnVjdG9yKHNxbCwgc2VsZWN0aW9uLCBhbGlhcywgaXNXaXRoID0gZmFsc2UpIHtcbiAgICAgICAgdGhpc1tTdWJxdWVyeUNvbmZpZ10gPSB7XG4gICAgICAgICAgICBzcWwsXG4gICAgICAgICAgICBzZWxlY3Rpb24sXG4gICAgICAgICAgICBhbGlhcyxcbiAgICAgICAgICAgIGlzV2l0aCxcbiAgICAgICAgfTtcbiAgICB9XG4gICAgZ2V0U1FMKCkge1xuICAgICAgICByZXR1cm4gbmV3IFNRTChbdGhpc10pO1xuICAgIH1cbn1cbmNsYXNzIFdpdGhTdWJxdWVyeSBleHRlbmRzIFN1YnF1ZXJ5IHtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ1dpdGhTdWJxdWVyeSc7XG59XG5jbGFzcyBTZWxlY3Rpb25Qcm94eUhhbmRsZXIge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnU2VsZWN0aW9uUHJveHlIYW5kbGVyJztcbiAgICBjb25maWc7XG4gICAgY29uc3RydWN0b3IoY29uZmlnKSB7XG4gICAgICAgIHRoaXMuY29uZmlnID0geyAuLi5jb25maWcgfTtcbiAgICB9XG4gICAgZ2V0KHN1YnF1ZXJ5LCBwcm9wKSB7XG4gICAgICAgIGlmIChwcm9wID09PSBTdWJxdWVyeUNvbmZpZykge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAuLi5zdWJxdWVyeVtTdWJxdWVyeUNvbmZpZ10sXG4gICAgICAgICAgICAgICAgc2VsZWN0aW9uOiBuZXcgUHJveHkoc3VicXVlcnlbU3VicXVlcnlDb25maWddLnNlbGVjdGlvbiwgdGhpcyksXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGlmIChwcm9wID09PSBWaWV3QmFzZUNvbmZpZykge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAuLi5zdWJxdWVyeVtWaWV3QmFzZUNvbmZpZ10sXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRGaWVsZHM6IG5ldyBQcm94eShzdWJxdWVyeVtWaWV3QmFzZUNvbmZpZ10uc2VsZWN0ZWRGaWVsZHMsIHRoaXMpLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIHByb3AgPT09ICdzeW1ib2wnKSB7XG4gICAgICAgICAgICByZXR1cm4gc3VicXVlcnlbcHJvcF07XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29sdW1ucyA9IGlzKHN1YnF1ZXJ5LCBTdWJxdWVyeSlcbiAgICAgICAgICAgID8gc3VicXVlcnlbU3VicXVlcnlDb25maWddLnNlbGVjdGlvblxuICAgICAgICAgICAgOiBpcyhzdWJxdWVyeSwgVmlldylcbiAgICAgICAgICAgICAgICA/IHN1YnF1ZXJ5W1ZpZXdCYXNlQ29uZmlnXS5zZWxlY3RlZEZpZWxkc1xuICAgICAgICAgICAgICAgIDogc3VicXVlcnk7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gY29sdW1uc1twcm9wXTtcbiAgICAgICAgaWYgKGlzKHZhbHVlLCBTUUwuQWxpYXNlZCkpIHtcbiAgICAgICAgICAgIC8vIE5ldmVyIHJldHVybiB0aGUgdW5kZXJseWluZyBTUUwgZXhwcmVzc2lvbiBmb3IgYSBmaWVsZCBwcmV2aW91c2x5IHNlbGVjdGVkIGluIGEgc3VicXVlcnlcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbmZpZy5zcWxBbGlhc2VkQmVoYXZpb3IgPT09ICdzcWwnICYmICF2YWx1ZS5pc1NlbGVjdGlvbkZpZWxkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlLnNxbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IG5ld1ZhbHVlID0gdmFsdWUuY2xvbmUoKTtcbiAgICAgICAgICAgIG5ld1ZhbHVlLmlzU2VsZWN0aW9uRmllbGQgPSB0cnVlO1xuICAgICAgICAgICAgcmV0dXJuIG5ld1ZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpcyh2YWx1ZSwgU1FMKSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuY29uZmlnLnNxbEJlaGF2aW9yID09PSAnc3FsJykge1xuICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgWW91IHRyaWVkIHRvIHJlZmVyZW5jZSBcIiR7cHJvcH1cIiBmaWVsZCBmcm9tIGEgc3VicXVlcnksIHdoaWNoIGlzIGEgcmF3IFNRTCBmaWVsZCwgYnV0IGl0IGRvZXNuJ3QgaGF2ZSBhbiBhbGlhcyBkZWNsYXJlZC4gUGxlYXNlIGFkZCBhbiBhbGlhcyB0byB0aGUgZmllbGQgdXNpbmcgXCIuYXMoJ2FsaWFzJylcIiBtZXRob2QuYCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzKHZhbHVlLCBDb2x1bW4pKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5jb25maWcuYWxpYXMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb3h5KHZhbHVlLCBuZXcgQ29sdW1uQWxpYXNQcm94eUhhbmRsZXIobmV3IFByb3h5KHZhbHVlLnRhYmxlLCBuZXcgVGFibGVBbGlhc1Byb3h5SGFuZGxlcih0aGlzLmNvbmZpZy5hbGlhcywgdGhpcy5jb25maWcucmVwbGFjZU9yaWdpbmFsTmFtZSA/PyBmYWxzZSkpKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ29iamVjdCcgfHwgdmFsdWUgPT09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IFByb3h5KHZhbHVlLCBuZXcgU2VsZWN0aW9uUHJveHlIYW5kbGVyKHRoaXMuY29uZmlnKSk7XG4gICAgfVxufVxuXG4vKiogQGludGVybmFsICovXG5mdW5jdGlvbiBtYXBSZXN1bHRSb3coY29sdW1ucywgcm93LCBqb2luc05vdE51bGxhYmxlTWFwKSB7XG4gICAgLy8gS2V5IC0+IG5lc3RlZCBvYmplY3Qga2V5LCB2YWx1ZSAtPiB0YWJsZSBuYW1lIGlmIGFsbCBmaWVsZHMgaW4gdGhlIG5lc3RlZCBvYmplY3QgYXJlIGZyb20gdGhlIHNhbWUgdGFibGUsIGZhbHNlIG90aGVyd2lzZVxuICAgIGNvbnN0IG51bGxpZnlNYXAgPSB7fTtcbiAgICBjb25zdCByZXN1bHQgPSBjb2x1bW5zLnJlZHVjZSgocmVzdWx0LCB7IHBhdGgsIGZpZWxkIH0sIGNvbHVtbkluZGV4KSA9PiB7XG4gICAgICAgIGxldCBkZWNvZGVyO1xuICAgICAgICBpZiAoaXMoZmllbGQsIENvbHVtbikpIHtcbiAgICAgICAgICAgIGRlY29kZXIgPSBmaWVsZDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChpcyhmaWVsZCwgU1FMKSkge1xuICAgICAgICAgICAgZGVjb2RlciA9IGZpZWxkLmRlY29kZXI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBkZWNvZGVyID0gZmllbGQuc3FsLmRlY29kZXI7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IG5vZGUgPSByZXN1bHQ7XG4gICAgICAgIGZvciAoY29uc3QgW3BhdGhDaHVua0luZGV4LCBwYXRoQ2h1bmtdIG9mIHBhdGguZW50cmllcygpKSB7XG4gICAgICAgICAgICBpZiAocGF0aENodW5rSW5kZXggPCBwYXRoLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICAgICAgICBpZiAoIShwYXRoQ2h1bmsgaW4gbm9kZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgbm9kZVtwYXRoQ2h1bmtdID0ge307XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG5vZGUgPSBub2RlW3BhdGhDaHVua107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCByYXdWYWx1ZSA9IHJvd1tjb2x1bW5JbmRleF07XG4gICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBub2RlW3BhdGhDaHVua10gPSByYXdWYWx1ZSA9PT0gbnVsbCA/IG51bGwgOiBkZWNvZGVyLm1hcEZyb21Ecml2ZXJWYWx1ZShyYXdWYWx1ZSk7XG4gICAgICAgICAgICAgICAgaWYgKGpvaW5zTm90TnVsbGFibGVNYXAgJiYgaXMoZmllbGQsIENvbHVtbikgJiYgcGF0aC5sZW5ndGggPT09IDIpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb2JqZWN0TmFtZSA9IHBhdGhbMF07XG4gICAgICAgICAgICAgICAgICAgIGlmICghKG9iamVjdE5hbWUgaW4gbnVsbGlmeU1hcCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG51bGxpZnlNYXBbb2JqZWN0TmFtZV0gPSB2YWx1ZSA9PT0gbnVsbCA/IGdldFRhYmxlTmFtZShmaWVsZC50YWJsZSkgOiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgbnVsbGlmeU1hcFtvYmplY3ROYW1lXSA9PT0gJ3N0cmluZycgJiYgbnVsbGlmeU1hcFtvYmplY3ROYW1lXSAhPT0gZ2V0VGFibGVOYW1lKGZpZWxkLnRhYmxlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbnVsbGlmeU1hcFtvYmplY3ROYW1lXSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSwge30pO1xuICAgIC8vIE51bGxpZnkgYWxsIG5lc3RlZCBvYmplY3RzIGZyb20gbnVsbGlmeU1hcCB0aGF0IGFyZSBudWxsYWJsZVxuICAgIGlmIChqb2luc05vdE51bGxhYmxlTWFwICYmIE9iamVjdC5rZXlzKG51bGxpZnlNYXApLmxlbmd0aCA+IDApIHtcbiAgICAgICAgZm9yIChjb25zdCBbb2JqZWN0TmFtZSwgdGFibGVOYW1lXSBvZiBPYmplY3QuZW50cmllcyhudWxsaWZ5TWFwKSkge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB0YWJsZU5hbWUgPT09ICdzdHJpbmcnICYmICFqb2luc05vdE51bGxhYmxlTWFwW3RhYmxlTmFtZV0pIHtcbiAgICAgICAgICAgICAgICByZXN1bHRbb2JqZWN0TmFtZV0gPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG59XG4vKiogQGludGVybmFsICovXG5mdW5jdGlvbiBvcmRlclNlbGVjdGVkRmllbGRzKGZpZWxkcywgcGF0aFByZWZpeCkge1xuICAgIHJldHVybiBPYmplY3QuZW50cmllcyhmaWVsZHMpLnJlZHVjZSgocmVzdWx0LCBbbmFtZSwgZmllbGRdKSA9PiB7XG4gICAgICAgIGlmICh0eXBlb2YgbmFtZSAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbmV3UGF0aCA9IHBhdGhQcmVmaXggPyBbLi4ucGF0aFByZWZpeCwgbmFtZV0gOiBbbmFtZV07XG4gICAgICAgIGlmIChpcyhmaWVsZCwgQ29sdW1uKSB8fCBpcyhmaWVsZCwgU1FMKSB8fCBpcyhmaWVsZCwgU1FMLkFsaWFzZWQpKSB7XG4gICAgICAgICAgICByZXN1bHQucHVzaCh7IHBhdGg6IG5ld1BhdGgsIGZpZWxkIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGlzKGZpZWxkLCBUYWJsZSkpIHtcbiAgICAgICAgICAgIHJlc3VsdC5wdXNoKC4uLm9yZGVyU2VsZWN0ZWRGaWVsZHMoZmllbGRbVGFibGUuU3ltYm9sLkNvbHVtbnNdLCBuZXdQYXRoKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXN1bHQucHVzaCguLi5vcmRlclNlbGVjdGVkRmllbGRzKGZpZWxkLCBuZXdQYXRoKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9LCBbXSk7XG59XG4vKiogQGludGVybmFsICovXG5mdW5jdGlvbiBtYXBVcGRhdGVTZXQodGFibGUsIHZhbHVlcykge1xuICAgIGNvbnN0IGVudHJpZXMgPSBPYmplY3QuZW50cmllcyh2YWx1ZXMpXG4gICAgICAgIC5maWx0ZXIoKFssIHZhbHVlXSkgPT4gdmFsdWUgIT09IHVuZGVmaW5lZClcbiAgICAgICAgLm1hcCgoW2tleSwgdmFsdWVdKSA9PiB7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSB1bmljb3JuL3ByZWZlci10ZXJuYXJ5XG4gICAgICAgIGlmIChpcyh2YWx1ZSwgU1FMKSkge1xuICAgICAgICAgICAgcmV0dXJuIFtrZXksIHZhbHVlXTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBba2V5LCBuZXcgUGFyYW0odmFsdWUsIHRhYmxlW1RhYmxlLlN5bWJvbC5Db2x1bW5zXVtrZXldKV07XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBpZiAoZW50cmllcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyB2YWx1ZXMgdG8gc2V0Jyk7XG4gICAgfVxuICAgIHJldHVybiBPYmplY3QuZnJvbUVudHJpZXMoZW50cmllcyk7XG59XG4vKiogQGludGVybmFsICovXG5mdW5jdGlvbiBhcHBseU1peGlucyhiYXNlQ2xhc3MsIGV4dGVuZGVkQ2xhc3Nlcykge1xuICAgIGZvciAoY29uc3QgZXh0ZW5kZWRDbGFzcyBvZiBleHRlbmRlZENsYXNzZXMpIHtcbiAgICAgICAgZm9yIChjb25zdCBuYW1lIG9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKGV4dGVuZGVkQ2xhc3MucHJvdG90eXBlKSkge1xuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGJhc2VDbGFzcy5wcm90b3R5cGUsIG5hbWUsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoZXh0ZW5kZWRDbGFzcy5wcm90b3R5cGUsIG5hbWUpIHx8IE9iamVjdC5jcmVhdGUobnVsbCkpO1xuICAgICAgICB9XG4gICAgfVxufVxuZnVuY3Rpb24gZ2V0VGFibGVDb2x1bW5zKHRhYmxlKSB7XG4gICAgcmV0dXJuIHRhYmxlW1RhYmxlLlN5bWJvbC5Db2x1bW5zXTtcbn1cbi8qKiBAaW50ZXJuYWwgKi9cbmZ1bmN0aW9uIGdldFRhYmxlTGlrZU5hbWUodGFibGUpIHtcbiAgICByZXR1cm4gaXModGFibGUsIFN1YnF1ZXJ5KVxuICAgICAgICA/IHRhYmxlW1N1YnF1ZXJ5Q29uZmlnXS5hbGlhc1xuICAgICAgICA6IGlzKHRhYmxlLCBWaWV3KVxuICAgICAgICAgICAgPyB0YWJsZVtWaWV3QmFzZUNvbmZpZ10ubmFtZVxuICAgICAgICAgICAgOiBpcyh0YWJsZSwgU1FMKVxuICAgICAgICAgICAgICAgID8gdW5kZWZpbmVkXG4gICAgICAgICAgICAgICAgOiB0YWJsZVtUYWJsZS5TeW1ib2wuSXNBbGlhc11cbiAgICAgICAgICAgICAgICAgICAgPyB0YWJsZVtUYWJsZS5TeW1ib2wuTmFtZV1cbiAgICAgICAgICAgICAgICAgICAgOiB0YWJsZVtUYWJsZS5TeW1ib2wuQmFzZU5hbWVdO1xufVxuZnVuY3Rpb24gaWlmZShmbiwgLi4uYXJncykge1xuICAgIHJldHVybiBmbiguLi5hcmdzKTtcbn1cblxuLyoqIEBpbnRlcm5hbCAqL1xuY29uc3QgVGFibGVOYW1lID0gU3ltYm9sLmZvcignZHJpenpsZTpOYW1lJyk7XG4vKiogQGludGVybmFsICovXG5jb25zdCBTY2hlbWEgPSBTeW1ib2wuZm9yKCdkcml6emxlOlNjaGVtYScpO1xuLyoqIEBpbnRlcm5hbCAqL1xuY29uc3QgQ29sdW1ucyA9IFN5bWJvbC5mb3IoJ2RyaXp6bGU6Q29sdW1ucycpO1xuLyoqIEBpbnRlcm5hbCAqL1xuY29uc3QgT3JpZ2luYWxOYW1lID0gU3ltYm9sLmZvcignZHJpenpsZTpPcmlnaW5hbE5hbWUnKTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNvbnN0IEJhc2VOYW1lID0gU3ltYm9sLmZvcignZHJpenpsZTpCYXNlTmFtZScpO1xuLyoqIEBpbnRlcm5hbCAqL1xuY29uc3QgSXNBbGlhcyA9IFN5bWJvbC5mb3IoJ2RyaXp6bGU6SXNBbGlhcycpO1xuLyoqIEBpbnRlcm5hbCAqL1xuY29uc3QgRXh0cmFDb25maWdCdWlsZGVyID0gU3ltYm9sLmZvcignZHJpenpsZTpFeHRyYUNvbmZpZ0J1aWxkZXInKTtcbmNvbnN0IElzRHJpenpsZVRhYmxlID0gU3ltYm9sLmZvcignZHJpenpsZTpJc0RyaXp6bGVUYWJsZScpO1xuY2xhc3MgVGFibGUge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnVGFibGUnO1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBzdGF0aWMgU3ltYm9sID0ge1xuICAgICAgICBOYW1lOiBUYWJsZU5hbWUsXG4gICAgICAgIFNjaGVtYTogU2NoZW1hLFxuICAgICAgICBPcmlnaW5hbE5hbWU6IE9yaWdpbmFsTmFtZSxcbiAgICAgICAgQ29sdW1uczogQ29sdW1ucyxcbiAgICAgICAgQmFzZU5hbWU6IEJhc2VOYW1lLFxuICAgICAgICBJc0FsaWFzOiBJc0FsaWFzLFxuICAgICAgICBFeHRyYUNvbmZpZ0J1aWxkZXI6IEV4dHJhQ29uZmlnQnVpbGRlcixcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqIENhbiBiZSBjaGFuZ2VkIGlmIHRoZSB0YWJsZSBpcyBhbGlhc2VkLlxuICAgICAqL1xuICAgIFtUYWJsZU5hbWVdO1xuICAgIC8qKlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqIFVzZWQgdG8gc3RvcmUgdGhlIG9yaWdpbmFsIG5hbWUgb2YgdGhlIHRhYmxlLCBiZWZvcmUgYW55IGFsaWFzaW5nLlxuICAgICAqL1xuICAgIFtPcmlnaW5hbE5hbWVdO1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBbU2NoZW1hXTtcbiAgICAvKiogQGludGVybmFsICovXG4gICAgW0NvbHVtbnNdO1xuICAgIC8qKlxuICAgICAqICBAaW50ZXJuYWxcbiAgICAgKiBVc2VkIHRvIHN0b3JlIHRoZSB0YWJsZSBuYW1lIGJlZm9yZSB0aGUgdHJhbnNmb3JtYXRpb24gdmlhIHRoZSBgdGFibGVDcmVhdG9yYCBmdW5jdGlvbnMuXG4gICAgICovXG4gICAgW0Jhc2VOYW1lXTtcbiAgICAvKiogQGludGVybmFsICovXG4gICAgW0lzQWxpYXNdID0gZmFsc2U7XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIFtFeHRyYUNvbmZpZ0J1aWxkZXJdID0gdW5kZWZpbmVkO1xuICAgIFtJc0RyaXp6bGVUYWJsZV0gPSB0cnVlO1xuICAgIGNvbnN0cnVjdG9yKG5hbWUsIHNjaGVtYSwgYmFzZU5hbWUpIHtcbiAgICAgICAgdGhpc1tUYWJsZU5hbWVdID0gdGhpc1tPcmlnaW5hbE5hbWVdID0gbmFtZTtcbiAgICAgICAgdGhpc1tTY2hlbWFdID0gc2NoZW1hO1xuICAgICAgICB0aGlzW0Jhc2VOYW1lXSA9IGJhc2VOYW1lO1xuICAgIH1cbiAgICBnZXRTUUwoKSB7XG4gICAgICAgIHJldHVybiBuZXcgU1FMKFt0aGlzXSk7XG4gICAgfVxufVxuZnVuY3Rpb24gaXNUYWJsZSh0YWJsZSkge1xuICAgIHJldHVybiB0eXBlb2YgdGFibGUgPT09ICdvYmplY3QnICYmIHRhYmxlICE9PSBudWxsICYmIElzRHJpenpsZVRhYmxlIGluIHRhYmxlO1xufVxuZnVuY3Rpb24gZ2V0VGFibGVOYW1lKHRhYmxlKSB7XG4gICAgcmV0dXJuIHRhYmxlW1RhYmxlTmFtZV07XG59XG5cbmNsYXNzIFF1ZXJ5UHJvbWlzZSB7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdRdWVyeVByb21pc2UnO1xuICAgIFtTeW1ib2wudG9TdHJpbmdUYWddID0gJ1F1ZXJ5UHJvbWlzZSc7XG4gICAgY2F0Y2gob25SZWplY3RlZCkge1xuICAgICAgICByZXR1cm4gdGhpcy50aGVuKHVuZGVmaW5lZCwgb25SZWplY3RlZCk7XG4gICAgfVxuICAgIGZpbmFsbHkob25GaW5hbGx5KSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRoZW4oKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICBvbkZpbmFsbHk/LigpO1xuICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICB9LCAocmVhc29uKSA9PiB7XG4gICAgICAgICAgICBvbkZpbmFsbHk/LigpO1xuICAgICAgICAgICAgdGhyb3cgcmVhc29uO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgdGhlbihvbkZ1bGZpbGxlZCwgb25SZWplY3RlZCkge1xuICAgICAgICByZXR1cm4gdGhpcy5leGVjdXRlKCkudGhlbihvbkZ1bGZpbGxlZCwgb25SZWplY3RlZCk7XG4gICAgfVxufVxuXG4vKiogQGludGVybmFsICovXG5jb25zdCB0cmFjZXIgPSB7XG4gICAgc3RhcnRBY3RpdmVTcGFuKG5hbWUsIGZuKSB7XG4gICAgICAgIHtcbiAgICAgICAgICAgIHJldHVybiBmbigpO1xuICAgICAgICB9XG4gICAgfSxcbn07XG5cbmNsYXNzIERyaXp6bGVFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ0RyaXp6bGVFcnJvcic7XG4gICAgY29uc3RydWN0b3IobWVzc2FnZSkge1xuICAgICAgICBzdXBlcihtZXNzYWdlKTtcbiAgICAgICAgdGhpcy5uYW1lID0gJ0RyaXp6bGVFcnJvcic7XG4gICAgfVxuICAgIHN0YXRpYyB3cmFwKGVycm9yLCBtZXNzYWdlKSB7XG4gICAgICAgIHJldHVybiBlcnJvciBpbnN0YW5jZW9mIEVycm9yIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8taW5zdGFuY2VvZi9uby1pbnN0YW5jZW9mXG4gICAgICAgICAgICA/IG5ldyBEcml6emxlRXJyb3IobWVzc2FnZSA/IGAke21lc3NhZ2V9OiAke2Vycm9yLm1lc3NhZ2V9YCA6IGVycm9yLm1lc3NhZ2UpXG4gICAgICAgICAgICA6IG5ldyBEcml6emxlRXJyb3IobWVzc2FnZSA/PyBTdHJpbmcoZXJyb3IpKTtcbiAgICB9XG59XG5jbGFzcyBUcmFuc2FjdGlvblJvbGxiYWNrRXJyb3IgZXh0ZW5kcyBEcml6emxlRXJyb3Ige1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnVHJhbnNhY3Rpb25Sb2xsYmFja0Vycm9yJztcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoJ1JvbGxiYWNrJyk7XG4gICAgfVxufVxuXG4vKiogQGludGVybmFsICovXG5jb25zdCBJbmxpbmVGb3JlaWduS2V5cyA9IFN5bWJvbC5mb3IoJ2RyaXp6bGU6UGdJbmxpbmVGb3JlaWduS2V5cycpO1xuY2xhc3MgUGdUYWJsZSBleHRlbmRzIFRhYmxlIHtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ1BnVGFibGUnO1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBzdGF0aWMgU3ltYm9sID0gT2JqZWN0LmFzc2lnbih7fSwgVGFibGUuU3ltYm9sLCB7XG4gICAgICAgIElubGluZUZvcmVpZ25LZXlzOiBJbmxpbmVGb3JlaWduS2V5cyxcbiAgICB9KTtcbiAgICAvKipAaW50ZXJuYWwgKi9cbiAgICBbSW5saW5lRm9yZWlnbktleXNdID0gW107XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIFtUYWJsZS5TeW1ib2wuRXh0cmFDb25maWdCdWlsZGVyXSA9IHVuZGVmaW5lZDtcbn1cbi8qKiBAaW50ZXJuYWwgKi9cbmZ1bmN0aW9uIHBnVGFibGVXaXRoU2NoZW1hKG5hbWUsIGNvbHVtbnMsIGV4dHJhQ29uZmlnLCBzY2hlbWEsIGJhc2VOYW1lID0gbmFtZSkge1xuICAgIGNvbnN0IHJhd1RhYmxlID0gbmV3IFBnVGFibGUobmFtZSwgc2NoZW1hLCBiYXNlTmFtZSk7XG4gICAgY29uc3QgYnVpbHRDb2x1bW5zID0gT2JqZWN0LmZyb21FbnRyaWVzKE9iamVjdC5lbnRyaWVzKGNvbHVtbnMpLm1hcCgoW25hbWUsIGNvbEJ1aWxkZXJCYXNlXSkgPT4ge1xuICAgICAgICBjb25zdCBjb2xCdWlsZGVyID0gY29sQnVpbGRlckJhc2U7XG4gICAgICAgIGNvbnN0IGNvbHVtbiA9IGNvbEJ1aWxkZXIuYnVpbGQocmF3VGFibGUpO1xuICAgICAgICByYXdUYWJsZVtJbmxpbmVGb3JlaWduS2V5c10ucHVzaCguLi5jb2xCdWlsZGVyLmJ1aWxkRm9yZWlnbktleXMoY29sdW1uLCByYXdUYWJsZSkpO1xuICAgICAgICByZXR1cm4gW25hbWUsIGNvbHVtbl07XG4gICAgfSkpO1xuICAgIGNvbnN0IHRhYmxlID0gT2JqZWN0LmFzc2lnbihyYXdUYWJsZSwgYnVpbHRDb2x1bW5zKTtcbiAgICB0YWJsZVtUYWJsZS5TeW1ib2wuQ29sdW1uc10gPSBidWlsdENvbHVtbnM7XG4gICAgaWYgKGV4dHJhQ29uZmlnKSB7XG4gICAgICAgIHRhYmxlW1BnVGFibGUuU3ltYm9sLkV4dHJhQ29uZmlnQnVpbGRlcl0gPSBleHRyYUNvbmZpZztcbiAgICB9XG4gICAgcmV0dXJuIHRhYmxlO1xufVxuY29uc3QgcGdUYWJsZSA9IChuYW1lLCBjb2x1bW5zLCBleHRyYUNvbmZpZykgPT4ge1xuICAgIHJldHVybiBwZ1RhYmxlV2l0aFNjaGVtYShuYW1lLCBjb2x1bW5zLCBleHRyYUNvbmZpZywgdW5kZWZpbmVkKTtcbn07XG5mdW5jdGlvbiBwZ1RhYmxlQ3JlYXRvcihjdXN0b21pemVUYWJsZU5hbWUpIHtcbiAgICByZXR1cm4gKG5hbWUsIGNvbHVtbnMsIGV4dHJhQ29uZmlnKSA9PiB7XG4gICAgICAgIHJldHVybiBwZ1RhYmxlV2l0aFNjaGVtYShjdXN0b21pemVUYWJsZU5hbWUobmFtZSksIGNvbHVtbnMsIGV4dHJhQ29uZmlnLCB1bmRlZmluZWQsIG5hbWUpO1xuICAgIH07XG59XG5cbmNsYXNzIENoZWNrQnVpbGRlciB7XG4gICAgbmFtZTtcbiAgICB2YWx1ZTtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ1BnQ2hlY2tCdWlsZGVyJztcbiAgICBicmFuZDtcbiAgICBjb25zdHJ1Y3RvcihuYW1lLCB2YWx1ZSkge1xuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBidWlsZCh0YWJsZSkge1xuICAgICAgICByZXR1cm4gbmV3IENoZWNrKHRhYmxlLCB0aGlzKTtcbiAgICB9XG59XG5jbGFzcyBDaGVjayB7XG4gICAgdGFibGU7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdQZ0NoZWNrJztcbiAgICBuYW1lO1xuICAgIHZhbHVlO1xuICAgIGNvbnN0cnVjdG9yKHRhYmxlLCBidWlsZGVyKSB7XG4gICAgICAgIHRoaXMudGFibGUgPSB0YWJsZTtcbiAgICAgICAgdGhpcy5uYW1lID0gYnVpbGRlci5uYW1lO1xuICAgICAgICB0aGlzLnZhbHVlID0gYnVpbGRlci52YWx1ZTtcbiAgICB9XG59XG5mdW5jdGlvbiBjaGVjayhuYW1lLCB2YWx1ZSkge1xuICAgIHJldHVybiBuZXcgQ2hlY2tCdWlsZGVyKG5hbWUsIHZhbHVlKTtcbn1cblxuY2xhc3MgRm9yZWlnbktleUJ1aWxkZXIge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnUGdGb3JlaWduS2V5QnVpbGRlcic7XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIHJlZmVyZW5jZTtcbiAgICAvKiogQGludGVybmFsICovXG4gICAgX29uVXBkYXRlID0gJ25vIGFjdGlvbic7XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIF9vbkRlbGV0ZSA9ICdubyBhY3Rpb24nO1xuICAgIGNvbnN0cnVjdG9yKGNvbmZpZywgYWN0aW9ucykge1xuICAgICAgICB0aGlzLnJlZmVyZW5jZSA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgY29sdW1ucywgZm9yZWlnbkNvbHVtbnMgfSA9IGNvbmZpZygpO1xuICAgICAgICAgICAgcmV0dXJuIHsgY29sdW1ucywgZm9yZWlnblRhYmxlOiBmb3JlaWduQ29sdW1uc1swXS50YWJsZSwgZm9yZWlnbkNvbHVtbnMgfTtcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKGFjdGlvbnMpIHtcbiAgICAgICAgICAgIHRoaXMuX29uVXBkYXRlID0gYWN0aW9ucy5vblVwZGF0ZTtcbiAgICAgICAgICAgIHRoaXMuX29uRGVsZXRlID0gYWN0aW9ucy5vbkRlbGV0ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBvblVwZGF0ZShhY3Rpb24pIHtcbiAgICAgICAgdGhpcy5fb25VcGRhdGUgPSBhY3Rpb24gPT09IHVuZGVmaW5lZCA/ICdubyBhY3Rpb24nIDogYWN0aW9uO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgb25EZWxldGUoYWN0aW9uKSB7XG4gICAgICAgIHRoaXMuX29uRGVsZXRlID0gYWN0aW9uID09PSB1bmRlZmluZWQgPyAnbm8gYWN0aW9uJyA6IGFjdGlvbjtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBidWlsZCh0YWJsZSkge1xuICAgICAgICByZXR1cm4gbmV3IEZvcmVpZ25LZXkodGFibGUsIHRoaXMpO1xuICAgIH1cbn1cbmNsYXNzIEZvcmVpZ25LZXkge1xuICAgIHRhYmxlO1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnUGdGb3JlaWduS2V5JztcbiAgICByZWZlcmVuY2U7XG4gICAgb25VcGRhdGU7XG4gICAgb25EZWxldGU7XG4gICAgY29uc3RydWN0b3IodGFibGUsIGJ1aWxkZXIpIHtcbiAgICAgICAgdGhpcy50YWJsZSA9IHRhYmxlO1xuICAgICAgICB0aGlzLnJlZmVyZW5jZSA9IGJ1aWxkZXIucmVmZXJlbmNlO1xuICAgICAgICB0aGlzLm9uVXBkYXRlID0gYnVpbGRlci5fb25VcGRhdGU7XG4gICAgICAgIHRoaXMub25EZWxldGUgPSBidWlsZGVyLl9vbkRlbGV0ZTtcbiAgICB9XG4gICAgZ2V0TmFtZSgpIHtcbiAgICAgICAgY29uc3QgeyBjb2x1bW5zLCBmb3JlaWduQ29sdW1ucyB9ID0gdGhpcy5yZWZlcmVuY2UoKTtcbiAgICAgICAgY29uc3QgY29sdW1uTmFtZXMgPSBjb2x1bW5zLm1hcCgoY29sdW1uKSA9PiBjb2x1bW4ubmFtZSk7XG4gICAgICAgIGNvbnN0IGZvcmVpZ25Db2x1bW5OYW1lcyA9IGZvcmVpZ25Db2x1bW5zLm1hcCgoY29sdW1uKSA9PiBjb2x1bW4ubmFtZSk7XG4gICAgICAgIGNvbnN0IGNodW5rcyA9IFtcbiAgICAgICAgICAgIHRoaXMudGFibGVbUGdUYWJsZS5TeW1ib2wuTmFtZV0sXG4gICAgICAgICAgICAuLi5jb2x1bW5OYW1lcyxcbiAgICAgICAgICAgIGZvcmVpZ25Db2x1bW5zWzBdLnRhYmxlW1BnVGFibGUuU3ltYm9sLk5hbWVdLFxuICAgICAgICAgICAgLi4uZm9yZWlnbkNvbHVtbk5hbWVzLFxuICAgICAgICBdO1xuICAgICAgICByZXR1cm4gYCR7Y2h1bmtzLmpvaW4oJ18nKX1fZmtgO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGZvcmVpZ25LZXkoY29uZmlnKSB7XG4gICAgZnVuY3Rpb24gbWFwcGVkQ29uZmlnKCkge1xuICAgICAgICBjb25zdCB7IGNvbHVtbnMsIGZvcmVpZ25Db2x1bW5zIH0gPSBjb25maWc7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjb2x1bW5zLFxuICAgICAgICAgICAgZm9yZWlnbkNvbHVtbnMsXG4gICAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBuZXcgRm9yZWlnbktleUJ1aWxkZXIobWFwcGVkQ29uZmlnKTtcbn1cblxuY2xhc3MgSW5kZXhCdWlsZGVyT24ge1xuICAgIHVuaXF1ZTtcbiAgICBuYW1lO1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnUGdJbmRleEJ1aWxkZXJPbic7XG4gICAgY29uc3RydWN0b3IodW5pcXVlLCBuYW1lKSB7XG4gICAgICAgIHRoaXMudW5pcXVlID0gdW5pcXVlO1xuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgIH1cbiAgICBvbiguLi5jb2x1bW5zKSB7XG4gICAgICAgIHJldHVybiBuZXcgSW5kZXhCdWlsZGVyKGNvbHVtbnMsIHRoaXMudW5pcXVlLCBmYWxzZSwgdGhpcy5uYW1lKTtcbiAgICB9XG4gICAgb25Pbmx5KC4uLmNvbHVtbnMpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBJbmRleEJ1aWxkZXIoY29sdW1ucywgdGhpcy51bmlxdWUsIHRydWUsIHRoaXMubmFtZSk7XG4gICAgfVxufVxuY2xhc3MgSW5kZXhCdWlsZGVyIHtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ1BnSW5kZXhCdWlsZGVyJztcbiAgICAvKiogQGludGVybmFsICovXG4gICAgY29uZmlnO1xuICAgIGNvbnN0cnVjdG9yKGNvbHVtbnMsIHVuaXF1ZSwgb25seSwgbmFtZSkge1xuICAgICAgICB0aGlzLmNvbmZpZyA9IHtcbiAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICBjb2x1bW5zLFxuICAgICAgICAgICAgdW5pcXVlLFxuICAgICAgICAgICAgb25seSxcbiAgICAgICAgfTtcbiAgICB9XG4gICAgY29uY3VycmVudGx5KCkge1xuICAgICAgICB0aGlzLmNvbmZpZy5jb25jdXJyZW50bHkgPSB0cnVlO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgdXNpbmcobWV0aG9kKSB7XG4gICAgICAgIHRoaXMuY29uZmlnLnVzaW5nID0gbWV0aG9kO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgYXNjKCkge1xuICAgICAgICB0aGlzLmNvbmZpZy5vcmRlciA9ICdhc2MnO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgZGVzYygpIHtcbiAgICAgICAgdGhpcy5jb25maWcub3JkZXIgPSAnZGVzYyc7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICBudWxsc0ZpcnN0KCkge1xuICAgICAgICB0aGlzLmNvbmZpZy5udWxscyA9ICdmaXJzdCc7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICBudWxsc0xhc3QoKSB7XG4gICAgICAgIHRoaXMuY29uZmlnLm51bGxzID0gJ2xhc3QnO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgd2hlcmUoY29uZGl0aW9uKSB7XG4gICAgICAgIHRoaXMuY29uZmlnLndoZXJlID0gY29uZGl0aW9uO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGJ1aWxkKHRhYmxlKSB7XG4gICAgICAgIHJldHVybiBuZXcgSW5kZXgodGhpcy5jb25maWcsIHRhYmxlKTtcbiAgICB9XG59XG5jbGFzcyBJbmRleCB7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdQZ0luZGV4JztcbiAgICBjb25maWc7XG4gICAgY29uc3RydWN0b3IoY29uZmlnLCB0YWJsZSkge1xuICAgICAgICB0aGlzLmNvbmZpZyA9IHsgLi4uY29uZmlnLCB0YWJsZSB9O1xuICAgIH1cbn1cbmZ1bmN0aW9uIGluZGV4KG5hbWUpIHtcbiAgICByZXR1cm4gbmV3IEluZGV4QnVpbGRlck9uKGZhbHNlLCBuYW1lKTtcbn1cbmZ1bmN0aW9uIHVuaXF1ZUluZGV4KG5hbWUpIHtcbiAgICByZXR1cm4gbmV3IEluZGV4QnVpbGRlck9uKHRydWUsIG5hbWUpO1xufVxuXG5mdW5jdGlvbiBwcmltYXJ5S2V5KC4uLmNvbHVtbnMpIHtcbiAgICByZXR1cm4gbmV3IFByaW1hcnlLZXlCdWlsZGVyKGNvbHVtbnMpO1xufVxuY2xhc3MgUHJpbWFyeUtleUJ1aWxkZXIge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnUGdQcmltYXJ5S2V5QnVpbGRlcic7XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGNvbHVtbnM7XG4gICAgY29uc3RydWN0b3IoY29sdW1ucykge1xuICAgICAgICB0aGlzLmNvbHVtbnMgPSBjb2x1bW5zO1xuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgYnVpbGQodGFibGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcmltYXJ5S2V5KHRhYmxlLCB0aGlzLmNvbHVtbnMpO1xuICAgIH1cbn1cbmNsYXNzIFByaW1hcnlLZXkge1xuICAgIHRhYmxlO1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnUGdQcmltYXJ5S2V5JztcbiAgICBjb2x1bW5zO1xuICAgIGNvbnN0cnVjdG9yKHRhYmxlLCBjb2x1bW5zKSB7XG4gICAgICAgIHRoaXMudGFibGUgPSB0YWJsZTtcbiAgICAgICAgdGhpcy5jb2x1bW5zID0gY29sdW1ucztcbiAgICB9XG4gICAgZ2V0TmFtZSgpIHtcbiAgICAgICAgcmV0dXJuIGAke3RoaXMudGFibGVbUGdUYWJsZS5TeW1ib2wuTmFtZV19XyR7dGhpcy5jb2x1bW5zLm1hcCgoY29sdW1uKSA9PiBjb2x1bW4ubmFtZSkuam9pbignXycpfV9wa2A7XG4gICAgfVxufVxuXG5mdW5jdGlvbiB1bmlxdWUobmFtZSkge1xuICAgIHJldHVybiBuZXcgVW5pcXVlT25Db25zdHJhaW50QnVpbGRlcihuYW1lKTtcbn1cbmZ1bmN0aW9uIHVuaXF1ZUtleU5hbWUodGFibGUsIGNvbHVtbnMpIHtcbiAgICByZXR1cm4gYCR7dGFibGVbUGdUYWJsZS5TeW1ib2wuTmFtZV19XyR7Y29sdW1ucy5qb2luKCdfJyl9X3VuaXF1ZWA7XG59XG5jbGFzcyBVbmlxdWVDb25zdHJhaW50QnVpbGRlciB7XG4gICAgbmFtZTtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ1BnVW5pcXVlQ29uc3RyYWludEJ1aWxkZXInO1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBjb2x1bW5zO1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBudWxsc05vdERpc3RpbmN0Q29uZmlnID0gZmFsc2U7XG4gICAgY29uc3RydWN0b3IoY29sdW1ucywgbmFtZSkge1xuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICB0aGlzLmNvbHVtbnMgPSBjb2x1bW5zO1xuICAgIH1cbiAgICBudWxsc05vdERpc3RpbmN0KCkge1xuICAgICAgICB0aGlzLm51bGxzTm90RGlzdGluY3RDb25maWcgPSB0cnVlO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGJ1aWxkKHRhYmxlKSB7XG4gICAgICAgIHJldHVybiBuZXcgVW5pcXVlQ29uc3RyYWludCh0YWJsZSwgdGhpcy5jb2x1bW5zLCB0aGlzLm51bGxzTm90RGlzdGluY3RDb25maWcsIHRoaXMubmFtZSk7XG4gICAgfVxufVxuY2xhc3MgVW5pcXVlT25Db25zdHJhaW50QnVpbGRlciB7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdQZ1VuaXF1ZU9uQ29uc3RyYWludEJ1aWxkZXInO1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBuYW1lO1xuICAgIGNvbnN0cnVjdG9yKG5hbWUpIHtcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICB9XG4gICAgb24oLi4uY29sdW1ucykge1xuICAgICAgICByZXR1cm4gbmV3IFVuaXF1ZUNvbnN0cmFpbnRCdWlsZGVyKGNvbHVtbnMsIHRoaXMubmFtZSk7XG4gICAgfVxufVxuY2xhc3MgVW5pcXVlQ29uc3RyYWludCB7XG4gICAgdGFibGU7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdQZ1VuaXF1ZUNvbnN0cmFpbnQnO1xuICAgIGNvbHVtbnM7XG4gICAgbmFtZTtcbiAgICBudWxsc05vdERpc3RpbmN0ID0gZmFsc2U7XG4gICAgY29uc3RydWN0b3IodGFibGUsIGNvbHVtbnMsIG51bGxzTm90RGlzdGluY3QsIG5hbWUpIHtcbiAgICAgICAgdGhpcy50YWJsZSA9IHRhYmxlO1xuICAgICAgICB0aGlzLmNvbHVtbnMgPSBjb2x1bW5zO1xuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lID8/IHVuaXF1ZUtleU5hbWUodGhpcy50YWJsZSwgdGhpcy5jb2x1bW5zLm1hcCgoY29sdW1uKSA9PiBjb2x1bW4ubmFtZSkpO1xuICAgICAgICB0aGlzLm51bGxzTm90RGlzdGluY3QgPSBudWxsc05vdERpc3RpbmN0O1xuICAgIH1cbiAgICBnZXROYW1lKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5uYW1lO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gZ2V0VGFibGVDb25maWcodGFibGUpIHtcbiAgICBjb25zdCBjb2x1bW5zID0gT2JqZWN0LnZhbHVlcyh0YWJsZVtUYWJsZS5TeW1ib2wuQ29sdW1uc10pO1xuICAgIGNvbnN0IGluZGV4ZXMgPSBbXTtcbiAgICBjb25zdCBjaGVja3MgPSBbXTtcbiAgICBjb25zdCBwcmltYXJ5S2V5cyA9IFtdO1xuICAgIGNvbnN0IGZvcmVpZ25LZXlzID0gT2JqZWN0LnZhbHVlcyh0YWJsZVtQZ1RhYmxlLlN5bWJvbC5JbmxpbmVGb3JlaWduS2V5c10pO1xuICAgIGNvbnN0IHVuaXF1ZUNvbnN0cmFpbnRzID0gW107XG4gICAgY29uc3QgbmFtZSA9IHRhYmxlW1RhYmxlLlN5bWJvbC5OYW1lXTtcbiAgICBjb25zdCBzY2hlbWEgPSB0YWJsZVtUYWJsZS5TeW1ib2wuU2NoZW1hXTtcbiAgICBjb25zdCBleHRyYUNvbmZpZ0J1aWxkZXIgPSB0YWJsZVtQZ1RhYmxlLlN5bWJvbC5FeHRyYUNvbmZpZ0J1aWxkZXJdO1xuICAgIGlmIChleHRyYUNvbmZpZ0J1aWxkZXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBjb25zdCBleHRyYUNvbmZpZyA9IGV4dHJhQ29uZmlnQnVpbGRlcih0YWJsZVtUYWJsZS5TeW1ib2wuQ29sdW1uc10pO1xuICAgICAgICBmb3IgKGNvbnN0IGJ1aWxkZXIgb2YgT2JqZWN0LnZhbHVlcyhleHRyYUNvbmZpZykpIHtcbiAgICAgICAgICAgIGlmIChpcyhidWlsZGVyLCBJbmRleEJ1aWxkZXIpKSB7XG4gICAgICAgICAgICAgICAgaW5kZXhlcy5wdXNoKGJ1aWxkZXIuYnVpbGQodGFibGUpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGlzKGJ1aWxkZXIsIENoZWNrQnVpbGRlcikpIHtcbiAgICAgICAgICAgICAgICBjaGVja3MucHVzaChidWlsZGVyLmJ1aWxkKHRhYmxlKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChpcyhidWlsZGVyLCBVbmlxdWVDb25zdHJhaW50QnVpbGRlcikpIHtcbiAgICAgICAgICAgICAgICB1bmlxdWVDb25zdHJhaW50cy5wdXNoKGJ1aWxkZXIuYnVpbGQodGFibGUpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGlzKGJ1aWxkZXIsIFByaW1hcnlLZXlCdWlsZGVyKSkge1xuICAgICAgICAgICAgICAgIHByaW1hcnlLZXlzLnB1c2goYnVpbGRlci5idWlsZCh0YWJsZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoaXMoYnVpbGRlciwgRm9yZWlnbktleUJ1aWxkZXIpKSB7XG4gICAgICAgICAgICAgICAgZm9yZWlnbktleXMucHVzaChidWlsZGVyLmJ1aWxkKHRhYmxlKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgICAgY29sdW1ucyxcbiAgICAgICAgaW5kZXhlcyxcbiAgICAgICAgZm9yZWlnbktleXMsXG4gICAgICAgIGNoZWNrcyxcbiAgICAgICAgcHJpbWFyeUtleXMsXG4gICAgICAgIHVuaXF1ZUNvbnN0cmFpbnRzLFxuICAgICAgICBuYW1lLFxuICAgICAgICBzY2hlbWEsXG4gICAgfTtcbn1cbmZ1bmN0aW9uIGdldFZpZXdDb25maWcodmlldykge1xuICAgIHJldHVybiB7XG4gICAgICAgIC4uLnZpZXdbVmlld0Jhc2VDb25maWddLFxuICAgICAgICAuLi52aWV3W1BnVmlld0NvbmZpZ10sXG4gICAgfTtcbn1cbmZ1bmN0aW9uIGdldE1hdGVyaWFsaXplZFZpZXdDb25maWcodmlldykge1xuICAgIHJldHVybiB7XG4gICAgICAgIC4uLnZpZXdbVmlld0Jhc2VDb25maWddLFxuICAgICAgICAuLi52aWV3W1BnTWF0ZXJpYWxpemVkVmlld0NvbmZpZ10sXG4gICAgfTtcbn1cbmZ1bmN0aW9uIHBhcnNlUGdBcnJheVZhbHVlKGFycmF5U3RyaW5nLCBzdGFydEZyb20sIGluUXVvdGVzKSB7XG4gICAgZm9yIChsZXQgaSA9IHN0YXJ0RnJvbTsgaSA8IGFycmF5U3RyaW5nLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGNoYXIgPSBhcnJheVN0cmluZ1tpXTtcbiAgICAgICAgaWYgKGNoYXIgPT09ICdcXFxcJykge1xuICAgICAgICAgICAgaSsrO1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNoYXIgPT09ICdcIicpIHtcbiAgICAgICAgICAgIHJldHVybiBbYXJyYXlTdHJpbmcuc2xpY2Uoc3RhcnRGcm9tLCBpKS5yZXBsYWNlKC9cXFxcL2csICcnKSwgaSArIDFdO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpblF1b3Rlcykge1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNoYXIgPT09ICcsJyB8fCBjaGFyID09PSAnfScpIHtcbiAgICAgICAgICAgIHJldHVybiBbYXJyYXlTdHJpbmcuc2xpY2Uoc3RhcnRGcm9tLCBpKS5yZXBsYWNlKC9cXFxcL2csICcnKSwgaV07XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIFthcnJheVN0cmluZy5zbGljZShzdGFydEZyb20pLnJlcGxhY2UoL1xcXFwvZywgJycpLCBhcnJheVN0cmluZy5sZW5ndGhdO1xufVxuZnVuY3Rpb24gcGFyc2VQZ05lc3RlZEFycmF5KGFycmF5U3RyaW5nLCBzdGFydEZyb20gPSAwKSB7XG4gICAgY29uc3QgcmVzdWx0ID0gW107XG4gICAgbGV0IGkgPSBzdGFydEZyb207XG4gICAgbGV0IGxhc3RDaGFySXNDb21tYSA9IGZhbHNlO1xuICAgIHdoaWxlIChpIDwgYXJyYXlTdHJpbmcubGVuZ3RoKSB7XG4gICAgICAgIGNvbnN0IGNoYXIgPSBhcnJheVN0cmluZ1tpXTtcbiAgICAgICAgaWYgKGNoYXIgPT09ICcsJykge1xuICAgICAgICAgICAgaWYgKGxhc3RDaGFySXNDb21tYSB8fCBpID09PSBzdGFydEZyb20pIHtcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaCgnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsYXN0Q2hhcklzQ29tbWEgPSB0cnVlO1xuICAgICAgICAgICAgaSsrO1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgbGFzdENoYXJJc0NvbW1hID0gZmFsc2U7XG4gICAgICAgIGlmIChjaGFyID09PSAnXFxcXCcpIHtcbiAgICAgICAgICAgIGkgKz0gMjtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjaGFyID09PSAnXCInKSB7XG4gICAgICAgICAgICBjb25zdCBbdmFsdWUsIHN0YXJ0RnJvbV0gPSBwYXJzZVBnQXJyYXlWYWx1ZShhcnJheVN0cmluZywgaSArIDEsIHRydWUpO1xuICAgICAgICAgICAgcmVzdWx0LnB1c2godmFsdWUpO1xuICAgICAgICAgICAgaSA9IHN0YXJ0RnJvbTtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjaGFyID09PSAnfScpIHtcbiAgICAgICAgICAgIHJldHVybiBbcmVzdWx0LCBpICsgMV07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNoYXIgPT09ICd7Jykge1xuICAgICAgICAgICAgY29uc3QgW3ZhbHVlLCBzdGFydEZyb21dID0gcGFyc2VQZ05lc3RlZEFycmF5KGFycmF5U3RyaW5nLCBpICsgMSk7XG4gICAgICAgICAgICByZXN1bHQucHVzaCh2YWx1ZSk7XG4gICAgICAgICAgICBpID0gc3RhcnRGcm9tO1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgW3ZhbHVlLCBuZXdTdGFydEZyb21dID0gcGFyc2VQZ0FycmF5VmFsdWUoYXJyYXlTdHJpbmcsIGksIGZhbHNlKTtcbiAgICAgICAgcmVzdWx0LnB1c2godmFsdWUpO1xuICAgICAgICBpID0gbmV3U3RhcnRGcm9tO1xuICAgIH1cbiAgICByZXR1cm4gW3Jlc3VsdCwgaV07XG59XG5mdW5jdGlvbiBwYXJzZVBnQXJyYXkoYXJyYXlTdHJpbmcpIHtcbiAgICBjb25zdCBbcmVzdWx0XSA9IHBhcnNlUGdOZXN0ZWRBcnJheShhcnJheVN0cmluZywgMSk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn1cbmZ1bmN0aW9uIG1ha2VQZ0FycmF5KGFycmF5KSB7XG4gICAgcmV0dXJuIGB7JHthcnJheS5tYXAoKGl0ZW0pID0+IHtcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoaXRlbSkpIHtcbiAgICAgICAgICAgIHJldHVybiBtYWtlUGdBcnJheShpdGVtKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIGl0ZW0gPT09ICdzdHJpbmcnICYmIGl0ZW0uaW5jbHVkZXMoJywnKSkge1xuICAgICAgICAgICAgcmV0dXJuIGBcIiR7aXRlbS5yZXBsYWNlKC9cIi9nLCAnXFxcXFwiJyl9XCJgO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBgJHtpdGVtfWA7XG4gICAgfSkuam9pbignLCcpfX1gO1xufVxuXG4vLyBUbyB1bmRlcnN0YW5kIGhvdyB0byB1c2UgYENvbHVtbkJ1aWxkZXJgIGFuZCBgQW55Q29sdW1uQnVpbGRlcmAsIHNlZSBgQ29sdW1uYCBhbmQgYEFueUNvbHVtbmAgZG9jdW1lbnRhdGlvbi5cbmNsYXNzIENvbHVtbkJ1aWxkZXIge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnQ29sdW1uQnVpbGRlcic7XG4gICAgY29uZmlnO1xuICAgIGNvbnN0cnVjdG9yKG5hbWUsIGRhdGFUeXBlLCBjb2x1bW5UeXBlKSB7XG4gICAgICAgIHRoaXMuY29uZmlnID0ge1xuICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgIG5vdE51bGw6IGZhbHNlLFxuICAgICAgICAgICAgZGVmYXVsdDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgaGFzRGVmYXVsdDogZmFsc2UsXG4gICAgICAgICAgICBwcmltYXJ5S2V5OiBmYWxzZSxcbiAgICAgICAgICAgIGlzVW5pcXVlOiBmYWxzZSxcbiAgICAgICAgICAgIHVuaXF1ZU5hbWU6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIHVuaXF1ZVR5cGU6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIGRhdGFUeXBlLFxuICAgICAgICAgICAgY29sdW1uVHlwZSxcbiAgICAgICAgfTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2hhbmdlcyB0aGUgZGF0YSB0eXBlIG9mIHRoZSBjb2x1bW4uIENvbW1vbmx5IHVzZWQgd2l0aCBganNvbmAgY29sdW1ucy4gQWxzbywgdXNlZnVsIGZvciBicmFuZGVkIHR5cGVzLlxuICAgICAqXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBgYGB0c1xuICAgICAqIGNvbnN0IHVzZXJzID0gcGdUYWJsZSgndXNlcnMnLCB7XG4gICAgICogXHRpZDogaW50ZWdlcignaWQnKS4kdHlwZTxVc2VySWQ+KCkucHJpbWFyeUtleSgpLFxuICAgICAqIFx0ZGV0YWlsczoganNvbignZGV0YWlscycpLiR0eXBlPFVzZXJEZXRhaWxzPigpLm5vdE51bGwoKSxcbiAgICAgKiB9KTtcbiAgICAgKiBgYGBcbiAgICAgKi9cbiAgICAkdHlwZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEFkZHMgYSBgbm90IG51bGxgIGNsYXVzZSB0byB0aGUgY29sdW1uIGRlZmluaXRpb24uXG4gICAgICpcbiAgICAgKiBBZmZlY3RzIHRoZSBgc2VsZWN0YCBtb2RlbCBvZiB0aGUgdGFibGUgLSBjb2x1bW5zICp3aXRob3V0KiBgbm90IG51bGxgIHdpbGwgYmUgbnVsbGFibGUgb24gc2VsZWN0LlxuICAgICAqL1xuICAgIG5vdE51bGwoKSB7XG4gICAgICAgIHRoaXMuY29uZmlnLm5vdE51bGwgPSB0cnVlO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogQWRkcyBhIGBkZWZhdWx0IDx2YWx1ZT5gIGNsYXVzZSB0byB0aGUgY29sdW1uIGRlZmluaXRpb24uXG4gICAgICpcbiAgICAgKiBBZmZlY3RzIHRoZSBgaW5zZXJ0YCBtb2RlbCBvZiB0aGUgdGFibGUgLSBjb2x1bW5zICp3aXRoKiBgZGVmYXVsdGAgYXJlIG9wdGlvbmFsIG9uIGluc2VydC5cbiAgICAgKlxuICAgICAqIElmIHlvdSBuZWVkIHRvIHNldCBhIGR5bmFtaWMgZGVmYXVsdCB2YWx1ZSwgdXNlIHtAbGluayAkZGVmYXVsdEZufSBpbnN0ZWFkLlxuICAgICAqL1xuICAgIGRlZmF1bHQodmFsdWUpIHtcbiAgICAgICAgdGhpcy5jb25maWcuZGVmYXVsdCA9IHZhbHVlO1xuICAgICAgICB0aGlzLmNvbmZpZy5oYXNEZWZhdWx0ID0gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEFkZHMgYSBkeW5hbWljIGRlZmF1bHQgdmFsdWUgdG8gdGhlIGNvbHVtbi5cbiAgICAgKiBUaGUgZnVuY3Rpb24gd2lsbCBiZSBjYWxsZWQgd2hlbiB0aGUgcm93IGlzIGluc2VydGVkLCBhbmQgdGhlIHJldHVybmVkIHZhbHVlIHdpbGwgYmUgdXNlZCBhcyB0aGUgY29sdW1uIHZhbHVlLlxuICAgICAqXG4gICAgICogKipOb3RlOioqIFRoaXMgdmFsdWUgZG9lcyBub3QgYWZmZWN0IHRoZSBgZHJpenpsZS1raXRgIGJlaGF2aW9yLCBpdCBpcyBvbmx5IHVzZWQgYXQgcnVudGltZSBpbiBgZHJpenpsZS1vcm1gLlxuICAgICAqL1xuICAgICRkZWZhdWx0Rm4oZm4pIHtcbiAgICAgICAgdGhpcy5jb25maWcuZGVmYXVsdEZuID0gZm47XG4gICAgICAgIHRoaXMuY29uZmlnLmhhc0RlZmF1bHQgPSB0cnVlO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogQWxpYXMgZm9yIHtAbGluayAkZGVmYXVsdEZufS5cbiAgICAgKi9cbiAgICAkZGVmYXVsdCA9IHRoaXMuJGRlZmF1bHRGbjtcbiAgICAvKipcbiAgICAgKiBBZGRzIGEgYHByaW1hcnkga2V5YCBjbGF1c2UgdG8gdGhlIGNvbHVtbiBkZWZpbml0aW9uLiBUaGlzIGltcGxpY2l0bHkgbWFrZXMgdGhlIGNvbHVtbiBgbm90IG51bGxgLlxuICAgICAqXG4gICAgICogSW4gU1FMaXRlLCBgaW50ZWdlciBwcmltYXJ5IGtleWAgaW1wbGljaXRseSBtYWtlcyB0aGUgY29sdW1uIGF1dG8taW5jcmVtZW50aW5nLlxuICAgICAqL1xuICAgIHByaW1hcnlLZXkoKSB7XG4gICAgICAgIHRoaXMuY29uZmlnLnByaW1hcnlLZXkgPSB0cnVlO1xuICAgICAgICB0aGlzLmNvbmZpZy5ub3ROdWxsID0gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxufVxuXG5jbGFzcyBQZ0NvbHVtbkJ1aWxkZXIgZXh0ZW5kcyBDb2x1bW5CdWlsZGVyIHtcbiAgICBmb3JlaWduS2V5Q29uZmlncyA9IFtdO1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnUGdDb2x1bW5CdWlsZGVyJztcbiAgICBhcnJheShzaXplKSB7XG4gICAgICAgIHJldHVybiBuZXcgUGdBcnJheUJ1aWxkZXIodGhpcy5jb25maWcubmFtZSwgdGhpcywgc2l6ZSk7XG4gICAgfVxuICAgIHJlZmVyZW5jZXMocmVmLCBhY3Rpb25zID0ge30pIHtcbiAgICAgICAgdGhpcy5mb3JlaWduS2V5Q29uZmlncy5wdXNoKHsgcmVmLCBhY3Rpb25zIH0pO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgdW5pcXVlKG5hbWUsIGNvbmZpZykge1xuICAgICAgICB0aGlzLmNvbmZpZy5pc1VuaXF1ZSA9IHRydWU7XG4gICAgICAgIHRoaXMuY29uZmlnLnVuaXF1ZU5hbWUgPSBuYW1lO1xuICAgICAgICB0aGlzLmNvbmZpZy51bmlxdWVUeXBlID0gY29uZmlnPy5udWxscztcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBidWlsZEZvcmVpZ25LZXlzKGNvbHVtbiwgdGFibGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZm9yZWlnbktleUNvbmZpZ3MubWFwKCh7IHJlZiwgYWN0aW9ucyB9KSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gaWlmZSgocmVmLCBhY3Rpb25zKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgYnVpbGRlciA9IG5ldyBGb3JlaWduS2V5QnVpbGRlcigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZvcmVpZ25Db2x1bW4gPSByZWYoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgY29sdW1uczogW2NvbHVtbl0sIGZvcmVpZ25Db2x1bW5zOiBbZm9yZWlnbkNvbHVtbl0gfTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpZiAoYWN0aW9ucy5vblVwZGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICBidWlsZGVyLm9uVXBkYXRlKGFjdGlvbnMub25VcGRhdGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoYWN0aW9ucy5vbkRlbGV0ZSkge1xuICAgICAgICAgICAgICAgICAgICBidWlsZGVyLm9uRGVsZXRlKGFjdGlvbnMub25EZWxldGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gYnVpbGRlci5idWlsZCh0YWJsZSk7XG4gICAgICAgICAgICB9LCByZWYsIGFjdGlvbnMpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG4vLyBUbyB1bmRlcnN0YW5kIGhvdyB0byB1c2UgYFBnQ29sdW1uYCBhbmQgYFBnQ29sdW1uYCwgc2VlIGBDb2x1bW5gIGFuZCBgQW55Q29sdW1uYCBkb2N1bWVudGF0aW9uLlxuY2xhc3MgUGdDb2x1bW4gZXh0ZW5kcyBDb2x1bW4ge1xuICAgIHRhYmxlO1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnUGdDb2x1bW4nO1xuICAgIGNvbnN0cnVjdG9yKHRhYmxlLCBjb25maWcpIHtcbiAgICAgICAgaWYgKCFjb25maWcudW5pcXVlTmFtZSkge1xuICAgICAgICAgICAgY29uZmlnLnVuaXF1ZU5hbWUgPSB1bmlxdWVLZXlOYW1lKHRhYmxlLCBbY29uZmlnLm5hbWVdKTtcbiAgICAgICAgfVxuICAgICAgICBzdXBlcih0YWJsZSwgY29uZmlnKTtcbiAgICAgICAgdGhpcy50YWJsZSA9IHRhYmxlO1xuICAgIH1cbn1cblxuY2xhc3MgUGdBcnJheUJ1aWxkZXIgZXh0ZW5kcyBQZ0NvbHVtbkJ1aWxkZXIge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnUGdBcnJheUJ1aWxkZXInO1xuICAgIGNvbnN0cnVjdG9yKG5hbWUsIGJhc2VCdWlsZGVyLCBzaXplKSB7XG4gICAgICAgIHN1cGVyKG5hbWUsICdhcnJheScsICdQZ0FycmF5Jyk7XG4gICAgICAgIHRoaXMuY29uZmlnLmJhc2VCdWlsZGVyID0gYmFzZUJ1aWxkZXI7XG4gICAgICAgIHRoaXMuY29uZmlnLnNpemUgPSBzaXplO1xuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgYnVpbGQodGFibGUpIHtcbiAgICAgICAgY29uc3QgYmFzZUNvbHVtbiA9IHRoaXMuY29uZmlnLmJhc2VCdWlsZGVyLmJ1aWxkKHRhYmxlKTtcbiAgICAgICAgcmV0dXJuIG5ldyBQZ0FycmF5KHRhYmxlLCB0aGlzLmNvbmZpZywgYmFzZUNvbHVtbik7XG4gICAgfVxufVxuY2xhc3MgUGdBcnJheSBleHRlbmRzIFBnQ29sdW1uIHtcbiAgICBiYXNlQ29sdW1uO1xuICAgIHJhbmdlO1xuICAgIHNpemU7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdQZ0FycmF5JztcbiAgICBjb25zdHJ1Y3Rvcih0YWJsZSwgY29uZmlnLCBiYXNlQ29sdW1uLCByYW5nZSkge1xuICAgICAgICBzdXBlcih0YWJsZSwgY29uZmlnKTtcbiAgICAgICAgdGhpcy5iYXNlQ29sdW1uID0gYmFzZUNvbHVtbjtcbiAgICAgICAgdGhpcy5yYW5nZSA9IHJhbmdlO1xuICAgICAgICB0aGlzLnNpemUgPSBjb25maWcuc2l6ZTtcbiAgICB9XG4gICAgZ2V0U1FMVHlwZSgpIHtcbiAgICAgICAgcmV0dXJuIGAke3RoaXMuYmFzZUNvbHVtbi5nZXRTUUxUeXBlKCl9WyR7dHlwZW9mIHRoaXMuc2l6ZSA9PT0gJ251bWJlcicgPyB0aGlzLnNpemUgOiAnJ31dYDtcbiAgICB9XG4gICAgbWFwRnJvbURyaXZlclZhbHVlKHZhbHVlKSB7XG4gICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAvLyBUaGFuayB5b3Ugbm9kZS1wb3N0Z3JlcyBmb3Igbm90IHBhcnNpbmcgZW51bSBhcnJheXNcbiAgICAgICAgICAgIHZhbHVlID0gcGFyc2VQZ0FycmF5KHZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdmFsdWUubWFwKCh2KSA9PiB0aGlzLmJhc2VDb2x1bW4ubWFwRnJvbURyaXZlclZhbHVlKHYpKTtcbiAgICB9XG4gICAgbWFwVG9Ecml2ZXJWYWx1ZSh2YWx1ZSwgaXNOZXN0ZWRBcnJheSA9IGZhbHNlKSB7XG4gICAgICAgIGNvbnN0IGEgPSB2YWx1ZS5tYXAoKHYpID0+IHYgPT09IG51bGxcbiAgICAgICAgICAgID8gbnVsbFxuICAgICAgICAgICAgOiBpcyh0aGlzLmJhc2VDb2x1bW4sIFBnQXJyYXkpXG4gICAgICAgICAgICAgICAgPyB0aGlzLmJhc2VDb2x1bW4ubWFwVG9Ecml2ZXJWYWx1ZSh2LCB0cnVlKVxuICAgICAgICAgICAgICAgIDogdGhpcy5iYXNlQ29sdW1uLm1hcFRvRHJpdmVyVmFsdWUodikpO1xuICAgICAgICBpZiAoaXNOZXN0ZWRBcnJheSlcbiAgICAgICAgICAgIHJldHVybiBhO1xuICAgICAgICByZXR1cm4gbWFrZVBnQXJyYXkoYSk7XG4gICAgfVxufVxuXG5jbGFzcyBQZ0RhdGVDb2x1bW5CYXNlQnVpbGRlciBleHRlbmRzIFBnQ29sdW1uQnVpbGRlciB7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdQZ0RhdGVDb2x1bW5CYXNlQnVpbGRlcic7XG4gICAgZGVmYXVsdE5vdygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGVmYXVsdChzcWwgYG5vdygpYCk7XG4gICAgfVxufVxuXG5jbGFzcyBQZ0RhdGVCdWlsZGVyIGV4dGVuZHMgUGdEYXRlQ29sdW1uQmFzZUJ1aWxkZXIge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnUGdEYXRlQnVpbGRlcic7XG4gICAgY29uc3RydWN0b3IobmFtZSkge1xuICAgICAgICBzdXBlcihuYW1lLCAnZGF0ZScsICdQZ0RhdGUnKTtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGJ1aWxkKHRhYmxlKSB7XG4gICAgICAgIHJldHVybiBuZXcgUGdEYXRlKHRhYmxlLCB0aGlzLmNvbmZpZyk7XG4gICAgfVxufVxuY2xhc3MgUGdEYXRlIGV4dGVuZHMgUGdDb2x1bW4ge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnUGdEYXRlJztcbiAgICBnZXRTUUxUeXBlKCkge1xuICAgICAgICByZXR1cm4gJ2RhdGUnO1xuICAgIH1cbiAgICBtYXBGcm9tRHJpdmVyVmFsdWUodmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKHZhbHVlKTtcbiAgICB9XG4gICAgbWFwVG9Ecml2ZXJWYWx1ZSh2YWx1ZSkge1xuICAgICAgICByZXR1cm4gdmFsdWUudG9JU09TdHJpbmcoKTtcbiAgICB9XG59XG5jbGFzcyBQZ0RhdGVTdHJpbmdCdWlsZGVyIGV4dGVuZHMgUGdEYXRlQ29sdW1uQmFzZUJ1aWxkZXIge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnUGdEYXRlU3RyaW5nQnVpbGRlcic7XG4gICAgY29uc3RydWN0b3IobmFtZSkge1xuICAgICAgICBzdXBlcihuYW1lLCAnc3RyaW5nJywgJ1BnRGF0ZVN0cmluZycpO1xuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgYnVpbGQodGFibGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQZ0RhdGVTdHJpbmcodGFibGUsIHRoaXMuY29uZmlnKTtcbiAgICB9XG59XG5jbGFzcyBQZ0RhdGVTdHJpbmcgZXh0ZW5kcyBQZ0NvbHVtbiB7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdQZ0RhdGVTdHJpbmcnO1xuICAgIGdldFNRTFR5cGUoKSB7XG4gICAgICAgIHJldHVybiAnZGF0ZSc7XG4gICAgfVxufVxuZnVuY3Rpb24gZGF0ZShuYW1lLCBjb25maWcpIHtcbiAgICBpZiAoY29uZmlnPy5tb2RlID09PSAnZGF0ZScpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQZ0RhdGVCdWlsZGVyKG5hbWUpO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IFBnRGF0ZVN0cmluZ0J1aWxkZXIobmFtZSk7XG59XG5cbmNsYXNzIFBnSnNvbkJ1aWxkZXIgZXh0ZW5kcyBQZ0NvbHVtbkJ1aWxkZXIge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnUGdKc29uQnVpbGRlcic7XG4gICAgY29uc3RydWN0b3IobmFtZSkge1xuICAgICAgICBzdXBlcihuYW1lLCAnanNvbicsICdQZ0pzb24nKTtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGJ1aWxkKHRhYmxlKSB7XG4gICAgICAgIHJldHVybiBuZXcgUGdKc29uKHRhYmxlLCB0aGlzLmNvbmZpZyk7XG4gICAgfVxufVxuY2xhc3MgUGdKc29uIGV4dGVuZHMgUGdDb2x1bW4ge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnUGdKc29uJztcbiAgICBjb25zdHJ1Y3Rvcih0YWJsZSwgY29uZmlnKSB7XG4gICAgICAgIHN1cGVyKHRhYmxlLCBjb25maWcpO1xuICAgIH1cbiAgICBnZXRTUUxUeXBlKCkge1xuICAgICAgICByZXR1cm4gJ2pzb24nO1xuICAgIH1cbiAgICBtYXBUb0RyaXZlclZhbHVlKHZhbHVlKSB7XG4gICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh2YWx1ZSk7XG4gICAgfVxuICAgIG1hcEZyb21Ecml2ZXJWYWx1ZSh2YWx1ZSkge1xuICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZSh2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9XG59XG5mdW5jdGlvbiBqc29uKG5hbWUpIHtcbiAgICByZXR1cm4gbmV3IFBnSnNvbkJ1aWxkZXIobmFtZSk7XG59XG5cbmNsYXNzIFBnSnNvbmJCdWlsZGVyIGV4dGVuZHMgUGdDb2x1bW5CdWlsZGVyIHtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ1BnSnNvbmJCdWlsZGVyJztcbiAgICBjb25zdHJ1Y3RvcihuYW1lKSB7XG4gICAgICAgIHN1cGVyKG5hbWUsICdqc29uJywgJ1BnSnNvbmInKTtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGJ1aWxkKHRhYmxlKSB7XG4gICAgICAgIHJldHVybiBuZXcgUGdKc29uYih0YWJsZSwgdGhpcy5jb25maWcpO1xuICAgIH1cbn1cbmNsYXNzIFBnSnNvbmIgZXh0ZW5kcyBQZ0NvbHVtbiB7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdQZ0pzb25iJztcbiAgICBjb25zdHJ1Y3Rvcih0YWJsZSwgY29uZmlnKSB7XG4gICAgICAgIHN1cGVyKHRhYmxlLCBjb25maWcpO1xuICAgIH1cbiAgICBnZXRTUUxUeXBlKCkge1xuICAgICAgICByZXR1cm4gJ2pzb25iJztcbiAgICB9XG4gICAgbWFwVG9Ecml2ZXJWYWx1ZSh2YWx1ZSkge1xuICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkodmFsdWUpO1xuICAgIH1cbiAgICBtYXBGcm9tRHJpdmVyVmFsdWUodmFsdWUpIHtcbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UodmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2gge1xuICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgfVxufVxuZnVuY3Rpb24ganNvbmIobmFtZSkge1xuICAgIHJldHVybiBuZXcgUGdKc29uYkJ1aWxkZXIobmFtZSk7XG59XG5cbmNsYXNzIFBnTnVtZXJpY0J1aWxkZXIgZXh0ZW5kcyBQZ0NvbHVtbkJ1aWxkZXIge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnUGdOdW1lcmljQnVpbGRlcic7XG4gICAgY29uc3RydWN0b3IobmFtZSwgcHJlY2lzaW9uLCBzY2FsZSkge1xuICAgICAgICBzdXBlcihuYW1lLCAnc3RyaW5nJywgJ1BnTnVtZXJpYycpO1xuICAgICAgICB0aGlzLmNvbmZpZy5wcmVjaXNpb24gPSBwcmVjaXNpb247XG4gICAgICAgIHRoaXMuY29uZmlnLnNjYWxlID0gc2NhbGU7XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBidWlsZCh0YWJsZSkge1xuICAgICAgICByZXR1cm4gbmV3IFBnTnVtZXJpYyh0YWJsZSwgdGhpcy5jb25maWcpO1xuICAgIH1cbn1cbmNsYXNzIFBnTnVtZXJpYyBleHRlbmRzIFBnQ29sdW1uIHtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ1BnTnVtZXJpYyc7XG4gICAgcHJlY2lzaW9uO1xuICAgIHNjYWxlO1xuICAgIGNvbnN0cnVjdG9yKHRhYmxlLCBjb25maWcpIHtcbiAgICAgICAgc3VwZXIodGFibGUsIGNvbmZpZyk7XG4gICAgICAgIHRoaXMucHJlY2lzaW9uID0gY29uZmlnLnByZWNpc2lvbjtcbiAgICAgICAgdGhpcy5zY2FsZSA9IGNvbmZpZy5zY2FsZTtcbiAgICB9XG4gICAgZ2V0U1FMVHlwZSgpIHtcbiAgICAgICAgaWYgKHRoaXMucHJlY2lzaW9uICE9PSB1bmRlZmluZWQgJiYgdGhpcy5zY2FsZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm4gYG51bWVyaWMoJHt0aGlzLnByZWNpc2lvbn0sICR7dGhpcy5zY2FsZX0pYDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0aGlzLnByZWNpc2lvbiA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm4gJ251bWVyaWMnO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGBudW1lcmljKCR7dGhpcy5wcmVjaXNpb259KWA7XG4gICAgICAgIH1cbiAgICB9XG59XG5mdW5jdGlvbiBudW1lcmljKG5hbWUsIGNvbmZpZykge1xuICAgIHJldHVybiBuZXcgUGdOdW1lcmljQnVpbGRlcihuYW1lLCBjb25maWc/LnByZWNpc2lvbiwgY29uZmlnPy5zY2FsZSk7XG59XG5jb25zdCBkZWNpbWFsID0gbnVtZXJpYztcblxuY2xhc3MgUGdUaW1lQnVpbGRlciBleHRlbmRzIFBnRGF0ZUNvbHVtbkJhc2VCdWlsZGVyIHtcbiAgICB3aXRoVGltZXpvbmU7XG4gICAgcHJlY2lzaW9uO1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnUGdUaW1lQnVpbGRlcic7XG4gICAgY29uc3RydWN0b3IobmFtZSwgd2l0aFRpbWV6b25lLCBwcmVjaXNpb24pIHtcbiAgICAgICAgc3VwZXIobmFtZSwgJ3N0cmluZycsICdQZ1RpbWUnKTtcbiAgICAgICAgdGhpcy53aXRoVGltZXpvbmUgPSB3aXRoVGltZXpvbmU7XG4gICAgICAgIHRoaXMucHJlY2lzaW9uID0gcHJlY2lzaW9uO1xuICAgICAgICB0aGlzLmNvbmZpZy53aXRoVGltZXpvbmUgPSB3aXRoVGltZXpvbmU7XG4gICAgICAgIHRoaXMuY29uZmlnLnByZWNpc2lvbiA9IHByZWNpc2lvbjtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGJ1aWxkKHRhYmxlKSB7XG4gICAgICAgIHJldHVybiBuZXcgUGdUaW1lKHRhYmxlLCB0aGlzLmNvbmZpZyk7XG4gICAgfVxufVxuY2xhc3MgUGdUaW1lIGV4dGVuZHMgUGdDb2x1bW4ge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnUGdUaW1lJztcbiAgICB3aXRoVGltZXpvbmU7XG4gICAgcHJlY2lzaW9uO1xuICAgIGNvbnN0cnVjdG9yKHRhYmxlLCBjb25maWcpIHtcbiAgICAgICAgc3VwZXIodGFibGUsIGNvbmZpZyk7XG4gICAgICAgIHRoaXMud2l0aFRpbWV6b25lID0gY29uZmlnLndpdGhUaW1lem9uZTtcbiAgICAgICAgdGhpcy5wcmVjaXNpb24gPSBjb25maWcucHJlY2lzaW9uO1xuICAgIH1cbiAgICBnZXRTUUxUeXBlKCkge1xuICAgICAgICBjb25zdCBwcmVjaXNpb24gPSB0aGlzLnByZWNpc2lvbiA9PT0gdW5kZWZpbmVkID8gJycgOiBgKCR7dGhpcy5wcmVjaXNpb259KWA7XG4gICAgICAgIHJldHVybiBgdGltZSR7cHJlY2lzaW9ufSR7dGhpcy53aXRoVGltZXpvbmUgPyAnIHdpdGggdGltZSB6b25lJyA6ICcnfWA7XG4gICAgfVxufVxuZnVuY3Rpb24gdGltZShuYW1lLCBjb25maWcgPSB7fSkge1xuICAgIHJldHVybiBuZXcgUGdUaW1lQnVpbGRlcihuYW1lLCBjb25maWcud2l0aFRpbWV6b25lID8/IGZhbHNlLCBjb25maWcucHJlY2lzaW9uKTtcbn1cblxuY2xhc3MgUGdUaW1lc3RhbXBCdWlsZGVyIGV4dGVuZHMgUGdEYXRlQ29sdW1uQmFzZUJ1aWxkZXIge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnUGdUaW1lc3RhbXBCdWlsZGVyJztcbiAgICBjb25zdHJ1Y3RvcihuYW1lLCB3aXRoVGltZXpvbmUsIHByZWNpc2lvbikge1xuICAgICAgICBzdXBlcihuYW1lLCAnZGF0ZScsICdQZ1RpbWVzdGFtcCcpO1xuICAgICAgICB0aGlzLmNvbmZpZy53aXRoVGltZXpvbmUgPSB3aXRoVGltZXpvbmU7XG4gICAgICAgIHRoaXMuY29uZmlnLnByZWNpc2lvbiA9IHByZWNpc2lvbjtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGJ1aWxkKHRhYmxlKSB7XG4gICAgICAgIHJldHVybiBuZXcgUGdUaW1lc3RhbXAodGFibGUsIHRoaXMuY29uZmlnKTtcbiAgICB9XG59XG5jbGFzcyBQZ1RpbWVzdGFtcCBleHRlbmRzIFBnQ29sdW1uIHtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ1BnVGltZXN0YW1wJztcbiAgICB3aXRoVGltZXpvbmU7XG4gICAgcHJlY2lzaW9uO1xuICAgIGNvbnN0cnVjdG9yKHRhYmxlLCBjb25maWcpIHtcbiAgICAgICAgc3VwZXIodGFibGUsIGNvbmZpZyk7XG4gICAgICAgIHRoaXMud2l0aFRpbWV6b25lID0gY29uZmlnLndpdGhUaW1lem9uZTtcbiAgICAgICAgdGhpcy5wcmVjaXNpb24gPSBjb25maWcucHJlY2lzaW9uO1xuICAgIH1cbiAgICBnZXRTUUxUeXBlKCkge1xuICAgICAgICBjb25zdCBwcmVjaXNpb24gPSB0aGlzLnByZWNpc2lvbiA9PT0gdW5kZWZpbmVkID8gJycgOiBgICgke3RoaXMucHJlY2lzaW9ufSlgO1xuICAgICAgICByZXR1cm4gYHRpbWVzdGFtcCR7cHJlY2lzaW9ufSR7dGhpcy53aXRoVGltZXpvbmUgPyAnIHdpdGggdGltZSB6b25lJyA6ICcnfWA7XG4gICAgfVxuICAgIG1hcEZyb21Ecml2ZXJWYWx1ZSA9ICh2YWx1ZSkgPT4ge1xuICAgICAgICByZXR1cm4gbmV3IERhdGUodGhpcy53aXRoVGltZXpvbmUgPyB2YWx1ZSA6IHZhbHVlICsgJyswMDAwJyk7XG4gICAgfTtcbiAgICBtYXBUb0RyaXZlclZhbHVlID0gKHZhbHVlKSA9PiB7XG4gICAgICAgIHJldHVybiB0aGlzLndpdGhUaW1lem9uZSA/IHZhbHVlLnRvVVRDU3RyaW5nKCkgOiB2YWx1ZS50b0lTT1N0cmluZygpO1xuICAgIH07XG59XG5jbGFzcyBQZ1RpbWVzdGFtcFN0cmluZ0J1aWxkZXIgZXh0ZW5kcyBQZ0RhdGVDb2x1bW5CYXNlQnVpbGRlciB7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdQZ1RpbWVzdGFtcFN0cmluZ0J1aWxkZXInO1xuICAgIGNvbnN0cnVjdG9yKG5hbWUsIHdpdGhUaW1lem9uZSwgcHJlY2lzaW9uKSB7XG4gICAgICAgIHN1cGVyKG5hbWUsICdzdHJpbmcnLCAnUGdUaW1lc3RhbXBTdHJpbmcnKTtcbiAgICAgICAgdGhpcy5jb25maWcud2l0aFRpbWV6b25lID0gd2l0aFRpbWV6b25lO1xuICAgICAgICB0aGlzLmNvbmZpZy5wcmVjaXNpb24gPSBwcmVjaXNpb247XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBidWlsZCh0YWJsZSkge1xuICAgICAgICByZXR1cm4gbmV3IFBnVGltZXN0YW1wU3RyaW5nKHRhYmxlLCB0aGlzLmNvbmZpZyk7XG4gICAgfVxufVxuY2xhc3MgUGdUaW1lc3RhbXBTdHJpbmcgZXh0ZW5kcyBQZ0NvbHVtbiB7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdQZ1RpbWVzdGFtcFN0cmluZyc7XG4gICAgd2l0aFRpbWV6b25lO1xuICAgIHByZWNpc2lvbjtcbiAgICBjb25zdHJ1Y3Rvcih0YWJsZSwgY29uZmlnKSB7XG4gICAgICAgIHN1cGVyKHRhYmxlLCBjb25maWcpO1xuICAgICAgICB0aGlzLndpdGhUaW1lem9uZSA9IGNvbmZpZy53aXRoVGltZXpvbmU7XG4gICAgICAgIHRoaXMucHJlY2lzaW9uID0gY29uZmlnLnByZWNpc2lvbjtcbiAgICB9XG4gICAgZ2V0U1FMVHlwZSgpIHtcbiAgICAgICAgY29uc3QgcHJlY2lzaW9uID0gdGhpcy5wcmVjaXNpb24gPT09IHVuZGVmaW5lZCA/ICcnIDogYCgke3RoaXMucHJlY2lzaW9ufSlgO1xuICAgICAgICByZXR1cm4gYHRpbWVzdGFtcCR7cHJlY2lzaW9ufSR7dGhpcy53aXRoVGltZXpvbmUgPyAnIHdpdGggdGltZSB6b25lJyA6ICcnfWA7XG4gICAgfVxufVxuZnVuY3Rpb24gdGltZXN0YW1wKG5hbWUsIGNvbmZpZyA9IHt9KSB7XG4gICAgaWYgKGNvbmZpZy5tb2RlID09PSAnc3RyaW5nJykge1xuICAgICAgICByZXR1cm4gbmV3IFBnVGltZXN0YW1wU3RyaW5nQnVpbGRlcihuYW1lLCBjb25maWcud2l0aFRpbWV6b25lID8/IGZhbHNlLCBjb25maWcucHJlY2lzaW9uKTtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBQZ1RpbWVzdGFtcEJ1aWxkZXIobmFtZSwgY29uZmlnLndpdGhUaW1lem9uZSA/PyBmYWxzZSwgY29uZmlnLnByZWNpc2lvbik7XG59XG5cbmNsYXNzIFBnVVVJREJ1aWxkZXIgZXh0ZW5kcyBQZ0NvbHVtbkJ1aWxkZXIge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnUGdVVUlEQnVpbGRlcic7XG4gICAgY29uc3RydWN0b3IobmFtZSkge1xuICAgICAgICBzdXBlcihuYW1lLCAnc3RyaW5nJywgJ1BnVVVJRCcpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBZGRzIGBkZWZhdWx0IGdlbl9yYW5kb21fdXVpZCgpYCB0byB0aGUgY29sdW1uIGRlZmluaXRpb24uXG4gICAgICovXG4gICAgZGVmYXVsdFJhbmRvbSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGVmYXVsdChzcWwgYGdlbl9yYW5kb21fdXVpZCgpYCk7XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBidWlsZCh0YWJsZSkge1xuICAgICAgICByZXR1cm4gbmV3IFBnVVVJRCh0YWJsZSwgdGhpcy5jb25maWcpO1xuICAgIH1cbn1cbmNsYXNzIFBnVVVJRCBleHRlbmRzIFBnQ29sdW1uIHtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ1BnVVVJRCc7XG4gICAgZ2V0U1FMVHlwZSgpIHtcbiAgICAgICAgcmV0dXJuICd1dWlkJztcbiAgICB9XG59XG5mdW5jdGlvbiB1dWlkKG5hbWUpIHtcbiAgICByZXR1cm4gbmV3IFBnVVVJREJ1aWxkZXIobmFtZSk7XG59XG5cbmNsYXNzIFBnRGlhbGVjdCB7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdQZ0RpYWxlY3QnO1xuICAgIGFzeW5jIG1pZ3JhdGUobWlncmF0aW9ucywgc2Vzc2lvbikge1xuICAgICAgICBjb25zdCBtaWdyYXRpb25UYWJsZUNyZWF0ZSA9IHNxbCBgXG5cdFx0XHRDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyBcImRyaXp6bGVcIi5cIl9fZHJpenpsZV9taWdyYXRpb25zXCIgKFxuXHRcdFx0XHRpZCBTRVJJQUwgUFJJTUFSWSBLRVksXG5cdFx0XHRcdGhhc2ggdGV4dCBOT1QgTlVMTCxcblx0XHRcdFx0Y3JlYXRlZF9hdCBiaWdpbnRcblx0XHRcdClcblx0XHRgO1xuICAgICAgICBhd2FpdCBzZXNzaW9uLmV4ZWN1dGUoc3FsIGBDUkVBVEUgU0NIRU1BIElGIE5PVCBFWElTVFMgXCJkcml6emxlXCJgKTtcbiAgICAgICAgYXdhaXQgc2Vzc2lvbi5leGVjdXRlKG1pZ3JhdGlvblRhYmxlQ3JlYXRlKTtcbiAgICAgICAgY29uc3QgZGJNaWdyYXRpb25zID0gYXdhaXQgc2Vzc2lvbi5hbGwoc3FsIGBzZWxlY3QgaWQsIGhhc2gsIGNyZWF0ZWRfYXQgZnJvbSBcImRyaXp6bGVcIi5cIl9fZHJpenpsZV9taWdyYXRpb25zXCIgb3JkZXIgYnkgY3JlYXRlZF9hdCBkZXNjIGxpbWl0IDFgKTtcbiAgICAgICAgY29uc3QgbGFzdERiTWlncmF0aW9uID0gZGJNaWdyYXRpb25zWzBdO1xuICAgICAgICBhd2FpdCBzZXNzaW9uLnRyYW5zYWN0aW9uKGFzeW5jICh0eCkgPT4ge1xuICAgICAgICAgICAgZm9yIGF3YWl0IChjb25zdCBtaWdyYXRpb24gb2YgbWlncmF0aW9ucykge1xuICAgICAgICAgICAgICAgIGlmICghbGFzdERiTWlncmF0aW9uXG4gICAgICAgICAgICAgICAgICAgIHx8IE51bWJlcihsYXN0RGJNaWdyYXRpb24uY3JlYXRlZF9hdCkgPCBtaWdyYXRpb24uZm9sZGVyTWlsbGlzKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3Qgc3RtdCBvZiBtaWdyYXRpb24uc3FsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0eC5leGVjdXRlKHNxbC5yYXcoc3RtdCkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHR4LmV4ZWN1dGUoc3FsIGBpbnNlcnQgaW50byBcImRyaXp6bGVcIi5cIl9fZHJpenpsZV9taWdyYXRpb25zXCIgKFwiaGFzaFwiLCBcImNyZWF0ZWRfYXRcIikgdmFsdWVzKCR7bWlncmF0aW9uLmhhc2h9LCAke21pZ3JhdGlvbi5mb2xkZXJNaWxsaXN9KWApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGVzY2FwZU5hbWUobmFtZSkge1xuICAgICAgICByZXR1cm4gYFwiJHtuYW1lfVwiYDtcbiAgICB9XG4gICAgZXNjYXBlUGFyYW0obnVtKSB7XG4gICAgICAgIHJldHVybiBgJCR7bnVtICsgMX1gO1xuICAgIH1cbiAgICBlc2NhcGVTdHJpbmcoc3RyKSB7XG4gICAgICAgIHJldHVybiBgJyR7c3RyLnJlcGxhY2UoLycvZywgXCInJ1wiKX0nYDtcbiAgICB9XG4gICAgYnVpbGREZWxldGVRdWVyeSh7IHRhYmxlLCB3aGVyZSwgcmV0dXJuaW5nIH0pIHtcbiAgICAgICAgY29uc3QgcmV0dXJuaW5nU3FsID0gcmV0dXJuaW5nXG4gICAgICAgICAgICA/IHNxbCBgIHJldHVybmluZyAke3RoaXMuYnVpbGRTZWxlY3Rpb24ocmV0dXJuaW5nLCB7IGlzU2luZ2xlVGFibGU6IHRydWUgfSl9YFxuICAgICAgICAgICAgOiB1bmRlZmluZWQ7XG4gICAgICAgIGNvbnN0IHdoZXJlU3FsID0gd2hlcmUgPyBzcWwgYCB3aGVyZSAke3doZXJlfWAgOiB1bmRlZmluZWQ7XG4gICAgICAgIHJldHVybiBzcWwgYGRlbGV0ZSBmcm9tICR7dGFibGV9JHt3aGVyZVNxbH0ke3JldHVybmluZ1NxbH1gO1xuICAgIH1cbiAgICBidWlsZFVwZGF0ZVNldCh0YWJsZSwgc2V0KSB7XG4gICAgICAgIGNvbnN0IHNldEVudHJpZXMgPSBPYmplY3QuZW50cmllcyhzZXQpO1xuICAgICAgICBjb25zdCBzZXRTaXplID0gc2V0RW50cmllcy5sZW5ndGg7XG4gICAgICAgIHJldHVybiBzcWwuam9pbihzZXRFbnRyaWVzXG4gICAgICAgICAgICAuZmxhdE1hcCgoW2NvbE5hbWUsIHZhbHVlXSwgaSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY29sID0gdGFibGVbVGFibGUuU3ltYm9sLkNvbHVtbnNdW2NvbE5hbWVdO1xuICAgICAgICAgICAgY29uc3QgcmVzID0gc3FsIGAke3NxbC5pZGVudGlmaWVyKGNvbC5uYW1lKX0gPSAke3ZhbHVlfWA7XG4gICAgICAgICAgICBpZiAoaSA8IHNldFNpemUgLSAxKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFtyZXMsIHNxbC5yYXcoJywgJyldO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFtyZXNdO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGJ1aWxkVXBkYXRlUXVlcnkoeyB0YWJsZSwgc2V0LCB3aGVyZSwgcmV0dXJuaW5nIH0pIHtcbiAgICAgICAgY29uc3Qgc2V0U3FsID0gdGhpcy5idWlsZFVwZGF0ZVNldCh0YWJsZSwgc2V0KTtcbiAgICAgICAgY29uc3QgcmV0dXJuaW5nU3FsID0gcmV0dXJuaW5nXG4gICAgICAgICAgICA/IHNxbCBgIHJldHVybmluZyAke3RoaXMuYnVpbGRTZWxlY3Rpb24ocmV0dXJuaW5nLCB7IGlzU2luZ2xlVGFibGU6IHRydWUgfSl9YFxuICAgICAgICAgICAgOiB1bmRlZmluZWQ7XG4gICAgICAgIGNvbnN0IHdoZXJlU3FsID0gd2hlcmUgPyBzcWwgYCB3aGVyZSAke3doZXJlfWAgOiB1bmRlZmluZWQ7XG4gICAgICAgIHJldHVybiBzcWwgYHVwZGF0ZSAke3RhYmxlfSBzZXQgJHtzZXRTcWx9JHt3aGVyZVNxbH0ke3JldHVybmluZ1NxbH1gO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBCdWlsZHMgc2VsZWN0aW9uIFNRTCB3aXRoIHByb3ZpZGVkIGZpZWxkcy9leHByZXNzaW9uc1xuICAgICAqXG4gICAgICogRXhhbXBsZXM6XG4gICAgICpcbiAgICAgKiBgc2VsZWN0IDxzZWxlY3Rpb24+IGZyb21gXG4gICAgICpcbiAgICAgKiBgaW5zZXJ0IC4uLiByZXR1cm5pbmcgPHNlbGVjdGlvbj5gXG4gICAgICpcbiAgICAgKiBJZiBgaXNTaW5nbGVUYWJsZWAgaXMgdHJ1ZSwgdGhlbiBjb2x1bW5zIHdvbid0IGJlIHByZWZpeGVkIHdpdGggdGFibGUgbmFtZVxuICAgICAqL1xuICAgIGJ1aWxkU2VsZWN0aW9uKGZpZWxkcywgeyBpc1NpbmdsZVRhYmxlID0gZmFsc2UgfSA9IHt9KSB7XG4gICAgICAgIGNvbnN0IGNvbHVtbnNMZW4gPSBmaWVsZHMubGVuZ3RoO1xuICAgICAgICBjb25zdCBjaHVua3MgPSBmaWVsZHNcbiAgICAgICAgICAgIC5mbGF0TWFwKCh7IGZpZWxkIH0sIGkpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNodW5rID0gW107XG4gICAgICAgICAgICBpZiAoaXMoZmllbGQsIFNRTC5BbGlhc2VkKSAmJiBmaWVsZC5pc1NlbGVjdGlvbkZpZWxkKSB7XG4gICAgICAgICAgICAgICAgY2h1bmsucHVzaChzcWwuaWRlbnRpZmllcihmaWVsZC5maWVsZEFsaWFzKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChpcyhmaWVsZCwgU1FMLkFsaWFzZWQpIHx8IGlzKGZpZWxkLCBTUUwpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcXVlcnkgPSBpcyhmaWVsZCwgU1FMLkFsaWFzZWQpID8gZmllbGQuc3FsIDogZmllbGQ7XG4gICAgICAgICAgICAgICAgaWYgKGlzU2luZ2xlVGFibGUpIHtcbiAgICAgICAgICAgICAgICAgICAgY2h1bmsucHVzaChuZXcgU1FMKHF1ZXJ5LnF1ZXJ5Q2h1bmtzLm1hcCgoYykgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzKGMsIFBnQ29sdW1uKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzcWwuaWRlbnRpZmllcihjLm5hbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGM7XG4gICAgICAgICAgICAgICAgICAgIH0pKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjaHVuay5wdXNoKHF1ZXJ5KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGlzKGZpZWxkLCBTUUwuQWxpYXNlZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgY2h1bmsucHVzaChzcWwgYCBhcyAke3NxbC5pZGVudGlmaWVyKGZpZWxkLmZpZWxkQWxpYXMpfWApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGlzKGZpZWxkLCBDb2x1bW4pKSB7XG4gICAgICAgICAgICAgICAgaWYgKGlzU2luZ2xlVGFibGUpIHtcbiAgICAgICAgICAgICAgICAgICAgY2h1bmsucHVzaChzcWwuaWRlbnRpZmllcihmaWVsZC5uYW1lKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjaHVuay5wdXNoKGZpZWxkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaSA8IGNvbHVtbnNMZW4gLSAxKSB7XG4gICAgICAgICAgICAgICAgY2h1bmsucHVzaChzcWwgYCwgYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gY2h1bms7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gc3FsLmpvaW4oY2h1bmtzKTtcbiAgICB9XG4gICAgYnVpbGRTZWxlY3RRdWVyeSh7IHdpdGhMaXN0LCBmaWVsZHMsIGZpZWxkc0ZsYXQsIHdoZXJlLCBoYXZpbmcsIHRhYmxlLCBqb2lucywgb3JkZXJCeSwgZ3JvdXBCeSwgbGltaXQsIG9mZnNldCwgbG9ja2luZ0NsYXVzZXMsIGRpc3RpbmN0LCB9KSB7XG4gICAgICAgIGNvbnN0IGZpZWxkc0xpc3QgPSBmaWVsZHNGbGF0ID8/IG9yZGVyU2VsZWN0ZWRGaWVsZHMoZmllbGRzKTtcbiAgICAgICAgZm9yIChjb25zdCBmIG9mIGZpZWxkc0xpc3QpIHtcbiAgICAgICAgICAgIGlmIChpcyhmLmZpZWxkLCBDb2x1bW4pXG4gICAgICAgICAgICAgICAgJiYgZ2V0VGFibGVOYW1lKGYuZmllbGQudGFibGUpXG4gICAgICAgICAgICAgICAgICAgICE9PSAoaXModGFibGUsIFN1YnF1ZXJ5KVxuICAgICAgICAgICAgICAgICAgICAgICAgPyB0YWJsZVtTdWJxdWVyeUNvbmZpZ10uYWxpYXNcbiAgICAgICAgICAgICAgICAgICAgICAgIDogaXModGFibGUsIFBnVmlld0Jhc2UpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPyB0YWJsZVtWaWV3QmFzZUNvbmZpZ10ubmFtZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogaXModGFibGUsIFNRTClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBnZXRUYWJsZU5hbWUodGFibGUpKVxuICAgICAgICAgICAgICAgICYmICEoKHRhYmxlKSA9PiBqb2lucz8uc29tZSgoeyBhbGlhcyB9KSA9PiBhbGlhcyA9PT0gKHRhYmxlW1RhYmxlLlN5bWJvbC5Jc0FsaWFzXSA/IGdldFRhYmxlTmFtZSh0YWJsZSkgOiB0YWJsZVtUYWJsZS5TeW1ib2wuQmFzZU5hbWVdKSkpKGYuZmllbGQudGFibGUpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdGFibGVOYW1lID0gZ2V0VGFibGVOYW1lKGYuZmllbGQudGFibGUpO1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgWW91ciBcIiR7Zi5wYXRoLmpvaW4oJy0+Jyl9XCIgZmllbGQgcmVmZXJlbmNlcyBhIGNvbHVtbiBcIiR7dGFibGVOYW1lfVwiLlwiJHtmLmZpZWxkLm5hbWV9XCIsIGJ1dCB0aGUgdGFibGUgXCIke3RhYmxlTmFtZX1cIiBpcyBub3QgcGFydCBvZiB0aGUgcXVlcnkhIERpZCB5b3UgZm9yZ2V0IHRvIGpvaW4gaXQ/YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaXNTaW5nbGVUYWJsZSA9ICFqb2lucyB8fCBqb2lucy5sZW5ndGggPT09IDA7XG4gICAgICAgIGxldCB3aXRoU3FsO1xuICAgICAgICBpZiAod2l0aExpc3Q/Lmxlbmd0aCkge1xuICAgICAgICAgICAgY29uc3Qgd2l0aFNxbENodW5rcyA9IFtzcWwgYHdpdGggYF07XG4gICAgICAgICAgICBmb3IgKGNvbnN0IFtpLCB3XSBvZiB3aXRoTGlzdC5lbnRyaWVzKCkpIHtcbiAgICAgICAgICAgICAgICB3aXRoU3FsQ2h1bmtzLnB1c2goc3FsIGAke3NxbC5pZGVudGlmaWVyKHdbU3VicXVlcnlDb25maWddLmFsaWFzKX0gYXMgKCR7d1tTdWJxdWVyeUNvbmZpZ10uc3FsfSlgKTtcbiAgICAgICAgICAgICAgICBpZiAoaSA8IHdpdGhMaXN0Lmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICAgICAgICAgICAgd2l0aFNxbENodW5rcy5wdXNoKHNxbCBgLCBgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB3aXRoU3FsQ2h1bmtzLnB1c2goc3FsIGAgYCk7XG4gICAgICAgICAgICB3aXRoU3FsID0gc3FsLmpvaW4od2l0aFNxbENodW5rcyk7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGRpc3RpbmN0U3FsO1xuICAgICAgICBpZiAoZGlzdGluY3QpIHtcbiAgICAgICAgICAgIGRpc3RpbmN0U3FsID0gZGlzdGluY3QgPT09IHRydWUgPyBzcWwgYCBkaXN0aW5jdGAgOiBzcWwgYCBkaXN0aW5jdCBvbiAoJHtzcWwuam9pbihkaXN0aW5jdC5vbiwgJywgJyl9KWA7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc2VsZWN0aW9uID0gdGhpcy5idWlsZFNlbGVjdGlvbihmaWVsZHNMaXN0LCB7IGlzU2luZ2xlVGFibGUgfSk7XG4gICAgICAgIGNvbnN0IHRhYmxlU3FsID0gKCgpID0+IHtcbiAgICAgICAgICAgIGlmIChpcyh0YWJsZSwgVGFibGUpICYmIHRhYmxlW1RhYmxlLlN5bWJvbC5PcmlnaW5hbE5hbWVdICE9PSB0YWJsZVtUYWJsZS5TeW1ib2wuTmFtZV0pIHtcbiAgICAgICAgICAgICAgICBsZXQgZnVsbE5hbWUgPSBzcWwgYCR7c3FsLmlkZW50aWZpZXIodGFibGVbVGFibGUuU3ltYm9sLk9yaWdpbmFsTmFtZV0pfWA7XG4gICAgICAgICAgICAgICAgaWYgKHRhYmxlW1RhYmxlLlN5bWJvbC5TY2hlbWFdKSB7XG4gICAgICAgICAgICAgICAgICAgIGZ1bGxOYW1lID0gc3FsIGAke3NxbC5pZGVudGlmaWVyKHRhYmxlW1RhYmxlLlN5bWJvbC5TY2hlbWFdKX0uJHtmdWxsTmFtZX1gO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gc3FsIGAke2Z1bGxOYW1lfSAke3NxbC5pZGVudGlmaWVyKHRhYmxlW1RhYmxlLlN5bWJvbC5OYW1lXSl9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0YWJsZTtcbiAgICAgICAgfSkoKTtcbiAgICAgICAgY29uc3Qgam9pbnNBcnJheSA9IFtdO1xuICAgICAgICBpZiAoam9pbnMpIHtcbiAgICAgICAgICAgIGZvciAoY29uc3QgW2luZGV4LCBqb2luTWV0YV0gb2Ygam9pbnMuZW50cmllcygpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGluZGV4ID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGpvaW5zQXJyYXkucHVzaChzcWwgYCBgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3QgdGFibGUgPSBqb2luTWV0YS50YWJsZTtcbiAgICAgICAgICAgICAgICBjb25zdCBsYXRlcmFsU3FsID0gam9pbk1ldGEubGF0ZXJhbCA/IHNxbCBgIGxhdGVyYWxgIDogdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIGlmIChpcyh0YWJsZSwgUGdUYWJsZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGFibGVOYW1lID0gdGFibGVbUGdUYWJsZS5TeW1ib2wuTmFtZV07XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHRhYmxlU2NoZW1hID0gdGFibGVbUGdUYWJsZS5TeW1ib2wuU2NoZW1hXTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3JpZ1RhYmxlTmFtZSA9IHRhYmxlW1BnVGFibGUuU3ltYm9sLk9yaWdpbmFsTmFtZV07XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGFsaWFzID0gdGFibGVOYW1lID09PSBvcmlnVGFibGVOYW1lID8gdW5kZWZpbmVkIDogam9pbk1ldGEuYWxpYXM7XG4gICAgICAgICAgICAgICAgICAgIGpvaW5zQXJyYXkucHVzaChzcWwgYCR7c3FsLnJhdyhqb2luTWV0YS5qb2luVHlwZSl9IGpvaW4ke2xhdGVyYWxTcWx9ICR7dGFibGVTY2hlbWEgPyBzcWwgYCR7c3FsLmlkZW50aWZpZXIodGFibGVTY2hlbWEpfS5gIDogdW5kZWZpbmVkfSR7c3FsLmlkZW50aWZpZXIob3JpZ1RhYmxlTmFtZSl9JHthbGlhcyAmJiBzcWwgYCAke3NxbC5pZGVudGlmaWVyKGFsaWFzKX1gfSBvbiAke2pvaW5NZXRhLm9ufWApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChpcyh0YWJsZSwgVmlldykpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgdmlld05hbWUgPSB0YWJsZVtWaWV3QmFzZUNvbmZpZ10ubmFtZTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgdmlld1NjaGVtYSA9IHRhYmxlW1ZpZXdCYXNlQ29uZmlnXS5zY2hlbWE7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG9yaWdWaWV3TmFtZSA9IHRhYmxlW1ZpZXdCYXNlQ29uZmlnXS5vcmlnaW5hbE5hbWU7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGFsaWFzID0gdmlld05hbWUgPT09IG9yaWdWaWV3TmFtZSA/IHVuZGVmaW5lZCA6IGpvaW5NZXRhLmFsaWFzO1xuICAgICAgICAgICAgICAgICAgICBqb2luc0FycmF5LnB1c2goc3FsIGAke3NxbC5yYXcoam9pbk1ldGEuam9pblR5cGUpfSBqb2luJHtsYXRlcmFsU3FsfSAke3ZpZXdTY2hlbWEgPyBzcWwgYCR7c3FsLmlkZW50aWZpZXIodmlld1NjaGVtYSl9LmAgOiB1bmRlZmluZWR9JHtzcWwuaWRlbnRpZmllcihvcmlnVmlld05hbWUpfSR7YWxpYXMgJiYgc3FsIGAgJHtzcWwuaWRlbnRpZmllcihhbGlhcyl9YH0gb24gJHtqb2luTWV0YS5vbn1gKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGpvaW5zQXJyYXkucHVzaChzcWwgYCR7c3FsLnJhdyhqb2luTWV0YS5qb2luVHlwZSl9IGpvaW4ke2xhdGVyYWxTcWx9ICR7dGFibGV9IG9uICR7am9pbk1ldGEub259YCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChpbmRleCA8IGpvaW5zLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICAgICAgICAgICAgam9pbnNBcnJheS5wdXNoKHNxbCBgIGApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCBqb2luc1NxbCA9IHNxbC5qb2luKGpvaW5zQXJyYXkpO1xuICAgICAgICBjb25zdCB3aGVyZVNxbCA9IHdoZXJlID8gc3FsIGAgd2hlcmUgJHt3aGVyZX1gIDogdW5kZWZpbmVkO1xuICAgICAgICBjb25zdCBoYXZpbmdTcWwgPSBoYXZpbmcgPyBzcWwgYCBoYXZpbmcgJHtoYXZpbmd9YCA6IHVuZGVmaW5lZDtcbiAgICAgICAgbGV0IG9yZGVyQnlTcWw7XG4gICAgICAgIGlmIChvcmRlckJ5ICYmIG9yZGVyQnkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgb3JkZXJCeVNxbCA9IHNxbCBgIG9yZGVyIGJ5ICR7c3FsLmpvaW4ob3JkZXJCeSwgc3FsIGAsIGApfWA7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGdyb3VwQnlTcWw7XG4gICAgICAgIGlmIChncm91cEJ5ICYmIGdyb3VwQnkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgZ3JvdXBCeVNxbCA9IHNxbCBgIGdyb3VwIGJ5ICR7c3FsLmpvaW4oZ3JvdXBCeSwgc3FsIGAsIGApfWA7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbGltaXRTcWwgPSBsaW1pdCA/IHNxbCBgIGxpbWl0ICR7bGltaXR9YCA6IHVuZGVmaW5lZDtcbiAgICAgICAgY29uc3Qgb2Zmc2V0U3FsID0gb2Zmc2V0ID8gc3FsIGAgb2Zmc2V0ICR7b2Zmc2V0fWAgOiB1bmRlZmluZWQ7XG4gICAgICAgIGNvbnN0IGxvY2tpbmdDbGF1c2VzU3FsID0gc3FsLmVtcHR5KCk7XG4gICAgICAgIGlmIChsb2NraW5nQ2xhdXNlcykge1xuICAgICAgICAgICAgZm9yIChjb25zdCB7IHN0cmVuZ3RoLCBjb25maWcgfSBvZiBsb2NraW5nQ2xhdXNlcykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNsYXVzZVNxbCA9IHNxbCBgIGZvciAke3NxbC5yYXcoc3RyZW5ndGgpfWA7XG4gICAgICAgICAgICAgICAgaWYgKGNvbmZpZy5vZikge1xuICAgICAgICAgICAgICAgICAgICBjbGF1c2VTcWwuYXBwZW5kKHNxbCBgIG9mICR7Y29uZmlnLm9mfWApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoY29uZmlnLm5vV2FpdCkge1xuICAgICAgICAgICAgICAgICAgICBjbGF1c2VTcWwuYXBwZW5kKHNxbCBgIG5vIHdhaXRgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoY29uZmlnLnNraXBMb2NrZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgY2xhdXNlU3FsLmFwcGVuZChzcWwgYCBza2lwIGxvY2tlZGApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBsb2NraW5nQ2xhdXNlc1NxbC5hcHBlbmQoY2xhdXNlU3FsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc3FsIGAke3dpdGhTcWx9c2VsZWN0JHtkaXN0aW5jdFNxbH0gJHtzZWxlY3Rpb259IGZyb20gJHt0YWJsZVNxbH0ke2pvaW5zU3FsfSR7d2hlcmVTcWx9JHtncm91cEJ5U3FsfSR7aGF2aW5nU3FsfSR7b3JkZXJCeVNxbH0ke2xpbWl0U3FsfSR7b2Zmc2V0U3FsfSR7bG9ja2luZ0NsYXVzZXNTcWx9YDtcbiAgICB9XG4gICAgYnVpbGRJbnNlcnRRdWVyeSh7IHRhYmxlLCB2YWx1ZXMsIG9uQ29uZmxpY3QsIHJldHVybmluZyB9KSB7XG4gICAgICAgIGNvbnN0IHZhbHVlc1NxbExpc3QgPSBbXTtcbiAgICAgICAgY29uc3QgY29sdW1ucyA9IHRhYmxlW1RhYmxlLlN5bWJvbC5Db2x1bW5zXTtcbiAgICAgICAgY29uc3QgY29sRW50cmllcyA9IE9iamVjdC5lbnRyaWVzKGNvbHVtbnMpO1xuICAgICAgICBjb25zdCBpbnNlcnRPcmRlciA9IGNvbEVudHJpZXMubWFwKChbLCBjb2x1bW5dKSA9PiBzcWwuaWRlbnRpZmllcihjb2x1bW4ubmFtZSkpO1xuICAgICAgICBmb3IgKGNvbnN0IFt2YWx1ZUluZGV4LCB2YWx1ZV0gb2YgdmFsdWVzLmVudHJpZXMoKSkge1xuICAgICAgICAgICAgY29uc3QgdmFsdWVMaXN0ID0gW107XG4gICAgICAgICAgICBmb3IgKGNvbnN0IFtmaWVsZE5hbWUsIGNvbF0gb2YgY29sRW50cmllcykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvbFZhbHVlID0gdmFsdWVbZmllbGROYW1lXTtcbiAgICAgICAgICAgICAgICBpZiAoY29sVmFsdWUgPT09IHVuZGVmaW5lZCB8fCAoaXMoY29sVmFsdWUsIFBhcmFtKSAmJiBjb2xWYWx1ZS52YWx1ZSA9PT0gdW5kZWZpbmVkKSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgdW5pY29ybi9uby1uZWdhdGVkLWNvbmRpdGlvblxuICAgICAgICAgICAgICAgICAgICBpZiAoY29sLmRlZmF1bHRGbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkZWZhdWx0Rm5SZXN1bHQgPSBjb2wuZGVmYXVsdEZuKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkZWZhdWx0VmFsdWUgPSBpcyhkZWZhdWx0Rm5SZXN1bHQsIFNRTCkgPyBkZWZhdWx0Rm5SZXN1bHQgOiBzcWwucGFyYW0oZGVmYXVsdEZuUmVzdWx0LCBjb2wpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVMaXN0LnB1c2goZGVmYXVsdFZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlTGlzdC5wdXNoKHNxbCBgZGVmYXVsdGApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZUxpc3QucHVzaChjb2xWYWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFsdWVzU3FsTGlzdC5wdXNoKHZhbHVlTGlzdCk7XG4gICAgICAgICAgICBpZiAodmFsdWVJbmRleCA8IHZhbHVlcy5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgICAgICAgdmFsdWVzU3FsTGlzdC5wdXNoKHNxbCBgLCBgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCB2YWx1ZXNTcWwgPSBzcWwuam9pbih2YWx1ZXNTcWxMaXN0KTtcbiAgICAgICAgY29uc3QgcmV0dXJuaW5nU3FsID0gcmV0dXJuaW5nXG4gICAgICAgICAgICA/IHNxbCBgIHJldHVybmluZyAke3RoaXMuYnVpbGRTZWxlY3Rpb24ocmV0dXJuaW5nLCB7IGlzU2luZ2xlVGFibGU6IHRydWUgfSl9YFxuICAgICAgICAgICAgOiB1bmRlZmluZWQ7XG4gICAgICAgIGNvbnN0IG9uQ29uZmxpY3RTcWwgPSBvbkNvbmZsaWN0ID8gc3FsIGAgb24gY29uZmxpY3QgJHtvbkNvbmZsaWN0fWAgOiB1bmRlZmluZWQ7XG4gICAgICAgIHJldHVybiBzcWwgYGluc2VydCBpbnRvICR7dGFibGV9ICR7aW5zZXJ0T3JkZXJ9IHZhbHVlcyAke3ZhbHVlc1NxbH0ke29uQ29uZmxpY3RTcWx9JHtyZXR1cm5pbmdTcWx9YDtcbiAgICB9XG4gICAgYnVpbGRSZWZyZXNoTWF0ZXJpYWxpemVkVmlld1F1ZXJ5KHsgdmlldywgY29uY3VycmVudGx5LCB3aXRoTm9EYXRhIH0pIHtcbiAgICAgICAgY29uc3QgY29uY3VycmVudGx5U3FsID0gY29uY3VycmVudGx5ID8gc3FsIGAgY29uY3VycmVudGx5YCA6IHVuZGVmaW5lZDtcbiAgICAgICAgY29uc3Qgd2l0aE5vRGF0YVNxbCA9IHdpdGhOb0RhdGEgPyBzcWwgYCB3aXRoIG5vIGRhdGFgIDogdW5kZWZpbmVkO1xuICAgICAgICByZXR1cm4gc3FsIGByZWZyZXNoIG1hdGVyaWFsaXplZCB2aWV3JHtjb25jdXJyZW50bHlTcWx9ICR7dmlld30ke3dpdGhOb0RhdGFTcWx9YDtcbiAgICB9XG4gICAgcHJlcGFyZVR5cGluZyhlbmNvZGVyKSB7XG4gICAgICAgIGlmIChpcyhlbmNvZGVyLCBQZ0pzb25iKSB8fCBpcyhlbmNvZGVyLCBQZ0pzb24pKSB7XG4gICAgICAgICAgICByZXR1cm4gJ2pzb24nO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGlzKGVuY29kZXIsIFBnTnVtZXJpYykpIHtcbiAgICAgICAgICAgIHJldHVybiAnZGVjaW1hbCc7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoaXMoZW5jb2RlciwgUGdUaW1lKSkge1xuICAgICAgICAgICAgcmV0dXJuICd0aW1lJztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChpcyhlbmNvZGVyLCBQZ1RpbWVzdGFtcCkpIHtcbiAgICAgICAgICAgIHJldHVybiAndGltZXN0YW1wJztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChpcyhlbmNvZGVyLCBQZ0RhdGUpKSB7XG4gICAgICAgICAgICByZXR1cm4gJ2RhdGUnO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGlzKGVuY29kZXIsIFBnVVVJRCkpIHtcbiAgICAgICAgICAgIHJldHVybiAndXVpZCc7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gJ25vbmUnO1xuICAgICAgICB9XG4gICAgfVxuICAgIHNxbFRvUXVlcnkoc3FsKSB7XG4gICAgICAgIHJldHVybiBzcWwudG9RdWVyeSh7XG4gICAgICAgICAgICBlc2NhcGVOYW1lOiB0aGlzLmVzY2FwZU5hbWUsXG4gICAgICAgICAgICBlc2NhcGVQYXJhbTogdGhpcy5lc2NhcGVQYXJhbSxcbiAgICAgICAgICAgIGVzY2FwZVN0cmluZzogdGhpcy5lc2NhcGVTdHJpbmcsXG4gICAgICAgICAgICBwcmVwYXJlVHlwaW5nOiB0aGlzLnByZXBhcmVUeXBpbmcsXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvLyBidWlsZFJlbGF0aW9uYWxRdWVyeVdpdGhQSyh7XG4gICAgLy8gXHRmdWxsU2NoZW1hLFxuICAgIC8vIFx0c2NoZW1hLFxuICAgIC8vIFx0dGFibGVOYW1lc01hcCxcbiAgICAvLyBcdHRhYmxlLFxuICAgIC8vIFx0dGFibGVDb25maWcsXG4gICAgLy8gXHRxdWVyeUNvbmZpZzogY29uZmlnLFxuICAgIC8vIFx0dGFibGVBbGlhcyxcbiAgICAvLyBcdGlzUm9vdCA9IGZhbHNlLFxuICAgIC8vIFx0am9pbk9uLFxuICAgIC8vIH06IHtcbiAgICAvLyBcdGZ1bGxTY2hlbWE6IFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICAgIC8vIFx0c2NoZW1hOiBUYWJsZXNSZWxhdGlvbmFsQ29uZmlnO1xuICAgIC8vIFx0dGFibGVOYW1lc01hcDogUmVjb3JkPHN0cmluZywgc3RyaW5nPjtcbiAgICAvLyBcdHRhYmxlOiBQZ1RhYmxlO1xuICAgIC8vIFx0dGFibGVDb25maWc6IFRhYmxlUmVsYXRpb25hbENvbmZpZztcbiAgICAvLyBcdHF1ZXJ5Q29uZmlnOiB0cnVlIHwgREJRdWVyeUNvbmZpZzwnbWFueScsIHRydWU+O1xuICAgIC8vIFx0dGFibGVBbGlhczogc3RyaW5nO1xuICAgIC8vIFx0aXNSb290PzogYm9vbGVhbjtcbiAgICAvLyBcdGpvaW5Pbj86IFNRTDtcbiAgICAvLyB9KTogQnVpbGRSZWxhdGlvbmFsUXVlcnlSZXN1bHQ8UGdUYWJsZSwgUGdDb2x1bW4+IHtcbiAgICAvLyBcdC8vIEZvciB7IFwiPHJlbGF0aW9uPlwiOiB0cnVlIH0sIHJldHVybiBhIHRhYmxlIHdpdGggc2VsZWN0aW9uIG9mIGFsbCBjb2x1bW5zXG4gICAgLy8gXHRpZiAoY29uZmlnID09PSB0cnVlKSB7XG4gICAgLy8gXHRcdGNvbnN0IHNlbGVjdGlvbkVudHJpZXMgPSBPYmplY3QuZW50cmllcyh0YWJsZUNvbmZpZy5jb2x1bW5zKTtcbiAgICAvLyBcdFx0Y29uc3Qgc2VsZWN0aW9uOiBCdWlsZFJlbGF0aW9uYWxRdWVyeVJlc3VsdDxQZ1RhYmxlLCBQZ0NvbHVtbj5bJ3NlbGVjdGlvbiddID0gc2VsZWN0aW9uRW50cmllcy5tYXAoKFxuICAgIC8vIFx0XHRcdFtrZXksIHZhbHVlXSxcbiAgICAvLyBcdFx0KSA9PiAoe1xuICAgIC8vIFx0XHRcdGRiS2V5OiB2YWx1ZS5uYW1lLFxuICAgIC8vIFx0XHRcdHRzS2V5OiBrZXksXG4gICAgLy8gXHRcdFx0ZmllbGQ6IHZhbHVlIGFzIFBnQ29sdW1uLFxuICAgIC8vIFx0XHRcdHJlbGF0aW9uVGFibGVUc0tleTogdW5kZWZpbmVkLFxuICAgIC8vIFx0XHRcdGlzSnNvbjogZmFsc2UsXG4gICAgLy8gXHRcdFx0c2VsZWN0aW9uOiBbXSxcbiAgICAvLyBcdFx0fSkpO1xuICAgIC8vIFx0XHRyZXR1cm4ge1xuICAgIC8vIFx0XHRcdHRhYmxlVHNLZXk6IHRhYmxlQ29uZmlnLnRzTmFtZSxcbiAgICAvLyBcdFx0XHRzcWw6IHRhYmxlLFxuICAgIC8vIFx0XHRcdHNlbGVjdGlvbixcbiAgICAvLyBcdFx0fTtcbiAgICAvLyBcdH1cbiAgICAvLyBcdC8vIGxldCBzZWxlY3Rpb246IEJ1aWxkUmVsYXRpb25hbFF1ZXJ5UmVzdWx0PFBnVGFibGUsIFBnQ29sdW1uPlsnc2VsZWN0aW9uJ10gPSBbXTtcbiAgICAvLyBcdC8vIGxldCBzZWxlY3Rpb25Gb3JCdWlsZCA9IHNlbGVjdGlvbjtcbiAgICAvLyBcdGNvbnN0IGFsaWFzZWRDb2x1bW5zID0gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgIC8vIFx0XHRPYmplY3QuZW50cmllcyh0YWJsZUNvbmZpZy5jb2x1bW5zKS5tYXAoKFtrZXksIHZhbHVlXSkgPT4gW2tleSwgYWxpYXNlZFRhYmxlQ29sdW1uKHZhbHVlLCB0YWJsZUFsaWFzKV0pLFxuICAgIC8vIFx0KTtcbiAgICAvLyBcdGNvbnN0IGFsaWFzZWRSZWxhdGlvbnMgPSBPYmplY3QuZnJvbUVudHJpZXMoXG4gICAgLy8gXHRcdE9iamVjdC5lbnRyaWVzKHRhYmxlQ29uZmlnLnJlbGF0aW9ucykubWFwKChba2V5LCB2YWx1ZV0pID0+IFtrZXksIGFsaWFzZWRSZWxhdGlvbih2YWx1ZSwgdGFibGVBbGlhcyldKSxcbiAgICAvLyBcdCk7XG4gICAgLy8gXHRjb25zdCBhbGlhc2VkRmllbGRzID0gT2JqZWN0LmFzc2lnbih7fSwgYWxpYXNlZENvbHVtbnMsIGFsaWFzZWRSZWxhdGlvbnMpO1xuICAgIC8vIFx0bGV0IHdoZXJlLCBoYXNVc2VyRGVmaW5lZFdoZXJlO1xuICAgIC8vIFx0aWYgKGNvbmZpZy53aGVyZSkge1xuICAgIC8vIFx0XHRjb25zdCB3aGVyZVNxbCA9IHR5cGVvZiBjb25maWcud2hlcmUgPT09ICdmdW5jdGlvbicgPyBjb25maWcud2hlcmUoYWxpYXNlZEZpZWxkcywgb3BlcmF0b3JzKSA6IGNvbmZpZy53aGVyZTtcbiAgICAvLyBcdFx0d2hlcmUgPSB3aGVyZVNxbCAmJiBtYXBDb2x1bW5zSW5TUUxUb0FsaWFzKHdoZXJlU3FsLCB0YWJsZUFsaWFzKTtcbiAgICAvLyBcdFx0aGFzVXNlckRlZmluZWRXaGVyZSA9ICEhd2hlcmU7XG4gICAgLy8gXHR9XG4gICAgLy8gXHR3aGVyZSA9IGFuZChqb2luT24sIHdoZXJlKTtcbiAgICAvLyBcdC8vIGNvbnN0IGZpZWxkc1NlbGVjdGlvbjogeyB0c0tleTogc3RyaW5nOyB2YWx1ZTogUGdDb2x1bW4gfCBTUUwuQWxpYXNlZDsgaXNFeHRyYT86IGJvb2xlYW4gfVtdID0gW107XG4gICAgLy8gXHRsZXQgam9pbnM6IEpvaW5bXSA9IFtdO1xuICAgIC8vIFx0bGV0IHNlbGVjdGVkQ29sdW1uczogc3RyaW5nW10gPSBbXTtcbiAgICAvLyBcdC8vIEZpZ3VyZSBvdXQgd2hpY2ggY29sdW1ucyB0byBzZWxlY3RcbiAgICAvLyBcdGlmIChjb25maWcuY29sdW1ucykge1xuICAgIC8vIFx0XHRsZXQgaXNJbmNsdWRlTW9kZSA9IGZhbHNlO1xuICAgIC8vIFx0XHRmb3IgKGNvbnN0IFtmaWVsZCwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGNvbmZpZy5jb2x1bW5zKSkge1xuICAgIC8vIFx0XHRcdGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgLy8gXHRcdFx0XHRjb250aW51ZTtcbiAgICAvLyBcdFx0XHR9XG4gICAgLy8gXHRcdFx0aWYgKGZpZWxkIGluIHRhYmxlQ29uZmlnLmNvbHVtbnMpIHtcbiAgICAvLyBcdFx0XHRcdGlmICghaXNJbmNsdWRlTW9kZSAmJiB2YWx1ZSA9PT0gdHJ1ZSkge1xuICAgIC8vIFx0XHRcdFx0XHRpc0luY2x1ZGVNb2RlID0gdHJ1ZTtcbiAgICAvLyBcdFx0XHRcdH1cbiAgICAvLyBcdFx0XHRcdHNlbGVjdGVkQ29sdW1ucy5wdXNoKGZpZWxkKTtcbiAgICAvLyBcdFx0XHR9XG4gICAgLy8gXHRcdH1cbiAgICAvLyBcdFx0aWYgKHNlbGVjdGVkQ29sdW1ucy5sZW5ndGggPiAwKSB7XG4gICAgLy8gXHRcdFx0c2VsZWN0ZWRDb2x1bW5zID0gaXNJbmNsdWRlTW9kZVxuICAgIC8vIFx0XHRcdFx0PyBzZWxlY3RlZENvbHVtbnMuZmlsdGVyKChjKSA9PiBjb25maWcuY29sdW1ucz8uW2NdID09PSB0cnVlKVxuICAgIC8vIFx0XHRcdFx0OiBPYmplY3Qua2V5cyh0YWJsZUNvbmZpZy5jb2x1bW5zKS5maWx0ZXIoKGtleSkgPT4gIXNlbGVjdGVkQ29sdW1ucy5pbmNsdWRlcyhrZXkpKTtcbiAgICAvLyBcdFx0fVxuICAgIC8vIFx0fSBlbHNlIHtcbiAgICAvLyBcdFx0Ly8gU2VsZWN0IGFsbCBjb2x1bW5zIGlmIHNlbGVjdGlvbiBpcyBub3Qgc3BlY2lmaWVkXG4gICAgLy8gXHRcdHNlbGVjdGVkQ29sdW1ucyA9IE9iamVjdC5rZXlzKHRhYmxlQ29uZmlnLmNvbHVtbnMpO1xuICAgIC8vIFx0fVxuICAgIC8vIFx0Ly8gZm9yIChjb25zdCBmaWVsZCBvZiBzZWxlY3RlZENvbHVtbnMpIHtcbiAgICAvLyBcdC8vIFx0Y29uc3QgY29sdW1uID0gdGFibGVDb25maWcuY29sdW1uc1tmaWVsZF0hIGFzIFBnQ29sdW1uO1xuICAgIC8vIFx0Ly8gXHRmaWVsZHNTZWxlY3Rpb24ucHVzaCh7IHRzS2V5OiBmaWVsZCwgdmFsdWU6IGNvbHVtbiB9KTtcbiAgICAvLyBcdC8vIH1cbiAgICAvLyBcdGxldCBpbml0aWFsbHlTZWxlY3RlZFJlbGF0aW9uczoge1xuICAgIC8vIFx0XHR0c0tleTogc3RyaW5nO1xuICAgIC8vIFx0XHRxdWVyeUNvbmZpZzogdHJ1ZSB8IERCUXVlcnlDb25maWc8J21hbnknLCBmYWxzZT47XG4gICAgLy8gXHRcdHJlbGF0aW9uOiBSZWxhdGlvbjtcbiAgICAvLyBcdH1bXSA9IFtdO1xuICAgIC8vIFx0Ly8gbGV0IHNlbGVjdGVkUmVsYXRpb25zOiBCdWlsZFJlbGF0aW9uYWxRdWVyeVJlc3VsdDxQZ1RhYmxlLCBQZ0NvbHVtbj5bJ3NlbGVjdGlvbiddID0gW107XG4gICAgLy8gXHQvLyBGaWd1cmUgb3V0IHdoaWNoIHJlbGF0aW9ucyB0byBzZWxlY3RcbiAgICAvLyBcdGlmIChjb25maWcud2l0aCkge1xuICAgIC8vIFx0XHRpbml0aWFsbHlTZWxlY3RlZFJlbGF0aW9ucyA9IE9iamVjdC5lbnRyaWVzKGNvbmZpZy53aXRoKVxuICAgIC8vIFx0XHRcdC5maWx0ZXIoKGVudHJ5KTogZW50cnkgaXMgW3R5cGVvZiBlbnRyeVswXSwgTm9uTnVsbGFibGU8dHlwZW9mIGVudHJ5WzFdPl0gPT4gISFlbnRyeVsxXSlcbiAgICAvLyBcdFx0XHQubWFwKChbdHNLZXksIHF1ZXJ5Q29uZmlnXSkgPT4gKHsgdHNLZXksIHF1ZXJ5Q29uZmlnLCByZWxhdGlvbjogdGFibGVDb25maWcucmVsYXRpb25zW3RzS2V5XSEgfSkpO1xuICAgIC8vIFx0fVxuICAgIC8vIFx0Y29uc3QgbWFueVJlbGF0aW9ucyA9IGluaXRpYWxseVNlbGVjdGVkUmVsYXRpb25zLmZpbHRlcigocikgPT5cbiAgICAvLyBcdFx0aXMoci5yZWxhdGlvbiwgTWFueSlcbiAgICAvLyBcdFx0JiYgKHNjaGVtYVt0YWJsZU5hbWVzTWFwW3IucmVsYXRpb24ucmVmZXJlbmNlZFRhYmxlW1RhYmxlLlN5bWJvbC5OYW1lXV0hXT8ucHJpbWFyeUtleS5sZW5ndGggPz8gMCkgPiAwXG4gICAgLy8gXHQpO1xuICAgIC8vIFx0Ly8gSWYgdGhpcyBpcyB0aGUgbGFzdCBNYW55IHJlbGF0aW9uIChvciB0aGVyZSBhcmUgbm8gTWFueSByZWxhdGlvbnMpLCB3ZSBhcmUgb24gdGhlIGlubmVybW9zdCBzdWJxdWVyeSBsZXZlbFxuICAgIC8vIFx0Y29uc3QgaXNJbm5lcm1vc3RRdWVyeSA9IG1hbnlSZWxhdGlvbnMubGVuZ3RoIDwgMjtcbiAgICAvLyBcdGNvbnN0IHNlbGVjdGVkRXh0cmFzOiB7XG4gICAgLy8gXHRcdHRzS2V5OiBzdHJpbmc7XG4gICAgLy8gXHRcdHZhbHVlOiBTUUwuQWxpYXNlZDtcbiAgICAvLyBcdH1bXSA9IFtdO1xuICAgIC8vIFx0Ly8gRmlndXJlIG91dCB3aGljaCBleHRyYXMgdG8gc2VsZWN0XG4gICAgLy8gXHRpZiAoaXNJbm5lcm1vc3RRdWVyeSAmJiBjb25maWcuZXh0cmFzKSB7XG4gICAgLy8gXHRcdGNvbnN0IGV4dHJhcyA9IHR5cGVvZiBjb25maWcuZXh0cmFzID09PSAnZnVuY3Rpb24nXG4gICAgLy8gXHRcdFx0PyBjb25maWcuZXh0cmFzKGFsaWFzZWRGaWVsZHMsIHsgc3FsIH0pXG4gICAgLy8gXHRcdFx0OiBjb25maWcuZXh0cmFzO1xuICAgIC8vIFx0XHRmb3IgKGNvbnN0IFt0c0tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGV4dHJhcykpIHtcbiAgICAvLyBcdFx0XHRzZWxlY3RlZEV4dHJhcy5wdXNoKHtcbiAgICAvLyBcdFx0XHRcdHRzS2V5LFxuICAgIC8vIFx0XHRcdFx0dmFsdWU6IG1hcENvbHVtbnNJbkFsaWFzZWRTUUxUb0FsaWFzKHZhbHVlLCB0YWJsZUFsaWFzKSxcbiAgICAvLyBcdFx0XHR9KTtcbiAgICAvLyBcdFx0fVxuICAgIC8vIFx0fVxuICAgIC8vIFx0Ly8gVHJhbnNmb3JtIGBmaWVsZHNTZWxlY3Rpb25gIGludG8gYHNlbGVjdGlvbmBcbiAgICAvLyBcdC8vIGBmaWVsZHNTZWxlY3Rpb25gIHNob3VsZG4ndCBiZSB1c2VkIGFmdGVyIHRoaXMgcG9pbnRcbiAgICAvLyBcdC8vIGZvciAoY29uc3QgeyB0c0tleSwgdmFsdWUsIGlzRXh0cmEgfSBvZiBmaWVsZHNTZWxlY3Rpb24pIHtcbiAgICAvLyBcdC8vIFx0c2VsZWN0aW9uLnB1c2goe1xuICAgIC8vIFx0Ly8gXHRcdGRiS2V5OiBpcyh2YWx1ZSwgU1FMLkFsaWFzZWQpID8gdmFsdWUuZmllbGRBbGlhcyA6IHRhYmxlQ29uZmlnLmNvbHVtbnNbdHNLZXldIS5uYW1lLFxuICAgIC8vIFx0Ly8gXHRcdHRzS2V5LFxuICAgIC8vIFx0Ly8gXHRcdGZpZWxkOiBpcyh2YWx1ZSwgQ29sdW1uKSA/IGFsaWFzZWRUYWJsZUNvbHVtbih2YWx1ZSwgdGFibGVBbGlhcykgOiB2YWx1ZSxcbiAgICAvLyBcdC8vIFx0XHRyZWxhdGlvblRhYmxlVHNLZXk6IHVuZGVmaW5lZCxcbiAgICAvLyBcdC8vIFx0XHRpc0pzb246IGZhbHNlLFxuICAgIC8vIFx0Ly8gXHRcdGlzRXh0cmEsXG4gICAgLy8gXHQvLyBcdFx0c2VsZWN0aW9uOiBbXSxcbiAgICAvLyBcdC8vIFx0fSk7XG4gICAgLy8gXHQvLyB9XG4gICAgLy8gXHRsZXQgb3JkZXJCeU9yaWcgPSB0eXBlb2YgY29uZmlnLm9yZGVyQnkgPT09ICdmdW5jdGlvbidcbiAgICAvLyBcdFx0PyBjb25maWcub3JkZXJCeShhbGlhc2VkRmllbGRzLCBvcmRlckJ5T3BlcmF0b3JzKVxuICAgIC8vIFx0XHQ6IGNvbmZpZy5vcmRlckJ5ID8/IFtdO1xuICAgIC8vIFx0aWYgKCFBcnJheS5pc0FycmF5KG9yZGVyQnlPcmlnKSkge1xuICAgIC8vIFx0XHRvcmRlckJ5T3JpZyA9IFtvcmRlckJ5T3JpZ107XG4gICAgLy8gXHR9XG4gICAgLy8gXHRjb25zdCBvcmRlckJ5ID0gb3JkZXJCeU9yaWcubWFwKChvcmRlckJ5VmFsdWUpID0+IHtcbiAgICAvLyBcdFx0aWYgKGlzKG9yZGVyQnlWYWx1ZSwgQ29sdW1uKSkge1xuICAgIC8vIFx0XHRcdHJldHVybiBhbGlhc2VkVGFibGVDb2x1bW4ob3JkZXJCeVZhbHVlLCB0YWJsZUFsaWFzKSBhcyBQZ0NvbHVtbjtcbiAgICAvLyBcdFx0fVxuICAgIC8vIFx0XHRyZXR1cm4gbWFwQ29sdW1uc0luU1FMVG9BbGlhcyhvcmRlckJ5VmFsdWUsIHRhYmxlQWxpYXMpO1xuICAgIC8vIFx0fSk7XG4gICAgLy8gXHRjb25zdCBsaW1pdCA9IGlzSW5uZXJtb3N0UXVlcnkgPyBjb25maWcubGltaXQgOiB1bmRlZmluZWQ7XG4gICAgLy8gXHRjb25zdCBvZmZzZXQgPSBpc0lubmVybW9zdFF1ZXJ5ID8gY29uZmlnLm9mZnNldCA6IHVuZGVmaW5lZDtcbiAgICAvLyBcdC8vIEZvciBub24tcm9vdCBxdWVyaWVzIHdpdGhvdXQgYWRkaXRpb25hbCBjb25maWcgZXhjZXB0IGNvbHVtbnMsIHJldHVybiBhIHRhYmxlIHdpdGggc2VsZWN0aW9uXG4gICAgLy8gXHRpZiAoXG4gICAgLy8gXHRcdCFpc1Jvb3RcbiAgICAvLyBcdFx0JiYgaW5pdGlhbGx5U2VsZWN0ZWRSZWxhdGlvbnMubGVuZ3RoID09PSAwXG4gICAgLy8gXHRcdCYmIHNlbGVjdGVkRXh0cmFzLmxlbmd0aCA9PT0gMFxuICAgIC8vIFx0XHQmJiAhd2hlcmVcbiAgICAvLyBcdFx0JiYgb3JkZXJCeS5sZW5ndGggPT09IDBcbiAgICAvLyBcdFx0JiYgbGltaXQgPT09IHVuZGVmaW5lZFxuICAgIC8vIFx0XHQmJiBvZmZzZXQgPT09IHVuZGVmaW5lZFxuICAgIC8vIFx0KSB7XG4gICAgLy8gXHRcdHJldHVybiB7XG4gICAgLy8gXHRcdFx0dGFibGVUc0tleTogdGFibGVDb25maWcudHNOYW1lLFxuICAgIC8vIFx0XHRcdHNxbDogdGFibGUsXG4gICAgLy8gXHRcdFx0c2VsZWN0aW9uOiBzZWxlY3RlZENvbHVtbnMubWFwKChrZXkpID0+ICh7XG4gICAgLy8gXHRcdFx0XHRkYktleTogdGFibGVDb25maWcuY29sdW1uc1trZXldIS5uYW1lLFxuICAgIC8vIFx0XHRcdFx0dHNLZXk6IGtleSxcbiAgICAvLyBcdFx0XHRcdGZpZWxkOiB0YWJsZUNvbmZpZy5jb2x1bW5zW2tleV0gYXMgUGdDb2x1bW4sXG4gICAgLy8gXHRcdFx0XHRyZWxhdGlvblRhYmxlVHNLZXk6IHVuZGVmaW5lZCxcbiAgICAvLyBcdFx0XHRcdGlzSnNvbjogZmFsc2UsXG4gICAgLy8gXHRcdFx0XHRzZWxlY3Rpb246IFtdLFxuICAgIC8vIFx0XHRcdH0pKSxcbiAgICAvLyBcdFx0fTtcbiAgICAvLyBcdH1cbiAgICAvLyBcdGNvbnN0IHNlbGVjdGVkUmVsYXRpb25zV2l0aG91dFBLOlxuICAgIC8vIFx0Ly8gUHJvY2VzcyBhbGwgcmVsYXRpb25zIHdpdGhvdXQgcHJpbWFyeSBrZXlzLCBiZWNhdXNlIHRoZXkgbmVlZCB0byBiZSBqb2luZWQgZGlmZmVyZW50bHkgYW5kIHdpbGwgYWxsIGJlIG9uIHRoZSBzYW1lIHF1ZXJ5IGxldmVsXG4gICAgLy8gXHRmb3IgKFxuICAgIC8vIFx0XHRjb25zdCB7XG4gICAgLy8gXHRcdFx0dHNLZXk6IHNlbGVjdGVkUmVsYXRpb25Uc0tleSxcbiAgICAvLyBcdFx0XHRxdWVyeUNvbmZpZzogc2VsZWN0ZWRSZWxhdGlvbkNvbmZpZ1ZhbHVlLFxuICAgIC8vIFx0XHRcdHJlbGF0aW9uLFxuICAgIC8vIFx0XHR9IG9mIGluaXRpYWxseVNlbGVjdGVkUmVsYXRpb25zXG4gICAgLy8gXHQpIHtcbiAgICAvLyBcdFx0Y29uc3Qgbm9ybWFsaXplZFJlbGF0aW9uID0gbm9ybWFsaXplUmVsYXRpb24oc2NoZW1hLCB0YWJsZU5hbWVzTWFwLCByZWxhdGlvbik7XG4gICAgLy8gXHRcdGNvbnN0IHJlbGF0aW9uVGFibGVOYW1lID0gcmVsYXRpb24ucmVmZXJlbmNlZFRhYmxlW1RhYmxlLlN5bWJvbC5OYW1lXTtcbiAgICAvLyBcdFx0Y29uc3QgcmVsYXRpb25UYWJsZVRzTmFtZSA9IHRhYmxlTmFtZXNNYXBbcmVsYXRpb25UYWJsZU5hbWVdITtcbiAgICAvLyBcdFx0Y29uc3QgcmVsYXRpb25UYWJsZSA9IHNjaGVtYVtyZWxhdGlvblRhYmxlVHNOYW1lXSE7XG4gICAgLy8gXHRcdGlmIChyZWxhdGlvblRhYmxlLnByaW1hcnlLZXkubGVuZ3RoID4gMCkge1xuICAgIC8vIFx0XHRcdGNvbnRpbnVlO1xuICAgIC8vIFx0XHR9XG4gICAgLy8gXHRcdGNvbnN0IHJlbGF0aW9uVGFibGVBbGlhcyA9IGAke3RhYmxlQWxpYXN9XyR7c2VsZWN0ZWRSZWxhdGlvblRzS2V5fWA7XG4gICAgLy8gXHRcdGNvbnN0IGpvaW5PbiA9IGFuZChcbiAgICAvLyBcdFx0XHQuLi5ub3JtYWxpemVkUmVsYXRpb24uZmllbGRzLm1hcCgoZmllbGQsIGkpID0+XG4gICAgLy8gXHRcdFx0XHRlcShcbiAgICAvLyBcdFx0XHRcdFx0YWxpYXNlZFRhYmxlQ29sdW1uKG5vcm1hbGl6ZWRSZWxhdGlvbi5yZWZlcmVuY2VzW2ldISwgcmVsYXRpb25UYWJsZUFsaWFzKSxcbiAgICAvLyBcdFx0XHRcdFx0YWxpYXNlZFRhYmxlQ29sdW1uKGZpZWxkLCB0YWJsZUFsaWFzKSxcbiAgICAvLyBcdFx0XHRcdClcbiAgICAvLyBcdFx0XHQpLFxuICAgIC8vIFx0XHQpO1xuICAgIC8vIFx0XHRjb25zdCBidWlsdFJlbGF0aW9uID0gdGhpcy5idWlsZFJlbGF0aW9uYWxRdWVyeVdpdGhvdXRQSyh7XG4gICAgLy8gXHRcdFx0ZnVsbFNjaGVtYSxcbiAgICAvLyBcdFx0XHRzY2hlbWEsXG4gICAgLy8gXHRcdFx0dGFibGVOYW1lc01hcCxcbiAgICAvLyBcdFx0XHR0YWJsZTogZnVsbFNjaGVtYVtyZWxhdGlvblRhYmxlVHNOYW1lXSBhcyBQZ1RhYmxlLFxuICAgIC8vIFx0XHRcdHRhYmxlQ29uZmlnOiBzY2hlbWFbcmVsYXRpb25UYWJsZVRzTmFtZV0hLFxuICAgIC8vIFx0XHRcdHF1ZXJ5Q29uZmlnOiBzZWxlY3RlZFJlbGF0aW9uQ29uZmlnVmFsdWUsXG4gICAgLy8gXHRcdFx0dGFibGVBbGlhczogcmVsYXRpb25UYWJsZUFsaWFzLFxuICAgIC8vIFx0XHRcdGpvaW5PbixcbiAgICAvLyBcdFx0XHRuZXN0ZWRRdWVyeVJlbGF0aW9uOiByZWxhdGlvbixcbiAgICAvLyBcdFx0fSk7XG4gICAgLy8gXHRcdGNvbnN0IGZpZWxkID0gc3FsYCR7c3FsLmlkZW50aWZpZXIocmVsYXRpb25UYWJsZUFsaWFzKX0uJHtzcWwuaWRlbnRpZmllcignZGF0YScpfWAuYXMoc2VsZWN0ZWRSZWxhdGlvblRzS2V5KTtcbiAgICAvLyBcdFx0am9pbnMucHVzaCh7XG4gICAgLy8gXHRcdFx0b246IHNxbGB0cnVlYCxcbiAgICAvLyBcdFx0XHR0YWJsZTogbmV3IFN1YnF1ZXJ5KGJ1aWx0UmVsYXRpb24uc3FsIGFzIFNRTCwge30sIHJlbGF0aW9uVGFibGVBbGlhcyksXG4gICAgLy8gXHRcdFx0YWxpYXM6IHJlbGF0aW9uVGFibGVBbGlhcyxcbiAgICAvLyBcdFx0XHRqb2luVHlwZTogJ2xlZnQnLFxuICAgIC8vIFx0XHRcdGxhdGVyYWw6IHRydWUsXG4gICAgLy8gXHRcdH0pO1xuICAgIC8vIFx0XHRzZWxlY3RlZFJlbGF0aW9ucy5wdXNoKHtcbiAgICAvLyBcdFx0XHRkYktleTogc2VsZWN0ZWRSZWxhdGlvblRzS2V5LFxuICAgIC8vIFx0XHRcdHRzS2V5OiBzZWxlY3RlZFJlbGF0aW9uVHNLZXksXG4gICAgLy8gXHRcdFx0ZmllbGQsXG4gICAgLy8gXHRcdFx0cmVsYXRpb25UYWJsZVRzS2V5OiByZWxhdGlvblRhYmxlVHNOYW1lLFxuICAgIC8vIFx0XHRcdGlzSnNvbjogdHJ1ZSxcbiAgICAvLyBcdFx0XHRzZWxlY3Rpb246IGJ1aWx0UmVsYXRpb24uc2VsZWN0aW9uLFxuICAgIC8vIFx0XHR9KTtcbiAgICAvLyBcdH1cbiAgICAvLyBcdGNvbnN0IG9uZVJlbGF0aW9ucyA9IGluaXRpYWxseVNlbGVjdGVkUmVsYXRpb25zLmZpbHRlcigocik6IHIgaXMgdHlwZW9mIHIgJiB7IHJlbGF0aW9uOiBPbmUgfSA9PlxuICAgIC8vIFx0XHRpcyhyLnJlbGF0aW9uLCBPbmUpXG4gICAgLy8gXHQpO1xuICAgIC8vIFx0Ly8gUHJvY2VzcyBhbGwgT25lIHJlbGF0aW9ucyB3aXRoIFBLcywgYmVjYXVzZSB0aGV5IGNhbiBhbGwgYmUgam9pbmVkIG9uIHRoZSBzYW1lIGxldmVsXG4gICAgLy8gXHRmb3IgKFxuICAgIC8vIFx0XHRjb25zdCB7XG4gICAgLy8gXHRcdFx0dHNLZXk6IHNlbGVjdGVkUmVsYXRpb25Uc0tleSxcbiAgICAvLyBcdFx0XHRxdWVyeUNvbmZpZzogc2VsZWN0ZWRSZWxhdGlvbkNvbmZpZ1ZhbHVlLFxuICAgIC8vIFx0XHRcdHJlbGF0aW9uLFxuICAgIC8vIFx0XHR9IG9mIG9uZVJlbGF0aW9uc1xuICAgIC8vIFx0KSB7XG4gICAgLy8gXHRcdGNvbnN0IG5vcm1hbGl6ZWRSZWxhdGlvbiA9IG5vcm1hbGl6ZVJlbGF0aW9uKHNjaGVtYSwgdGFibGVOYW1lc01hcCwgcmVsYXRpb24pO1xuICAgIC8vIFx0XHRjb25zdCByZWxhdGlvblRhYmxlTmFtZSA9IHJlbGF0aW9uLnJlZmVyZW5jZWRUYWJsZVtUYWJsZS5TeW1ib2wuTmFtZV07XG4gICAgLy8gXHRcdGNvbnN0IHJlbGF0aW9uVGFibGVUc05hbWUgPSB0YWJsZU5hbWVzTWFwW3JlbGF0aW9uVGFibGVOYW1lXSE7XG4gICAgLy8gXHRcdGNvbnN0IHJlbGF0aW9uVGFibGVBbGlhcyA9IGAke3RhYmxlQWxpYXN9XyR7c2VsZWN0ZWRSZWxhdGlvblRzS2V5fWA7XG4gICAgLy8gXHRcdGNvbnN0IHJlbGF0aW9uVGFibGUgPSBzY2hlbWFbcmVsYXRpb25UYWJsZVRzTmFtZV0hO1xuICAgIC8vIFx0XHRpZiAocmVsYXRpb25UYWJsZS5wcmltYXJ5S2V5Lmxlbmd0aCA9PT0gMCkge1xuICAgIC8vIFx0XHRcdGNvbnRpbnVlO1xuICAgIC8vIFx0XHR9XG4gICAgLy8gXHRcdGNvbnN0IGpvaW5PbiA9IGFuZChcbiAgICAvLyBcdFx0XHQuLi5ub3JtYWxpemVkUmVsYXRpb24uZmllbGRzLm1hcCgoZmllbGQsIGkpID0+XG4gICAgLy8gXHRcdFx0XHRlcShcbiAgICAvLyBcdFx0XHRcdFx0YWxpYXNlZFRhYmxlQ29sdW1uKG5vcm1hbGl6ZWRSZWxhdGlvbi5yZWZlcmVuY2VzW2ldISwgcmVsYXRpb25UYWJsZUFsaWFzKSxcbiAgICAvLyBcdFx0XHRcdFx0YWxpYXNlZFRhYmxlQ29sdW1uKGZpZWxkLCB0YWJsZUFsaWFzKSxcbiAgICAvLyBcdFx0XHRcdClcbiAgICAvLyBcdFx0XHQpLFxuICAgIC8vIFx0XHQpO1xuICAgIC8vIFx0XHRjb25zdCBidWlsdFJlbGF0aW9uID0gdGhpcy5idWlsZFJlbGF0aW9uYWxRdWVyeVdpdGhQSyh7XG4gICAgLy8gXHRcdFx0ZnVsbFNjaGVtYSxcbiAgICAvLyBcdFx0XHRzY2hlbWEsXG4gICAgLy8gXHRcdFx0dGFibGVOYW1lc01hcCxcbiAgICAvLyBcdFx0XHR0YWJsZTogZnVsbFNjaGVtYVtyZWxhdGlvblRhYmxlVHNOYW1lXSBhcyBQZ1RhYmxlLFxuICAgIC8vIFx0XHRcdHRhYmxlQ29uZmlnOiBzY2hlbWFbcmVsYXRpb25UYWJsZVRzTmFtZV0hLFxuICAgIC8vIFx0XHRcdHF1ZXJ5Q29uZmlnOiBzZWxlY3RlZFJlbGF0aW9uQ29uZmlnVmFsdWUsXG4gICAgLy8gXHRcdFx0dGFibGVBbGlhczogcmVsYXRpb25UYWJsZUFsaWFzLFxuICAgIC8vIFx0XHRcdGpvaW5PbixcbiAgICAvLyBcdFx0fSk7XG4gICAgLy8gXHRcdGNvbnN0IGZpZWxkID0gc3FsYGNhc2Ugd2hlbiAke3NxbC5pZGVudGlmaWVyKHJlbGF0aW9uVGFibGVBbGlhcyl9IGlzIG51bGwgdGhlbiBudWxsIGVsc2UganNvbl9idWlsZF9hcnJheSgke1xuICAgIC8vIFx0XHRcdHNxbC5qb2luKFxuICAgIC8vIFx0XHRcdFx0YnVpbHRSZWxhdGlvbi5zZWxlY3Rpb24ubWFwKCh7IGZpZWxkIH0pID0+XG4gICAgLy8gXHRcdFx0XHRcdGlzKGZpZWxkLCBTUUwuQWxpYXNlZClcbiAgICAvLyBcdFx0XHRcdFx0XHQ/IHNxbGAke3NxbC5pZGVudGlmaWVyKHJlbGF0aW9uVGFibGVBbGlhcyl9LiR7c3FsLmlkZW50aWZpZXIoZmllbGQuZmllbGRBbGlhcyl9YFxuICAgIC8vIFx0XHRcdFx0XHRcdDogaXMoZmllbGQsIENvbHVtbilcbiAgICAvLyBcdFx0XHRcdFx0XHQ/IGFsaWFzZWRUYWJsZUNvbHVtbihmaWVsZCwgcmVsYXRpb25UYWJsZUFsaWFzKVxuICAgIC8vIFx0XHRcdFx0XHRcdDogZmllbGRcbiAgICAvLyBcdFx0XHRcdCksXG4gICAgLy8gXHRcdFx0XHRzcWxgLCBgLFxuICAgIC8vIFx0XHRcdClcbiAgICAvLyBcdFx0fSkgZW5kYC5hcyhzZWxlY3RlZFJlbGF0aW9uVHNLZXkpO1xuICAgIC8vIFx0XHRjb25zdCBpc0xhdGVyYWxKb2luID0gaXMoYnVpbHRSZWxhdGlvbi5zcWwsIFNRTCk7XG4gICAgLy8gXHRcdGpvaW5zLnB1c2goe1xuICAgIC8vIFx0XHRcdG9uOiBpc0xhdGVyYWxKb2luID8gc3FsYHRydWVgIDogam9pbk9uLFxuICAgIC8vIFx0XHRcdHRhYmxlOiBpcyhidWlsdFJlbGF0aW9uLnNxbCwgU1FMKVxuICAgIC8vIFx0XHRcdFx0PyBuZXcgU3VicXVlcnkoYnVpbHRSZWxhdGlvbi5zcWwsIHt9LCByZWxhdGlvblRhYmxlQWxpYXMpXG4gICAgLy8gXHRcdFx0XHQ6IGFsaWFzZWRUYWJsZShidWlsdFJlbGF0aW9uLnNxbCwgcmVsYXRpb25UYWJsZUFsaWFzKSxcbiAgICAvLyBcdFx0XHRhbGlhczogcmVsYXRpb25UYWJsZUFsaWFzLFxuICAgIC8vIFx0XHRcdGpvaW5UeXBlOiAnbGVmdCcsXG4gICAgLy8gXHRcdFx0bGF0ZXJhbDogaXMoYnVpbHRSZWxhdGlvbi5zcWwsIFNRTCksXG4gICAgLy8gXHRcdH0pO1xuICAgIC8vIFx0XHRzZWxlY3RlZFJlbGF0aW9ucy5wdXNoKHtcbiAgICAvLyBcdFx0XHRkYktleTogc2VsZWN0ZWRSZWxhdGlvblRzS2V5LFxuICAgIC8vIFx0XHRcdHRzS2V5OiBzZWxlY3RlZFJlbGF0aW9uVHNLZXksXG4gICAgLy8gXHRcdFx0ZmllbGQsXG4gICAgLy8gXHRcdFx0cmVsYXRpb25UYWJsZVRzS2V5OiByZWxhdGlvblRhYmxlVHNOYW1lLFxuICAgIC8vIFx0XHRcdGlzSnNvbjogdHJ1ZSxcbiAgICAvLyBcdFx0XHRzZWxlY3Rpb246IGJ1aWx0UmVsYXRpb24uc2VsZWN0aW9uLFxuICAgIC8vIFx0XHR9KTtcbiAgICAvLyBcdH1cbiAgICAvLyBcdGxldCBkaXN0aW5jdDogUGdTZWxlY3RDb25maWdbJ2Rpc3RpbmN0J107XG4gICAgLy8gXHRsZXQgdGFibGVGcm9tOiBQZ1RhYmxlIHwgU3VicXVlcnkgPSB0YWJsZTtcbiAgICAvLyBcdC8vIFByb2Nlc3MgZmlyc3QgTWFueSByZWxhdGlvbiAtIGVhY2ggb25lIHJlcXVpcmVzIGEgbmVzdGVkIHN1YnF1ZXJ5XG4gICAgLy8gXHRjb25zdCBtYW55UmVsYXRpb24gPSBtYW55UmVsYXRpb25zWzBdO1xuICAgIC8vIFx0aWYgKG1hbnlSZWxhdGlvbikge1xuICAgIC8vIFx0XHRjb25zdCB7XG4gICAgLy8gXHRcdFx0dHNLZXk6IHNlbGVjdGVkUmVsYXRpb25Uc0tleSxcbiAgICAvLyBcdFx0XHRxdWVyeUNvbmZpZzogc2VsZWN0ZWRSZWxhdGlvblF1ZXJ5Q29uZmlnLFxuICAgIC8vIFx0XHRcdHJlbGF0aW9uLFxuICAgIC8vIFx0XHR9ID0gbWFueVJlbGF0aW9uO1xuICAgIC8vIFx0XHRkaXN0aW5jdCA9IHtcbiAgICAvLyBcdFx0XHRvbjogdGFibGVDb25maWcucHJpbWFyeUtleS5tYXAoKGMpID0+IGFsaWFzZWRUYWJsZUNvbHVtbihjIGFzIFBnQ29sdW1uLCB0YWJsZUFsaWFzKSksXG4gICAgLy8gXHRcdH07XG4gICAgLy8gXHRcdGNvbnN0IG5vcm1hbGl6ZWRSZWxhdGlvbiA9IG5vcm1hbGl6ZVJlbGF0aW9uKHNjaGVtYSwgdGFibGVOYW1lc01hcCwgcmVsYXRpb24pO1xuICAgIC8vIFx0XHRjb25zdCByZWxhdGlvblRhYmxlTmFtZSA9IHJlbGF0aW9uLnJlZmVyZW5jZWRUYWJsZVtUYWJsZS5TeW1ib2wuTmFtZV07XG4gICAgLy8gXHRcdGNvbnN0IHJlbGF0aW9uVGFibGVUc05hbWUgPSB0YWJsZU5hbWVzTWFwW3JlbGF0aW9uVGFibGVOYW1lXSE7XG4gICAgLy8gXHRcdGNvbnN0IHJlbGF0aW9uVGFibGVBbGlhcyA9IGAke3RhYmxlQWxpYXN9XyR7c2VsZWN0ZWRSZWxhdGlvblRzS2V5fWA7XG4gICAgLy8gXHRcdGNvbnN0IGpvaW5PbiA9IGFuZChcbiAgICAvLyBcdFx0XHQuLi5ub3JtYWxpemVkUmVsYXRpb24uZmllbGRzLm1hcCgoZmllbGQsIGkpID0+XG4gICAgLy8gXHRcdFx0XHRlcShcbiAgICAvLyBcdFx0XHRcdFx0YWxpYXNlZFRhYmxlQ29sdW1uKG5vcm1hbGl6ZWRSZWxhdGlvbi5yZWZlcmVuY2VzW2ldISwgcmVsYXRpb25UYWJsZUFsaWFzKSxcbiAgICAvLyBcdFx0XHRcdFx0YWxpYXNlZFRhYmxlQ29sdW1uKGZpZWxkLCB0YWJsZUFsaWFzKSxcbiAgICAvLyBcdFx0XHRcdClcbiAgICAvLyBcdFx0XHQpLFxuICAgIC8vIFx0XHQpO1xuICAgIC8vIFx0XHRjb25zdCBidWlsdFJlbGF0aW9uSm9pbiA9IHRoaXMuYnVpbGRSZWxhdGlvbmFsUXVlcnlXaXRoUEsoe1xuICAgIC8vIFx0XHRcdGZ1bGxTY2hlbWEsXG4gICAgLy8gXHRcdFx0c2NoZW1hLFxuICAgIC8vIFx0XHRcdHRhYmxlTmFtZXNNYXAsXG4gICAgLy8gXHRcdFx0dGFibGU6IGZ1bGxTY2hlbWFbcmVsYXRpb25UYWJsZVRzTmFtZV0gYXMgUGdUYWJsZSxcbiAgICAvLyBcdFx0XHR0YWJsZUNvbmZpZzogc2NoZW1hW3JlbGF0aW9uVGFibGVUc05hbWVdISxcbiAgICAvLyBcdFx0XHRxdWVyeUNvbmZpZzogc2VsZWN0ZWRSZWxhdGlvblF1ZXJ5Q29uZmlnLFxuICAgIC8vIFx0XHRcdHRhYmxlQWxpYXM6IHJlbGF0aW9uVGFibGVBbGlhcyxcbiAgICAvLyBcdFx0XHRqb2luT24sXG4gICAgLy8gXHRcdH0pO1xuICAgIC8vIFx0XHRjb25zdCBidWlsdFJlbGF0aW9uU2VsZWN0aW9uRmllbGQgPSBzcWxgY2FzZSB3aGVuICR7XG4gICAgLy8gXHRcdFx0c3FsLmlkZW50aWZpZXIocmVsYXRpb25UYWJsZUFsaWFzKVxuICAgIC8vIFx0XHR9IGlzIG51bGwgdGhlbiAnW10nIGVsc2UganNvbl9hZ2coanNvbl9idWlsZF9hcnJheSgke1xuICAgIC8vIFx0XHRcdHNxbC5qb2luKFxuICAgIC8vIFx0XHRcdFx0YnVpbHRSZWxhdGlvbkpvaW4uc2VsZWN0aW9uLm1hcCgoeyBmaWVsZCB9KSA9PlxuICAgIC8vIFx0XHRcdFx0XHRpcyhmaWVsZCwgU1FMLkFsaWFzZWQpXG4gICAgLy8gXHRcdFx0XHRcdFx0PyBzcWxgJHtzcWwuaWRlbnRpZmllcihyZWxhdGlvblRhYmxlQWxpYXMpfS4ke3NxbC5pZGVudGlmaWVyKGZpZWxkLmZpZWxkQWxpYXMpfWBcbiAgICAvLyBcdFx0XHRcdFx0XHQ6IGlzKGZpZWxkLCBDb2x1bW4pXG4gICAgLy8gXHRcdFx0XHRcdFx0PyBhbGlhc2VkVGFibGVDb2x1bW4oZmllbGQsIHJlbGF0aW9uVGFibGVBbGlhcylcbiAgICAvLyBcdFx0XHRcdFx0XHQ6IGZpZWxkXG4gICAgLy8gXHRcdFx0XHQpLFxuICAgIC8vIFx0XHRcdFx0c3FsYCwgYCxcbiAgICAvLyBcdFx0XHQpXG4gICAgLy8gXHRcdH0pKSBvdmVyIChwYXJ0aXRpb24gYnkgJHtzcWwuam9pbihkaXN0aW5jdC5vbiwgc3FsYCwgYCl9KSBlbmRgLmFzKHNlbGVjdGVkUmVsYXRpb25Uc0tleSk7XG4gICAgLy8gXHRcdGNvbnN0IGlzTGF0ZXJhbEpvaW4gPSBpcyhidWlsdFJlbGF0aW9uSm9pbi5zcWwsIFNRTCk7XG4gICAgLy8gXHRcdGpvaW5zLnB1c2goe1xuICAgIC8vIFx0XHRcdG9uOiBpc0xhdGVyYWxKb2luID8gc3FsYHRydWVgIDogam9pbk9uLFxuICAgIC8vIFx0XHRcdHRhYmxlOiBpc0xhdGVyYWxKb2luXG4gICAgLy8gXHRcdFx0XHQ/IG5ldyBTdWJxdWVyeShidWlsdFJlbGF0aW9uSm9pbi5zcWwgYXMgU1FMLCB7fSwgcmVsYXRpb25UYWJsZUFsaWFzKVxuICAgIC8vIFx0XHRcdFx0OiBhbGlhc2VkVGFibGUoYnVpbHRSZWxhdGlvbkpvaW4uc3FsIGFzIFBnVGFibGUsIHJlbGF0aW9uVGFibGVBbGlhcyksXG4gICAgLy8gXHRcdFx0YWxpYXM6IHJlbGF0aW9uVGFibGVBbGlhcyxcbiAgICAvLyBcdFx0XHRqb2luVHlwZTogJ2xlZnQnLFxuICAgIC8vIFx0XHRcdGxhdGVyYWw6IGlzTGF0ZXJhbEpvaW4sXG4gICAgLy8gXHRcdH0pO1xuICAgIC8vIFx0XHQvLyBCdWlsZCB0aGUgXCJmcm9tXCIgc3VicXVlcnkgd2l0aCB0aGUgcmVtYWluaW5nIE1hbnkgcmVsYXRpb25zXG4gICAgLy8gXHRcdGNvbnN0IGJ1aWx0VGFibGVGcm9tID0gdGhpcy5idWlsZFJlbGF0aW9uYWxRdWVyeVdpdGhQSyh7XG4gICAgLy8gXHRcdFx0ZnVsbFNjaGVtYSxcbiAgICAvLyBcdFx0XHRzY2hlbWEsXG4gICAgLy8gXHRcdFx0dGFibGVOYW1lc01hcCxcbiAgICAvLyBcdFx0XHR0YWJsZSxcbiAgICAvLyBcdFx0XHR0YWJsZUNvbmZpZyxcbiAgICAvLyBcdFx0XHRxdWVyeUNvbmZpZzoge1xuICAgIC8vIFx0XHRcdFx0Li4uY29uZmlnLFxuICAgIC8vIFx0XHRcdFx0d2hlcmU6IHVuZGVmaW5lZCxcbiAgICAvLyBcdFx0XHRcdG9yZGVyQnk6IHVuZGVmaW5lZCxcbiAgICAvLyBcdFx0XHRcdGxpbWl0OiB1bmRlZmluZWQsXG4gICAgLy8gXHRcdFx0XHRvZmZzZXQ6IHVuZGVmaW5lZCxcbiAgICAvLyBcdFx0XHRcdHdpdGg6IG1hbnlSZWxhdGlvbnMuc2xpY2UoMSkucmVkdWNlPE5vbk51bGxhYmxlPHR5cGVvZiBjb25maWdbJ3dpdGgnXT4+KFxuICAgIC8vIFx0XHRcdFx0XHQocmVzdWx0LCB7IHRzS2V5LCBxdWVyeUNvbmZpZzogY29uZmlnVmFsdWUgfSkgPT4ge1xuICAgIC8vIFx0XHRcdFx0XHRcdHJlc3VsdFt0c0tleV0gPSBjb25maWdWYWx1ZTtcbiAgICAvLyBcdFx0XHRcdFx0XHRyZXR1cm4gcmVzdWx0O1xuICAgIC8vIFx0XHRcdFx0XHR9LFxuICAgIC8vIFx0XHRcdFx0XHR7fSxcbiAgICAvLyBcdFx0XHRcdCksXG4gICAgLy8gXHRcdFx0fSxcbiAgICAvLyBcdFx0XHR0YWJsZUFsaWFzLFxuICAgIC8vIFx0XHR9KTtcbiAgICAvLyBcdFx0c2VsZWN0ZWRSZWxhdGlvbnMucHVzaCh7XG4gICAgLy8gXHRcdFx0ZGJLZXk6IHNlbGVjdGVkUmVsYXRpb25Uc0tleSxcbiAgICAvLyBcdFx0XHR0c0tleTogc2VsZWN0ZWRSZWxhdGlvblRzS2V5LFxuICAgIC8vIFx0XHRcdGZpZWxkOiBidWlsdFJlbGF0aW9uU2VsZWN0aW9uRmllbGQsXG4gICAgLy8gXHRcdFx0cmVsYXRpb25UYWJsZVRzS2V5OiByZWxhdGlvblRhYmxlVHNOYW1lLFxuICAgIC8vIFx0XHRcdGlzSnNvbjogdHJ1ZSxcbiAgICAvLyBcdFx0XHRzZWxlY3Rpb246IGJ1aWx0UmVsYXRpb25Kb2luLnNlbGVjdGlvbixcbiAgICAvLyBcdFx0fSk7XG4gICAgLy8gXHRcdC8vIHNlbGVjdGlvbiA9IGJ1aWx0VGFibGVGcm9tLnNlbGVjdGlvbi5tYXAoKGl0ZW0pID0+XG4gICAgLy8gXHRcdC8vIFx0aXMoaXRlbS5maWVsZCwgU1FMLkFsaWFzZWQpXG4gICAgLy8gXHRcdC8vIFx0XHQ/IHsgLi4uaXRlbSwgZmllbGQ6IHNxbGAke3NxbC5pZGVudGlmaWVyKHRhYmxlQWxpYXMpfS4ke3NxbC5pZGVudGlmaWVyKGl0ZW0uZmllbGQuZmllbGRBbGlhcyl9YCB9XG4gICAgLy8gXHRcdC8vIFx0XHQ6IGl0ZW1cbiAgICAvLyBcdFx0Ly8gKTtcbiAgICAvLyBcdFx0Ly8gc2VsZWN0aW9uRm9yQnVpbGQgPSBbe1xuICAgIC8vIFx0XHQvLyBcdGRiS2V5OiAnKicsXG4gICAgLy8gXHRcdC8vIFx0dHNLZXk6ICcqJyxcbiAgICAvLyBcdFx0Ly8gXHRmaWVsZDogc3FsYCR7c3FsLmlkZW50aWZpZXIodGFibGVBbGlhcyl9LipgLFxuICAgIC8vIFx0XHQvLyBcdHNlbGVjdGlvbjogW10sXG4gICAgLy8gXHRcdC8vIFx0aXNKc29uOiBmYWxzZSxcbiAgICAvLyBcdFx0Ly8gXHRyZWxhdGlvblRhYmxlVHNLZXk6IHVuZGVmaW5lZCxcbiAgICAvLyBcdFx0Ly8gfV07XG4gICAgLy8gXHRcdC8vIGNvbnN0IG5ld1NlbGVjdGlvbkl0ZW06ICh0eXBlb2Ygc2VsZWN0aW9uKVtudW1iZXJdID0ge1xuICAgIC8vIFx0XHQvLyBcdGRiS2V5OiBzZWxlY3RlZFJlbGF0aW9uVHNLZXksXG4gICAgLy8gXHRcdC8vIFx0dHNLZXk6IHNlbGVjdGVkUmVsYXRpb25Uc0tleSxcbiAgICAvLyBcdFx0Ly8gXHRmaWVsZCxcbiAgICAvLyBcdFx0Ly8gXHRyZWxhdGlvblRhYmxlVHNLZXk6IHJlbGF0aW9uVGFibGVUc05hbWUsXG4gICAgLy8gXHRcdC8vIFx0aXNKc29uOiB0cnVlLFxuICAgIC8vIFx0XHQvLyBcdHNlbGVjdGlvbjogYnVpbHRSZWxhdGlvbkpvaW4uc2VsZWN0aW9uLFxuICAgIC8vIFx0XHQvLyB9O1xuICAgIC8vIFx0XHQvLyBzZWxlY3Rpb24ucHVzaChuZXdTZWxlY3Rpb25JdGVtKTtcbiAgICAvLyBcdFx0Ly8gc2VsZWN0aW9uRm9yQnVpbGQucHVzaChuZXdTZWxlY3Rpb25JdGVtKTtcbiAgICAvLyBcdFx0dGFibGVGcm9tID0gaXMoYnVpbHRUYWJsZUZyb20uc3FsLCBQZ1RhYmxlKVxuICAgIC8vIFx0XHRcdD8gYnVpbHRUYWJsZUZyb20uc3FsXG4gICAgLy8gXHRcdFx0OiBuZXcgU3VicXVlcnkoYnVpbHRUYWJsZUZyb20uc3FsLCB7fSwgdGFibGVBbGlhcyk7XG4gICAgLy8gXHR9XG4gICAgLy8gXHRpZiAoc2VsZWN0ZWRDb2x1bW5zLmxlbmd0aCA9PT0gMCAmJiBzZWxlY3RlZFJlbGF0aW9ucy5sZW5ndGggPT09IDAgJiYgc2VsZWN0ZWRFeHRyYXMubGVuZ3RoID09PSAwKSB7XG4gICAgLy8gXHRcdHRocm93IG5ldyBEcml6emxlRXJyb3IoYE5vIGZpZWxkcyBzZWxlY3RlZCBmb3IgdGFibGUgXCIke3RhYmxlQ29uZmlnLnRzTmFtZX1cIiAoXCIke3RhYmxlQWxpYXN9XCIpYCk7XG4gICAgLy8gXHR9XG4gICAgLy8gXHRsZXQgc2VsZWN0aW9uOiBCdWlsZFJlbGF0aW9uYWxRdWVyeVJlc3VsdDxQZ1RhYmxlLCBQZ0NvbHVtbj5bJ3NlbGVjdGlvbiddO1xuICAgIC8vIFx0ZnVuY3Rpb24gcHJlcGFyZVNlbGVjdGVkQ29sdW1ucygpIHtcbiAgICAvLyBcdFx0cmV0dXJuIHNlbGVjdGVkQ29sdW1ucy5tYXAoKGtleSkgPT4gKHtcbiAgICAvLyBcdFx0XHRkYktleTogdGFibGVDb25maWcuY29sdW1uc1trZXldIS5uYW1lLFxuICAgIC8vIFx0XHRcdHRzS2V5OiBrZXksXG4gICAgLy8gXHRcdFx0ZmllbGQ6IHRhYmxlQ29uZmlnLmNvbHVtbnNba2V5XSBhcyBQZ0NvbHVtbixcbiAgICAvLyBcdFx0XHRyZWxhdGlvblRhYmxlVHNLZXk6IHVuZGVmaW5lZCxcbiAgICAvLyBcdFx0XHRpc0pzb246IGZhbHNlLFxuICAgIC8vIFx0XHRcdHNlbGVjdGlvbjogW10sXG4gICAgLy8gXHRcdH0pKTtcbiAgICAvLyBcdH1cbiAgICAvLyBcdGZ1bmN0aW9uIHByZXBhcmVTZWxlY3RlZEV4dHJhcygpIHtcbiAgICAvLyBcdFx0cmV0dXJuIHNlbGVjdGVkRXh0cmFzLm1hcCgoaXRlbSkgPT4gKHtcbiAgICAvLyBcdFx0XHRkYktleTogaXRlbS52YWx1ZS5maWVsZEFsaWFzLFxuICAgIC8vIFx0XHRcdHRzS2V5OiBpdGVtLnRzS2V5LFxuICAgIC8vIFx0XHRcdGZpZWxkOiBpdGVtLnZhbHVlLFxuICAgIC8vIFx0XHRcdHJlbGF0aW9uVGFibGVUc0tleTogdW5kZWZpbmVkLFxuICAgIC8vIFx0XHRcdGlzSnNvbjogZmFsc2UsXG4gICAgLy8gXHRcdFx0c2VsZWN0aW9uOiBbXSxcbiAgICAvLyBcdFx0fSkpO1xuICAgIC8vIFx0fVxuICAgIC8vIFx0aWYgKGlzUm9vdCkge1xuICAgIC8vIFx0XHRzZWxlY3Rpb24gPSBbXG4gICAgLy8gXHRcdFx0Li4ucHJlcGFyZVNlbGVjdGVkQ29sdW1ucygpLFxuICAgIC8vIFx0XHRcdC4uLnByZXBhcmVTZWxlY3RlZEV4dHJhcygpLFxuICAgIC8vIFx0XHRdO1xuICAgIC8vIFx0fVxuICAgIC8vIFx0aWYgKGhhc1VzZXJEZWZpbmVkV2hlcmUgfHwgb3JkZXJCeS5sZW5ndGggPiAwKSB7XG4gICAgLy8gXHRcdHRhYmxlRnJvbSA9IG5ldyBTdWJxdWVyeShcbiAgICAvLyBcdFx0XHR0aGlzLmJ1aWxkU2VsZWN0UXVlcnkoe1xuICAgIC8vIFx0XHRcdFx0dGFibGU6IGlzKHRhYmxlRnJvbSwgUGdUYWJsZSkgPyBhbGlhc2VkVGFibGUodGFibGVGcm9tLCB0YWJsZUFsaWFzKSA6IHRhYmxlRnJvbSxcbiAgICAvLyBcdFx0XHRcdGZpZWxkczoge30sXG4gICAgLy8gXHRcdFx0XHRmaWVsZHNGbGF0OiBzZWxlY3Rpb25Gb3JCdWlsZC5tYXAoKHsgZmllbGQgfSkgPT4gKHtcbiAgICAvLyBcdFx0XHRcdFx0cGF0aDogW10sXG4gICAgLy8gXHRcdFx0XHRcdGZpZWxkOiBpcyhmaWVsZCwgQ29sdW1uKSA/IGFsaWFzZWRUYWJsZUNvbHVtbihmaWVsZCwgdGFibGVBbGlhcykgOiBmaWVsZCxcbiAgICAvLyBcdFx0XHRcdH0pKSxcbiAgICAvLyBcdFx0XHRcdGpvaW5zLFxuICAgIC8vIFx0XHRcdFx0ZGlzdGluY3QsXG4gICAgLy8gXHRcdFx0fSksXG4gICAgLy8gXHRcdFx0e30sXG4gICAgLy8gXHRcdFx0dGFibGVBbGlhcyxcbiAgICAvLyBcdFx0KTtcbiAgICAvLyBcdFx0c2VsZWN0aW9uRm9yQnVpbGQgPSBzZWxlY3Rpb24ubWFwKChpdGVtKSA9PlxuICAgIC8vIFx0XHRcdGlzKGl0ZW0uZmllbGQsIFNRTC5BbGlhc2VkKVxuICAgIC8vIFx0XHRcdFx0PyB7IC4uLml0ZW0sIGZpZWxkOiBzcWxgJHtzcWwuaWRlbnRpZmllcih0YWJsZUFsaWFzKX0uJHtzcWwuaWRlbnRpZmllcihpdGVtLmZpZWxkLmZpZWxkQWxpYXMpfWAgfVxuICAgIC8vIFx0XHRcdFx0OiBpdGVtXG4gICAgLy8gXHRcdCk7XG4gICAgLy8gXHRcdGpvaW5zID0gW107XG4gICAgLy8gXHRcdGRpc3RpbmN0ID0gdW5kZWZpbmVkO1xuICAgIC8vIFx0fVxuICAgIC8vIFx0Y29uc3QgcmVzdWx0ID0gdGhpcy5idWlsZFNlbGVjdFF1ZXJ5KHtcbiAgICAvLyBcdFx0dGFibGU6IGlzKHRhYmxlRnJvbSwgUGdUYWJsZSkgPyBhbGlhc2VkVGFibGUodGFibGVGcm9tLCB0YWJsZUFsaWFzKSA6IHRhYmxlRnJvbSxcbiAgICAvLyBcdFx0ZmllbGRzOiB7fSxcbiAgICAvLyBcdFx0ZmllbGRzRmxhdDogc2VsZWN0aW9uRm9yQnVpbGQubWFwKCh7IGZpZWxkIH0pID0+ICh7XG4gICAgLy8gXHRcdFx0cGF0aDogW10sXG4gICAgLy8gXHRcdFx0ZmllbGQ6IGlzKGZpZWxkLCBDb2x1bW4pID8gYWxpYXNlZFRhYmxlQ29sdW1uKGZpZWxkLCB0YWJsZUFsaWFzKSA6IGZpZWxkLFxuICAgIC8vIFx0XHR9KSksXG4gICAgLy8gXHRcdHdoZXJlLFxuICAgIC8vIFx0XHRsaW1pdCxcbiAgICAvLyBcdFx0b2Zmc2V0LFxuICAgIC8vIFx0XHRqb2lucyxcbiAgICAvLyBcdFx0b3JkZXJCeSxcbiAgICAvLyBcdFx0ZGlzdGluY3QsXG4gICAgLy8gXHR9KTtcbiAgICAvLyBcdHJldHVybiB7XG4gICAgLy8gXHRcdHRhYmxlVHNLZXk6IHRhYmxlQ29uZmlnLnRzTmFtZSxcbiAgICAvLyBcdFx0c3FsOiByZXN1bHQsXG4gICAgLy8gXHRcdHNlbGVjdGlvbixcbiAgICAvLyBcdH07XG4gICAgLy8gfVxuICAgIGJ1aWxkUmVsYXRpb25hbFF1ZXJ5V2l0aG91dFBLKHsgZnVsbFNjaGVtYSwgc2NoZW1hLCB0YWJsZU5hbWVzTWFwLCB0YWJsZSwgdGFibGVDb25maWcsIHF1ZXJ5Q29uZmlnOiBjb25maWcsIHRhYmxlQWxpYXMsIG5lc3RlZFF1ZXJ5UmVsYXRpb24sIGpvaW5PbiwgfSkge1xuICAgICAgICBsZXQgc2VsZWN0aW9uID0gW107XG4gICAgICAgIGxldCBsaW1pdCwgb2Zmc2V0LCBvcmRlckJ5ID0gW10sIHdoZXJlO1xuICAgICAgICBjb25zdCBqb2lucyA9IFtdO1xuICAgICAgICBpZiAoY29uZmlnID09PSB0cnVlKSB7XG4gICAgICAgICAgICBjb25zdCBzZWxlY3Rpb25FbnRyaWVzID0gT2JqZWN0LmVudHJpZXModGFibGVDb25maWcuY29sdW1ucyk7XG4gICAgICAgICAgICBzZWxlY3Rpb24gPSBzZWxlY3Rpb25FbnRyaWVzLm1hcCgoW2tleSwgdmFsdWVdKSA9PiAoe1xuICAgICAgICAgICAgICAgIGRiS2V5OiB2YWx1ZS5uYW1lLFxuICAgICAgICAgICAgICAgIHRzS2V5OiBrZXksXG4gICAgICAgICAgICAgICAgZmllbGQ6IGFsaWFzZWRUYWJsZUNvbHVtbih2YWx1ZSwgdGFibGVBbGlhcyksXG4gICAgICAgICAgICAgICAgcmVsYXRpb25UYWJsZVRzS2V5OiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgaXNKc29uOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBzZWxlY3Rpb246IFtdLFxuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgYWxpYXNlZENvbHVtbnMgPSBPYmplY3QuZnJvbUVudHJpZXMoT2JqZWN0LmVudHJpZXModGFibGVDb25maWcuY29sdW1ucykubWFwKChba2V5LCB2YWx1ZV0pID0+IFtrZXksIGFsaWFzZWRUYWJsZUNvbHVtbih2YWx1ZSwgdGFibGVBbGlhcyldKSk7XG4gICAgICAgICAgICBpZiAoY29uZmlnLndoZXJlKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgd2hlcmVTcWwgPSB0eXBlb2YgY29uZmlnLndoZXJlID09PSAnZnVuY3Rpb24nXG4gICAgICAgICAgICAgICAgICAgID8gY29uZmlnLndoZXJlKGFsaWFzZWRDb2x1bW5zLCBnZXRPcGVyYXRvcnMoKSlcbiAgICAgICAgICAgICAgICAgICAgOiBjb25maWcud2hlcmU7XG4gICAgICAgICAgICAgICAgd2hlcmUgPSB3aGVyZVNxbCAmJiBtYXBDb2x1bW5zSW5TUUxUb0FsaWFzKHdoZXJlU3FsLCB0YWJsZUFsaWFzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGZpZWxkc1NlbGVjdGlvbiA9IFtdO1xuICAgICAgICAgICAgbGV0IHNlbGVjdGVkQ29sdW1ucyA9IFtdO1xuICAgICAgICAgICAgLy8gRmlndXJlIG91dCB3aGljaCBjb2x1bW5zIHRvIHNlbGVjdFxuICAgICAgICAgICAgaWYgKGNvbmZpZy5jb2x1bW5zKSB7XG4gICAgICAgICAgICAgICAgbGV0IGlzSW5jbHVkZU1vZGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IFtmaWVsZCwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGNvbmZpZy5jb2x1bW5zKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpZWxkIGluIHRhYmxlQ29uZmlnLmNvbHVtbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaXNJbmNsdWRlTW9kZSAmJiB2YWx1ZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzSW5jbHVkZU1vZGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRDb2x1bW5zLnB1c2goZmllbGQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZENvbHVtbnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZENvbHVtbnMgPSBpc0luY2x1ZGVNb2RlXG4gICAgICAgICAgICAgICAgICAgICAgICA/IHNlbGVjdGVkQ29sdW1ucy5maWx0ZXIoKGMpID0+IGNvbmZpZy5jb2x1bW5zPy5bY10gPT09IHRydWUpXG4gICAgICAgICAgICAgICAgICAgICAgICA6IE9iamVjdC5rZXlzKHRhYmxlQ29uZmlnLmNvbHVtbnMpLmZpbHRlcigoa2V5KSA9PiAhc2VsZWN0ZWRDb2x1bW5zLmluY2x1ZGVzKGtleSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIFNlbGVjdCBhbGwgY29sdW1ucyBpZiBzZWxlY3Rpb24gaXMgbm90IHNwZWNpZmllZFxuICAgICAgICAgICAgICAgIHNlbGVjdGVkQ29sdW1ucyA9IE9iamVjdC5rZXlzKHRhYmxlQ29uZmlnLmNvbHVtbnMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yIChjb25zdCBmaWVsZCBvZiBzZWxlY3RlZENvbHVtbnMpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjb2x1bW4gPSB0YWJsZUNvbmZpZy5jb2x1bW5zW2ZpZWxkXTtcbiAgICAgICAgICAgICAgICBmaWVsZHNTZWxlY3Rpb24ucHVzaCh7IHRzS2V5OiBmaWVsZCwgdmFsdWU6IGNvbHVtbiB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCBzZWxlY3RlZFJlbGF0aW9ucyA9IFtdO1xuICAgICAgICAgICAgLy8gRmlndXJlIG91dCB3aGljaCByZWxhdGlvbnMgdG8gc2VsZWN0XG4gICAgICAgICAgICBpZiAoY29uZmlnLndpdGgpIHtcbiAgICAgICAgICAgICAgICBzZWxlY3RlZFJlbGF0aW9ucyA9IE9iamVjdC5lbnRyaWVzKGNvbmZpZy53aXRoKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKChlbnRyeSkgPT4gISFlbnRyeVsxXSlcbiAgICAgICAgICAgICAgICAgICAgLm1hcCgoW3RzS2V5LCBxdWVyeUNvbmZpZ10pID0+ICh7IHRzS2V5LCBxdWVyeUNvbmZpZywgcmVsYXRpb246IHRhYmxlQ29uZmlnLnJlbGF0aW9uc1t0c0tleV0gfSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IGV4dHJhcztcbiAgICAgICAgICAgIC8vIEZpZ3VyZSBvdXQgd2hpY2ggZXh0cmFzIHRvIHNlbGVjdFxuICAgICAgICAgICAgaWYgKGNvbmZpZy5leHRyYXMpIHtcbiAgICAgICAgICAgICAgICBleHRyYXMgPSB0eXBlb2YgY29uZmlnLmV4dHJhcyA9PT0gJ2Z1bmN0aW9uJ1xuICAgICAgICAgICAgICAgICAgICA/IGNvbmZpZy5leHRyYXMoYWxpYXNlZENvbHVtbnMsIHsgc3FsIH0pXG4gICAgICAgICAgICAgICAgICAgIDogY29uZmlnLmV4dHJhcztcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IFt0c0tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGV4dHJhcykpIHtcbiAgICAgICAgICAgICAgICAgICAgZmllbGRzU2VsZWN0aW9uLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgdHNLZXksXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogbWFwQ29sdW1uc0luQWxpYXNlZFNRTFRvQWxpYXModmFsdWUsIHRhYmxlQWxpYXMpLFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBUcmFuc2Zvcm0gYGZpZWxkc1NlbGVjdGlvbmAgaW50byBgc2VsZWN0aW9uYFxuICAgICAgICAgICAgLy8gYGZpZWxkc1NlbGVjdGlvbmAgc2hvdWxkbid0IGJlIHVzZWQgYWZ0ZXIgdGhpcyBwb2ludFxuICAgICAgICAgICAgZm9yIChjb25zdCB7IHRzS2V5LCB2YWx1ZSB9IG9mIGZpZWxkc1NlbGVjdGlvbikge1xuICAgICAgICAgICAgICAgIHNlbGVjdGlvbi5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgZGJLZXk6IGlzKHZhbHVlLCBTUUwuQWxpYXNlZCkgPyB2YWx1ZS5maWVsZEFsaWFzIDogdGFibGVDb25maWcuY29sdW1uc1t0c0tleV0ubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgdHNLZXksXG4gICAgICAgICAgICAgICAgICAgIGZpZWxkOiBpcyh2YWx1ZSwgQ29sdW1uKSA/IGFsaWFzZWRUYWJsZUNvbHVtbih2YWx1ZSwgdGFibGVBbGlhcykgOiB2YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgcmVsYXRpb25UYWJsZVRzS2V5OiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIGlzSnNvbjogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGlvbjogW10sXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgb3JkZXJCeU9yaWcgPSB0eXBlb2YgY29uZmlnLm9yZGVyQnkgPT09ICdmdW5jdGlvbidcbiAgICAgICAgICAgICAgICA/IGNvbmZpZy5vcmRlckJ5KGFsaWFzZWRDb2x1bW5zLCBnZXRPcmRlckJ5T3BlcmF0b3JzKCkpXG4gICAgICAgICAgICAgICAgOiBjb25maWcub3JkZXJCeSA/PyBbXTtcbiAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShvcmRlckJ5T3JpZykpIHtcbiAgICAgICAgICAgICAgICBvcmRlckJ5T3JpZyA9IFtvcmRlckJ5T3JpZ107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBvcmRlckJ5ID0gb3JkZXJCeU9yaWcubWFwKChvcmRlckJ5VmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoaXMob3JkZXJCeVZhbHVlLCBDb2x1bW4pKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhbGlhc2VkVGFibGVDb2x1bW4ob3JkZXJCeVZhbHVlLCB0YWJsZUFsaWFzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1hcENvbHVtbnNJblNRTFRvQWxpYXMob3JkZXJCeVZhbHVlLCB0YWJsZUFsaWFzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgbGltaXQgPSBjb25maWcubGltaXQ7XG4gICAgICAgICAgICBvZmZzZXQgPSBjb25maWcub2Zmc2V0O1xuICAgICAgICAgICAgLy8gUHJvY2VzcyBhbGwgcmVsYXRpb25zXG4gICAgICAgICAgICBmb3IgKGNvbnN0IHsgdHNLZXk6IHNlbGVjdGVkUmVsYXRpb25Uc0tleSwgcXVlcnlDb25maWc6IHNlbGVjdGVkUmVsYXRpb25Db25maWdWYWx1ZSwgcmVsYXRpb24sIH0gb2Ygc2VsZWN0ZWRSZWxhdGlvbnMpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBub3JtYWxpemVkUmVsYXRpb24gPSBub3JtYWxpemVSZWxhdGlvbihzY2hlbWEsIHRhYmxlTmFtZXNNYXAsIHJlbGF0aW9uKTtcbiAgICAgICAgICAgICAgICBjb25zdCByZWxhdGlvblRhYmxlTmFtZSA9IHJlbGF0aW9uLnJlZmVyZW5jZWRUYWJsZVtUYWJsZS5TeW1ib2wuTmFtZV07XG4gICAgICAgICAgICAgICAgY29uc3QgcmVsYXRpb25UYWJsZVRzTmFtZSA9IHRhYmxlTmFtZXNNYXBbcmVsYXRpb25UYWJsZU5hbWVdO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlbGF0aW9uVGFibGVBbGlhcyA9IGAke3RhYmxlQWxpYXN9XyR7c2VsZWN0ZWRSZWxhdGlvblRzS2V5fWA7XG4gICAgICAgICAgICAgICAgY29uc3Qgam9pbk9uID0gYW5kKC4uLm5vcm1hbGl6ZWRSZWxhdGlvbi5maWVsZHMubWFwKChmaWVsZCwgaSkgPT4gZXEoYWxpYXNlZFRhYmxlQ29sdW1uKG5vcm1hbGl6ZWRSZWxhdGlvbi5yZWZlcmVuY2VzW2ldLCByZWxhdGlvblRhYmxlQWxpYXMpLCBhbGlhc2VkVGFibGVDb2x1bW4oZmllbGQsIHRhYmxlQWxpYXMpKSkpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGJ1aWx0UmVsYXRpb24gPSB0aGlzLmJ1aWxkUmVsYXRpb25hbFF1ZXJ5V2l0aG91dFBLKHtcbiAgICAgICAgICAgICAgICAgICAgZnVsbFNjaGVtYSxcbiAgICAgICAgICAgICAgICAgICAgc2NoZW1hLFxuICAgICAgICAgICAgICAgICAgICB0YWJsZU5hbWVzTWFwLFxuICAgICAgICAgICAgICAgICAgICB0YWJsZTogZnVsbFNjaGVtYVtyZWxhdGlvblRhYmxlVHNOYW1lXSxcbiAgICAgICAgICAgICAgICAgICAgdGFibGVDb25maWc6IHNjaGVtYVtyZWxhdGlvblRhYmxlVHNOYW1lXSxcbiAgICAgICAgICAgICAgICAgICAgcXVlcnlDb25maWc6IGlzKHJlbGF0aW9uLCBPbmUpXG4gICAgICAgICAgICAgICAgICAgICAgICA/IChzZWxlY3RlZFJlbGF0aW9uQ29uZmlnVmFsdWUgPT09IHRydWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IHsgbGltaXQ6IDEgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogeyAuLi5zZWxlY3RlZFJlbGF0aW9uQ29uZmlnVmFsdWUsIGxpbWl0OiAxIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICA6IHNlbGVjdGVkUmVsYXRpb25Db25maWdWYWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgdGFibGVBbGlhczogcmVsYXRpb25UYWJsZUFsaWFzLFxuICAgICAgICAgICAgICAgICAgICBqb2luT24sXG4gICAgICAgICAgICAgICAgICAgIG5lc3RlZFF1ZXJ5UmVsYXRpb246IHJlbGF0aW9uLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGNvbnN0IGZpZWxkID0gc3FsIGAke3NxbC5pZGVudGlmaWVyKHJlbGF0aW9uVGFibGVBbGlhcyl9LiR7c3FsLmlkZW50aWZpZXIoJ2RhdGEnKX1gLmFzKHNlbGVjdGVkUmVsYXRpb25Uc0tleSk7XG4gICAgICAgICAgICAgICAgam9pbnMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIG9uOiBzcWwgYHRydWVgLFxuICAgICAgICAgICAgICAgICAgICB0YWJsZTogbmV3IFN1YnF1ZXJ5KGJ1aWx0UmVsYXRpb24uc3FsLCB7fSwgcmVsYXRpb25UYWJsZUFsaWFzKSxcbiAgICAgICAgICAgICAgICAgICAgYWxpYXM6IHJlbGF0aW9uVGFibGVBbGlhcyxcbiAgICAgICAgICAgICAgICAgICAgam9pblR5cGU6ICdsZWZ0JyxcbiAgICAgICAgICAgICAgICAgICAgbGF0ZXJhbDogdHJ1ZSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBzZWxlY3Rpb24ucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIGRiS2V5OiBzZWxlY3RlZFJlbGF0aW9uVHNLZXksXG4gICAgICAgICAgICAgICAgICAgIHRzS2V5OiBzZWxlY3RlZFJlbGF0aW9uVHNLZXksXG4gICAgICAgICAgICAgICAgICAgIGZpZWxkLFxuICAgICAgICAgICAgICAgICAgICByZWxhdGlvblRhYmxlVHNLZXk6IHJlbGF0aW9uVGFibGVUc05hbWUsXG4gICAgICAgICAgICAgICAgICAgIGlzSnNvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0aW9uOiBidWlsdFJlbGF0aW9uLnNlbGVjdGlvbixcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoc2VsZWN0aW9uLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IERyaXp6bGVFcnJvcihgTm8gZmllbGRzIHNlbGVjdGVkIGZvciB0YWJsZSBcIiR7dGFibGVDb25maWcudHNOYW1lfVwiIChcIiR7dGFibGVBbGlhc31cIilgKTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgcmVzdWx0O1xuICAgICAgICB3aGVyZSA9IGFuZChqb2luT24sIHdoZXJlKTtcbiAgICAgICAgaWYgKG5lc3RlZFF1ZXJ5UmVsYXRpb24pIHtcbiAgICAgICAgICAgIGxldCBmaWVsZCA9IHNxbCBganNvbl9idWlsZF9hcnJheSgke3NxbC5qb2luKHNlbGVjdGlvbi5tYXAoKHsgZmllbGQsIHRzS2V5LCBpc0pzb24gfSkgPT4gaXNKc29uXG4gICAgICAgICAgICAgICAgPyBzcWwgYCR7c3FsLmlkZW50aWZpZXIoYCR7dGFibGVBbGlhc31fJHt0c0tleX1gKX0uJHtzcWwuaWRlbnRpZmllcignZGF0YScpfWBcbiAgICAgICAgICAgICAgICA6IGlzKGZpZWxkLCBTUUwuQWxpYXNlZClcbiAgICAgICAgICAgICAgICAgICAgPyBmaWVsZC5zcWxcbiAgICAgICAgICAgICAgICAgICAgOiBmaWVsZCksIHNxbCBgLCBgKX0pYDtcbiAgICAgICAgICAgIGlmIChpcyhuZXN0ZWRRdWVyeVJlbGF0aW9uLCBNYW55KSkge1xuICAgICAgICAgICAgICAgIGZpZWxkID0gc3FsIGBjb2FsZXNjZShqc29uX2FnZygke2ZpZWxkfSR7b3JkZXJCeS5sZW5ndGggPiAwID8gc3FsIGAgb3JkZXIgYnkgJHtzcWwuam9pbihvcmRlckJ5LCBzcWwgYCwgYCl9YCA6IHVuZGVmaW5lZH0pLCAnW10nOjpqc29uKWA7XG4gICAgICAgICAgICAgICAgLy8gb3JkZXJCeSA9IFtdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgbmVzdGVkU2VsZWN0aW9uID0gW3tcbiAgICAgICAgICAgICAgICAgICAgZGJLZXk6ICdkYXRhJyxcbiAgICAgICAgICAgICAgICAgICAgdHNLZXk6ICdkYXRhJyxcbiAgICAgICAgICAgICAgICAgICAgZmllbGQ6IGZpZWxkLmFzKCdkYXRhJyksXG4gICAgICAgICAgICAgICAgICAgIGlzSnNvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgcmVsYXRpb25UYWJsZVRzS2V5OiB0YWJsZUNvbmZpZy50c05hbWUsXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGlvbixcbiAgICAgICAgICAgICAgICB9XTtcbiAgICAgICAgICAgIGNvbnN0IG5lZWRzU3VicXVlcnkgPSBsaW1pdCAhPT0gdW5kZWZpbmVkIHx8IG9mZnNldCAhPT0gdW5kZWZpbmVkIHx8IG9yZGVyQnkubGVuZ3RoID4gMDtcbiAgICAgICAgICAgIGlmIChuZWVkc1N1YnF1ZXJ5KSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gdGhpcy5idWlsZFNlbGVjdFF1ZXJ5KHtcbiAgICAgICAgICAgICAgICAgICAgdGFibGU6IGFsaWFzZWRUYWJsZSh0YWJsZSwgdGFibGVBbGlhcyksXG4gICAgICAgICAgICAgICAgICAgIGZpZWxkczoge30sXG4gICAgICAgICAgICAgICAgICAgIGZpZWxkc0ZsYXQ6IFt7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogW10sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQ6IHNxbC5yYXcoJyonKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH1dLFxuICAgICAgICAgICAgICAgICAgICB3aGVyZSxcbiAgICAgICAgICAgICAgICAgICAgbGltaXQsXG4gICAgICAgICAgICAgICAgICAgIG9mZnNldCxcbiAgICAgICAgICAgICAgICAgICAgb3JkZXJCeSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB3aGVyZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICBsaW1pdCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICBvZmZzZXQgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgb3JkZXJCeSA9IFtdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gYWxpYXNlZFRhYmxlKHRhYmxlLCB0YWJsZUFsaWFzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlc3VsdCA9IHRoaXMuYnVpbGRTZWxlY3RRdWVyeSh7XG4gICAgICAgICAgICAgICAgdGFibGU6IGlzKHJlc3VsdCwgUGdUYWJsZSkgPyByZXN1bHQgOiBuZXcgU3VicXVlcnkocmVzdWx0LCB7fSwgdGFibGVBbGlhcyksXG4gICAgICAgICAgICAgICAgZmllbGRzOiB7fSxcbiAgICAgICAgICAgICAgICBmaWVsZHNGbGF0OiBuZXN0ZWRTZWxlY3Rpb24ubWFwKCh7IGZpZWxkIH0pID0+ICh7XG4gICAgICAgICAgICAgICAgICAgIHBhdGg6IFtdLFxuICAgICAgICAgICAgICAgICAgICBmaWVsZDogaXMoZmllbGQsIENvbHVtbikgPyBhbGlhc2VkVGFibGVDb2x1bW4oZmllbGQsIHRhYmxlQWxpYXMpIDogZmllbGQsXG4gICAgICAgICAgICAgICAgfSkpLFxuICAgICAgICAgICAgICAgIGpvaW5zLFxuICAgICAgICAgICAgICAgIHdoZXJlLFxuICAgICAgICAgICAgICAgIGxpbWl0LFxuICAgICAgICAgICAgICAgIG9mZnNldCxcbiAgICAgICAgICAgICAgICBvcmRlckJ5LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXN1bHQgPSB0aGlzLmJ1aWxkU2VsZWN0UXVlcnkoe1xuICAgICAgICAgICAgICAgIHRhYmxlOiBhbGlhc2VkVGFibGUodGFibGUsIHRhYmxlQWxpYXMpLFxuICAgICAgICAgICAgICAgIGZpZWxkczoge30sXG4gICAgICAgICAgICAgICAgZmllbGRzRmxhdDogc2VsZWN0aW9uLm1hcCgoeyBmaWVsZCB9KSA9PiAoe1xuICAgICAgICAgICAgICAgICAgICBwYXRoOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgZmllbGQ6IGlzKGZpZWxkLCBDb2x1bW4pID8gYWxpYXNlZFRhYmxlQ29sdW1uKGZpZWxkLCB0YWJsZUFsaWFzKSA6IGZpZWxkLFxuICAgICAgICAgICAgICAgIH0pKSxcbiAgICAgICAgICAgICAgICBqb2lucyxcbiAgICAgICAgICAgICAgICB3aGVyZSxcbiAgICAgICAgICAgICAgICBsaW1pdCxcbiAgICAgICAgICAgICAgICBvZmZzZXQsXG4gICAgICAgICAgICAgICAgb3JkZXJCeSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0YWJsZVRzS2V5OiB0YWJsZUNvbmZpZy50c05hbWUsXG4gICAgICAgICAgICBzcWw6IHJlc3VsdCxcbiAgICAgICAgICAgIHNlbGVjdGlvbixcbiAgICAgICAgfTtcbiAgICB9XG59XG5cbmNsYXNzIFR5cGVkUXVlcnlCdWlsZGVyIHtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ1R5cGVkUXVlcnlCdWlsZGVyJztcbiAgICAvKiogQGludGVybmFsICovXG4gICAgZ2V0U2VsZWN0ZWRGaWVsZHMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl8uc2VsZWN0ZWRGaWVsZHM7XG4gICAgfVxufVxuXG5jbGFzcyBQZ1NlbGVjdEJ1aWxkZXIge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnUGdTZWxlY3RCdWlsZGVyJztcbiAgICBmaWVsZHM7XG4gICAgc2Vzc2lvbjtcbiAgICBkaWFsZWN0O1xuICAgIHdpdGhMaXN0ID0gW107XG4gICAgZGlzdGluY3Q7XG4gICAgY29uc3RydWN0b3IoY29uZmlnKSB7XG4gICAgICAgIHRoaXMuZmllbGRzID0gY29uZmlnLmZpZWxkcztcbiAgICAgICAgdGhpcy5zZXNzaW9uID0gY29uZmlnLnNlc3Npb247XG4gICAgICAgIHRoaXMuZGlhbGVjdCA9IGNvbmZpZy5kaWFsZWN0O1xuICAgICAgICBpZiAoY29uZmlnLndpdGhMaXN0KSB7XG4gICAgICAgICAgICB0aGlzLndpdGhMaXN0ID0gY29uZmlnLndpdGhMaXN0O1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZGlzdGluY3QgPSBjb25maWcuZGlzdGluY3Q7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNwZWNpZnkgdGhlIHRhYmxlLCBzdWJxdWVyeSwgb3Igb3RoZXIgdGFyZ2V0IHRoYXQgeW91J3JlXG4gICAgICogYnVpbGRpbmcgYSBzZWxlY3QgcXVlcnkgYWdhaW5zdC5cbiAgICAgKlxuICAgICAqIHtAbGluayBodHRwczovL3d3dy5wb3N0Z3Jlc3FsLm9yZy9kb2NzL2N1cnJlbnQvc3FsLXNlbGVjdC5odG1sI1NRTC1GUk9NfFBvc3RncmVzIGZyb20gZG9jdW1lbnRhdGlvbn1cbiAgICAgKi9cbiAgICBmcm9tKHNvdXJjZSkge1xuICAgICAgICBjb25zdCBpc1BhcnRpYWxTZWxlY3QgPSAhIXRoaXMuZmllbGRzO1xuICAgICAgICBsZXQgZmllbGRzO1xuICAgICAgICBpZiAodGhpcy5maWVsZHMpIHtcbiAgICAgICAgICAgIGZpZWxkcyA9IHRoaXMuZmllbGRzO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGlzKHNvdXJjZSwgU3VicXVlcnkpKSB7XG4gICAgICAgICAgICAvLyBUaGlzIGlzIHJlcXVpcmVkIHRvIHVzZSB0aGUgcHJveHkgaGFuZGxlciB0byBnZXQgdGhlIGNvcnJlY3QgZmllbGQgdmFsdWVzIGZyb20gdGhlIHN1YnF1ZXJ5XG4gICAgICAgICAgICBmaWVsZHMgPSBPYmplY3QuZnJvbUVudHJpZXMoT2JqZWN0LmtleXMoc291cmNlW1N1YnF1ZXJ5Q29uZmlnXS5zZWxlY3Rpb24pLm1hcCgoa2V5KSA9PiBba2V5LCBzb3VyY2Vba2V5XV0pKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChpcyhzb3VyY2UsIFBnVmlld0Jhc2UpKSB7XG4gICAgICAgICAgICBmaWVsZHMgPSBzb3VyY2VbVmlld0Jhc2VDb25maWddLnNlbGVjdGVkRmllbGRzO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGlzKHNvdXJjZSwgU1FMKSkge1xuICAgICAgICAgICAgZmllbGRzID0ge307XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBmaWVsZHMgPSBnZXRUYWJsZUNvbHVtbnMoc291cmNlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IFBnU2VsZWN0KHtcbiAgICAgICAgICAgIHRhYmxlOiBzb3VyY2UsXG4gICAgICAgICAgICBmaWVsZHMsXG4gICAgICAgICAgICBpc1BhcnRpYWxTZWxlY3QsXG4gICAgICAgICAgICBzZXNzaW9uOiB0aGlzLnNlc3Npb24sXG4gICAgICAgICAgICBkaWFsZWN0OiB0aGlzLmRpYWxlY3QsXG4gICAgICAgICAgICB3aXRoTGlzdDogdGhpcy53aXRoTGlzdCxcbiAgICAgICAgICAgIGRpc3RpbmN0OiB0aGlzLmRpc3RpbmN0LFxuICAgICAgICB9KTtcbiAgICB9XG59XG5jbGFzcyBQZ1NlbGVjdFF1ZXJ5QnVpbGRlciBleHRlbmRzIFR5cGVkUXVlcnlCdWlsZGVyIHtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ1BnU2VsZWN0UXVlcnlCdWlsZGVyJztcbiAgICBfO1xuICAgIGNvbmZpZztcbiAgICBqb2luc05vdE51bGxhYmxlTWFwO1xuICAgIHRhYmxlTmFtZTtcbiAgICBpc1BhcnRpYWxTZWxlY3Q7XG4gICAgc2Vzc2lvbjtcbiAgICBkaWFsZWN0O1xuICAgIGNvbnN0cnVjdG9yKHsgdGFibGUsIGZpZWxkcywgaXNQYXJ0aWFsU2VsZWN0LCBzZXNzaW9uLCBkaWFsZWN0LCB3aXRoTGlzdCwgZGlzdGluY3QgfSkge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLmNvbmZpZyA9IHtcbiAgICAgICAgICAgIHdpdGhMaXN0LFxuICAgICAgICAgICAgdGFibGUsXG4gICAgICAgICAgICBmaWVsZHM6IHsgLi4uZmllbGRzIH0sXG4gICAgICAgICAgICBkaXN0aW5jdCxcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5pc1BhcnRpYWxTZWxlY3QgPSBpc1BhcnRpYWxTZWxlY3Q7XG4gICAgICAgIHRoaXMuc2Vzc2lvbiA9IHNlc3Npb247XG4gICAgICAgIHRoaXMuZGlhbGVjdCA9IGRpYWxlY3Q7XG4gICAgICAgIHRoaXMuXyA9IHtcbiAgICAgICAgICAgIHNlbGVjdGVkRmllbGRzOiBmaWVsZHMsXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMudGFibGVOYW1lID0gZ2V0VGFibGVMaWtlTmFtZSh0YWJsZSk7XG4gICAgICAgIHRoaXMuam9pbnNOb3ROdWxsYWJsZU1hcCA9IHR5cGVvZiB0aGlzLnRhYmxlTmFtZSA9PT0gJ3N0cmluZycgPyB7IFt0aGlzLnRhYmxlTmFtZV06IHRydWUgfSA6IHt9O1xuICAgIH1cbiAgICBjcmVhdGVKb2luKGpvaW5UeXBlKSB7XG4gICAgICAgIHJldHVybiAodGFibGUsIG9uKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBiYXNlVGFibGVOYW1lID0gdGhpcy50YWJsZU5hbWU7XG4gICAgICAgICAgICBjb25zdCB0YWJsZU5hbWUgPSBnZXRUYWJsZUxpa2VOYW1lKHRhYmxlKTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdGFibGVOYW1lID09PSAnc3RyaW5nJyAmJiB0aGlzLmNvbmZpZy5qb2lucz8uc29tZSgoam9pbikgPT4gam9pbi5hbGlhcyA9PT0gdGFibGVOYW1lKSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgQWxpYXMgXCIke3RhYmxlTmFtZX1cIiBpcyBhbHJlYWR5IHVzZWQgaW4gdGhpcyBxdWVyeWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCF0aGlzLmlzUGFydGlhbFNlbGVjdCkge1xuICAgICAgICAgICAgICAgIC8vIElmIHRoaXMgaXMgdGhlIGZpcnN0IGpvaW4gYW5kIHRoaXMgaXMgbm90IGEgcGFydGlhbCBzZWxlY3QgYW5kIHdlJ3JlIG5vdCBzZWxlY3RpbmcgZnJvbSByYXcgU1FMLCBcIm1vdmVcIiB0aGUgZmllbGRzIGZyb20gdGhlIG1haW4gdGFibGUgdG8gdGhlIG5lc3RlZCBvYmplY3RcbiAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmtleXModGhpcy5qb2luc05vdE51bGxhYmxlTWFwKS5sZW5ndGggPT09IDEgJiYgdHlwZW9mIGJhc2VUYWJsZU5hbWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnLmZpZWxkcyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFtiYXNlVGFibGVOYW1lXTogdGhpcy5jb25maWcuZmllbGRzLFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHRhYmxlTmFtZSA9PT0gJ3N0cmluZycgJiYgIWlzKHRhYmxlLCBTUUwpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGlvbiA9IGlzKHRhYmxlLCBTdWJxdWVyeSlcbiAgICAgICAgICAgICAgICAgICAgICAgID8gdGFibGVbU3VicXVlcnlDb25maWddLnNlbGVjdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgOiBpcyh0YWJsZSwgVmlldylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IHRhYmxlW1ZpZXdCYXNlQ29uZmlnXS5zZWxlY3RlZEZpZWxkc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogdGFibGVbVGFibGUuU3ltYm9sLkNvbHVtbnNdO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5maWVsZHNbdGFibGVOYW1lXSA9IHNlbGVjdGlvbjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodHlwZW9mIG9uID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgb24gPSBvbihuZXcgUHJveHkodGhpcy5jb25maWcuZmllbGRzLCBuZXcgU2VsZWN0aW9uUHJveHlIYW5kbGVyKHsgc3FsQWxpYXNlZEJlaGF2aW9yOiAnc3FsJywgc3FsQmVoYXZpb3I6ICdzcWwnIH0pKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXRoaXMuY29uZmlnLmpvaW5zKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jb25maWcuam9pbnMgPSBbXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuY29uZmlnLmpvaW5zLnB1c2goeyBvbiwgdGFibGUsIGpvaW5UeXBlLCBhbGlhczogdGFibGVOYW1lIH0pO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB0YWJsZU5hbWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChqb2luVHlwZSkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdsZWZ0Jzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5qb2luc05vdE51bGxhYmxlTWFwW3RhYmxlTmFtZV0gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3JpZ2h0Jzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5qb2luc05vdE51bGxhYmxlTWFwID0gT2JqZWN0LmZyb21FbnRyaWVzKE9iamVjdC5lbnRyaWVzKHRoaXMuam9pbnNOb3ROdWxsYWJsZU1hcCkubWFwKChba2V5XSkgPT4gW2tleSwgZmFsc2VdKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmpvaW5zTm90TnVsbGFibGVNYXBbdGFibGVOYW1lXSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjYXNlICdpbm5lcic6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuam9pbnNOb3ROdWxsYWJsZU1hcFt0YWJsZU5hbWVdID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2Z1bGwnOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmpvaW5zTm90TnVsbGFibGVNYXAgPSBPYmplY3QuZnJvbUVudHJpZXMoT2JqZWN0LmVudHJpZXModGhpcy5qb2luc05vdE51bGxhYmxlTWFwKS5tYXAoKFtrZXldKSA9PiBba2V5LCBmYWxzZV0pKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuam9pbnNOb3ROdWxsYWJsZU1hcFt0YWJsZU5hbWVdID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBGb3IgZWFjaCByb3cgb2YgdGhlIHRhYmxlLCBpbmNsdWRlXG4gICAgICogdmFsdWVzIGZyb20gYSBtYXRjaGluZyByb3cgb2YgdGhlIGpvaW5lZFxuICAgICAqIHRhYmxlLCBpZiB0aGVyZSBpcyBhIG1hdGNoaW5nIHJvdy4gSWYgbm90LFxuICAgICAqIGFsbCBvZiB0aGUgY29sdW1ucyBvZiB0aGUgam9pbmVkIHRhYmxlXG4gICAgICogd2lsbCBiZSBzZXQgdG8gbnVsbC5cbiAgICAgKi9cbiAgICBsZWZ0Sm9pbiA9IHRoaXMuY3JlYXRlSm9pbignbGVmdCcpO1xuICAgIC8qKlxuICAgICAqIEluY2x1ZGVzIGFsbCBvZiB0aGUgcm93cyBvZiB0aGUgam9pbmVkIHRhYmxlLlxuICAgICAqIElmIHRoZXJlIGlzIG5vIG1hdGNoaW5nIHJvdyBpbiB0aGUgbWFpbiB0YWJsZSxcbiAgICAgKiBhbGwgdGhlIGNvbHVtbnMgb2YgdGhlIG1haW4gdGFibGUgd2lsbCBiZVxuICAgICAqIHNldCB0byBudWxsLlxuICAgICAqL1xuICAgIHJpZ2h0Sm9pbiA9IHRoaXMuY3JlYXRlSm9pbigncmlnaHQnKTtcbiAgICAvKipcbiAgICAgKiBUaGlzIGlzIHRoZSBkZWZhdWx0IHR5cGUgb2Ygam9pbi5cbiAgICAgKlxuICAgICAqIEZvciBlYWNoIHJvdyBvZiB0aGUgdGFibGUsIHRoZSBqb2luZWQgdGFibGVcbiAgICAgKiBuZWVkcyB0byBoYXZlIGEgbWF0Y2hpbmcgcm93LCBvciBpdCB3aWxsXG4gICAgICogYmUgZXhjbHVkZWQgZnJvbSByZXN1bHRzLlxuICAgICAqL1xuICAgIGlubmVySm9pbiA9IHRoaXMuY3JlYXRlSm9pbignaW5uZXInKTtcbiAgICAvKipcbiAgICAgKiBSb3dzIGZyb20gYm90aCB0aGUgbWFpbiAmIGpvaW5lZCBhcmUgaW5jbHVkZWQsXG4gICAgICogcmVnYXJkbGVzcyBvZiB3aGV0aGVyIG9yIG5vdCB0aGV5IGhhdmUgbWF0Y2hpbmdcbiAgICAgKiByb3dzIGluIHRoZSBvdGhlciB0YWJsZS5cbiAgICAgKi9cbiAgICBmdWxsSm9pbiA9IHRoaXMuY3JlYXRlSm9pbignZnVsbCcpO1xuICAgIC8qKlxuICAgICAqIFNwZWNpZnkgYSBjb25kaXRpb24gdG8gbmFycm93IHRoZSByZXN1bHQgc2V0LiBNdWx0aXBsZVxuICAgICAqIGNvbmRpdGlvbnMgY2FuIGJlIGNvbWJpbmVkIHdpdGggdGhlIGBhbmRgIGFuZCBgb3JgXG4gICAgICogZnVuY3Rpb25zLlxuICAgICAqXG4gICAgICogIyMgRXhhbXBsZXNcbiAgICAgKlxuICAgICAqIGBgYHRzXG4gICAgICogLy8gRmluZCBjYXJzIG1hZGUgaW4gdGhlIHllYXIgMjAwMFxuICAgICAqIGRiLnNlbGVjdCgpLmZyb20oY2Fycykud2hlcmUoZXEoY2Fycy55ZWFyLCAyMDAwKSk7XG4gICAgICogYGBgXG4gICAgICovXG4gICAgd2hlcmUod2hlcmUpIHtcbiAgICAgICAgaWYgKHR5cGVvZiB3aGVyZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgd2hlcmUgPSB3aGVyZShuZXcgUHJveHkodGhpcy5jb25maWcuZmllbGRzLCBuZXcgU2VsZWN0aW9uUHJveHlIYW5kbGVyKHsgc3FsQWxpYXNlZEJlaGF2aW9yOiAnc3FsJywgc3FsQmVoYXZpb3I6ICdzcWwnIH0pKSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jb25maWcud2hlcmUgPSB3aGVyZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIEhBVklORyBjbGF1c2Ugb2YgdGhpcyBxdWVyeSwgd2hpY2ggb2Z0ZW5cbiAgICAgKiB1c2VkIHdpdGggR1JPVVAgQlkgYW5kIGZpbHRlcnMgcm93cyBhZnRlciB0aGV5J3ZlIGJlZW5cbiAgICAgKiBncm91cGVkIHRvZ2V0aGVyIGFuZCBjb21iaW5lZC5cbiAgICAgKlxuICAgICAqIHtAbGluayBodHRwczovL3d3dy5wb3N0Z3Jlc3FsLm9yZy9kb2NzL2N1cnJlbnQvc3FsLXNlbGVjdC5odG1sI1NRTC1IQVZJTkd8UG9zdGdyZXMgaGF2aW5nIGNsYXVzZSBkb2N1bWVudGF0aW9ufVxuICAgICAqL1xuICAgIGhhdmluZyhoYXZpbmcpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBoYXZpbmcgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIGhhdmluZyA9IGhhdmluZyhuZXcgUHJveHkodGhpcy5jb25maWcuZmllbGRzLCBuZXcgU2VsZWN0aW9uUHJveHlIYW5kbGVyKHsgc3FsQWxpYXNlZEJlaGF2aW9yOiAnc3FsJywgc3FsQmVoYXZpb3I6ICdzcWwnIH0pKSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jb25maWcuaGF2aW5nID0gaGF2aW5nO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgZ3JvdXBCeSguLi5jb2x1bW5zKSB7XG4gICAgICAgIGlmICh0eXBlb2YgY29sdW1uc1swXSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgY29uc3QgZ3JvdXBCeSA9IGNvbHVtbnNbMF0obmV3IFByb3h5KHRoaXMuY29uZmlnLmZpZWxkcywgbmV3IFNlbGVjdGlvblByb3h5SGFuZGxlcih7IHNxbEFsaWFzZWRCZWhhdmlvcjogJ2FsaWFzJywgc3FsQmVoYXZpb3I6ICdzcWwnIH0pKSk7XG4gICAgICAgICAgICB0aGlzLmNvbmZpZy5ncm91cEJ5ID0gQXJyYXkuaXNBcnJheShncm91cEJ5KSA/IGdyb3VwQnkgOiBbZ3JvdXBCeV07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmNvbmZpZy5ncm91cEJ5ID0gY29sdW1ucztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgb3JkZXJCeSguLi5jb2x1bW5zKSB7XG4gICAgICAgIGlmICh0eXBlb2YgY29sdW1uc1swXSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgY29uc3Qgb3JkZXJCeSA9IGNvbHVtbnNbMF0obmV3IFByb3h5KHRoaXMuY29uZmlnLmZpZWxkcywgbmV3IFNlbGVjdGlvblByb3h5SGFuZGxlcih7IHNxbEFsaWFzZWRCZWhhdmlvcjogJ2FsaWFzJywgc3FsQmVoYXZpb3I6ICdzcWwnIH0pKSk7XG4gICAgICAgICAgICB0aGlzLmNvbmZpZy5vcmRlckJ5ID0gQXJyYXkuaXNBcnJheShvcmRlckJ5KSA/IG9yZGVyQnkgOiBbb3JkZXJCeV07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmNvbmZpZy5vcmRlckJ5ID0gY29sdW1ucztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogU2V0IHRoZSBtYXhpbXVtIG51bWJlciBvZiByb3dzIHRoYXQgd2lsbCBiZVxuICAgICAqIHJldHVybmVkIGJ5IHRoaXMgcXVlcnkuXG4gICAgICpcbiAgICAgKiAjIyBFeGFtcGxlc1xuICAgICAqXG4gICAgICogYGBgdHNcbiAgICAgKiAvLyBHZXQgdGhlIGZpcnN0IDEwIHBlb3BsZSBmcm9tIHRoaXMgcXVlcnkuXG4gICAgICogZGIuc2VsZWN0KCkuZnJvbShwZW9wbGUpLmxpbWl0KDEwKTtcbiAgICAgKiBgYGBcbiAgICAgKlxuICAgICAqIHtAbGluayBodHRwczovL3d3dy5wb3N0Z3Jlc3FsLm9yZy9kb2NzL2N1cnJlbnQvc3FsLXNlbGVjdC5odG1sI1NRTC1MSU1JVHxQb3N0Z3JlcyBMSU1JVCBkb2N1bWVudGF0aW9ufVxuICAgICAqL1xuICAgIGxpbWl0KGxpbWl0KSB7XG4gICAgICAgIHRoaXMuY29uZmlnLmxpbWl0ID0gbGltaXQ7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTa2lwIGEgbnVtYmVyIG9mIHJvd3Mgd2hlbiByZXR1cm5pbmcgcmVzdWx0c1xuICAgICAqIGZyb20gdGhpcyBxdWVyeS5cbiAgICAgKlxuICAgICAqICMjIEV4YW1wbGVzXG4gICAgICpcbiAgICAgKiBgYGB0c1xuICAgICAqIC8vIEdldCB0aGUgMTB0aC0yMHRoIHBlb3BsZSBmcm9tIHRoaXMgcXVlcnkuXG4gICAgICogZGIuc2VsZWN0KCkuZnJvbShwZW9wbGUpLm9mZnNldCgxMCkubGltaXQoMTApO1xuICAgICAqIGBgYFxuICAgICAqL1xuICAgIG9mZnNldChvZmZzZXQpIHtcbiAgICAgICAgdGhpcy5jb25maWcub2Zmc2V0ID0gb2Zmc2V0O1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGhlIEZPUiBjbGF1c2Ugc3BlY2lmaWVzIGEgbG9jayBzdHJlbmd0aCBmb3IgdGhpcyBxdWVyeVxuICAgICAqIHRoYXQgY29udHJvbHMgaG93IHN0cmljdGx5IGl0IGFjcXVpcmVzIGV4Y2x1c2l2ZSBhY2Nlc3MgdG9cbiAgICAgKiB0aGUgcm93cyBiZWluZyBxdWVyaWVkLlxuICAgICAqXG4gICAgICoge0BsaW5rIGh0dHBzOi8vd3d3LnBvc3RncmVzcWwub3JnL2RvY3MvY3VycmVudC9zcWwtc2VsZWN0Lmh0bWwjU1FMLUZPUi1VUERBVEUtU0hBUkV8UG9zdGdyZXMgbG9ja2luZyBjbGF1c2UgZG9jdW1lbnRhdGlvbn1cbiAgICAgKi9cbiAgICBmb3Ioc3RyZW5ndGgsIGNvbmZpZyA9IHt9KSB7XG4gICAgICAgIGlmICghdGhpcy5jb25maWcubG9ja2luZ0NsYXVzZXMpIHtcbiAgICAgICAgICAgIHRoaXMuY29uZmlnLmxvY2tpbmdDbGF1c2VzID0gW107XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jb25maWcubG9ja2luZ0NsYXVzZXMucHVzaCh7IHN0cmVuZ3RoLCBjb25maWcgfSk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgZ2V0U1FMKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kaWFsZWN0LmJ1aWxkU2VsZWN0UXVlcnkodGhpcy5jb25maWcpO1xuICAgIH1cbiAgICB0b1NRTCgpIHtcbiAgICAgICAgY29uc3QgeyB0eXBpbmdzOiBfdHlwaW5ncywgLi4ucmVzdCB9ID0gdGhpcy5kaWFsZWN0LnNxbFRvUXVlcnkodGhpcy5nZXRTUUwoKSk7XG4gICAgICAgIHJldHVybiByZXN0O1xuICAgIH1cbiAgICBhcyhhbGlhcykge1xuICAgICAgICByZXR1cm4gbmV3IFByb3h5KG5ldyBTdWJxdWVyeSh0aGlzLmdldFNRTCgpLCB0aGlzLmNvbmZpZy5maWVsZHMsIGFsaWFzKSwgbmV3IFNlbGVjdGlvblByb3h5SGFuZGxlcih7IGFsaWFzLCBzcWxBbGlhc2VkQmVoYXZpb3I6ICdhbGlhcycsIHNxbEJlaGF2aW9yOiAnZXJyb3InIH0pKTtcbiAgICB9XG59XG5jbGFzcyBQZ1NlbGVjdCBleHRlbmRzIFBnU2VsZWN0UXVlcnlCdWlsZGVyIHtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ1BnU2VsZWN0JztcbiAgICBfcHJlcGFyZShuYW1lKSB7XG4gICAgICAgIGNvbnN0IHsgc2Vzc2lvbiwgY29uZmlnLCBkaWFsZWN0LCBqb2luc05vdE51bGxhYmxlTWFwIH0gPSB0aGlzO1xuICAgICAgICBpZiAoIXNlc3Npb24pIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IGV4ZWN1dGUgYSBxdWVyeSBvbiBhIHF1ZXJ5IGJ1aWxkZXIuIFBsZWFzZSB1c2UgYSBkYXRhYmFzZSBpbnN0YW5jZSBpbnN0ZWFkLicpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cmFjZXIuc3RhcnRBY3RpdmVTcGFuKCdkcml6emxlLnByZXBhcmVRdWVyeScsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGZpZWxkc0xpc3QgPSBvcmRlclNlbGVjdGVkRmllbGRzKGNvbmZpZy5maWVsZHMpO1xuICAgICAgICAgICAgY29uc3QgcXVlcnkgPSBzZXNzaW9uLnByZXBhcmVRdWVyeShkaWFsZWN0LnNxbFRvUXVlcnkodGhpcy5nZXRTUUwoKSksIGZpZWxkc0xpc3QsIG5hbWUpO1xuICAgICAgICAgICAgcXVlcnkuam9pbnNOb3ROdWxsYWJsZU1hcCA9IGpvaW5zTm90TnVsbGFibGVNYXA7XG4gICAgICAgICAgICByZXR1cm4gcXVlcnk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBwcmVwYXJlZCBzdGF0ZW1lbnQgZm9yIHRoaXMgcXVlcnkuIFRoaXMgYWxsb3dzXG4gICAgICogdGhlIGRhdGFiYXNlIHRvIHJlbWVtYmVyIHRoaXMgcXVlcnkgZm9yIHRoZSBnaXZlbiBzZXNzaW9uXG4gICAgICogYW5kIGNhbGwgaXQgYnkgbmFtZSwgcmF0aGVyIHRoYW4gc3BlY2lmeWluZyB0aGUgZnVsbCBxdWVyeS5cbiAgICAgKlxuICAgICAqIHtAbGluayBodHRwczovL3d3dy5wb3N0Z3Jlc3FsLm9yZy9kb2NzL2N1cnJlbnQvc3FsLXByZXBhcmUuaHRtbHxQb3N0Z3JlcyBwcmVwYXJlIGRvY3VtZW50YXRpb259XG4gICAgICovXG4gICAgcHJlcGFyZShuYW1lKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9wcmVwYXJlKG5hbWUpO1xuICAgIH1cbiAgICBleGVjdXRlID0gKHBsYWNlaG9sZGVyVmFsdWVzKSA9PiB7XG4gICAgICAgIHJldHVybiB0cmFjZXIuc3RhcnRBY3RpdmVTcGFuKCdkcml6emxlLm9wZXJhdGlvbicsICgpID0+IHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wcmVwYXJlKCkuZXhlY3V0ZShwbGFjZWhvbGRlclZhbHVlcyk7XG4gICAgICAgIH0pO1xuICAgIH07XG59XG5hcHBseU1peGlucyhQZ1NlbGVjdCwgW1F1ZXJ5UHJvbWlzZV0pO1xuXG5jbGFzcyBRdWVyeUJ1aWxkZXIge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnUGdRdWVyeUJ1aWxkZXInO1xuICAgIGRpYWxlY3Q7XG4gICAgJHdpdGgoYWxpYXMpIHtcbiAgICAgICAgY29uc3QgcXVlcnlCdWlsZGVyID0gdGhpcztcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGFzKHFiKSB7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBxYiA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICBxYiA9IHFiKHF1ZXJ5QnVpbGRlcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUHJveHkobmV3IFdpdGhTdWJxdWVyeShxYi5nZXRTUUwoKSwgcWIuZ2V0U2VsZWN0ZWRGaWVsZHMoKSwgYWxpYXMsIHRydWUpLCBuZXcgU2VsZWN0aW9uUHJveHlIYW5kbGVyKHsgYWxpYXMsIHNxbEFsaWFzZWRCZWhhdmlvcjogJ2FsaWFzJywgc3FsQmVoYXZpb3I6ICdlcnJvcicgfSkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfTtcbiAgICB9XG4gICAgd2l0aCguLi5xdWVyaWVzKSB7XG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuICAgICAgICBmdW5jdGlvbiBzZWxlY3QoZmllbGRzKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFBnU2VsZWN0QnVpbGRlcih7XG4gICAgICAgICAgICAgICAgZmllbGRzOiBmaWVsZHMgPz8gdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHNlc3Npb246IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICBkaWFsZWN0OiBzZWxmLmdldERpYWxlY3QoKSxcbiAgICAgICAgICAgICAgICB3aXRoTGlzdDogcXVlcmllcyxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIHNlbGVjdERpc3RpbmN0KGZpZWxkcykge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBQZ1NlbGVjdEJ1aWxkZXIoe1xuICAgICAgICAgICAgICAgIGZpZWxkczogZmllbGRzID8/IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICBzZXNzaW9uOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgZGlhbGVjdDogc2VsZi5nZXREaWFsZWN0KCksXG4gICAgICAgICAgICAgICAgZGlzdGluY3Q6IHRydWUsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBzZWxlY3REaXN0aW5jdE9uKG9uLCBmaWVsZHMpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgUGdTZWxlY3RCdWlsZGVyKHtcbiAgICAgICAgICAgICAgICBmaWVsZHM6IGZpZWxkcyA/PyB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgc2Vzc2lvbjogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIGRpYWxlY3Q6IHNlbGYuZ2V0RGlhbGVjdCgpLFxuICAgICAgICAgICAgICAgIGRpc3RpbmN0OiB7IG9uIH0sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBzZWxlY3QsIHNlbGVjdERpc3RpbmN0LCBzZWxlY3REaXN0aW5jdE9uIH07XG4gICAgfVxuICAgIHNlbGVjdChmaWVsZHMpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQZ1NlbGVjdEJ1aWxkZXIoe1xuICAgICAgICAgICAgZmllbGRzOiBmaWVsZHMgPz8gdW5kZWZpbmVkLFxuICAgICAgICAgICAgc2Vzc2lvbjogdW5kZWZpbmVkLFxuICAgICAgICAgICAgZGlhbGVjdDogdGhpcy5nZXREaWFsZWN0KCksXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBzZWxlY3REaXN0aW5jdChmaWVsZHMpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQZ1NlbGVjdEJ1aWxkZXIoe1xuICAgICAgICAgICAgZmllbGRzOiBmaWVsZHMgPz8gdW5kZWZpbmVkLFxuICAgICAgICAgICAgc2Vzc2lvbjogdW5kZWZpbmVkLFxuICAgICAgICAgICAgZGlhbGVjdDogdGhpcy5nZXREaWFsZWN0KCksXG4gICAgICAgICAgICBkaXN0aW5jdDogdHJ1ZSxcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHNlbGVjdERpc3RpbmN0T24ob24sIGZpZWxkcykge1xuICAgICAgICByZXR1cm4gbmV3IFBnU2VsZWN0QnVpbGRlcih7XG4gICAgICAgICAgICBmaWVsZHM6IGZpZWxkcyA/PyB1bmRlZmluZWQsXG4gICAgICAgICAgICBzZXNzaW9uOiB1bmRlZmluZWQsXG4gICAgICAgICAgICBkaWFsZWN0OiB0aGlzLmdldERpYWxlY3QoKSxcbiAgICAgICAgICAgIGRpc3RpbmN0OiB7IG9uIH0sXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvLyBMYXp5IGxvYWQgZGlhbGVjdCB0byBhdm9pZCBjaXJjdWxhciBkZXBlbmRlbmN5XG4gICAgZ2V0RGlhbGVjdCgpIHtcbiAgICAgICAgaWYgKCF0aGlzLmRpYWxlY3QpIHtcbiAgICAgICAgICAgIHRoaXMuZGlhbGVjdCA9IG5ldyBQZ0RpYWxlY3QoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5kaWFsZWN0O1xuICAgIH1cbn1cblxuY2xhc3MgRGVmYXVsdFZpZXdCdWlsZGVyQ29yZSB7XG4gICAgbmFtZTtcbiAgICBzY2hlbWE7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdQZ0RlZmF1bHRWaWV3QnVpbGRlckNvcmUnO1xuICAgIGNvbnN0cnVjdG9yKG5hbWUsIHNjaGVtYSkge1xuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICB0aGlzLnNjaGVtYSA9IHNjaGVtYTtcbiAgICB9XG4gICAgY29uZmlnID0ge307XG4gICAgd2l0aChjb25maWcpIHtcbiAgICAgICAgdGhpcy5jb25maWcud2l0aCA9IGNvbmZpZztcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxufVxuY2xhc3MgVmlld0J1aWxkZXIgZXh0ZW5kcyBEZWZhdWx0Vmlld0J1aWxkZXJDb3JlIHtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ1BnVmlld0J1aWxkZXInO1xuICAgIGFzKHFiKSB7XG4gICAgICAgIGlmICh0eXBlb2YgcWIgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIHFiID0gcWIobmV3IFF1ZXJ5QnVpbGRlcigpKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzZWxlY3Rpb25Qcm94eSA9IG5ldyBTZWxlY3Rpb25Qcm94eUhhbmRsZXIoe1xuICAgICAgICAgICAgYWxpYXM6IHRoaXMubmFtZSxcbiAgICAgICAgICAgIHNxbEJlaGF2aW9yOiAnZXJyb3InLFxuICAgICAgICAgICAgc3FsQWxpYXNlZEJlaGF2aW9yOiAnYWxpYXMnLFxuICAgICAgICAgICAgcmVwbGFjZU9yaWdpbmFsTmFtZTogdHJ1ZSxcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IGFsaWFzZWRTZWxlY3Rpb24gPSBuZXcgUHJveHkocWIuZ2V0U2VsZWN0ZWRGaWVsZHMoKSwgc2VsZWN0aW9uUHJveHkpO1xuICAgICAgICByZXR1cm4gbmV3IFByb3h5KG5ldyBQZ1ZpZXcoe1xuICAgICAgICAgICAgcGdDb25maWc6IHRoaXMuY29uZmlnLFxuICAgICAgICAgICAgY29uZmlnOiB7XG4gICAgICAgICAgICAgICAgbmFtZTogdGhpcy5uYW1lLFxuICAgICAgICAgICAgICAgIHNjaGVtYTogdGhpcy5zY2hlbWEsXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRGaWVsZHM6IGFsaWFzZWRTZWxlY3Rpb24sXG4gICAgICAgICAgICAgICAgcXVlcnk6IHFiLmdldFNRTCgpLmlubGluZVBhcmFtcygpLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSksIHNlbGVjdGlvblByb3h5KTtcbiAgICB9XG59XG5jbGFzcyBNYW51YWxWaWV3QnVpbGRlciBleHRlbmRzIERlZmF1bHRWaWV3QnVpbGRlckNvcmUge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnUGdNYW51YWxWaWV3QnVpbGRlcic7XG4gICAgY29sdW1ucztcbiAgICBjb25zdHJ1Y3RvcihuYW1lLCBjb2x1bW5zLCBzY2hlbWEpIHtcbiAgICAgICAgc3VwZXIobmFtZSwgc2NoZW1hKTtcbiAgICAgICAgdGhpcy5jb2x1bW5zID0gZ2V0VGFibGVDb2x1bW5zKHBnVGFibGUobmFtZSwgY29sdW1ucykpO1xuICAgIH1cbiAgICBleGlzdGluZygpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm94eShuZXcgUGdWaWV3KHtcbiAgICAgICAgICAgIHBnQ29uZmlnOiB1bmRlZmluZWQsXG4gICAgICAgICAgICBjb25maWc6IHtcbiAgICAgICAgICAgICAgICBuYW1lOiB0aGlzLm5hbWUsXG4gICAgICAgICAgICAgICAgc2NoZW1hOiB0aGlzLnNjaGVtYSxcbiAgICAgICAgICAgICAgICBzZWxlY3RlZEZpZWxkczogdGhpcy5jb2x1bW5zLFxuICAgICAgICAgICAgICAgIHF1ZXJ5OiB1bmRlZmluZWQsXG4gICAgICAgICAgICB9LFxuICAgICAgICB9KSwgbmV3IFNlbGVjdGlvblByb3h5SGFuZGxlcih7XG4gICAgICAgICAgICBhbGlhczogdGhpcy5uYW1lLFxuICAgICAgICAgICAgc3FsQmVoYXZpb3I6ICdlcnJvcicsXG4gICAgICAgICAgICBzcWxBbGlhc2VkQmVoYXZpb3I6ICdhbGlhcycsXG4gICAgICAgICAgICByZXBsYWNlT3JpZ2luYWxOYW1lOiB0cnVlLFxuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGFzKHF1ZXJ5KSB7XG4gICAgICAgIHJldHVybiBuZXcgUHJveHkobmV3IFBnVmlldyh7XG4gICAgICAgICAgICBwZ0NvbmZpZzogdGhpcy5jb25maWcsXG4gICAgICAgICAgICBjb25maWc6IHtcbiAgICAgICAgICAgICAgICBuYW1lOiB0aGlzLm5hbWUsXG4gICAgICAgICAgICAgICAgc2NoZW1hOiB0aGlzLnNjaGVtYSxcbiAgICAgICAgICAgICAgICBzZWxlY3RlZEZpZWxkczogdGhpcy5jb2x1bW5zLFxuICAgICAgICAgICAgICAgIHF1ZXJ5OiBxdWVyeS5pbmxpbmVQYXJhbXMoKSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pLCBuZXcgU2VsZWN0aW9uUHJveHlIYW5kbGVyKHtcbiAgICAgICAgICAgIGFsaWFzOiB0aGlzLm5hbWUsXG4gICAgICAgICAgICBzcWxCZWhhdmlvcjogJ2Vycm9yJyxcbiAgICAgICAgICAgIHNxbEFsaWFzZWRCZWhhdmlvcjogJ2FsaWFzJyxcbiAgICAgICAgICAgIHJlcGxhY2VPcmlnaW5hbE5hbWU6IHRydWUsXG4gICAgICAgIH0pKTtcbiAgICB9XG59XG5jbGFzcyBNYXRlcmlhbGl6ZWRWaWV3QnVpbGRlckNvcmUge1xuICAgIG5hbWU7XG4gICAgc2NoZW1hO1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnUGdNYXRlcmlhbGl6ZWRWaWV3QnVpbGRlckNvcmUnO1xuICAgIGNvbnN0cnVjdG9yKG5hbWUsIHNjaGVtYSkge1xuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICB0aGlzLnNjaGVtYSA9IHNjaGVtYTtcbiAgICB9XG4gICAgY29uZmlnID0ge307XG4gICAgdXNpbmcodXNpbmcpIHtcbiAgICAgICAgdGhpcy5jb25maWcudXNpbmcgPSB1c2luZztcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIHdpdGgoY29uZmlnKSB7XG4gICAgICAgIHRoaXMuY29uZmlnLndpdGggPSBjb25maWc7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICB0YWJsZXNwYWNlKHRhYmxlc3BhY2UpIHtcbiAgICAgICAgdGhpcy5jb25maWcudGFibGVzcGFjZSA9IHRhYmxlc3BhY2U7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICB3aXRoTm9EYXRhKCkge1xuICAgICAgICB0aGlzLmNvbmZpZy53aXRoTm9EYXRhID0gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxufVxuY2xhc3MgTWF0ZXJpYWxpemVkVmlld0J1aWxkZXIgZXh0ZW5kcyBNYXRlcmlhbGl6ZWRWaWV3QnVpbGRlckNvcmUge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnUGdNYXRlcmlhbGl6ZWRWaWV3QnVpbGRlcic7XG4gICAgYXMocWIpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBxYiA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgcWIgPSBxYihuZXcgUXVlcnlCdWlsZGVyKCkpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNlbGVjdGlvblByb3h5ID0gbmV3IFNlbGVjdGlvblByb3h5SGFuZGxlcih7XG4gICAgICAgICAgICBhbGlhczogdGhpcy5uYW1lLFxuICAgICAgICAgICAgc3FsQmVoYXZpb3I6ICdlcnJvcicsXG4gICAgICAgICAgICBzcWxBbGlhc2VkQmVoYXZpb3I6ICdhbGlhcycsXG4gICAgICAgICAgICByZXBsYWNlT3JpZ2luYWxOYW1lOiB0cnVlLFxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgYWxpYXNlZFNlbGVjdGlvbiA9IG5ldyBQcm94eShxYi5nZXRTZWxlY3RlZEZpZWxkcygpLCBzZWxlY3Rpb25Qcm94eSk7XG4gICAgICAgIHJldHVybiBuZXcgUHJveHkobmV3IFBnTWF0ZXJpYWxpemVkVmlldyh7XG4gICAgICAgICAgICBwZ0NvbmZpZzoge1xuICAgICAgICAgICAgICAgIHdpdGg6IHRoaXMuY29uZmlnLndpdGgsXG4gICAgICAgICAgICAgICAgdXNpbmc6IHRoaXMuY29uZmlnLnVzaW5nLFxuICAgICAgICAgICAgICAgIHRhYmxlc3BhY2U6IHRoaXMuY29uZmlnLnRhYmxlc3BhY2UsXG4gICAgICAgICAgICAgICAgd2l0aE5vRGF0YTogdGhpcy5jb25maWcud2l0aE5vRGF0YSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb25maWc6IHtcbiAgICAgICAgICAgICAgICBuYW1lOiB0aGlzLm5hbWUsXG4gICAgICAgICAgICAgICAgc2NoZW1hOiB0aGlzLnNjaGVtYSxcbiAgICAgICAgICAgICAgICBzZWxlY3RlZEZpZWxkczogYWxpYXNlZFNlbGVjdGlvbixcbiAgICAgICAgICAgICAgICBxdWVyeTogcWIuZ2V0U1FMKCkuaW5saW5lUGFyYW1zKCksXG4gICAgICAgICAgICB9LFxuICAgICAgICB9KSwgc2VsZWN0aW9uUHJveHkpO1xuICAgIH1cbn1cbmNsYXNzIE1hbnVhbE1hdGVyaWFsaXplZFZpZXdCdWlsZGVyIGV4dGVuZHMgTWF0ZXJpYWxpemVkVmlld0J1aWxkZXJDb3JlIHtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ1BnTWFudWFsTWF0ZXJpYWxpemVkVmlld0J1aWxkZXInO1xuICAgIGNvbHVtbnM7XG4gICAgY29uc3RydWN0b3IobmFtZSwgY29sdW1ucywgc2NoZW1hKSB7XG4gICAgICAgIHN1cGVyKG5hbWUsIHNjaGVtYSk7XG4gICAgICAgIHRoaXMuY29sdW1ucyA9IGdldFRhYmxlQ29sdW1ucyhwZ1RhYmxlKG5hbWUsIGNvbHVtbnMpKTtcbiAgICB9XG4gICAgZXhpc3RpbmcoKSB7XG4gICAgICAgIHJldHVybiBuZXcgUHJveHkobmV3IFBnTWF0ZXJpYWxpemVkVmlldyh7XG4gICAgICAgICAgICBwZ0NvbmZpZzogdW5kZWZpbmVkLFxuICAgICAgICAgICAgY29uZmlnOiB7XG4gICAgICAgICAgICAgICAgbmFtZTogdGhpcy5uYW1lLFxuICAgICAgICAgICAgICAgIHNjaGVtYTogdGhpcy5zY2hlbWEsXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRGaWVsZHM6IHRoaXMuY29sdW1ucyxcbiAgICAgICAgICAgICAgICBxdWVyeTogdW5kZWZpbmVkLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSksIG5ldyBTZWxlY3Rpb25Qcm94eUhhbmRsZXIoe1xuICAgICAgICAgICAgYWxpYXM6IHRoaXMubmFtZSxcbiAgICAgICAgICAgIHNxbEJlaGF2aW9yOiAnZXJyb3InLFxuICAgICAgICAgICAgc3FsQWxpYXNlZEJlaGF2aW9yOiAnYWxpYXMnLFxuICAgICAgICAgICAgcmVwbGFjZU9yaWdpbmFsTmFtZTogdHJ1ZSxcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBhcyhxdWVyeSkge1xuICAgICAgICByZXR1cm4gbmV3IFByb3h5KG5ldyBQZ01hdGVyaWFsaXplZFZpZXcoe1xuICAgICAgICAgICAgcGdDb25maWc6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIGNvbmZpZzoge1xuICAgICAgICAgICAgICAgIG5hbWU6IHRoaXMubmFtZSxcbiAgICAgICAgICAgICAgICBzY2hlbWE6IHRoaXMuc2NoZW1hLFxuICAgICAgICAgICAgICAgIHNlbGVjdGVkRmllbGRzOiB0aGlzLmNvbHVtbnMsXG4gICAgICAgICAgICAgICAgcXVlcnk6IHF1ZXJ5LmlubGluZVBhcmFtcygpLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSksIG5ldyBTZWxlY3Rpb25Qcm94eUhhbmRsZXIoe1xuICAgICAgICAgICAgYWxpYXM6IHRoaXMubmFtZSxcbiAgICAgICAgICAgIHNxbEJlaGF2aW9yOiAnZXJyb3InLFxuICAgICAgICAgICAgc3FsQWxpYXNlZEJlaGF2aW9yOiAnYWxpYXMnLFxuICAgICAgICAgICAgcmVwbGFjZU9yaWdpbmFsTmFtZTogdHJ1ZSxcbiAgICAgICAgfSkpO1xuICAgIH1cbn1cbmNsYXNzIFBnVmlld0Jhc2UgZXh0ZW5kcyBWaWV3IHtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ1BnVmlld0Jhc2UnO1xufVxuY29uc3QgUGdWaWV3Q29uZmlnID0gU3ltYm9sLmZvcignZHJpenpsZTpQZ1ZpZXdDb25maWcnKTtcbmNsYXNzIFBnVmlldyBleHRlbmRzIFBnVmlld0Jhc2Uge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnUGdWaWV3JztcbiAgICBbUGdWaWV3Q29uZmlnXTtcbiAgICBjb25zdHJ1Y3Rvcih7IHBnQ29uZmlnLCBjb25maWcgfSkge1xuICAgICAgICBzdXBlcihjb25maWcpO1xuICAgICAgICBpZiAocGdDb25maWcpIHtcbiAgICAgICAgICAgIHRoaXNbUGdWaWV3Q29uZmlnXSA9IHtcbiAgICAgICAgICAgICAgICB3aXRoOiBwZ0NvbmZpZy53aXRoLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmNvbnN0IFBnTWF0ZXJpYWxpemVkVmlld0NvbmZpZyA9IFN5bWJvbC5mb3IoJ2RyaXp6bGU6UGdNYXRlcmlhbGl6ZWRWaWV3Q29uZmlnJyk7XG5jbGFzcyBQZ01hdGVyaWFsaXplZFZpZXcgZXh0ZW5kcyBQZ1ZpZXdCYXNlIHtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ1BnTWF0ZXJpYWxpemVkVmlldyc7XG4gICAgW1BnTWF0ZXJpYWxpemVkVmlld0NvbmZpZ107XG4gICAgY29uc3RydWN0b3IoeyBwZ0NvbmZpZywgY29uZmlnIH0pIHtcbiAgICAgICAgc3VwZXIoY29uZmlnKTtcbiAgICAgICAgdGhpc1tQZ01hdGVyaWFsaXplZFZpZXdDb25maWddID0ge1xuICAgICAgICAgICAgd2l0aDogcGdDb25maWc/LndpdGgsXG4gICAgICAgICAgICB1c2luZzogcGdDb25maWc/LnVzaW5nLFxuICAgICAgICAgICAgdGFibGVzcGFjZTogcGdDb25maWc/LnRhYmxlc3BhY2UsXG4gICAgICAgICAgICB3aXRoTm9EYXRhOiBwZ0NvbmZpZz8ud2l0aE5vRGF0YSxcbiAgICAgICAgfTtcbiAgICB9XG59XG4vKiogQGludGVybmFsICovXG5mdW5jdGlvbiBwZ1ZpZXdXaXRoU2NoZW1hKG5hbWUsIHNlbGVjdGlvbiwgc2NoZW1hKSB7XG4gICAgaWYgKHNlbGVjdGlvbikge1xuICAgICAgICByZXR1cm4gbmV3IE1hbnVhbFZpZXdCdWlsZGVyKG5hbWUsIHNlbGVjdGlvbiwgc2NoZW1hKTtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBWaWV3QnVpbGRlcihuYW1lLCBzY2hlbWEpO1xufVxuLyoqIEBpbnRlcm5hbCAqL1xuZnVuY3Rpb24gcGdNYXRlcmlhbGl6ZWRWaWV3V2l0aFNjaGVtYShuYW1lLCBzZWxlY3Rpb24sIHNjaGVtYSkge1xuICAgIGlmIChzZWxlY3Rpb24pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBNYW51YWxNYXRlcmlhbGl6ZWRWaWV3QnVpbGRlcihuYW1lLCBzZWxlY3Rpb24sIHNjaGVtYSk7XG4gICAgfVxuICAgIHJldHVybiBuZXcgTWF0ZXJpYWxpemVkVmlld0J1aWxkZXIobmFtZSwgc2NoZW1hKTtcbn1cbmZ1bmN0aW9uIHBnVmlldyhuYW1lLCBjb2x1bW5zKSB7XG4gICAgcmV0dXJuIHBnVmlld1dpdGhTY2hlbWEobmFtZSwgY29sdW1ucywgdW5kZWZpbmVkKTtcbn1cbmZ1bmN0aW9uIHBnTWF0ZXJpYWxpemVkVmlldyhuYW1lLCBjb2x1bW5zKSB7XG4gICAgcmV0dXJuIHBnTWF0ZXJpYWxpemVkVmlld1dpdGhTY2hlbWEobmFtZSwgY29sdW1ucywgdW5kZWZpbmVkKTtcbn1cblxuY2xhc3MgUmVsYXRpb24ge1xuICAgIHNvdXJjZVRhYmxlO1xuICAgIHJlZmVyZW5jZWRUYWJsZTtcbiAgICByZWxhdGlvbk5hbWU7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdSZWxhdGlvbic7XG4gICAgcmVmZXJlbmNlZFRhYmxlTmFtZTtcbiAgICBmaWVsZE5hbWU7XG4gICAgY29uc3RydWN0b3Ioc291cmNlVGFibGUsIHJlZmVyZW5jZWRUYWJsZSwgcmVsYXRpb25OYW1lKSB7XG4gICAgICAgIHRoaXMuc291cmNlVGFibGUgPSBzb3VyY2VUYWJsZTtcbiAgICAgICAgdGhpcy5yZWZlcmVuY2VkVGFibGUgPSByZWZlcmVuY2VkVGFibGU7XG4gICAgICAgIHRoaXMucmVsYXRpb25OYW1lID0gcmVsYXRpb25OYW1lO1xuICAgICAgICB0aGlzLnJlZmVyZW5jZWRUYWJsZU5hbWUgPSByZWZlcmVuY2VkVGFibGVbVGFibGUuU3ltYm9sLk5hbWVdO1xuICAgIH1cbn1cbmNsYXNzIFJlbGF0aW9ucyB7XG4gICAgdGFibGU7XG4gICAgY29uZmlnO1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnUmVsYXRpb25zJztcbiAgICBjb25zdHJ1Y3Rvcih0YWJsZSwgY29uZmlnKSB7XG4gICAgICAgIHRoaXMudGFibGUgPSB0YWJsZTtcbiAgICAgICAgdGhpcy5jb25maWcgPSBjb25maWc7XG4gICAgfVxufVxuY2xhc3MgT25lIGV4dGVuZHMgUmVsYXRpb24ge1xuICAgIGNvbmZpZztcbiAgICBpc051bGxhYmxlO1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnT25lJztcbiAgICBjb25zdHJ1Y3Rvcihzb3VyY2VUYWJsZSwgcmVmZXJlbmNlZFRhYmxlLCBjb25maWcsIGlzTnVsbGFibGUpIHtcbiAgICAgICAgc3VwZXIoc291cmNlVGFibGUsIHJlZmVyZW5jZWRUYWJsZSwgY29uZmlnPy5yZWxhdGlvbk5hbWUpO1xuICAgICAgICB0aGlzLmNvbmZpZyA9IGNvbmZpZztcbiAgICAgICAgdGhpcy5pc051bGxhYmxlID0gaXNOdWxsYWJsZTtcbiAgICB9XG4gICAgd2l0aEZpZWxkTmFtZShmaWVsZE5hbWUpIHtcbiAgICAgICAgY29uc3QgcmVsYXRpb24gPSBuZXcgT25lKHRoaXMuc291cmNlVGFibGUsIHRoaXMucmVmZXJlbmNlZFRhYmxlLCB0aGlzLmNvbmZpZywgdGhpcy5pc051bGxhYmxlKTtcbiAgICAgICAgcmVsYXRpb24uZmllbGROYW1lID0gZmllbGROYW1lO1xuICAgICAgICByZXR1cm4gcmVsYXRpb247XG4gICAgfVxufVxuY2xhc3MgTWFueSBleHRlbmRzIFJlbGF0aW9uIHtcbiAgICBjb25maWc7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdNYW55JztcbiAgICBjb25zdHJ1Y3Rvcihzb3VyY2VUYWJsZSwgcmVmZXJlbmNlZFRhYmxlLCBjb25maWcpIHtcbiAgICAgICAgc3VwZXIoc291cmNlVGFibGUsIHJlZmVyZW5jZWRUYWJsZSwgY29uZmlnPy5yZWxhdGlvbk5hbWUpO1xuICAgICAgICB0aGlzLmNvbmZpZyA9IGNvbmZpZztcbiAgICB9XG4gICAgd2l0aEZpZWxkTmFtZShmaWVsZE5hbWUpIHtcbiAgICAgICAgY29uc3QgcmVsYXRpb24gPSBuZXcgTWFueSh0aGlzLnNvdXJjZVRhYmxlLCB0aGlzLnJlZmVyZW5jZWRUYWJsZSwgdGhpcy5jb25maWcpO1xuICAgICAgICByZWxhdGlvbi5maWVsZE5hbWUgPSBmaWVsZE5hbWU7XG4gICAgICAgIHJldHVybiByZWxhdGlvbjtcbiAgICB9XG59XG5mdW5jdGlvbiBnZXRPcGVyYXRvcnMoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgYW5kLFxuICAgICAgICBiZXR3ZWVuLFxuICAgICAgICBlcSxcbiAgICAgICAgZXhpc3RzLFxuICAgICAgICBndCxcbiAgICAgICAgZ3RlLFxuICAgICAgICBpbGlrZSxcbiAgICAgICAgaW5BcnJheSxcbiAgICAgICAgaXNOdWxsLFxuICAgICAgICBpc05vdE51bGwsXG4gICAgICAgIGxpa2UsXG4gICAgICAgIGx0LFxuICAgICAgICBsdGUsXG4gICAgICAgIG5lLFxuICAgICAgICBub3QsXG4gICAgICAgIG5vdEJldHdlZW4sXG4gICAgICAgIG5vdEV4aXN0cyxcbiAgICAgICAgbm90TGlrZSxcbiAgICAgICAgbm90SWxpa2UsXG4gICAgICAgIG5vdEluQXJyYXksXG4gICAgICAgIG9yLFxuICAgICAgICBzcWwsXG4gICAgfTtcbn1cbmZ1bmN0aW9uIGdldE9yZGVyQnlPcGVyYXRvcnMoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgc3FsLFxuICAgICAgICBhc2MsXG4gICAgICAgIGRlc2MsXG4gICAgfTtcbn1cbmZ1bmN0aW9uIGV4dHJhY3RUYWJsZXNSZWxhdGlvbmFsQ29uZmlnKHNjaGVtYSwgY29uZmlnSGVscGVycykge1xuICAgIGlmIChPYmplY3Qua2V5cyhzY2hlbWEpLmxlbmd0aCA9PT0gMVxuICAgICAgICAmJiAnZGVmYXVsdCcgaW4gc2NoZW1hXG4gICAgICAgICYmICFpcyhzY2hlbWFbJ2RlZmF1bHQnXSwgVGFibGUpKSB7XG4gICAgICAgIHNjaGVtYSA9IHNjaGVtYVsnZGVmYXVsdCddO1xuICAgIH1cbiAgICAvLyB0YWJsZSBEQiBuYW1lIC0+IHNjaGVtYSB0YWJsZSBrZXlcbiAgICBjb25zdCB0YWJsZU5hbWVzTWFwID0ge307XG4gICAgLy8gVGFibGUgcmVsYXRpb25zIGZvdW5kIGJlZm9yZSB0aGVpciB0YWJsZXMgLSBuZWVkIHRvIGJ1ZmZlciB0aGVtIHVudGlsIHdlIGtub3cgdGhlIHNjaGVtYSB0YWJsZSBrZXlcbiAgICBjb25zdCByZWxhdGlvbnNCdWZmZXIgPSB7fTtcbiAgICBjb25zdCB0YWJsZXNDb25maWcgPSB7fTtcbiAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhzY2hlbWEpKSB7XG4gICAgICAgIGlmIChpc1RhYmxlKHZhbHVlKSkge1xuICAgICAgICAgICAgY29uc3QgZGJOYW1lID0gdmFsdWVbVGFibGUuU3ltYm9sLk5hbWVdO1xuICAgICAgICAgICAgY29uc3QgYnVmZmVyZWRSZWxhdGlvbnMgPSByZWxhdGlvbnNCdWZmZXJbZGJOYW1lXTtcbiAgICAgICAgICAgIHRhYmxlTmFtZXNNYXBbZGJOYW1lXSA9IGtleTtcbiAgICAgICAgICAgIHRhYmxlc0NvbmZpZ1trZXldID0ge1xuICAgICAgICAgICAgICAgIHRzTmFtZToga2V5LFxuICAgICAgICAgICAgICAgIGRiTmFtZTogdmFsdWVbVGFibGUuU3ltYm9sLk5hbWVdLFxuICAgICAgICAgICAgICAgIGNvbHVtbnM6IHZhbHVlW1RhYmxlLlN5bWJvbC5Db2x1bW5zXSxcbiAgICAgICAgICAgICAgICByZWxhdGlvbnM6IGJ1ZmZlcmVkUmVsYXRpb25zPy5yZWxhdGlvbnMgPz8ge30sXG4gICAgICAgICAgICAgICAgcHJpbWFyeUtleTogYnVmZmVyZWRSZWxhdGlvbnM/LnByaW1hcnlLZXkgPz8gW10sXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgLy8gRmlsbCBpbiBwcmltYXJ5IGtleXNcbiAgICAgICAgICAgIGZvciAoY29uc3QgY29sdW1uIG9mIE9iamVjdC52YWx1ZXModmFsdWVbVGFibGUuU3ltYm9sLkNvbHVtbnNdKSkge1xuICAgICAgICAgICAgICAgIGlmIChjb2x1bW4ucHJpbWFyeSkge1xuICAgICAgICAgICAgICAgICAgICB0YWJsZXNDb25maWdba2V5XS5wcmltYXJ5S2V5LnB1c2goY29sdW1uKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBleHRyYUNvbmZpZyA9IHZhbHVlW1RhYmxlLlN5bWJvbC5FeHRyYUNvbmZpZ0J1aWxkZXJdPy4odmFsdWUpO1xuICAgICAgICAgICAgaWYgKGV4dHJhQ29uZmlnKSB7XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBjb25maWdFbnRyeSBvZiBPYmplY3QudmFsdWVzKGV4dHJhQ29uZmlnKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXMoY29uZmlnRW50cnksIFByaW1hcnlLZXlCdWlsZGVyKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVzQ29uZmlnW2tleV0ucHJpbWFyeUtleS5wdXNoKC4uLmNvbmZpZ0VudHJ5LmNvbHVtbnMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGlzKHZhbHVlLCBSZWxhdGlvbnMpKSB7XG4gICAgICAgICAgICBjb25zdCBkYk5hbWUgPSB2YWx1ZS50YWJsZVtUYWJsZS5TeW1ib2wuTmFtZV07XG4gICAgICAgICAgICBjb25zdCB0YWJsZU5hbWUgPSB0YWJsZU5hbWVzTWFwW2RiTmFtZV07XG4gICAgICAgICAgICBjb25zdCByZWxhdGlvbnMgPSB2YWx1ZS5jb25maWcoY29uZmlnSGVscGVycyh2YWx1ZS50YWJsZSkpO1xuICAgICAgICAgICAgbGV0IHByaW1hcnlLZXk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IFtyZWxhdGlvbk5hbWUsIHJlbGF0aW9uXSBvZiBPYmplY3QuZW50cmllcyhyZWxhdGlvbnMpKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRhYmxlTmFtZSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB0YWJsZUNvbmZpZyA9IHRhYmxlc0NvbmZpZ1t0YWJsZU5hbWVdO1xuICAgICAgICAgICAgICAgICAgICB0YWJsZUNvbmZpZy5yZWxhdGlvbnNbcmVsYXRpb25OYW1lXSA9IHJlbGF0aW9uO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEoZGJOYW1lIGluIHJlbGF0aW9uc0J1ZmZlcikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlbGF0aW9uc0J1ZmZlcltkYk5hbWVdID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbGF0aW9uczoge30sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbWFyeUtleSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmVsYXRpb25zQnVmZmVyW2RiTmFtZV0ucmVsYXRpb25zW3JlbGF0aW9uTmFtZV0gPSByZWxhdGlvbjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHsgdGFibGVzOiB0YWJsZXNDb25maWcsIHRhYmxlTmFtZXNNYXAgfTtcbn1cbmZ1bmN0aW9uIHJlbGF0aW9ucyh0YWJsZSwgcmVsYXRpb25zKSB7XG4gICAgcmV0dXJuIG5ldyBSZWxhdGlvbnModGFibGUsIChoZWxwZXJzKSA9PiBPYmplY3QuZnJvbUVudHJpZXMoT2JqZWN0LmVudHJpZXMocmVsYXRpb25zKGhlbHBlcnMpKS5tYXAoKFtrZXksIHZhbHVlXSkgPT4gW1xuICAgICAgICBrZXksXG4gICAgICAgIHZhbHVlLndpdGhGaWVsZE5hbWUoa2V5KSxcbiAgICBdKSkpO1xufVxuZnVuY3Rpb24gY3JlYXRlT25lKHNvdXJjZVRhYmxlKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIG9uZSh0YWJsZSwgY29uZmlnKSB7XG4gICAgICAgIHJldHVybiBuZXcgT25lKHNvdXJjZVRhYmxlLCB0YWJsZSwgY29uZmlnLCAoY29uZmlnPy5maWVsZHMucmVkdWNlKChyZXMsIGYpID0+IHJlcyAmJiBmLm5vdE51bGwsIHRydWUpXG4gICAgICAgICAgICA/PyBmYWxzZSkpO1xuICAgIH07XG59XG5mdW5jdGlvbiBjcmVhdGVNYW55KHNvdXJjZVRhYmxlKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIG1hbnkocmVmZXJlbmNlZFRhYmxlLCBjb25maWcpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBNYW55KHNvdXJjZVRhYmxlLCByZWZlcmVuY2VkVGFibGUsIGNvbmZpZyk7XG4gICAgfTtcbn1cbmZ1bmN0aW9uIG5vcm1hbGl6ZVJlbGF0aW9uKHNjaGVtYSwgdGFibGVOYW1lc01hcCwgcmVsYXRpb24pIHtcbiAgICBpZiAoaXMocmVsYXRpb24sIE9uZSkgJiYgcmVsYXRpb24uY29uZmlnKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBmaWVsZHM6IHJlbGF0aW9uLmNvbmZpZy5maWVsZHMsXG4gICAgICAgICAgICByZWZlcmVuY2VzOiByZWxhdGlvbi5jb25maWcucmVmZXJlbmNlcyxcbiAgICAgICAgfTtcbiAgICB9XG4gICAgY29uc3QgcmVmZXJlbmNlZFRhYmxlVHNOYW1lID0gdGFibGVOYW1lc01hcFtyZWxhdGlvbi5yZWZlcmVuY2VkVGFibGVbVGFibGUuU3ltYm9sLk5hbWVdXTtcbiAgICBpZiAoIXJlZmVyZW5jZWRUYWJsZVRzTmFtZSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFRhYmxlIFwiJHtyZWxhdGlvbi5yZWZlcmVuY2VkVGFibGVbVGFibGUuU3ltYm9sLk5hbWVdfVwiIG5vdCBmb3VuZCBpbiBzY2hlbWFgKTtcbiAgICB9XG4gICAgY29uc3QgcmVmZXJlbmNlZFRhYmxlQ29uZmlnID0gc2NoZW1hW3JlZmVyZW5jZWRUYWJsZVRzTmFtZV07XG4gICAgaWYgKCFyZWZlcmVuY2VkVGFibGVDb25maWcpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBUYWJsZSBcIiR7cmVmZXJlbmNlZFRhYmxlVHNOYW1lfVwiIG5vdCBmb3VuZCBpbiBzY2hlbWFgKTtcbiAgICB9XG4gICAgY29uc3Qgc291cmNlVGFibGUgPSByZWxhdGlvbi5zb3VyY2VUYWJsZTtcbiAgICBjb25zdCBzb3VyY2VUYWJsZVRzTmFtZSA9IHRhYmxlTmFtZXNNYXBbc291cmNlVGFibGVbVGFibGUuU3ltYm9sLk5hbWVdXTtcbiAgICBpZiAoIXNvdXJjZVRhYmxlVHNOYW1lKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgVGFibGUgXCIke3NvdXJjZVRhYmxlW1RhYmxlLlN5bWJvbC5OYW1lXX1cIiBub3QgZm91bmQgaW4gc2NoZW1hYCk7XG4gICAgfVxuICAgIGNvbnN0IHJldmVyc2VSZWxhdGlvbnMgPSBbXTtcbiAgICBmb3IgKGNvbnN0IHJlZmVyZW5jZWRUYWJsZVJlbGF0aW9uIG9mIE9iamVjdC52YWx1ZXMocmVmZXJlbmNlZFRhYmxlQ29uZmlnLnJlbGF0aW9ucykpIHtcbiAgICAgICAgaWYgKChyZWxhdGlvbi5yZWxhdGlvbk5hbWVcbiAgICAgICAgICAgICYmIHJlbGF0aW9uICE9PSByZWZlcmVuY2VkVGFibGVSZWxhdGlvblxuICAgICAgICAgICAgJiYgcmVmZXJlbmNlZFRhYmxlUmVsYXRpb24ucmVsYXRpb25OYW1lID09PSByZWxhdGlvbi5yZWxhdGlvbk5hbWUpXG4gICAgICAgICAgICB8fCAoIXJlbGF0aW9uLnJlbGF0aW9uTmFtZVxuICAgICAgICAgICAgICAgICYmIHJlZmVyZW5jZWRUYWJsZVJlbGF0aW9uLnJlZmVyZW5jZWRUYWJsZSA9PT0gcmVsYXRpb24uc291cmNlVGFibGUpKSB7XG4gICAgICAgICAgICByZXZlcnNlUmVsYXRpb25zLnB1c2gocmVmZXJlbmNlZFRhYmxlUmVsYXRpb24pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmIChyZXZlcnNlUmVsYXRpb25zLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgdGhyb3cgcmVsYXRpb24ucmVsYXRpb25OYW1lXG4gICAgICAgICAgICA/IG5ldyBFcnJvcihgVGhlcmUgYXJlIG11bHRpcGxlIHJlbGF0aW9ucyB3aXRoIG5hbWUgXCIke3JlbGF0aW9uLnJlbGF0aW9uTmFtZX1cIiBpbiB0YWJsZSBcIiR7cmVmZXJlbmNlZFRhYmxlVHNOYW1lfVwiYClcbiAgICAgICAgICAgIDogbmV3IEVycm9yKGBUaGVyZSBhcmUgbXVsdGlwbGUgcmVsYXRpb25zIGJldHdlZW4gXCIke3JlZmVyZW5jZWRUYWJsZVRzTmFtZX1cIiBhbmQgXCIke3JlbGF0aW9uLnNvdXJjZVRhYmxlW1RhYmxlLlN5bWJvbC5OYW1lXX1cIi4gUGxlYXNlIHNwZWNpZnkgcmVsYXRpb24gbmFtZWApO1xuICAgIH1cbiAgICBpZiAocmV2ZXJzZVJlbGF0aW9uc1swXVxuICAgICAgICAmJiBpcyhyZXZlcnNlUmVsYXRpb25zWzBdLCBPbmUpXG4gICAgICAgICYmIHJldmVyc2VSZWxhdGlvbnNbMF0uY29uZmlnKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBmaWVsZHM6IHJldmVyc2VSZWxhdGlvbnNbMF0uY29uZmlnLnJlZmVyZW5jZXMsXG4gICAgICAgICAgICByZWZlcmVuY2VzOiByZXZlcnNlUmVsYXRpb25zWzBdLmNvbmZpZy5maWVsZHMsXG4gICAgICAgIH07XG4gICAgfVxuICAgIHRocm93IG5ldyBFcnJvcihgVGhlcmUgaXMgbm90IGVub3VnaCBpbmZvcm1hdGlvbiB0byBpbmZlciByZWxhdGlvbiBcIiR7c291cmNlVGFibGVUc05hbWV9LiR7cmVsYXRpb24uZmllbGROYW1lfVwiYCk7XG59XG5mdW5jdGlvbiBjcmVhdGVUYWJsZVJlbGF0aW9uc0hlbHBlcnMoc291cmNlVGFibGUpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBvbmU6IGNyZWF0ZU9uZShzb3VyY2VUYWJsZSksXG4gICAgICAgIG1hbnk6IGNyZWF0ZU1hbnkoc291cmNlVGFibGUpLFxuICAgIH07XG59XG5mdW5jdGlvbiBtYXBSZWxhdGlvbmFsUm93KHRhYmxlc0NvbmZpZywgdGFibGVDb25maWcsIHJvdywgYnVpbGRRdWVyeVJlc3VsdFNlbGVjdGlvbiwgbWFwQ29sdW1uVmFsdWUgPSAodmFsdWUpID0+IHZhbHVlKSB7XG4gICAgY29uc3QgcmVzdWx0ID0ge307XG4gICAgZm9yIChjb25zdCBbc2VsZWN0aW9uSXRlbUluZGV4LCBzZWxlY3Rpb25JdGVtLF0gb2YgYnVpbGRRdWVyeVJlc3VsdFNlbGVjdGlvbi5lbnRyaWVzKCkpIHtcbiAgICAgICAgaWYgKHNlbGVjdGlvbkl0ZW0uaXNKc29uKSB7XG4gICAgICAgICAgICBjb25zdCByZWxhdGlvbiA9IHRhYmxlQ29uZmlnLnJlbGF0aW9uc1tzZWxlY3Rpb25JdGVtLnRzS2V5XTtcbiAgICAgICAgICAgIGNvbnN0IHJhd1N1YlJvd3MgPSByb3dbc2VsZWN0aW9uSXRlbUluZGV4XTtcbiAgICAgICAgICAgIGNvbnN0IHN1YlJvd3MgPSB0eXBlb2YgcmF3U3ViUm93cyA9PT0gJ3N0cmluZydcbiAgICAgICAgICAgICAgICA/IEpTT04ucGFyc2UocmF3U3ViUm93cylcbiAgICAgICAgICAgICAgICA6IHJhd1N1YlJvd3M7XG4gICAgICAgICAgICByZXN1bHRbc2VsZWN0aW9uSXRlbS50c0tleV0gPSBpcyhyZWxhdGlvbiwgT25lKVxuICAgICAgICAgICAgICAgID8gc3ViUm93c1xuICAgICAgICAgICAgICAgICAgICAmJiBtYXBSZWxhdGlvbmFsUm93KHRhYmxlc0NvbmZpZywgdGFibGVzQ29uZmlnW3NlbGVjdGlvbkl0ZW0ucmVsYXRpb25UYWJsZVRzS2V5XSwgc3ViUm93cywgc2VsZWN0aW9uSXRlbS5zZWxlY3Rpb24sIG1hcENvbHVtblZhbHVlKVxuICAgICAgICAgICAgICAgIDogc3ViUm93cy5tYXAoKHN1YlJvdykgPT4gbWFwUmVsYXRpb25hbFJvdyh0YWJsZXNDb25maWcsIHRhYmxlc0NvbmZpZ1tzZWxlY3Rpb25JdGVtLnJlbGF0aW9uVGFibGVUc0tleV0sIHN1YlJvdywgc2VsZWN0aW9uSXRlbS5zZWxlY3Rpb24sIG1hcENvbHVtblZhbHVlKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9IG1hcENvbHVtblZhbHVlKHJvd1tzZWxlY3Rpb25JdGVtSW5kZXhdKTtcbiAgICAgICAgICAgIGNvbnN0IGZpZWxkID0gc2VsZWN0aW9uSXRlbS5maWVsZDtcbiAgICAgICAgICAgIGxldCBkZWNvZGVyO1xuICAgICAgICAgICAgaWYgKGlzKGZpZWxkLCBDb2x1bW4pKSB7XG4gICAgICAgICAgICAgICAgZGVjb2RlciA9IGZpZWxkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoaXMoZmllbGQsIFNRTCkpIHtcbiAgICAgICAgICAgICAgICBkZWNvZGVyID0gZmllbGQuZGVjb2RlcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGRlY29kZXIgPSBmaWVsZC5zcWwuZGVjb2RlcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlc3VsdFtzZWxlY3Rpb25JdGVtLnRzS2V5XSA9IHZhbHVlID09PSBudWxsID8gbnVsbCA6IGRlY29kZXIubWFwRnJvbURyaXZlclZhbHVlKHZhbHVlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xufVxuXG5mdW5jdGlvbiBiaW5kSWZQYXJhbSh2YWx1ZSwgY29sdW1uKSB7XG4gICAgaWYgKGlzRHJpdmVyVmFsdWVFbmNvZGVyKGNvbHVtbilcbiAgICAgICAgJiYgIWlzU1FMV3JhcHBlcih2YWx1ZSlcbiAgICAgICAgJiYgIWlzKHZhbHVlLCBQYXJhbSlcbiAgICAgICAgJiYgIWlzKHZhbHVlLCBQbGFjZWhvbGRlcilcbiAgICAgICAgJiYgIWlzKHZhbHVlLCBDb2x1bW4pXG4gICAgICAgICYmICFpcyh2YWx1ZSwgVGFibGUpXG4gICAgICAgICYmICFpcyh2YWx1ZSwgVmlldykpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQYXJhbSh2YWx1ZSwgY29sdW1uKTtcbiAgICB9XG4gICAgcmV0dXJuIHZhbHVlO1xufVxuLyoqXG4gKiBUZXN0IHRoYXQgdHdvIHZhbHVlcyBhcmUgZXF1YWwuXG4gKlxuICogUmVtZW1iZXIgdGhhdCB0aGUgU1FMIHN0YW5kYXJkIGRpY3RhdGVzIHRoYXRcbiAqIHR3byBOVUxMIHZhbHVlcyBhcmUgbm90IGVxdWFsLCBzbyBpZiB5b3Ugd2FudCB0byB0ZXN0XG4gKiB3aGV0aGVyIGEgdmFsdWUgaXMgbnVsbCwgeW91IG1heSB3YW50IHRvIHVzZVxuICogYGlzTnVsbGAgaW5zdGVhZC5cbiAqXG4gKiAjIyBFeGFtcGxlc1xuICpcbiAqIGBgYHRzXG4gKiAvLyBTZWxlY3QgY2FycyBtYWRlIGJ5IEZvcmRcbiAqIGRiLnNlbGVjdCgpLmZyb20oY2FycylcbiAqICAgLndoZXJlKGVxKGNhcnMubWFrZSwgJ0ZvcmQnKSlcbiAqIGBgYFxuICpcbiAqIEBzZWUgaXNOdWxsIGZvciBhIHdheSB0byB0ZXN0IGVxdWFsaXR5IHRvIE5VTEwuXG4gKi9cbmNvbnN0IGVxID0gKGxlZnQsIHJpZ2h0KSA9PiB7XG4gICAgcmV0dXJuIHNxbCBgJHtsZWZ0fSA9ICR7YmluZElmUGFyYW0ocmlnaHQsIGxlZnQpfWA7XG59O1xuLyoqXG4gKiBUZXN0IHRoYXQgdHdvIHZhbHVlcyBhcmUgbm90IGVxdWFsLlxuICpcbiAqIFJlbWVtYmVyIHRoYXQgdGhlIFNRTCBzdGFuZGFyZCBkaWN0YXRlcyB0aGF0XG4gKiB0d28gTlVMTCB2YWx1ZXMgYXJlIG5vdCBlcXVhbCwgc28gaWYgeW91IHdhbnQgdG8gdGVzdFxuICogd2hldGhlciBhIHZhbHVlIGlzIG5vdCBudWxsLCB5b3UgbWF5IHdhbnQgdG8gdXNlXG4gKiBgaXNOb3ROdWxsYCBpbnN0ZWFkLlxuICpcbiAqICMjIEV4YW1wbGVzXG4gKlxuICogYGBgdHNcbiAqIC8vIFNlbGVjdCBjYXJzIG5vdCBtYWRlIGJ5IEZvcmRcbiAqIGRiLnNlbGVjdCgpLmZyb20oY2FycylcbiAqICAgLndoZXJlKG5lKGNhcnMubWFrZSwgJ0ZvcmQnKSlcbiAqIGBgYFxuICpcbiAqIEBzZWUgaXNOb3ROdWxsIGZvciBhIHdheSB0byB0ZXN0IHdoZXRoZXIgYSB2YWx1ZSBpcyBub3QgbnVsbC5cbiAqL1xuY29uc3QgbmUgPSAobGVmdCwgcmlnaHQpID0+IHtcbiAgICByZXR1cm4gc3FsIGAke2xlZnR9IDw+ICR7YmluZElmUGFyYW0ocmlnaHQsIGxlZnQpfWA7XG59O1xuZnVuY3Rpb24gYW5kKC4uLnVuZmlsdGVyZWRDb25kaXRpb25zKSB7XG4gICAgY29uc3QgY29uZGl0aW9ucyA9IHVuZmlsdGVyZWRDb25kaXRpb25zLmZpbHRlcigoYykgPT4gYyAhPT0gdW5kZWZpbmVkKTtcbiAgICBpZiAoY29uZGl0aW9ucy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG4gICAgaWYgKGNvbmRpdGlvbnMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgIHJldHVybiBuZXcgU1FMKGNvbmRpdGlvbnMpO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IFNRTChbXG4gICAgICAgIG5ldyBTdHJpbmdDaHVuaygnKCcpLFxuICAgICAgICBzcWwuam9pbihjb25kaXRpb25zLCBuZXcgU3RyaW5nQ2h1bmsoJyBhbmQgJykpLFxuICAgICAgICBuZXcgU3RyaW5nQ2h1bmsoJyknKSxcbiAgICBdKTtcbn1cbmZ1bmN0aW9uIG9yKC4uLnVuZmlsdGVyZWRDb25kaXRpb25zKSB7XG4gICAgY29uc3QgY29uZGl0aW9ucyA9IHVuZmlsdGVyZWRDb25kaXRpb25zLmZpbHRlcigoYykgPT4gYyAhPT0gdW5kZWZpbmVkKTtcbiAgICBpZiAoY29uZGl0aW9ucy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG4gICAgaWYgKGNvbmRpdGlvbnMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgIHJldHVybiBuZXcgU1FMKGNvbmRpdGlvbnMpO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IFNRTChbXG4gICAgICAgIG5ldyBTdHJpbmdDaHVuaygnKCcpLFxuICAgICAgICBzcWwuam9pbihjb25kaXRpb25zLCBuZXcgU3RyaW5nQ2h1bmsoJyBvciAnKSksXG4gICAgICAgIG5ldyBTdHJpbmdDaHVuaygnKScpLFxuICAgIF0pO1xufVxuLyoqXG4gKiBOZWdhdGUgdGhlIG1lYW5pbmcgb2YgYW4gZXhwcmVzc2lvbiB1c2luZyB0aGUgYG5vdGAga2V5d29yZC5cbiAqXG4gKiAjIyBFeGFtcGxlc1xuICpcbiAqIGBgYHRzXG4gKiAvLyBTZWxlY3QgY2FycyBfbm90XyBtYWRlIGJ5IEdNIG9yIEZvcmQuXG4gKiBkYi5zZWxlY3QoKS5mcm9tKGNhcnMpXG4gKiAgIC53aGVyZShub3QoaW5BcnJheShjYXJzLm1ha2UsIFsnR00nLCAnRm9yZCddKSkpXG4gKiBgYGBcbiAqL1xuZnVuY3Rpb24gbm90KGNvbmRpdGlvbikge1xuICAgIHJldHVybiBzcWwgYG5vdCAke2NvbmRpdGlvbn1gO1xufVxuLyoqXG4gKiBUZXN0IHRoYXQgdGhlIGZpcnN0IGV4cHJlc3Npb24gcGFzc2VkIGlzIGdyZWF0ZXIgdGhhblxuICogdGhlIHNlY29uZCBleHByZXNzaW9uLlxuICpcbiAqICMjIEV4YW1wbGVzXG4gKlxuICogYGBgdHNcbiAqIC8vIFNlbGVjdCBjYXJzIG1hZGUgYWZ0ZXIgMjAwMC5cbiAqIGRiLnNlbGVjdCgpLmZyb20oY2FycylcbiAqICAgLndoZXJlKGd0KGNhcnMueWVhciwgMjAwMCkpXG4gKiBgYGBcbiAqXG4gKiBAc2VlIGd0ZSBmb3IgZ3JlYXRlci10aGFuLW9yLWVxdWFsXG4gKi9cbmNvbnN0IGd0ID0gKGxlZnQsIHJpZ2h0KSA9PiB7XG4gICAgcmV0dXJuIHNxbCBgJHtsZWZ0fSA+ICR7YmluZElmUGFyYW0ocmlnaHQsIGxlZnQpfWA7XG59O1xuLyoqXG4gKiBUZXN0IHRoYXQgdGhlIGZpcnN0IGV4cHJlc3Npb24gcGFzc2VkIGlzIGdyZWF0ZXIgdGhhblxuICogb3IgZXF1YWwgdG8gdGhlIHNlY29uZCBleHByZXNzaW9uLiBVc2UgYGd0YCB0b1xuICogdGVzdCB3aGV0aGVyIGFuIGV4cHJlc3Npb24gaXMgc3RyaWN0bHkgZ3JlYXRlclxuICogdGhhbiBhbm90aGVyLlxuICpcbiAqICMjIEV4YW1wbGVzXG4gKlxuICogYGBgdHNcbiAqIC8vIFNlbGVjdCBjYXJzIG1hZGUgb24gb3IgYWZ0ZXIgMjAwMC5cbiAqIGRiLnNlbGVjdCgpLmZyb20oY2FycylcbiAqICAgLndoZXJlKGd0ZShjYXJzLnllYXIsIDIwMDApKVxuICogYGBgXG4gKlxuICogQHNlZSBndCBmb3IgYSBzdHJpY3RseSBncmVhdGVyLXRoYW4gY29uZGl0aW9uXG4gKi9cbmNvbnN0IGd0ZSA9IChsZWZ0LCByaWdodCkgPT4ge1xuICAgIHJldHVybiBzcWwgYCR7bGVmdH0gPj0gJHtiaW5kSWZQYXJhbShyaWdodCwgbGVmdCl9YDtcbn07XG4vKipcbiAqIFRlc3QgdGhhdCB0aGUgZmlyc3QgZXhwcmVzc2lvbiBwYXNzZWQgaXMgbGVzcyB0aGFuXG4gKiB0aGUgc2Vjb25kIGV4cHJlc3Npb24uXG4gKlxuICogIyMgRXhhbXBsZXNcbiAqXG4gKiBgYGB0c1xuICogLy8gU2VsZWN0IGNhcnMgbWFkZSBiZWZvcmUgMjAwMC5cbiAqIGRiLnNlbGVjdCgpLmZyb20oY2FycylcbiAqICAgLndoZXJlKGx0KGNhcnMueWVhciwgMjAwMCkpXG4gKiBgYGBcbiAqXG4gKiBAc2VlIGx0ZSBmb3IgZ3JlYXRlci10aGFuLW9yLWVxdWFsXG4gKi9cbmNvbnN0IGx0ID0gKGxlZnQsIHJpZ2h0KSA9PiB7XG4gICAgcmV0dXJuIHNxbCBgJHtsZWZ0fSA8ICR7YmluZElmUGFyYW0ocmlnaHQsIGxlZnQpfWA7XG59O1xuLyoqXG4gKiBUZXN0IHRoYXQgdGhlIGZpcnN0IGV4cHJlc3Npb24gcGFzc2VkIGlzIGxlc3MgdGhhblxuICogb3IgZXF1YWwgdG8gdGhlIHNlY29uZCBleHByZXNzaW9uLlxuICpcbiAqICMjIEV4YW1wbGVzXG4gKlxuICogYGBgdHNcbiAqIC8vIFNlbGVjdCBjYXJzIG1hZGUgYmVmb3JlIDIwMDAuXG4gKiBkYi5zZWxlY3QoKS5mcm9tKGNhcnMpXG4gKiAgIC53aGVyZShsdGUoY2Fycy55ZWFyLCAyMDAwKSlcbiAqIGBgYFxuICpcbiAqIEBzZWUgbHQgZm9yIGEgc3RyaWN0bHkgbGVzcy10aGFuIGNvbmRpdGlvblxuICovXG5jb25zdCBsdGUgPSAobGVmdCwgcmlnaHQpID0+IHtcbiAgICByZXR1cm4gc3FsIGAke2xlZnR9IDw9ICR7YmluZElmUGFyYW0ocmlnaHQsIGxlZnQpfWA7XG59O1xuZnVuY3Rpb24gaW5BcnJheShjb2x1bW4sIHZhbHVlcykge1xuICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlcykpIHtcbiAgICAgICAgaWYgKHZhbHVlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW5BcnJheSByZXF1aXJlcyBhdCBsZWFzdCBvbmUgdmFsdWUnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc3FsIGAke2NvbHVtbn0gaW4gJHt2YWx1ZXMubWFwKCh2KSA9PiBiaW5kSWZQYXJhbSh2LCBjb2x1bW4pKX1gO1xuICAgIH1cbiAgICByZXR1cm4gc3FsIGAke2NvbHVtbn0gaW4gJHtiaW5kSWZQYXJhbSh2YWx1ZXMsIGNvbHVtbil9YDtcbn1cbmZ1bmN0aW9uIG5vdEluQXJyYXkoY29sdW1uLCB2YWx1ZXMpIHtcbiAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZXMpKSB7XG4gICAgICAgIGlmICh2YWx1ZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ25vdEluQXJyYXkgcmVxdWlyZXMgYXQgbGVhc3Qgb25lIHZhbHVlJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHNxbCBgJHtjb2x1bW59IG5vdCBpbiAke3ZhbHVlcy5tYXAoKHYpID0+IGJpbmRJZlBhcmFtKHYsIGNvbHVtbikpfWA7XG4gICAgfVxuICAgIHJldHVybiBzcWwgYCR7Y29sdW1ufSBub3QgaW4gJHtiaW5kSWZQYXJhbSh2YWx1ZXMsIGNvbHVtbil9YDtcbn1cbi8qKlxuICogVGVzdCB3aGV0aGVyIGFuIGV4cHJlc3Npb24gaXMgTlVMTC4gQnkgdGhlIFNRTCBzdGFuZGFyZCxcbiAqIE5VTEwgaXMgbmVpdGhlciBlcXVhbCBub3Igbm90IGVxdWFsIHRvIGl0c2VsZiwgc29cbiAqIGl0J3MgcmVjb21tZW5kZWQgdG8gdXNlIGBpc051bGxgIGFuZCBgbm90SXNOdWxsYCBmb3JcbiAqIGNvbXBhcmlzb25zIHRvIE5VTEwuXG4gKlxuICogIyMgRXhhbXBsZXNcbiAqXG4gKiBgYGB0c1xuICogLy8gU2VsZWN0IGNhcnMgdGhhdCBoYXZlIG5vIGRpc2NvbnRpbnVlZEF0IGRhdGUuXG4gKiBkYi5zZWxlY3QoKS5mcm9tKGNhcnMpXG4gKiAgIC53aGVyZShpc051bGwoY2Fycy5kaXNjb250aW51ZWRBdCkpXG4gKiBgYGBcbiAqXG4gKiBAc2VlIGlzTm90TnVsbCBmb3IgdGhlIGludmVyc2Ugb2YgdGhpcyB0ZXN0XG4gKi9cbmZ1bmN0aW9uIGlzTnVsbCh2YWx1ZSkge1xuICAgIHJldHVybiBzcWwgYCR7dmFsdWV9IGlzIG51bGxgO1xufVxuLyoqXG4gKiBUZXN0IHdoZXRoZXIgYW4gZXhwcmVzc2lvbiBpcyBub3QgTlVMTC4gQnkgdGhlIFNRTCBzdGFuZGFyZCxcbiAqIE5VTEwgaXMgbmVpdGhlciBlcXVhbCBub3Igbm90IGVxdWFsIHRvIGl0c2VsZiwgc29cbiAqIGl0J3MgcmVjb21tZW5kZWQgdG8gdXNlIGBpc051bGxgIGFuZCBgbm90SXNOdWxsYCBmb3JcbiAqIGNvbXBhcmlzb25zIHRvIE5VTEwuXG4gKlxuICogIyMgRXhhbXBsZXNcbiAqXG4gKiBgYGB0c1xuICogLy8gU2VsZWN0IGNhcnMgdGhhdCBoYXZlIGJlZW4gZGlzY29udGludWVkLlxuICogZGIuc2VsZWN0KCkuZnJvbShjYXJzKVxuICogICAud2hlcmUoaXNOb3ROdWxsKGNhcnMuZGlzY29udGludWVkQXQpKVxuICogYGBgXG4gKlxuICogQHNlZSBpc051bGwgZm9yIHRoZSBpbnZlcnNlIG9mIHRoaXMgdGVzdFxuICovXG5mdW5jdGlvbiBpc05vdE51bGwodmFsdWUpIHtcbiAgICByZXR1cm4gc3FsIGAke3ZhbHVlfSBpcyBub3QgbnVsbGA7XG59XG4vKipcbiAqIFRlc3Qgd2hldGhlciBhIHN1YnF1ZXJ5IGV2YWx1YXRlcyB0byBoYXZlIGFueSByb3dzLlxuICpcbiAqICMjIEV4YW1wbGVzXG4gKlxuICogYGBgdHNcbiAqIC8vIFVzZXJzIHdob3NlIGBob21lQ2l0eWAgY29sdW1uIGhhcyBhIG1hdGNoIGluIGEgY2l0aWVzXG4gKiAvLyB0YWJsZS5cbiAqIGRiXG4gKiAgIC5zZWxlY3QoKVxuICogICAuZnJvbSh1c2VycylcbiAqICAgLndoZXJlKFxuICogICAgIGV4aXN0cyhkYi5zZWxlY3QoKVxuICogICAgICAgLmZyb20oY2l0aWVzKVxuICogICAgICAgLndoZXJlKGVxKHVzZXJzLmhvbWVDaXR5LCBjaXRpZXMuaWQpKSksXG4gKiAgICk7XG4gKiBgYGBcbiAqXG4gKiBAc2VlIG5vdEV4aXN0cyBmb3IgdGhlIGludmVyc2Ugb2YgdGhpcyB0ZXN0XG4gKi9cbmZ1bmN0aW9uIGV4aXN0cyhzdWJxdWVyeSkge1xuICAgIHJldHVybiBzcWwgYGV4aXN0cyAoJHtzdWJxdWVyeX0pYDtcbn1cbi8qKlxuICogVGVzdCB3aGV0aGVyIGEgc3VicXVlcnkgZG9lc24ndCBpbmNsdWRlIGFueSByZXN1bHRcbiAqIHJvd3MuXG4gKlxuICogIyMgRXhhbXBsZXNcbiAqXG4gKiBgYGB0c1xuICogLy8gVXNlcnMgd2hvc2UgYGhvbWVDaXR5YCBjb2x1bW4gZG9lc24ndCBtYXRjaFxuICogLy8gYSByb3cgaW4gdGhlIGNpdGllcyB0YWJsZS5cbiAqIGRiXG4gKiAgIC5zZWxlY3QoKVxuICogICAuZnJvbSh1c2VycylcbiAqICAgLndoZXJlKFxuICogICAgIG5vdEV4aXN0cyhkYi5zZWxlY3QoKVxuICogICAgICAgLmZyb20oY2l0aWVzKVxuICogICAgICAgLndoZXJlKGVxKHVzZXJzLmhvbWVDaXR5LCBjaXRpZXMuaWQpKSksXG4gKiAgICk7XG4gKiBgYGBcbiAqXG4gKiBAc2VlIGV4aXN0cyBmb3IgdGhlIGludmVyc2Ugb2YgdGhpcyB0ZXN0XG4gKi9cbmZ1bmN0aW9uIG5vdEV4aXN0cyhzdWJxdWVyeSkge1xuICAgIHJldHVybiBzcWwgYG5vdCBleGlzdHMgKCR7c3VicXVlcnl9KWA7XG59XG5mdW5jdGlvbiBiZXR3ZWVuKGNvbHVtbiwgbWluLCBtYXgpIHtcbiAgICByZXR1cm4gc3FsIGAke2NvbHVtbn0gYmV0d2VlbiAke2JpbmRJZlBhcmFtKG1pbiwgY29sdW1uKX0gYW5kICR7YmluZElmUGFyYW0obWF4LCBjb2x1bW4pfWA7XG59XG5mdW5jdGlvbiBub3RCZXR3ZWVuKGNvbHVtbiwgbWluLCBtYXgpIHtcbiAgICByZXR1cm4gc3FsIGAke2NvbHVtbn0gbm90IGJldHdlZW4gJHtiaW5kSWZQYXJhbShtaW4sIGNvbHVtbil9IGFuZCAke2JpbmRJZlBhcmFtKG1heCwgY29sdW1uKX1gO1xufVxuLyoqXG4gKiBDb21wYXJlIGEgY29sdW1uIHRvIGEgcGF0dGVybiwgd2hpY2ggY2FuIGluY2x1ZGUgYCVgIGFuZCBgX2BcbiAqIGNoYXJhY3RlcnMgdG8gbWF0Y2ggbXVsdGlwbGUgdmFyaWF0aW9ucy4gSW5jbHVkaW5nIGAlYFxuICogaW4gdGhlIHBhdHRlcm4gbWF0Y2hlcyB6ZXJvIG9yIG1vcmUgY2hhcmFjdGVycywgYW5kIGluY2x1ZGluZ1xuICogYF9gIHdpbGwgbWF0Y2ggYSBzaW5nbGUgY2hhcmFjdGVyLlxuICpcbiAqICMjIEV4YW1wbGVzXG4gKlxuICogYGBgdHNcbiAqIC8vIFNlbGVjdCBhbGwgY2FycyB3aXRoICdUdXJibycgaW4gdGhlaXIgbmFtZXMuXG4gKiBkYi5zZWxlY3QoKS5mcm9tKGNhcnMpXG4gKiAgIC53aGVyZShsaWtlKGNhcnMubmFtZSwgJyVUdXJibyUnKSlcbiAqIGBgYFxuICpcbiAqIEBzZWUgaWxpa2UgZm9yIGEgY2FzZS1pbnNlbnNpdGl2ZSB2ZXJzaW9uIG9mIHRoaXMgY29uZGl0aW9uXG4gKi9cbmZ1bmN0aW9uIGxpa2UoY29sdW1uLCB2YWx1ZSkge1xuICAgIHJldHVybiBzcWwgYCR7Y29sdW1ufSBsaWtlICR7dmFsdWV9YDtcbn1cbi8qKlxuICogVGhlIGludmVyc2Ugb2YgbGlrZSAtIHRoaXMgdGVzdHMgdGhhdCBhIGdpdmVuIGNvbHVtblxuICogZG9lcyBub3QgbWF0Y2ggYSBwYXR0ZXJuLCB3aGljaCBjYW4gaW5jbHVkZSBgJWAgYW5kIGBfYFxuICogY2hhcmFjdGVycyB0byBtYXRjaCBtdWx0aXBsZSB2YXJpYXRpb25zLiBJbmNsdWRpbmcgYCVgXG4gKiBpbiB0aGUgcGF0dGVybiBtYXRjaGVzIHplcm8gb3IgbW9yZSBjaGFyYWN0ZXJzLCBhbmQgaW5jbHVkaW5nXG4gKiBgX2Agd2lsbCBtYXRjaCBhIHNpbmdsZSBjaGFyYWN0ZXIuXG4gKlxuICogIyMgRXhhbXBsZXNcbiAqXG4gKiBgYGB0c1xuICogLy8gU2VsZWN0IGFsbCBjYXJzIHRoYXQgZG9uJ3QgaGF2ZSBcIlJPdmVyXCIgaW4gdGhlaXIgbmFtZS5cbiAqIGRiLnNlbGVjdCgpLmZyb20oY2FycylcbiAqICAgLndoZXJlKG5vdExpa2UoY2Fycy5uYW1lLCAnJVJvdmVyJScpKVxuICogYGBgXG4gKlxuICogQHNlZSBsaWtlIGZvciB0aGUgaW52ZXJzZSBjb25kaXRpb25cbiAqIEBzZWUgbm90SWxpa2UgZm9yIGEgY2FzZS1pbnNlbnNpdGl2ZSB2ZXJzaW9uIG9mIHRoaXMgY29uZGl0aW9uXG4gKi9cbmZ1bmN0aW9uIG5vdExpa2UoY29sdW1uLCB2YWx1ZSkge1xuICAgIHJldHVybiBzcWwgYCR7Y29sdW1ufSBub3QgbGlrZSAke3ZhbHVlfWA7XG59XG4vKipcbiAqIENhc2UtaW5zZW5zaXRpdmVseSBjb21wYXJlIGEgY29sdW1uIHRvIGEgcGF0dGVybixcbiAqIHdoaWNoIGNhbiBpbmNsdWRlIGAlYCBhbmQgYF9gXG4gKiBjaGFyYWN0ZXJzIHRvIG1hdGNoIG11bHRpcGxlIHZhcmlhdGlvbnMuIEluY2x1ZGluZyBgJWBcbiAqIGluIHRoZSBwYXR0ZXJuIG1hdGNoZXMgemVybyBvciBtb3JlIGNoYXJhY3RlcnMsIGFuZCBpbmNsdWRpbmdcbiAqIGBfYCB3aWxsIG1hdGNoIGEgc2luZ2xlIGNoYXJhY3Rlci5cbiAqXG4gKiBVbmxpa2UgbGlrZSwgdGhpcyBwZXJmb3JtcyBhIGNhc2UtaW5zZW5zaXRpdmUgY29tcGFyaXNvbi5cbiAqXG4gKiAjIyBFeGFtcGxlc1xuICpcbiAqIGBgYHRzXG4gKiAvLyBTZWxlY3QgYWxsIGNhcnMgd2l0aCAnVHVyYm8nIGluIHRoZWlyIG5hbWVzLlxuICogZGIuc2VsZWN0KCkuZnJvbShjYXJzKVxuICogICAud2hlcmUoaWxpa2UoY2Fycy5uYW1lLCAnJVR1cmJvJScpKVxuICogYGBgXG4gKlxuICogQHNlZSBsaWtlIGZvciBhIGNhc2Utc2Vuc2l0aXZlIHZlcnNpb24gb2YgdGhpcyBjb25kaXRpb25cbiAqL1xuZnVuY3Rpb24gaWxpa2UoY29sdW1uLCB2YWx1ZSkge1xuICAgIHJldHVybiBzcWwgYCR7Y29sdW1ufSBpbGlrZSAke3ZhbHVlfWA7XG59XG4vKipcbiAqIFRoZSBpbnZlcnNlIG9mIGlsaWtlIC0gdGhpcyBjYXNlLWluc2Vuc2l0aXZlbHkgdGVzdHMgdGhhdCBhIGdpdmVuIGNvbHVtblxuICogZG9lcyBub3QgbWF0Y2ggYSBwYXR0ZXJuLCB3aGljaCBjYW4gaW5jbHVkZSBgJWAgYW5kIGBfYFxuICogY2hhcmFjdGVycyB0byBtYXRjaCBtdWx0aXBsZSB2YXJpYXRpb25zLiBJbmNsdWRpbmcgYCVgXG4gKiBpbiB0aGUgcGF0dGVybiBtYXRjaGVzIHplcm8gb3IgbW9yZSBjaGFyYWN0ZXJzLCBhbmQgaW5jbHVkaW5nXG4gKiBgX2Agd2lsbCBtYXRjaCBhIHNpbmdsZSBjaGFyYWN0ZXIuXG4gKlxuICogIyMgRXhhbXBsZXNcbiAqXG4gKiBgYGB0c1xuICogLy8gU2VsZWN0IGFsbCBjYXJzIHRoYXQgZG9uJ3QgaGF2ZSBcIlJvdmVyXCIgaW4gdGhlaXIgbmFtZS5cbiAqIGRiLnNlbGVjdCgpLmZyb20oY2FycylcbiAqICAgLndoZXJlKG5vdExpa2UoY2Fycy5uYW1lLCAnJVJvdmVyJScpKVxuICogYGBgXG4gKlxuICogQHNlZSBpbGlrZSBmb3IgdGhlIGludmVyc2UgY29uZGl0aW9uXG4gKiBAc2VlIG5vdExpa2UgZm9yIGEgY2FzZS1zZW5zaXRpdmUgdmVyc2lvbiBvZiB0aGlzIGNvbmRpdGlvblxuICovXG5mdW5jdGlvbiBub3RJbGlrZShjb2x1bW4sIHZhbHVlKSB7XG4gICAgcmV0dXJuIHNxbCBgJHtjb2x1bW59IG5vdCBpbGlrZSAke3ZhbHVlfWA7XG59XG5mdW5jdGlvbiBhcnJheUNvbnRhaW5zKGNvbHVtbiwgdmFsdWVzKSB7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWVzKSkge1xuICAgICAgICBpZiAodmFsdWVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdhcnJheUNvbnRhaW5zIHJlcXVpcmVzIGF0IGxlYXN0IG9uZSB2YWx1ZScpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGFycmF5ID0gc3FsIGAke2JpbmRJZlBhcmFtKHZhbHVlcywgY29sdW1uKX1gO1xuICAgICAgICByZXR1cm4gc3FsIGAke2NvbHVtbn0gQD4gJHthcnJheX1gO1xuICAgIH1cbiAgICByZXR1cm4gc3FsIGAke2NvbHVtbn0gQD4gJHtiaW5kSWZQYXJhbSh2YWx1ZXMsIGNvbHVtbil9YDtcbn1cbmZ1bmN0aW9uIGFycmF5Q29udGFpbmVkKGNvbHVtbiwgdmFsdWVzKSB7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWVzKSkge1xuICAgICAgICBpZiAodmFsdWVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdhcnJheUNvbnRhaW5lZCByZXF1aXJlcyBhdCBsZWFzdCBvbmUgdmFsdWUnKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBhcnJheSA9IHNxbCBgJHtiaW5kSWZQYXJhbSh2YWx1ZXMsIGNvbHVtbil9YDtcbiAgICAgICAgcmV0dXJuIHNxbCBgJHtjb2x1bW59IDxAICR7YXJyYXl9YDtcbiAgICB9XG4gICAgcmV0dXJuIHNxbCBgJHtjb2x1bW59IDxAICR7YmluZElmUGFyYW0odmFsdWVzLCBjb2x1bW4pfWA7XG59XG5mdW5jdGlvbiBhcnJheU92ZXJsYXBzKGNvbHVtbiwgdmFsdWVzKSB7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWVzKSkge1xuICAgICAgICBpZiAodmFsdWVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdhcnJheU92ZXJsYXBzIHJlcXVpcmVzIGF0IGxlYXN0IG9uZSB2YWx1ZScpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGFycmF5ID0gc3FsIGAke2JpbmRJZlBhcmFtKHZhbHVlcywgY29sdW1uKX1gO1xuICAgICAgICByZXR1cm4gc3FsIGAke2NvbHVtbn0gJiYgJHthcnJheX1gO1xuICAgIH1cbiAgICByZXR1cm4gc3FsIGAke2NvbHVtbn0gJiYgJHtiaW5kSWZQYXJhbSh2YWx1ZXMsIGNvbHVtbil9YDtcbn1cblxuLyoqXG4gKiBVc2VkIGluIHNvcnRpbmcsIHRoaXMgc3BlY2lmaWVzIHRoYXQgdGhlIGdpdmVuXG4gKiBjb2x1bW4gb3IgZXhwcmVzc2lvbiBzaG91bGQgYmUgc29ydGVkIGluIGFzY2VuZGluZ1xuICogb3JkZXIuIEJ5IHRoZSBTUUwgc3RhbmRhcmQsIGFzY2VuZGluZyBvcmRlciBpcyB0aGVcbiAqIGRlZmF1bHQsIHNvIGl0IGlzIG5vdCB1c3VhbGx5IG5lY2Vzc2FyeSB0byBzcGVjaWZ5XG4gKiBhc2NlbmRpbmcgc29ydCBvcmRlci5cbiAqXG4gKiAjIyBFeGFtcGxlc1xuICpcbiAqIGBgYHRzXG4gKiAvLyBSZXR1cm4gY2Fycywgc3RhcnRpbmcgd2l0aCB0aGUgb2xkZXN0IG1vZGVsc1xuICogLy8gYW5kIGdvaW5nIGluIGFzY2VuZGluZyBvcmRlciB0byB0aGUgbmV3ZXN0LlxuICogZGIuc2VsZWN0KCkuZnJvbShjYXJzKVxuICogICAub3JkZXJCeShhc2MoY2Fycy55ZWFyKSk7XG4gKiBgYGBcbiAqXG4gKiBAc2VlIGRlc2MgdG8gc29ydCBpbiBkZXNjZW5kaW5nIG9yZGVyXG4gKi9cbmZ1bmN0aW9uIGFzYyhjb2x1bW4pIHtcbiAgICByZXR1cm4gc3FsIGAke2NvbHVtbn0gYXNjYDtcbn1cbi8qKlxuICogVXNlZCBpbiBzb3J0aW5nLCB0aGlzIHNwZWNpZmllcyB0aGF0IHRoZSBnaXZlblxuICogY29sdW1uIG9yIGV4cHJlc3Npb24gc2hvdWxkIGJlIHNvcnRlZCBpbiBkZXNjZW5kaW5nXG4gKiBvcmRlci5cbiAqXG4gKiAjIyBFeGFtcGxlc1xuICpcbiAqIGBgYHRzXG4gKiAvLyBTZWxlY3QgdXNlcnMsIHdpdGggdGhlIG1vc3QgcmVjZW50bHkgY3JlYXRlZFxuICogLy8gcmVjb3JkcyBjb21pbmcgZmlyc3QuXG4gKiBkYi5zZWxlY3QoKS5mcm9tKHVzZXJzKVxuICogICAub3JkZXJCeShkZXNjKHVzZXJzLmNyZWF0ZWRBdCkpO1xuICogYGBgXG4gKlxuICogQHNlZSBhc2MgdG8gc29ydCBpbiBhc2NlbmRpbmcgb3JkZXJcbiAqL1xuZnVuY3Rpb24gZGVzYyhjb2x1bW4pIHtcbiAgICByZXR1cm4gc3FsIGAke2NvbHVtbn0gZGVzY2A7XG59XG5cbi8qKlxuICogVGhpcyBjbGFzcyBpcyB1c2VkIHRvIGluZGljYXRlIGEgcHJpbWl0aXZlIHBhcmFtIHZhbHVlIHRoYXQgaXMgdXNlZCBpbiBgc3FsYCB0YWcuXG4gKiBJdCBpcyBvbmx5IHVzZWQgb24gdHlwZSBsZXZlbCBhbmQgaXMgbmV2ZXIgaW5zdGFudGlhdGVkIGF0IHJ1bnRpbWUuXG4gKiBJZiB5b3Ugc2VlIGEgdmFsdWUgb2YgdGhpcyB0eXBlIGluIHRoZSBjb2RlLCBpdHMgcnVudGltZSB2YWx1ZSBpcyBhY3R1YWxseSB0aGUgcHJpbWl0aXZlIHBhcmFtIHZhbHVlLlxuICovXG5jbGFzcyBGYWtlUHJpbWl0aXZlUGFyYW0ge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnRmFrZVByaW1pdGl2ZVBhcmFtJztcbn1cbmZ1bmN0aW9uIGlzU1FMV3JhcHBlcih2YWx1ZSkge1xuICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICE9PSBudWxsICYmICdnZXRTUUwnIGluIHZhbHVlXG4gICAgICAgICYmIHR5cGVvZiB2YWx1ZS5nZXRTUUwgPT09ICdmdW5jdGlvbic7XG59XG5mdW5jdGlvbiBtZXJnZVF1ZXJpZXMocXVlcmllcykge1xuICAgIGNvbnN0IHJlc3VsdCA9IHsgc3FsOiAnJywgcGFyYW1zOiBbXSB9O1xuICAgIGZvciAoY29uc3QgcXVlcnkgb2YgcXVlcmllcykge1xuICAgICAgICByZXN1bHQuc3FsICs9IHF1ZXJ5LnNxbDtcbiAgICAgICAgcmVzdWx0LnBhcmFtcy5wdXNoKC4uLnF1ZXJ5LnBhcmFtcyk7XG4gICAgICAgIGlmIChxdWVyeS50eXBpbmdzPy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGlmICghcmVzdWx0LnR5cGluZ3MpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQudHlwaW5ncyA9IFtdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmVzdWx0LnR5cGluZ3MucHVzaCguLi5xdWVyeS50eXBpbmdzKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xufVxuY2xhc3MgU3RyaW5nQ2h1bmsge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnU3RyaW5nQ2h1bmsnO1xuICAgIHZhbHVlO1xuICAgIGNvbnN0cnVjdG9yKHZhbHVlKSB7XG4gICAgICAgIHRoaXMudmFsdWUgPSBBcnJheS5pc0FycmF5KHZhbHVlKSA/IHZhbHVlIDogW3ZhbHVlXTtcbiAgICB9XG4gICAgZ2V0U1FMKCkge1xuICAgICAgICByZXR1cm4gbmV3IFNRTChbdGhpc10pO1xuICAgIH1cbn1cbmNsYXNzIFNRTCB7XG4gICAgcXVlcnlDaHVua3M7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdTUUwnO1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBkZWNvZGVyID0gbm9vcERlY29kZXI7XG4gICAgc2hvdWxkSW5saW5lUGFyYW1zID0gZmFsc2U7XG4gICAgY29uc3RydWN0b3IocXVlcnlDaHVua3MpIHtcbiAgICAgICAgdGhpcy5xdWVyeUNodW5rcyA9IHF1ZXJ5Q2h1bmtzO1xuICAgIH1cbiAgICBhcHBlbmQocXVlcnkpIHtcbiAgICAgICAgdGhpcy5xdWVyeUNodW5rcy5wdXNoKC4uLnF1ZXJ5LnF1ZXJ5Q2h1bmtzKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIHRvUXVlcnkoY29uZmlnKSB7XG4gICAgICAgIHJldHVybiB0cmFjZXIuc3RhcnRBY3RpdmVTcGFuKCdkcml6emxlLmJ1aWxkU1FMJywgKHNwYW4pID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHF1ZXJ5ID0gdGhpcy5idWlsZFF1ZXJ5RnJvbVNvdXJjZVBhcmFtcyh0aGlzLnF1ZXJ5Q2h1bmtzLCBjb25maWcpO1xuICAgICAgICAgICAgc3Bhbj8uc2V0QXR0cmlidXRlcyh7XG4gICAgICAgICAgICAgICAgJ2RyaXp6bGUucXVlcnkudGV4dCc6IHF1ZXJ5LnNxbCxcbiAgICAgICAgICAgICAgICAnZHJpenpsZS5xdWVyeS5wYXJhbXMnOiBKU09OLnN0cmluZ2lmeShxdWVyeS5wYXJhbXMpLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gcXVlcnk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBidWlsZFF1ZXJ5RnJvbVNvdXJjZVBhcmFtcyhjaHVua3MsIF9jb25maWcpIHtcbiAgICAgICAgY29uc3QgY29uZmlnID0gT2JqZWN0LmFzc2lnbih7fSwgX2NvbmZpZywge1xuICAgICAgICAgICAgaW5saW5lUGFyYW1zOiBfY29uZmlnLmlubGluZVBhcmFtcyB8fCB0aGlzLnNob3VsZElubGluZVBhcmFtcyxcbiAgICAgICAgICAgIHBhcmFtU3RhcnRJbmRleDogX2NvbmZpZy5wYXJhbVN0YXJ0SW5kZXggfHwgeyB2YWx1ZTogMCB9LFxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgeyBlc2NhcGVOYW1lLCBlc2NhcGVQYXJhbSwgcHJlcGFyZVR5cGluZywgaW5saW5lUGFyYW1zLCBwYXJhbVN0YXJ0SW5kZXgsIH0gPSBjb25maWc7XG4gICAgICAgIHJldHVybiBtZXJnZVF1ZXJpZXMoY2h1bmtzLm1hcCgoY2h1bmspID0+IHtcbiAgICAgICAgICAgIGlmIChpcyhjaHVuaywgU3RyaW5nQ2h1bmspKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgc3FsOiBjaHVuay52YWx1ZS5qb2luKCcnKSwgcGFyYW1zOiBbXSB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGlzKGNodW5rLCBOYW1lKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB7IHNxbDogZXNjYXBlTmFtZShjaHVuay52YWx1ZSksIHBhcmFtczogW10gfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjaHVuayA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgc3FsOiAnJywgcGFyYW1zOiBbXSB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoY2h1bmspKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gW25ldyBTdHJpbmdDaHVuaygnKCcpXTtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IFtpLCBwXSBvZiBjaHVuay5lbnRyaWVzKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gocCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpIDwgY2h1bmsubGVuZ3RoIC0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gobmV3IFN0cmluZ0NodW5rKCcsICcpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaChuZXcgU3RyaW5nQ2h1bmsoJyknKSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYnVpbGRRdWVyeUZyb21Tb3VyY2VQYXJhbXMocmVzdWx0LCBjb25maWcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGlzKGNodW5rLCBTUUwpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYnVpbGRRdWVyeUZyb21Tb3VyY2VQYXJhbXMoY2h1bmsucXVlcnlDaHVua3MsIHtcbiAgICAgICAgICAgICAgICAgICAgLi4uY29uZmlnLFxuICAgICAgICAgICAgICAgICAgICBpbmxpbmVQYXJhbXM6IGlubGluZVBhcmFtcyB8fCBjaHVuay5zaG91bGRJbmxpbmVQYXJhbXMsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaXMoY2h1bmssIFRhYmxlKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHNjaGVtYU5hbWUgPSBjaHVua1tUYWJsZS5TeW1ib2wuU2NoZW1hXTtcbiAgICAgICAgICAgICAgICBjb25zdCB0YWJsZU5hbWUgPSBjaHVua1tUYWJsZS5TeW1ib2wuTmFtZV07XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgc3FsOiBzY2hlbWFOYW1lID09PSB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICAgICAgICAgID8gZXNjYXBlTmFtZSh0YWJsZU5hbWUpXG4gICAgICAgICAgICAgICAgICAgICAgICA6IGVzY2FwZU5hbWUoc2NoZW1hTmFtZSkgKyAnLicgKyBlc2NhcGVOYW1lKHRhYmxlTmFtZSksXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtczogW10sXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpcyhjaHVuaywgQ29sdW1uKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB7IHNxbDogZXNjYXBlTmFtZShjaHVuay50YWJsZVtUYWJsZS5TeW1ib2wuTmFtZV0pICsgJy4nICsgZXNjYXBlTmFtZShjaHVuay5uYW1lKSwgcGFyYW1zOiBbXSB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGlzKGNodW5rLCBWaWV3KSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHNjaGVtYU5hbWUgPSBjaHVua1tWaWV3QmFzZUNvbmZpZ10uc2NoZW1hO1xuICAgICAgICAgICAgICAgIGNvbnN0IHZpZXdOYW1lID0gY2h1bmtbVmlld0Jhc2VDb25maWddLm5hbWU7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgc3FsOiBzY2hlbWFOYW1lID09PSB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICAgICAgICAgID8gZXNjYXBlTmFtZSh2aWV3TmFtZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIDogZXNjYXBlTmFtZShzY2hlbWFOYW1lKSArICcuJyArIGVzY2FwZU5hbWUodmlld05hbWUpLFxuICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IFtdLFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaXMoY2h1bmssIFBhcmFtKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IG1hcHBlZFZhbHVlID0gKGNodW5rLnZhbHVlID09PSBudWxsKSA/IG51bGwgOiBjaHVuay5lbmNvZGVyLm1hcFRvRHJpdmVyVmFsdWUoY2h1bmsudmFsdWUpO1xuICAgICAgICAgICAgICAgIGlmIChpcyhtYXBwZWRWYWx1ZSwgU1FMKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5idWlsZFF1ZXJ5RnJvbVNvdXJjZVBhcmFtcyhbbWFwcGVkVmFsdWVdLCBjb25maWcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoaW5saW5lUGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7IHNxbDogdGhpcy5tYXBJbmxpbmVQYXJhbShtYXBwZWRWYWx1ZSwgY29uZmlnKSwgcGFyYW1zOiBbXSB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBsZXQgdHlwaW5ncztcbiAgICAgICAgICAgICAgICBpZiAocHJlcGFyZVR5cGluZyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGluZ3MgPSBbcHJlcGFyZVR5cGluZyhjaHVuay5lbmNvZGVyKV07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB7IHNxbDogZXNjYXBlUGFyYW0ocGFyYW1TdGFydEluZGV4LnZhbHVlKyssIG1hcHBlZFZhbHVlKSwgcGFyYW1zOiBbbWFwcGVkVmFsdWVdLCB0eXBpbmdzIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaXMoY2h1bmssIFBsYWNlaG9sZGVyKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB7IHNxbDogZXNjYXBlUGFyYW0ocGFyYW1TdGFydEluZGV4LnZhbHVlKyssIGNodW5rKSwgcGFyYW1zOiBbY2h1bmtdIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaXMoY2h1bmssIFNRTC5BbGlhc2VkKSAmJiBjaHVuay5maWVsZEFsaWFzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4geyBzcWw6IGVzY2FwZU5hbWUoY2h1bmsuZmllbGRBbGlhcyksIHBhcmFtczogW10gfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpcyhjaHVuaywgU3VicXVlcnkpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGNodW5rW1N1YnF1ZXJ5Q29uZmlnXS5pc1dpdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgc3FsOiBlc2NhcGVOYW1lKGNodW5rW1N1YnF1ZXJ5Q29uZmlnXS5hbGlhcyksIHBhcmFtczogW10gfTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYnVpbGRRdWVyeUZyb21Tb3VyY2VQYXJhbXMoW1xuICAgICAgICAgICAgICAgICAgICBuZXcgU3RyaW5nQ2h1bmsoJygnKSxcbiAgICAgICAgICAgICAgICAgICAgY2h1bmtbU3VicXVlcnlDb25maWddLnNxbCxcbiAgICAgICAgICAgICAgICAgICAgbmV3IFN0cmluZ0NodW5rKCcpICcpLFxuICAgICAgICAgICAgICAgICAgICBuZXcgTmFtZShjaHVua1tTdWJxdWVyeUNvbmZpZ10uYWxpYXMpLFxuICAgICAgICAgICAgICAgIF0sIGNvbmZpZyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBpZiAoaXMoY2h1bmssIFBsYWNlaG9sZGVyKSkge1xuICAgICAgICAgICAgLy8gXHRyZXR1cm4ge3NxbDogZXNjYXBlUGFyYW19XG4gICAgICAgICAgICBpZiAoaXNTUUxXcmFwcGVyKGNodW5rKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmJ1aWxkUXVlcnlGcm9tU291cmNlUGFyYW1zKFtcbiAgICAgICAgICAgICAgICAgICAgbmV3IFN0cmluZ0NodW5rKCcoJyksXG4gICAgICAgICAgICAgICAgICAgIGNodW5rLmdldFNRTCgpLFxuICAgICAgICAgICAgICAgICAgICBuZXcgU3RyaW5nQ2h1bmsoJyknKSxcbiAgICAgICAgICAgICAgICBdLCBjb25maWcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGlzKGNodW5rLCBSZWxhdGlvbikpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5idWlsZFF1ZXJ5RnJvbVNvdXJjZVBhcmFtcyhbXG4gICAgICAgICAgICAgICAgICAgIGNodW5rLnNvdXJjZVRhYmxlLFxuICAgICAgICAgICAgICAgICAgICBuZXcgU3RyaW5nQ2h1bmsoJy4nKSxcbiAgICAgICAgICAgICAgICAgICAgc3FsLmlkZW50aWZpZXIoY2h1bmsuZmllbGROYW1lKSxcbiAgICAgICAgICAgICAgICBdLCBjb25maWcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGlubGluZVBhcmFtcykge1xuICAgICAgICAgICAgICAgIHJldHVybiB7IHNxbDogdGhpcy5tYXBJbmxpbmVQYXJhbShjaHVuaywgY29uZmlnKSwgcGFyYW1zOiBbXSB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHsgc3FsOiBlc2NhcGVQYXJhbShwYXJhbVN0YXJ0SW5kZXgudmFsdWUrKywgY2h1bmspLCBwYXJhbXM6IFtjaHVua10gfTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBtYXBJbmxpbmVQYXJhbShjaHVuaywgeyBlc2NhcGVTdHJpbmcgfSkge1xuICAgICAgICBpZiAoY2h1bmsgPT09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiAnbnVsbCc7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiBjaHVuayA9PT0gJ251bWJlcicgfHwgdHlwZW9mIGNodW5rID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgIHJldHVybiBjaHVuay50b1N0cmluZygpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2YgY2h1bmsgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICByZXR1cm4gZXNjYXBlU3RyaW5nKGNodW5rKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIGNodW5rID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgY29uc3QgbWFwcGVkVmFsdWVBc1N0cmluZyA9IGNodW5rLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICBpZiAobWFwcGVkVmFsdWVBc1N0cmluZyA9PT0gJ1tvYmplY3QgT2JqZWN0XScpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZXNjYXBlU3RyaW5nKEpTT04uc3RyaW5naWZ5KGNodW5rKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZXNjYXBlU3RyaW5nKG1hcHBlZFZhbHVlQXNTdHJpbmcpO1xuICAgICAgICB9XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignVW5leHBlY3RlZCBwYXJhbSB2YWx1ZTogJyArIGNodW5rKTtcbiAgICB9XG4gICAgZ2V0U1FMKCkge1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgYXMoYWxpYXMpIHtcbiAgICAgICAgLy8gVE9ETzogcmVtb3ZlIHdpdGggZGVwcmVjYXRlZCBvdmVybG9hZHNcbiAgICAgICAgaWYgKGFsaWFzID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgU1FMLkFsaWFzZWQodGhpcywgYWxpYXMpO1xuICAgIH1cbiAgICBtYXBXaXRoKGRlY29kZXIpIHtcbiAgICAgICAgdGhpcy5kZWNvZGVyID0gdHlwZW9mIGRlY29kZXIgPT09ICdmdW5jdGlvbicgPyB7IG1hcEZyb21Ecml2ZXJWYWx1ZTogZGVjb2RlciB9IDogZGVjb2RlcjtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIGlubGluZVBhcmFtcygpIHtcbiAgICAgICAgdGhpcy5zaG91bGRJbmxpbmVQYXJhbXMgPSB0cnVlO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG59XG4vKipcbiAqIEFueSBEQiBuYW1lICh0YWJsZSwgY29sdW1uLCBpbmRleCBldGMuKVxuICovXG5jbGFzcyBOYW1lIHtcbiAgICB2YWx1ZTtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ05hbWUnO1xuICAgIGJyYW5kO1xuICAgIGNvbnN0cnVjdG9yKHZhbHVlKSB7XG4gICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTtcbiAgICB9XG4gICAgZ2V0U1FMKCkge1xuICAgICAgICByZXR1cm4gbmV3IFNRTChbdGhpc10pO1xuICAgIH1cbn1cbi8qKlxuICogQW55IERCIG5hbWUgKHRhYmxlLCBjb2x1bW4sIGluZGV4IGV0Yy4pXG4gKiBAZGVwcmVjYXRlZCBVc2UgYHNxbC5pZGVudGlmaWVyYCBpbnN0ZWFkLlxuICovXG5mdW5jdGlvbiBuYW1lKHZhbHVlKSB7XG4gICAgcmV0dXJuIG5ldyBOYW1lKHZhbHVlKTtcbn1cbmZ1bmN0aW9uIGlzRHJpdmVyVmFsdWVFbmNvZGVyKHZhbHVlKSB7XG4gICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgIT09IG51bGwgJiYgJ21hcFRvRHJpdmVyVmFsdWUnIGluIHZhbHVlXG4gICAgICAgICYmIHR5cGVvZiB2YWx1ZS5tYXBUb0RyaXZlclZhbHVlID09PSAnZnVuY3Rpb24nO1xufVxuY29uc3Qgbm9vcERlY29kZXIgPSB7XG4gICAgbWFwRnJvbURyaXZlclZhbHVlOiAodmFsdWUpID0+IHZhbHVlLFxufTtcbmNvbnN0IG5vb3BFbmNvZGVyID0ge1xuICAgIG1hcFRvRHJpdmVyVmFsdWU6ICh2YWx1ZSkgPT4gdmFsdWUsXG59O1xuY29uc3Qgbm9vcE1hcHBlciA9IHtcbiAgICAuLi5ub29wRGVjb2RlcixcbiAgICAuLi5ub29wRW5jb2Rlcixcbn07XG4vKiogUGFyYW1ldGVyIHZhbHVlIHRoYXQgaXMgb3B0aW9uYWxseSBib3VuZCB0byBhbiBlbmNvZGVyIChmb3IgZXhhbXBsZSwgYSBjb2x1bW4pLiAqL1xuY2xhc3MgUGFyYW0ge1xuICAgIHZhbHVlO1xuICAgIGVuY29kZXI7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdQYXJhbSc7XG4gICAgYnJhbmQ7XG4gICAgLyoqXG4gICAgICogQHBhcmFtIHZhbHVlIC0gUGFyYW1ldGVyIHZhbHVlXG4gICAgICogQHBhcmFtIGVuY29kZXIgLSBFbmNvZGVyIHRvIGNvbnZlcnQgdGhlIHZhbHVlIHRvIGEgZHJpdmVyIHBhcmFtZXRlclxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKHZhbHVlLCBlbmNvZGVyID0gbm9vcEVuY29kZXIpIHtcbiAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlO1xuICAgICAgICB0aGlzLmVuY29kZXIgPSBlbmNvZGVyO1xuICAgIH1cbiAgICBnZXRTUUwoKSB7XG4gICAgICAgIHJldHVybiBuZXcgU1FMKFt0aGlzXSk7XG4gICAgfVxufVxuLyoqIEBkZXByZWNhdGVkIFVzZSBgc3FsLnBhcmFtYCBpbnN0ZWFkLiAqL1xuZnVuY3Rpb24gcGFyYW0odmFsdWUsIGVuY29kZXIpIHtcbiAgICByZXR1cm4gbmV3IFBhcmFtKHZhbHVlLCBlbmNvZGVyKTtcbn1cbi8qXG4gICAgVGhlIHR5cGUgb2YgYHBhcmFtc2AgaXMgc3BlY2lmaWVkIGFzIGBTUUxTb3VyY2VQYXJhbVtdYCwgYnV0IHRoYXQncyBzbGlnaHRseSBpbmNvcnJlY3QgLVxuICAgIGluIHJ1bnRpbWUsIHVzZXJzIHdvbid0IHBhc3MgYEZha2VQcmltaXRpdmVQYXJhbWAgaW5zdGFuY2VzIGFzIGBwYXJhbXNgIC0gdGhleSB3aWxsIHBhc3MgcHJpbWl0aXZlIHZhbHVlc1xuICAgIHdoaWNoIHdpbGwgYmUgd3JhcHBlZCBpbiBgUGFyYW1gIHVzaW5nIGBidWlsZENodW5rc0Zyb21QYXJhbSguLi4pYC4gVGhhdCdzIHdoeSB0aGUgb3ZlcmxvYWRcbiAgICBzcGVjaWZ5IGBwYXJhbXNgIGFzIGBhbnlbXWAgYW5kIG5vdCBhcyBgU1FMU291cmNlUGFyYW1bXWAuIFRoaXMgdHlwZSBpcyB1c2VkIHRvIG1ha2Ugb3VyIGxpdmVzIGVhc2llciBhbmRcbiAgICB0aGUgdHlwZSBjaGVja2VyIGhhcHB5LlxuKi9cbmZ1bmN0aW9uIHNxbChzdHJpbmdzLCAuLi5wYXJhbXMpIHtcbiAgICBjb25zdCBxdWVyeUNodW5rcyA9IFtdO1xuICAgIGlmIChwYXJhbXMubGVuZ3RoID4gMCB8fCAoc3RyaW5ncy5sZW5ndGggPiAwICYmIHN0cmluZ3NbMF0gIT09ICcnKSkge1xuICAgICAgICBxdWVyeUNodW5rcy5wdXNoKG5ldyBTdHJpbmdDaHVuayhzdHJpbmdzWzBdKSk7XG4gICAgfVxuICAgIGZvciAoY29uc3QgW3BhcmFtSW5kZXgsIHBhcmFtXSBvZiBwYXJhbXMuZW50cmllcygpKSB7XG4gICAgICAgIHF1ZXJ5Q2h1bmtzLnB1c2gocGFyYW0sIG5ldyBTdHJpbmdDaHVuayhzdHJpbmdzW3BhcmFtSW5kZXggKyAxXSkpO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IFNRTChxdWVyeUNodW5rcyk7XG59XG4oZnVuY3Rpb24gKHNxbCkge1xuICAgIGZ1bmN0aW9uIGVtcHR5KCkge1xuICAgICAgICByZXR1cm4gbmV3IFNRTChbXSk7XG4gICAgfVxuICAgIHNxbC5lbXB0eSA9IGVtcHR5O1xuICAgIC8qKiBAZGVwcmVjYXRlZCAtIHVzZSBgc3FsLmpvaW4oKWAgKi9cbiAgICBmdW5jdGlvbiBmcm9tTGlzdChsaXN0KSB7XG4gICAgICAgIHJldHVybiBuZXcgU1FMKGxpc3QpO1xuICAgIH1cbiAgICBzcWwuZnJvbUxpc3QgPSBmcm9tTGlzdDtcbiAgICAvKipcbiAgICAgKiBDb252ZW5pZW5jZSBmdW5jdGlvbiB0byBjcmVhdGUgYW4gU1FMIHF1ZXJ5IGZyb20gYSByYXcgc3RyaW5nLlxuICAgICAqIEBwYXJhbSBzdHIgVGhlIHJhdyBTUUwgcXVlcnkgc3RyaW5nLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHJhdyhzdHIpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTUUwoW25ldyBTdHJpbmdDaHVuayhzdHIpXSk7XG4gICAgfVxuICAgIHNxbC5yYXcgPSByYXc7XG4gICAgLyoqXG4gICAgICogSm9pbiBhIGxpc3Qgb2YgU1FMIGNodW5rcyB3aXRoIGEgc2VwYXJhdG9yLlxuICAgICAqIEBleGFtcGxlXG4gICAgICogYGBgdHNcbiAgICAgKiBjb25zdCBxdWVyeSA9IHNxbC5qb2luKFtzcWxgYWAsIHNxbGBiYCwgc3FsYGNgXSk7XG4gICAgICogLy8gc3FsYGFiY2BcbiAgICAgKiBgYGBcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIGBgYHRzXG4gICAgICogY29uc3QgcXVlcnkgPSBzcWwuam9pbihbc3FsYGFgLCBzcWxgYmAsIHNxbGBjYF0sIHNxbGAsIGApO1xuICAgICAqIC8vIHNxbGBhLCBiLCBjYFxuICAgICAqIGBgYFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGpvaW4oY2h1bmtzLCBzZXBhcmF0b3IpIHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gW107XG4gICAgICAgIGZvciAoY29uc3QgW2ksIGNodW5rXSBvZiBjaHVua3MuZW50cmllcygpKSB7XG4gICAgICAgICAgICBpZiAoaSA+IDAgJiYgc2VwYXJhdG9yICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaChzZXBhcmF0b3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmVzdWx0LnB1c2goY2h1bmspO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgU1FMKHJlc3VsdCk7XG4gICAgfVxuICAgIHNxbC5qb2luID0gam9pbjtcbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBTUUwgY2h1bmsgdGhhdCByZXByZXNlbnRzIGEgREIgaWRlbnRpZmllciAodGFibGUsIGNvbHVtbiwgaW5kZXggZXRjLikuXG4gICAgICogV2hlbiB1c2VkIGluIGEgcXVlcnksIHRoZSBpZGVudGlmaWVyIHdpbGwgYmUgZXNjYXBlZCBiYXNlZCBvbiB0aGUgREIgZW5naW5lLlxuICAgICAqIEZvciBleGFtcGxlLCBpbiBQb3N0Z3JlU1FMLCBpZGVudGlmaWVycyBhcmUgZXNjYXBlZCB3aXRoIGRvdWJsZSBxdW90ZXMuXG4gICAgICpcbiAgICAgKiAqKldBUk5JTkc6IFRoaXMgZnVuY3Rpb24gZG9lcyBub3Qgb2ZmZXIgYW55IHByb3RlY3Rpb24gYWdhaW5zdCBTUUwgaW5qZWN0aW9ucywgc28geW91IG11c3QgdmFsaWRhdGUgYW55IHVzZXIgaW5wdXQgYmVmb3JlaGFuZC4qKlxuICAgICAqXG4gICAgICogQGV4YW1wbGUgYGBgdHNcbiAgICAgKiBjb25zdCBxdWVyeSA9IHNxbGBTRUxFQ1QgKiBGUk9NICR7c3FsLmlkZW50aWZpZXIoJ215LXRhYmxlJyl9YDtcbiAgICAgKiAvLyAnU0VMRUNUICogRlJPTSBcIm15LXRhYmxlXCInXG4gICAgICogYGBgXG4gICAgICovXG4gICAgZnVuY3Rpb24gaWRlbnRpZmllcih2YWx1ZSkge1xuICAgICAgICByZXR1cm4gbmV3IE5hbWUodmFsdWUpO1xuICAgIH1cbiAgICBzcWwuaWRlbnRpZmllciA9IGlkZW50aWZpZXI7XG4gICAgZnVuY3Rpb24gcGxhY2Vob2xkZXIobmFtZSkge1xuICAgICAgICByZXR1cm4gbmV3IFBsYWNlaG9sZGVyKG5hbWUpO1xuICAgIH1cbiAgICBzcWwucGxhY2Vob2xkZXIgPSBwbGFjZWhvbGRlcjtcbiAgICBmdW5jdGlvbiBwYXJhbSh2YWx1ZSwgZW5jb2Rlcikge1xuICAgICAgICByZXR1cm4gbmV3IFBhcmFtKHZhbHVlLCBlbmNvZGVyKTtcbiAgICB9XG4gICAgc3FsLnBhcmFtID0gcGFyYW07XG59KShzcWwgfHwgKHNxbCA9IHt9KSk7XG4oZnVuY3Rpb24gKFNRTCkge1xuICAgIGNsYXNzIEFsaWFzZWQge1xuICAgICAgICBzcWw7XG4gICAgICAgIGZpZWxkQWxpYXM7XG4gICAgICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnU1FMLkFsaWFzZWQnO1xuICAgICAgICAvKiogQGludGVybmFsICovXG4gICAgICAgIGlzU2VsZWN0aW9uRmllbGQgPSBmYWxzZTtcbiAgICAgICAgY29uc3RydWN0b3Ioc3FsLCBmaWVsZEFsaWFzKSB7XG4gICAgICAgICAgICB0aGlzLnNxbCA9IHNxbDtcbiAgICAgICAgICAgIHRoaXMuZmllbGRBbGlhcyA9IGZpZWxkQWxpYXM7XG4gICAgICAgIH1cbiAgICAgICAgZ2V0U1FMKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3FsO1xuICAgICAgICB9XG4gICAgICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICAgICAgY2xvbmUoKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IEFsaWFzZWQodGhpcy5zcWwsIHRoaXMuZmllbGRBbGlhcyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgU1FMLkFsaWFzZWQgPSBBbGlhc2VkO1xufSkoU1FMIHx8IChTUUwgPSB7fSkpO1xuY2xhc3MgUGxhY2Vob2xkZXIge1xuICAgIG5hbWU7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdQbGFjZWhvbGRlcic7XG4gICAgY29uc3RydWN0b3IobmFtZSkge1xuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgIH1cbiAgICBnZXRTUUwoKSB7XG4gICAgICAgIHJldHVybiBuZXcgU1FMKFt0aGlzXSk7XG4gICAgfVxufVxuLyoqIEBkZXByZWNhdGVkIFVzZSBgc3FsLnBsYWNlaG9sZGVyYCBpbnN0ZWFkLiAqL1xuZnVuY3Rpb24gcGxhY2Vob2xkZXIobmFtZSkge1xuICAgIHJldHVybiBuZXcgUGxhY2Vob2xkZXIobmFtZSk7XG59XG5mdW5jdGlvbiBmaWxsUGxhY2Vob2xkZXJzKHBhcmFtcywgdmFsdWVzKSB7XG4gICAgcmV0dXJuIHBhcmFtcy5tYXAoKHApID0+IHtcbiAgICAgICAgaWYgKGlzKHAsIFBsYWNlaG9sZGVyKSkge1xuICAgICAgICAgICAgaWYgKCEocC5uYW1lIGluIHZhbHVlcykpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYE5vIHZhbHVlIGZvciBwbGFjZWhvbGRlciBcIiR7cC5uYW1lfVwiIHdhcyBwcm92aWRlZGApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlc1twLm5hbWVdO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwO1xuICAgIH0pO1xufVxuLy8gRGVmaW5lZCBzZXBhcmF0ZWx5IGZyb20gdGhlIENvbHVtbiBjbGFzcyB0byByZXNvbHZlIGNpcmN1bGFyIGRlcGVuZGVuY3lcbkNvbHVtbi5wcm90b3R5cGUuZ2V0U1FMID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBuZXcgU1FMKFt0aGlzXSk7XG59O1xuXG5jbGFzcyBDb2x1bW5BbGlhc1Byb3h5SGFuZGxlciB7XG4gICAgdGFibGU7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdDb2x1bW5BbGlhc1Byb3h5SGFuZGxlcic7XG4gICAgY29uc3RydWN0b3IodGFibGUpIHtcbiAgICAgICAgdGhpcy50YWJsZSA9IHRhYmxlO1xuICAgIH1cbiAgICBnZXQoY29sdW1uT2JqLCBwcm9wKSB7XG4gICAgICAgIGlmIChwcm9wID09PSAndGFibGUnKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy50YWJsZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY29sdW1uT2JqW3Byb3BdO1xuICAgIH1cbn1cbmNsYXNzIFRhYmxlQWxpYXNQcm94eUhhbmRsZXIge1xuICAgIGFsaWFzO1xuICAgIHJlcGxhY2VPcmlnaW5hbE5hbWU7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdUYWJsZUFsaWFzUHJveHlIYW5kbGVyJztcbiAgICBjb25zdHJ1Y3RvcihhbGlhcywgcmVwbGFjZU9yaWdpbmFsTmFtZSkge1xuICAgICAgICB0aGlzLmFsaWFzID0gYWxpYXM7XG4gICAgICAgIHRoaXMucmVwbGFjZU9yaWdpbmFsTmFtZSA9IHJlcGxhY2VPcmlnaW5hbE5hbWU7XG4gICAgfVxuICAgIGdldCh0YXJnZXQsIHByb3ApIHtcbiAgICAgICAgaWYgKHByb3AgPT09IFRhYmxlLlN5bWJvbC5Jc0FsaWFzKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocHJvcCA9PT0gVGFibGUuU3ltYm9sLk5hbWUpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmFsaWFzO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnJlcGxhY2VPcmlnaW5hbE5hbWUgJiYgcHJvcCA9PT0gVGFibGUuU3ltYm9sLk9yaWdpbmFsTmFtZSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWxpYXM7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHByb3AgPT09IFZpZXdCYXNlQ29uZmlnKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnRhcmdldFtWaWV3QmFzZUNvbmZpZ10sXG4gICAgICAgICAgICAgICAgbmFtZTogdGhpcy5hbGlhcyxcbiAgICAgICAgICAgICAgICBpc0FsaWFzOiB0cnVlLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocHJvcCA9PT0gVGFibGUuU3ltYm9sLkNvbHVtbnMpIHtcbiAgICAgICAgICAgIGNvbnN0IGNvbHVtbnMgPSB0YXJnZXRbVGFibGUuU3ltYm9sLkNvbHVtbnNdO1xuICAgICAgICAgICAgaWYgKCFjb2x1bW5zKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbHVtbnM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBwcm94aWVkQ29sdW1ucyA9IHt9O1xuICAgICAgICAgICAgT2JqZWN0LmtleXMoY29sdW1ucykubWFwKChrZXkpID0+IHtcbiAgICAgICAgICAgICAgICBwcm94aWVkQ29sdW1uc1trZXldID0gbmV3IFByb3h5KGNvbHVtbnNba2V5XSwgbmV3IENvbHVtbkFsaWFzUHJveHlIYW5kbGVyKG5ldyBQcm94eSh0YXJnZXQsIHRoaXMpKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBwcm94aWVkQ29sdW1ucztcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB2YWx1ZSA9IHRhcmdldFtwcm9wXTtcbiAgICAgICAgaWYgKGlzKHZhbHVlLCBDb2x1bW4pKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb3h5KHZhbHVlLCBuZXcgQ29sdW1uQWxpYXNQcm94eUhhbmRsZXIobmV3IFByb3h5KHRhcmdldCwgdGhpcykpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgfVxufVxuY2xhc3MgUmVsYXRpb25UYWJsZUFsaWFzUHJveHlIYW5kbGVyIHtcbiAgICBhbGlhcztcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ1JlbGF0aW9uVGFibGVBbGlhc1Byb3h5SGFuZGxlcic7XG4gICAgY29uc3RydWN0b3IoYWxpYXMpIHtcbiAgICAgICAgdGhpcy5hbGlhcyA9IGFsaWFzO1xuICAgIH1cbiAgICBnZXQodGFyZ2V0LCBwcm9wKSB7XG4gICAgICAgIGlmIChwcm9wID09PSAnc291cmNlVGFibGUnKSB7XG4gICAgICAgICAgICByZXR1cm4gYWxpYXNlZFRhYmxlKHRhcmdldC5zb3VyY2VUYWJsZSwgdGhpcy5hbGlhcyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRhcmdldFtwcm9wXTtcbiAgICB9XG59XG5mdW5jdGlvbiBhbGlhc2VkVGFibGUodGFibGUsIHRhYmxlQWxpYXMpIHtcbiAgICByZXR1cm4gbmV3IFByb3h5KHRhYmxlLCBuZXcgVGFibGVBbGlhc1Byb3h5SGFuZGxlcih0YWJsZUFsaWFzLCBmYWxzZSkpO1xufVxuZnVuY3Rpb24gYWxpYXNlZFJlbGF0aW9uKHJlbGF0aW9uLCB0YWJsZUFsaWFzKSB7XG4gICAgcmV0dXJuIG5ldyBQcm94eShyZWxhdGlvbiwgbmV3IFJlbGF0aW9uVGFibGVBbGlhc1Byb3h5SGFuZGxlcih0YWJsZUFsaWFzKSk7XG59XG5mdW5jdGlvbiBhbGlhc2VkVGFibGVDb2x1bW4oY29sdW1uLCB0YWJsZUFsaWFzKSB7XG4gICAgcmV0dXJuIG5ldyBQcm94eShjb2x1bW4sIG5ldyBDb2x1bW5BbGlhc1Byb3h5SGFuZGxlcihuZXcgUHJveHkoY29sdW1uLnRhYmxlLCBuZXcgVGFibGVBbGlhc1Byb3h5SGFuZGxlcih0YWJsZUFsaWFzLCBmYWxzZSkpKSk7XG59XG5mdW5jdGlvbiBtYXBDb2x1bW5zSW5BbGlhc2VkU1FMVG9BbGlhcyhxdWVyeSwgYWxpYXMpIHtcbiAgICByZXR1cm4gbmV3IFNRTC5BbGlhc2VkKG1hcENvbHVtbnNJblNRTFRvQWxpYXMocXVlcnkuc3FsLCBhbGlhcyksIHF1ZXJ5LmZpZWxkQWxpYXMpO1xufVxuZnVuY3Rpb24gbWFwQ29sdW1uc0luU1FMVG9BbGlhcyhxdWVyeSwgYWxpYXMpIHtcbiAgICByZXR1cm4gc3FsLmpvaW4ocXVlcnkucXVlcnlDaHVua3MubWFwKChjKSA9PiB7XG4gICAgICAgIGlmIChpcyhjLCBDb2x1bW4pKSB7XG4gICAgICAgICAgICByZXR1cm4gYWxpYXNlZFRhYmxlQ29sdW1uKGMsIGFsaWFzKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXMoYywgU1FMKSkge1xuICAgICAgICAgICAgcmV0dXJuIG1hcENvbHVtbnNJblNRTFRvQWxpYXMoYywgYWxpYXMpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpcyhjLCBTUUwuQWxpYXNlZCkpIHtcbiAgICAgICAgICAgIHJldHVybiBtYXBDb2x1bW5zSW5BbGlhc2VkU1FMVG9BbGlhcyhjLCBhbGlhcyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGM7XG4gICAgfSkpO1xufVxuXG5leHBvcnQgeyBQZ0FycmF5QnVpbGRlciBhcyAkLCBnZXRPcmRlckJ5T3BlcmF0b3JzIGFzIEEsIG5vcm1hbGl6ZVJlbGF0aW9uIGFzIEIsIENvbHVtbkJ1aWxkZXIgYXMgQywgRHJpenpsZUVycm9yIGFzIEQsIGFuZCBhcyBFLCBlcSBhcyBGLCBhbGlhc2VkVGFibGUgYXMgRywgYXBwbHlNaXhpbnMgYXMgSCwgZ2V0VGFibGVDb2x1bW5zIGFzIEksIFR5cGVkUXVlcnlCdWlsZGVyIGFzIEosIGdldFRhYmxlTGlrZU5hbWUgYXMgSywgUGdDb2x1bW5CdWlsZGVyIGFzIEwsIE1hbnkgYXMgTSwgUGdDb2x1bW4gYXMgTiwgT25lIGFzIE8sIFBnRGlhbGVjdCBhcyBQLCBRdWVyeVByb21pc2UgYXMgUSwgcGdUYWJsZVdpdGhTY2hlbWEgYXMgUiwgU1FMIGFzIFMsIFRhYmxlIGFzIFQsIHBnVmlld1dpdGhTY2hlbWEgYXMgVSwgVmlld0Jhc2VDb25maWcgYXMgViwgV2l0aFN1YnF1ZXJ5IGFzIFcsIHBnTWF0ZXJpYWxpemVkVmlld1dpdGhTY2hlbWEgYXMgWCwgQ2hlY2tCdWlsZGVyIGFzIFksIENoZWNrIGFzIFosIGNoZWNrIGFzIF8sIGV4dHJhY3RUYWJsZXNSZWxhdGlvbmFsQ29uZmlnIGFzIGEsIFBnVmlldyBhcyBhJCwgUGdBcnJheSBhcyBhMCwgUGdEYXRlQnVpbGRlciBhcyBhMSwgUGdEYXRlIGFzIGEyLCBQZ0RhdGVTdHJpbmdCdWlsZGVyIGFzIGEzLCBQZ0RhdGVTdHJpbmcgYXMgYTQsIGRhdGUgYXMgYTUsIFBnSnNvbkJ1aWxkZXIgYXMgYTYsIFBnSnNvbiBhcyBhNywganNvbiBhcyBhOCwgUGdKc29uYkJ1aWxkZXIgYXMgYTksIFByaW1hcnlLZXlCdWlsZGVyIGFzIGFBLCBQcmltYXJ5S2V5IGFzIGFCLCBQZ1NlbGVjdFF1ZXJ5QnVpbGRlciBhcyBhQywgUGdTZWxlY3QgYXMgYUQsIElubGluZUZvcmVpZ25LZXlzIGFzIGFFLCBQZ1RhYmxlIGFzIGFGLCBwZ1RhYmxlIGFzIGFHLCBwZ1RhYmxlQ3JlYXRvciBhcyBhSCwgdW5pcXVlIGFzIGFJLCB1bmlxdWVLZXlOYW1lIGFzIGFKLCBVbmlxdWVDb25zdHJhaW50QnVpbGRlciBhcyBhSywgVW5pcXVlT25Db25zdHJhaW50QnVpbGRlciBhcyBhTCwgVW5pcXVlQ29uc3RyYWludCBhcyBhTSwgZ2V0VGFibGVDb25maWcgYXMgYU4sIGdldFZpZXdDb25maWcgYXMgYU8sIGdldE1hdGVyaWFsaXplZFZpZXdDb25maWcgYXMgYVAsIHBhcnNlUGdOZXN0ZWRBcnJheSBhcyBhUSwgcGFyc2VQZ0FycmF5IGFzIGFSLCBtYWtlUGdBcnJheSBhcyBhUywgRGVmYXVsdFZpZXdCdWlsZGVyQ29yZSBhcyBhVCwgVmlld0J1aWxkZXIgYXMgYVUsIE1hbnVhbFZpZXdCdWlsZGVyIGFzIGFWLCBNYXRlcmlhbGl6ZWRWaWV3QnVpbGRlckNvcmUgYXMgYVcsIE1hdGVyaWFsaXplZFZpZXdCdWlsZGVyIGFzIGFYLCBNYW51YWxNYXRlcmlhbGl6ZWRWaWV3QnVpbGRlciBhcyBhWSwgUGdWaWV3QmFzZSBhcyBhWiwgUGdWaWV3Q29uZmlnIGFzIGFfLCBQZ0pzb25iIGFzIGFhLCBqc29uYiBhcyBhYiwgUGdOdW1lcmljQnVpbGRlciBhcyBhYywgUGdOdW1lcmljIGFzIGFkLCBudW1lcmljIGFzIGFlLCBkZWNpbWFsIGFzIGFmLCBQZ1RpbWVCdWlsZGVyIGFzIGFnLCBQZ1RpbWUgYXMgYWgsIHRpbWUgYXMgYWksIFBnVGltZXN0YW1wQnVpbGRlciBhcyBhaiwgUGdUaW1lc3RhbXAgYXMgYWssIFBnVGltZXN0YW1wU3RyaW5nQnVpbGRlciBhcyBhbCwgUGdUaW1lc3RhbXBTdHJpbmcgYXMgYW0sIHRpbWVzdGFtcCBhcyBhbiwgUGdVVUlEQnVpbGRlciBhcyBhbywgUGdVVUlEIGFzIGFwLCB1dWlkIGFzIGFxLCBGb3JlaWduS2V5QnVpbGRlciBhcyBhciwgRm9yZWlnbktleSBhcyBhcywgZm9yZWlnbktleSBhcyBhdCwgSW5kZXhCdWlsZGVyT24gYXMgYXUsIEluZGV4QnVpbGRlciBhcyBhdiwgSW5kZXggYXMgYXcsIGluZGV4IGFzIGF4LCB1bmlxdWVJbmRleCBhcyBheSwgcHJpbWFyeUtleSBhcyBheiwgUGFyYW0gYXMgYiwgUGdNYXRlcmlhbGl6ZWRWaWV3Q29uZmlnIGFzIGIwLCBQZ01hdGVyaWFsaXplZFZpZXcgYXMgYjEsIHBnVmlldyBhcyBiMiwgcGdNYXRlcmlhbGl6ZWRWaWV3IGFzIGIzLCBDb2x1bW5BbGlhc1Byb3h5SGFuZGxlciBhcyBiNCwgUmVsYXRpb25UYWJsZUFsaWFzUHJveHlIYW5kbGVyIGFzIGI1LCBhbGlhc2VkUmVsYXRpb24gYXMgYjYsIGhhc093bkVudGl0eUtpbmQgYXMgYjcsIGJpbmRJZlBhcmFtIGFzIGI4LCBuZSBhcyBiOSwgY3JlYXRlT25lIGFzIGJBLCBjcmVhdGVNYW55IGFzIGJCLCBGYWtlUHJpbWl0aXZlUGFyYW0gYXMgYkMsIGlzU1FMV3JhcHBlciBhcyBiRCwgU3RyaW5nQ2h1bmsgYXMgYkUsIE5hbWUgYXMgYkYsIG5hbWUgYXMgYkcsIGlzRHJpdmVyVmFsdWVFbmNvZGVyIGFzIGJILCBub29wRGVjb2RlciBhcyBiSSwgbm9vcEVuY29kZXIgYXMgYkosIG5vb3BNYXBwZXIgYXMgYkssIHBhcmFtIGFzIGJMLCBQbGFjZWhvbGRlciBhcyBiTSwgcGxhY2Vob2xkZXIgYXMgYk4sIFRhYmxlTmFtZSBhcyBiTywgU2NoZW1hIGFzIGJQLCBDb2x1bW5zIGFzIGJRLCBPcmlnaW5hbE5hbWUgYXMgYlIsIEJhc2VOYW1lIGFzIGJTLCBJc0FsaWFzIGFzIGJULCBFeHRyYUNvbmZpZ0J1aWxkZXIgYXMgYlUsIGlzVGFibGUgYXMgYlYsIGlpZmUgYXMgYlcsIG9yIGFzIGJhLCBub3QgYXMgYmIsIGd0IGFzIGJjLCBndGUgYXMgYmQsIGx0IGFzIGJlLCBsdGUgYXMgYmYsIGluQXJyYXkgYXMgYmcsIG5vdEluQXJyYXkgYXMgYmgsIGlzTnVsbCBhcyBiaSwgaXNOb3ROdWxsIGFzIGJqLCBleGlzdHMgYXMgYmssIG5vdEV4aXN0cyBhcyBibCwgYmV0d2VlbiBhcyBibSwgbm90QmV0d2VlbiBhcyBibiwgbGlrZSBhcyBibywgbm90TGlrZSBhcyBicCwgaWxpa2UgYXMgYnEsIG5vdElsaWtlIGFzIGJyLCBhcnJheUNvbnRhaW5zIGFzIGJzLCBhcnJheUNvbnRhaW5lZCBhcyBidCwgYXJyYXlPdmVybGFwcyBhcyBidSwgYXNjIGFzIGJ2LCBkZXNjIGFzIGJ3LCBSZWxhdGlvbiBhcyBieCwgUmVsYXRpb25zIGFzIGJ5LCByZWxhdGlvbnMgYXMgYnosIGNyZWF0ZVRhYmxlUmVsYXRpb25zSGVscGVycyBhcyBjLCBtYXBVcGRhdGVTZXQgYXMgZCwgZW50aXR5S2luZCBhcyBlLCBmaWxsUGxhY2Vob2xkZXJzIGFzIGYsIG1hcFJlbGF0aW9uYWxSb3cgYXMgZywgUXVlcnlCdWlsZGVyIGFzIGgsIGlzIGFzIGksIFNlbGVjdGlvblByb3h5SGFuZGxlciBhcyBqLCBQZ1NlbGVjdEJ1aWxkZXIgYXMgaywgVHJhbnNhY3Rpb25Sb2xsYmFja0Vycm9yIGFzIGwsIG1hcFJlc3VsdFJvdyBhcyBtLCBUYWJsZUFsaWFzUHJveHlIYW5kbGVyIGFzIG4sIG9yZGVyU2VsZWN0ZWRGaWVsZHMgYXMgbywgQ29sdW1uIGFzIHAsIGdldFRhYmxlTmFtZSBhcyBxLCBTdWJxdWVyeSBhcyByLCBzcWwgYXMgcywgdHJhY2VyIGFzIHQsIFN1YnF1ZXJ5Q29uZmlnIGFzIHUsIFZpZXcgYXMgdiwgYWxpYXNlZFRhYmxlQ29sdW1uIGFzIHcsIGdldE9wZXJhdG9ycyBhcyB4LCBtYXBDb2x1bW5zSW5TUUxUb0FsaWFzIGFzIHksIG1hcENvbHVtbnNJbkFsaWFzZWRTUUxUb0FsaWFzIGFzIHogfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFsaWFzLWNmOGUwM2NkLm1qcy5tYXBcbiJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/drizzle-orm/alias-cf8e03cd.mjs\n");

/***/ }),

/***/ "(rsc)/./node_modules/drizzle-orm/index.mjs":
/*!********************************************!*\
  !*** ./node_modules/drizzle-orm/index.mjs ***!
  \********************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   BaseName: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bS),\n/* harmony export */   Column: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.p),\n/* harmony export */   ColumnAliasProxyHandler: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.b4),\n/* harmony export */   ColumnBuilder: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.C),\n/* harmony export */   Columns: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bQ),\n/* harmony export */   ConsoleLogWriter: () => (/* binding */ ConsoleLogWriter),\n/* harmony export */   DefaultLogger: () => (/* binding */ DefaultLogger),\n/* harmony export */   DrizzleError: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.D),\n/* harmony export */   ExtraConfigBuilder: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bU),\n/* harmony export */   FakePrimitiveParam: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bC),\n/* harmony export */   IsAlias: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bT),\n/* harmony export */   Many: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.M),\n/* harmony export */   Name: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bF),\n/* harmony export */   NoopLogger: () => (/* binding */ NoopLogger),\n/* harmony export */   One: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.O),\n/* harmony export */   OriginalName: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bR),\n/* harmony export */   Param: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.b),\n/* harmony export */   Placeholder: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bM),\n/* harmony export */   QueryPromise: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.Q),\n/* harmony export */   Relation: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bx),\n/* harmony export */   RelationTableAliasProxyHandler: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.b5),\n/* harmony export */   Relations: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.by),\n/* harmony export */   SQL: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.S),\n/* harmony export */   Schema: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bP),\n/* harmony export */   SelectionProxyHandler: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.j),\n/* harmony export */   StringChunk: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bE),\n/* harmony export */   Subquery: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.r),\n/* harmony export */   SubqueryConfig: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.u),\n/* harmony export */   Table: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.T),\n/* harmony export */   TableAliasProxyHandler: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.n),\n/* harmony export */   TableName: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bO),\n/* harmony export */   TransactionRollbackError: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.l),\n/* harmony export */   View: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.v),\n/* harmony export */   ViewBaseConfig: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.V),\n/* harmony export */   WithSubquery: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.W),\n/* harmony export */   aliasedRelation: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.b6),\n/* harmony export */   aliasedTable: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.G),\n/* harmony export */   aliasedTableColumn: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.w),\n/* harmony export */   and: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.E),\n/* harmony export */   applyMixins: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.H),\n/* harmony export */   arrayContained: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bt),\n/* harmony export */   arrayContains: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bs),\n/* harmony export */   arrayOverlaps: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bu),\n/* harmony export */   asc: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bv),\n/* harmony export */   between: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bm),\n/* harmony export */   bindIfParam: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.b8),\n/* harmony export */   createMany: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bB),\n/* harmony export */   createOne: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bA),\n/* harmony export */   createTableRelationsHelpers: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.c),\n/* harmony export */   desc: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bw),\n/* harmony export */   entityKind: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.e),\n/* harmony export */   eq: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.F),\n/* harmony export */   exists: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bk),\n/* harmony export */   extractTablesRelationalConfig: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.a),\n/* harmony export */   fillPlaceholders: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.f),\n/* harmony export */   getOperators: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.x),\n/* harmony export */   getOrderByOperators: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.A),\n/* harmony export */   getTableColumns: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.I),\n/* harmony export */   getTableLikeName: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.K),\n/* harmony export */   getTableName: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.q),\n/* harmony export */   gt: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bc),\n/* harmony export */   gte: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bd),\n/* harmony export */   hasOwnEntityKind: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.b7),\n/* harmony export */   iife: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bW),\n/* harmony export */   ilike: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bq),\n/* harmony export */   inArray: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bg),\n/* harmony export */   is: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i),\n/* harmony export */   isDriverValueEncoder: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bH),\n/* harmony export */   isNotNull: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bj),\n/* harmony export */   isNull: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bi),\n/* harmony export */   isSQLWrapper: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bD),\n/* harmony export */   isTable: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bV),\n/* harmony export */   like: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bo),\n/* harmony export */   lt: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.be),\n/* harmony export */   lte: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bf),\n/* harmony export */   mapColumnsInAliasedSQLToAlias: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.z),\n/* harmony export */   mapColumnsInSQLToAlias: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.y),\n/* harmony export */   mapRelationalRow: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.g),\n/* harmony export */   mapResultRow: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.m),\n/* harmony export */   mapUpdateSet: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.d),\n/* harmony export */   name: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bG),\n/* harmony export */   ne: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.b9),\n/* harmony export */   noopDecoder: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bI),\n/* harmony export */   noopEncoder: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bJ),\n/* harmony export */   noopMapper: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bK),\n/* harmony export */   normalizeRelation: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.B),\n/* harmony export */   not: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bb),\n/* harmony export */   notBetween: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bn),\n/* harmony export */   notExists: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bl),\n/* harmony export */   notIlike: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.br),\n/* harmony export */   notInArray: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bh),\n/* harmony export */   notLike: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bp),\n/* harmony export */   or: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.ba),\n/* harmony export */   orderSelectedFields: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.o),\n/* harmony export */   param: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bL),\n/* harmony export */   placeholder: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bN),\n/* harmony export */   relations: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.bz),\n/* harmony export */   sql: () => (/* reexport safe */ _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s)\n/* harmony export */ });\n/* harmony import */ var _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./alias-cf8e03cd.mjs */ \"(rsc)/./node_modules/drizzle-orm/alias-cf8e03cd.mjs\");\n\n\n\nclass ConsoleLogWriter {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.e] = 'ConsoleLogWriter';\n    write(message) {\n        console.log(message);\n    }\n}\nclass DefaultLogger {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.e] = 'DefaultLogger';\n    writer;\n    constructor(config) {\n        this.writer = config?.writer ?? new ConsoleLogWriter();\n    }\n    logQuery(query, params) {\n        const stringifiedParams = params.map((p) => {\n            try {\n                return JSON.stringify(p);\n            }\n            catch {\n                return String(p);\n            }\n        });\n        const paramsStr = stringifiedParams.length ? ` -- params: [${stringifiedParams.join(', ')}]` : '';\n        this.writer.write(`Query: ${query}${paramsStr}`);\n    }\n}\nclass NoopLogger {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.e] = 'NoopLogger';\n    logQuery() {\n        // noop\n    }\n}\n\n\n//# sourceMappingURL=index.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvZHJpenpsZS1vcm0vaW5kZXgubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUF1RDtBQUNvcUQ7O0FBRTN0RDtBQUNBLFlBQVksa0RBQVU7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksa0RBQVU7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULHFFQUFxRSw2QkFBNkI7QUFDbEcsb0NBQW9DLE1BQU0sRUFBRSxVQUFVO0FBQ3REO0FBQ0E7QUFDQTtBQUNBLFlBQVksa0RBQVU7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7O0FBRW1FO0FBQ25FIiwic291cmNlcyI6WyJDOlxcVXNlcnNcXEVkZ2FyIEogUm9qYXMgTFxcZGV2XFxjYXByZXMtd2ViXFxub2RlX21vZHVsZXNcXGRyaXp6bGUtb3JtXFxpbmRleC5tanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZSBhcyBlbnRpdHlLaW5kIH0gZnJvbSAnLi9hbGlhcy1jZjhlMDNjZC5tanMnO1xuZXhwb3J0IHsgYlMgYXMgQmFzZU5hbWUsIHAgYXMgQ29sdW1uLCBiNCBhcyBDb2x1bW5BbGlhc1Byb3h5SGFuZGxlciwgQyBhcyBDb2x1bW5CdWlsZGVyLCBiUSBhcyBDb2x1bW5zLCBEIGFzIERyaXp6bGVFcnJvciwgYlUgYXMgRXh0cmFDb25maWdCdWlsZGVyLCBiQyBhcyBGYWtlUHJpbWl0aXZlUGFyYW0sIGJUIGFzIElzQWxpYXMsIE0gYXMgTWFueSwgYkYgYXMgTmFtZSwgTyBhcyBPbmUsIGJSIGFzIE9yaWdpbmFsTmFtZSwgYiBhcyBQYXJhbSwgYk0gYXMgUGxhY2Vob2xkZXIsIFEgYXMgUXVlcnlQcm9taXNlLCBieCBhcyBSZWxhdGlvbiwgYjUgYXMgUmVsYXRpb25UYWJsZUFsaWFzUHJveHlIYW5kbGVyLCBieSBhcyBSZWxhdGlvbnMsIFMgYXMgU1FMLCBiUCBhcyBTY2hlbWEsIGogYXMgU2VsZWN0aW9uUHJveHlIYW5kbGVyLCBiRSBhcyBTdHJpbmdDaHVuaywgciBhcyBTdWJxdWVyeSwgdSBhcyBTdWJxdWVyeUNvbmZpZywgVCBhcyBUYWJsZSwgbiBhcyBUYWJsZUFsaWFzUHJveHlIYW5kbGVyLCBiTyBhcyBUYWJsZU5hbWUsIGwgYXMgVHJhbnNhY3Rpb25Sb2xsYmFja0Vycm9yLCB2IGFzIFZpZXcsIFYgYXMgVmlld0Jhc2VDb25maWcsIFcgYXMgV2l0aFN1YnF1ZXJ5LCBiNiBhcyBhbGlhc2VkUmVsYXRpb24sIEcgYXMgYWxpYXNlZFRhYmxlLCB3IGFzIGFsaWFzZWRUYWJsZUNvbHVtbiwgRSBhcyBhbmQsIEggYXMgYXBwbHlNaXhpbnMsIGJ0IGFzIGFycmF5Q29udGFpbmVkLCBicyBhcyBhcnJheUNvbnRhaW5zLCBidSBhcyBhcnJheU92ZXJsYXBzLCBidiBhcyBhc2MsIGJtIGFzIGJldHdlZW4sIGI4IGFzIGJpbmRJZlBhcmFtLCBiQiBhcyBjcmVhdGVNYW55LCBiQSBhcyBjcmVhdGVPbmUsIGMgYXMgY3JlYXRlVGFibGVSZWxhdGlvbnNIZWxwZXJzLCBidyBhcyBkZXNjLCBGIGFzIGVxLCBiayBhcyBleGlzdHMsIGEgYXMgZXh0cmFjdFRhYmxlc1JlbGF0aW9uYWxDb25maWcsIGYgYXMgZmlsbFBsYWNlaG9sZGVycywgeCBhcyBnZXRPcGVyYXRvcnMsIEEgYXMgZ2V0T3JkZXJCeU9wZXJhdG9ycywgSSBhcyBnZXRUYWJsZUNvbHVtbnMsIEsgYXMgZ2V0VGFibGVMaWtlTmFtZSwgcSBhcyBnZXRUYWJsZU5hbWUsIGJjIGFzIGd0LCBiZCBhcyBndGUsIGI3IGFzIGhhc093bkVudGl0eUtpbmQsIGJXIGFzIGlpZmUsIGJxIGFzIGlsaWtlLCBiZyBhcyBpbkFycmF5LCBpIGFzIGlzLCBiSCBhcyBpc0RyaXZlclZhbHVlRW5jb2RlciwgYmogYXMgaXNOb3ROdWxsLCBiaSBhcyBpc051bGwsIGJEIGFzIGlzU1FMV3JhcHBlciwgYlYgYXMgaXNUYWJsZSwgYm8gYXMgbGlrZSwgYmUgYXMgbHQsIGJmIGFzIGx0ZSwgeiBhcyBtYXBDb2x1bW5zSW5BbGlhc2VkU1FMVG9BbGlhcywgeSBhcyBtYXBDb2x1bW5zSW5TUUxUb0FsaWFzLCBnIGFzIG1hcFJlbGF0aW9uYWxSb3csIG0gYXMgbWFwUmVzdWx0Um93LCBkIGFzIG1hcFVwZGF0ZVNldCwgYkcgYXMgbmFtZSwgYjkgYXMgbmUsIGJJIGFzIG5vb3BEZWNvZGVyLCBiSiBhcyBub29wRW5jb2RlciwgYksgYXMgbm9vcE1hcHBlciwgQiBhcyBub3JtYWxpemVSZWxhdGlvbiwgYmIgYXMgbm90LCBibiBhcyBub3RCZXR3ZWVuLCBibCBhcyBub3RFeGlzdHMsIGJyIGFzIG5vdElsaWtlLCBiaCBhcyBub3RJbkFycmF5LCBicCBhcyBub3RMaWtlLCBiYSBhcyBvciwgbyBhcyBvcmRlclNlbGVjdGVkRmllbGRzLCBiTCBhcyBwYXJhbSwgYk4gYXMgcGxhY2Vob2xkZXIsIGJ6IGFzIHJlbGF0aW9ucywgcyBhcyBzcWwgfSBmcm9tICcuL2FsaWFzLWNmOGUwM2NkLm1qcyc7XG5cbmNsYXNzIENvbnNvbGVMb2dXcml0ZXIge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnQ29uc29sZUxvZ1dyaXRlcic7XG4gICAgd3JpdGUobWVzc2FnZSkge1xuICAgICAgICBjb25zb2xlLmxvZyhtZXNzYWdlKTtcbiAgICB9XG59XG5jbGFzcyBEZWZhdWx0TG9nZ2VyIHtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ0RlZmF1bHRMb2dnZXInO1xuICAgIHdyaXRlcjtcbiAgICBjb25zdHJ1Y3Rvcihjb25maWcpIHtcbiAgICAgICAgdGhpcy53cml0ZXIgPSBjb25maWc/LndyaXRlciA/PyBuZXcgQ29uc29sZUxvZ1dyaXRlcigpO1xuICAgIH1cbiAgICBsb2dRdWVyeShxdWVyeSwgcGFyYW1zKSB7XG4gICAgICAgIGNvbnN0IHN0cmluZ2lmaWVkUGFyYW1zID0gcGFyYW1zLm1hcCgocCkgPT4ge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkocCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFN0cmluZyhwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHBhcmFtc1N0ciA9IHN0cmluZ2lmaWVkUGFyYW1zLmxlbmd0aCA/IGAgLS0gcGFyYW1zOiBbJHtzdHJpbmdpZmllZFBhcmFtcy5qb2luKCcsICcpfV1gIDogJyc7XG4gICAgICAgIHRoaXMud3JpdGVyLndyaXRlKGBRdWVyeTogJHtxdWVyeX0ke3BhcmFtc1N0cn1gKTtcbiAgICB9XG59XG5jbGFzcyBOb29wTG9nZ2VyIHtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ05vb3BMb2dnZXInO1xuICAgIGxvZ1F1ZXJ5KCkge1xuICAgICAgICAvLyBub29wXG4gICAgfVxufVxuXG5leHBvcnQgeyBDb25zb2xlTG9nV3JpdGVyLCBEZWZhdWx0TG9nZ2VyLCBOb29wTG9nZ2VyLCBlbnRpdHlLaW5kIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5tanMubWFwXG4iXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/drizzle-orm/index.mjs\n");

/***/ }),

/***/ "(rsc)/./node_modules/drizzle-orm/mysql-core/index.mjs":
/*!*******************************************************!*\
  !*** ./node_modules/drizzle-orm/mysql-core/index.mjs ***!
  \*******************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Check: () => (/* binding */ Check),\n/* harmony export */   CheckBuilder: () => (/* binding */ CheckBuilder),\n/* harmony export */   ForeignKey: () => (/* reexport safe */ _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.k),\n/* harmony export */   ForeignKeyBuilder: () => (/* reexport safe */ _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.F),\n/* harmony export */   Index: () => (/* binding */ Index),\n/* harmony export */   IndexBuilder: () => (/* binding */ IndexBuilder),\n/* harmony export */   IndexBuilderOn: () => (/* binding */ IndexBuilderOn),\n/* harmony export */   InlineForeignKeys: () => (/* reexport safe */ _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.I),\n/* harmony export */   ManualViewBuilder: () => (/* reexport safe */ _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.C),\n/* harmony export */   MySqlBigInt53: () => (/* binding */ MySqlBigInt53),\n/* harmony export */   MySqlBigInt53Builder: () => (/* binding */ MySqlBigInt53Builder),\n/* harmony export */   MySqlBigInt64: () => (/* binding */ MySqlBigInt64),\n/* harmony export */   MySqlBigInt64Builder: () => (/* binding */ MySqlBigInt64Builder),\n/* harmony export */   MySqlBinary: () => (/* binding */ MySqlBinary),\n/* harmony export */   MySqlBinaryBuilder: () => (/* binding */ MySqlBinaryBuilder),\n/* harmony export */   MySqlBoolean: () => (/* binding */ MySqlBoolean),\n/* harmony export */   MySqlBooleanBuilder: () => (/* binding */ MySqlBooleanBuilder),\n/* harmony export */   MySqlChar: () => (/* binding */ MySqlChar),\n/* harmony export */   MySqlCharBuilder: () => (/* binding */ MySqlCharBuilder),\n/* harmony export */   MySqlColumn: () => (/* reexport safe */ _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.g),\n/* harmony export */   MySqlColumnBuilder: () => (/* reexport safe */ _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.f),\n/* harmony export */   MySqlColumnBuilderWithAutoIncrement: () => (/* reexport safe */ _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.d),\n/* harmony export */   MySqlColumnWithAutoIncrement: () => (/* reexport safe */ _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.e),\n/* harmony export */   MySqlCustomColumn: () => (/* binding */ MySqlCustomColumn),\n/* harmony export */   MySqlCustomColumnBuilder: () => (/* binding */ MySqlCustomColumnBuilder),\n/* harmony export */   MySqlDatabase: () => (/* reexport safe */ _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.b),\n/* harmony export */   MySqlDate: () => (/* binding */ MySqlDate),\n/* harmony export */   MySqlDateBuilder: () => (/* binding */ MySqlDateBuilder),\n/* harmony export */   MySqlDateString: () => (/* binding */ MySqlDateString),\n/* harmony export */   MySqlDateStringBuilder: () => (/* binding */ MySqlDateStringBuilder),\n/* harmony export */   MySqlDateTime: () => (/* binding */ MySqlDateTime),\n/* harmony export */   MySqlDateTimeBuilder: () => (/* binding */ MySqlDateTimeBuilder),\n/* harmony export */   MySqlDateTimeString: () => (/* binding */ MySqlDateTimeString),\n/* harmony export */   MySqlDateTimeStringBuilder: () => (/* binding */ MySqlDateTimeStringBuilder),\n/* harmony export */   MySqlDecimal: () => (/* binding */ MySqlDecimal),\n/* harmony export */   MySqlDecimalBuilder: () => (/* binding */ MySqlDecimalBuilder),\n/* harmony export */   MySqlDelete: () => (/* reexport safe */ _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.n),\n/* harmony export */   MySqlDialect: () => (/* reexport safe */ _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.c),\n/* harmony export */   MySqlDouble: () => (/* binding */ MySqlDouble),\n/* harmony export */   MySqlDoubleBuilder: () => (/* binding */ MySqlDoubleBuilder),\n/* harmony export */   MySqlEnumColumn: () => (/* binding */ MySqlEnumColumn),\n/* harmony export */   MySqlEnumColumnBuilder: () => (/* binding */ MySqlEnumColumnBuilder),\n/* harmony export */   MySqlFloat: () => (/* binding */ MySqlFloat),\n/* harmony export */   MySqlFloatBuilder: () => (/* binding */ MySqlFloatBuilder),\n/* harmony export */   MySqlInsert: () => (/* reexport safe */ _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.p),\n/* harmony export */   MySqlInsertBuilder: () => (/* reexport safe */ _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.o),\n/* harmony export */   MySqlInt: () => (/* binding */ MySqlInt),\n/* harmony export */   MySqlIntBuilder: () => (/* binding */ MySqlIntBuilder),\n/* harmony export */   MySqlJson: () => (/* binding */ MySqlJson),\n/* harmony export */   MySqlJsonBuilder: () => (/* binding */ MySqlJsonBuilder),\n/* harmony export */   MySqlMediumInt: () => (/* binding */ MySqlMediumInt),\n/* harmony export */   MySqlMediumIntBuilder: () => (/* binding */ MySqlMediumIntBuilder),\n/* harmony export */   MySqlReal: () => (/* binding */ MySqlReal),\n/* harmony export */   MySqlRealBuilder: () => (/* binding */ MySqlRealBuilder),\n/* harmony export */   MySqlSchema: () => (/* binding */ MySqlSchema),\n/* harmony export */   MySqlSelect: () => (/* reexport safe */ _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.s),\n/* harmony export */   MySqlSelectBuilder: () => (/* reexport safe */ _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.q),\n/* harmony export */   MySqlSelectQueryBuilder: () => (/* reexport safe */ _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.r),\n/* harmony export */   MySqlSerial: () => (/* binding */ MySqlSerial),\n/* harmony export */   MySqlSerialBuilder: () => (/* binding */ MySqlSerialBuilder),\n/* harmony export */   MySqlSession: () => (/* reexport safe */ _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.M),\n/* harmony export */   MySqlSmallInt: () => (/* binding */ MySqlSmallInt),\n/* harmony export */   MySqlSmallIntBuilder: () => (/* binding */ MySqlSmallIntBuilder),\n/* harmony export */   MySqlTable: () => (/* reexport safe */ _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.h),\n/* harmony export */   MySqlText: () => (/* binding */ MySqlText),\n/* harmony export */   MySqlTextBuilder: () => (/* binding */ MySqlTextBuilder),\n/* harmony export */   MySqlTime: () => (/* binding */ MySqlTime),\n/* harmony export */   MySqlTimeBuilder: () => (/* binding */ MySqlTimeBuilder),\n/* harmony export */   MySqlTimestamp: () => (/* binding */ MySqlTimestamp),\n/* harmony export */   MySqlTimestampBuilder: () => (/* binding */ MySqlTimestampBuilder),\n/* harmony export */   MySqlTimestampString: () => (/* binding */ MySqlTimestampString),\n/* harmony export */   MySqlTimestampStringBuilder: () => (/* binding */ MySqlTimestampStringBuilder),\n/* harmony export */   MySqlTinyInt: () => (/* binding */ MySqlTinyInt),\n/* harmony export */   MySqlTinyIntBuilder: () => (/* binding */ MySqlTinyIntBuilder),\n/* harmony export */   MySqlTransaction: () => (/* reexport safe */ _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.a),\n/* harmony export */   MySqlUpdate: () => (/* reexport safe */ _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.u),\n/* harmony export */   MySqlUpdateBuilder: () => (/* reexport safe */ _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.t),\n/* harmony export */   MySqlVarBinary: () => (/* binding */ MySqlVarBinary),\n/* harmony export */   MySqlVarBinaryBuilder: () => (/* binding */ MySqlVarBinaryBuilder),\n/* harmony export */   MySqlVarChar: () => (/* binding */ MySqlVarChar),\n/* harmony export */   MySqlVarCharBuilder: () => (/* binding */ MySqlVarCharBuilder),\n/* harmony export */   MySqlView: () => (/* reexport safe */ _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.E),\n/* harmony export */   MySqlViewBase: () => (/* reexport safe */ _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.D),\n/* harmony export */   MySqlViewConfig: () => (/* reexport safe */ _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.j),\n/* harmony export */   MySqlYear: () => (/* binding */ MySqlYear),\n/* harmony export */   MySqlYearBuilder: () => (/* binding */ MySqlYearBuilder),\n/* harmony export */   PreparedQuery: () => (/* reexport safe */ _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.P),\n/* harmony export */   PrimaryKey: () => (/* binding */ PrimaryKey),\n/* harmony export */   PrimaryKeyBuilder: () => (/* binding */ PrimaryKeyBuilder),\n/* harmony export */   QueryBuilder: () => (/* reexport safe */ _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.Q),\n/* harmony export */   UniqueConstraint: () => (/* reexport safe */ _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.A),\n/* harmony export */   UniqueConstraintBuilder: () => (/* reexport safe */ _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.U),\n/* harmony export */   UniqueOnConstraintBuilder: () => (/* reexport safe */ _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.z),\n/* harmony export */   ViewBuilder: () => (/* reexport safe */ _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.B),\n/* harmony export */   ViewBuilderCore: () => (/* reexport safe */ _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.V),\n/* harmony export */   alias: () => (/* binding */ alias),\n/* harmony export */   bigint: () => (/* binding */ bigint),\n/* harmony export */   binary: () => (/* binding */ binary),\n/* harmony export */   boolean: () => (/* binding */ boolean),\n/* harmony export */   char: () => (/* binding */ char),\n/* harmony export */   check: () => (/* binding */ check),\n/* harmony export */   customType: () => (/* binding */ customType),\n/* harmony export */   date: () => (/* binding */ date),\n/* harmony export */   datetime: () => (/* binding */ datetime),\n/* harmony export */   decimal: () => (/* binding */ decimal),\n/* harmony export */   double: () => (/* binding */ double),\n/* harmony export */   float: () => (/* binding */ float),\n/* harmony export */   foreignKey: () => (/* reexport safe */ _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.l),\n/* harmony export */   getTableConfig: () => (/* binding */ getTableConfig),\n/* harmony export */   getViewConfig: () => (/* binding */ getViewConfig),\n/* harmony export */   index: () => (/* binding */ index),\n/* harmony export */   int: () => (/* binding */ int),\n/* harmony export */   isMySqlSchema: () => (/* binding */ isMySqlSchema),\n/* harmony export */   json: () => (/* binding */ json),\n/* harmony export */   longtext: () => (/* binding */ longtext),\n/* harmony export */   mediumint: () => (/* binding */ mediumint),\n/* harmony export */   mediumtext: () => (/* binding */ mediumtext),\n/* harmony export */   mysqlDatabase: () => (/* binding */ mysqlDatabase),\n/* harmony export */   mysqlEnum: () => (/* binding */ mysqlEnum),\n/* harmony export */   mysqlSchema: () => (/* binding */ mysqlSchema),\n/* harmony export */   mysqlTable: () => (/* reexport safe */ _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.v),\n/* harmony export */   mysqlTableCreator: () => (/* reexport safe */ _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.w),\n/* harmony export */   mysqlTableWithSchema: () => (/* reexport safe */ _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.m),\n/* harmony export */   mysqlView: () => (/* reexport safe */ _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.G),\n/* harmony export */   mysqlViewWithSchema: () => (/* reexport safe */ _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.i),\n/* harmony export */   primaryKey: () => (/* binding */ primaryKey),\n/* harmony export */   real: () => (/* binding */ real),\n/* harmony export */   serial: () => (/* binding */ serial),\n/* harmony export */   smallint: () => (/* binding */ smallint),\n/* harmony export */   text: () => (/* binding */ text),\n/* harmony export */   time: () => (/* binding */ time),\n/* harmony export */   timestamp: () => (/* binding */ timestamp),\n/* harmony export */   tinyint: () => (/* binding */ tinyint),\n/* harmony export */   tinytext: () => (/* binding */ tinytext),\n/* harmony export */   unique: () => (/* reexport safe */ _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.x),\n/* harmony export */   uniqueIndex: () => (/* binding */ uniqueIndex),\n/* harmony export */   uniqueKeyName: () => (/* reexport safe */ _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.y),\n/* harmony export */   varbinary: () => (/* binding */ varbinary),\n/* harmony export */   varchar: () => (/* binding */ varchar),\n/* harmony export */   year: () => (/* binding */ year)\n/* harmony export */ });\n/* harmony import */ var _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../alias-cf8e03cd.mjs */ \"(rsc)/./node_modules/drizzle-orm/alias-cf8e03cd.mjs\");\n/* harmony import */ var _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../view-23898f21.mjs */ \"(rsc)/./node_modules/drizzle-orm/view-23898f21.mjs\");\n\n\n\n\nclass MySqlBigInt53Builder extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.d {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlBigInt53Builder';\n    constructor(name) {\n        super(name, 'number', 'MySqlBigInt53');\n    }\n    /** @internal */\n    build(table) {\n        return new MySqlBigInt53(table, this.config);\n    }\n}\nclass MySqlBigInt53 extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.e {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlBigInt53';\n    getSQLType() {\n        return 'bigint';\n    }\n    mapFromDriverValue(value) {\n        if (typeof value === 'number') {\n            return value;\n        }\n        return Number(value);\n    }\n}\nclass MySqlBigInt64Builder extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.d {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlBigInt64Builder';\n    constructor(name) {\n        super(name, 'bigint', 'MySqlBigInt64');\n    }\n    /** @internal */\n    build(table) {\n        return new MySqlBigInt64(table, this.config);\n    }\n}\nclass MySqlBigInt64 extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.e {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlBigInt64';\n    getSQLType() {\n        return 'bigint';\n    }\n    // eslint-disable-next-line unicorn/prefer-native-coercion-functions\n    mapFromDriverValue(value) {\n        return BigInt(value);\n    }\n}\nfunction bigint(name, config) {\n    if (config.mode === 'number') {\n        return new MySqlBigInt53Builder(name);\n    }\n    return new MySqlBigInt64Builder(name);\n}\n\nclass MySqlBinaryBuilder extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.f {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlBinaryBuilder';\n    constructor(name, length) {\n        super(name, 'string', 'MySqlBinary');\n        this.config.length = length;\n    }\n    /** @internal */\n    build(table) {\n        return new MySqlBinary(table, this.config);\n    }\n}\nclass MySqlBinary extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.g {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlBinary';\n    length = this.config.length;\n    getSQLType() {\n        return this.length === undefined ? `binary` : `binary(${this.length})`;\n    }\n}\nfunction binary(name, config = {}) {\n    return new MySqlBinaryBuilder(name, config.length);\n}\n\nclass MySqlBooleanBuilder extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.f {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlBooleanBuilder';\n    constructor(name) {\n        super(name, 'boolean', 'MySqlBoolean');\n    }\n    /** @internal */\n    build(table) {\n        return new MySqlBoolean(table, this.config);\n    }\n}\nclass MySqlBoolean extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.g {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlBoolean';\n    getSQLType() {\n        return 'boolean';\n    }\n    mapFromDriverValue(value) {\n        if (typeof value === 'boolean') {\n            return value;\n        }\n        return value === 1;\n    }\n}\nfunction boolean(name) {\n    return new MySqlBooleanBuilder(name);\n}\n\nclass MySqlCharBuilder extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.f {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlCharBuilder';\n    constructor(name, config) {\n        super(name, 'string', 'MySqlChar');\n        this.config.length = config.length;\n        this.config.enum = config.enum;\n    }\n    /** @internal */\n    build(table) {\n        return new MySqlChar(table, this.config);\n    }\n}\nclass MySqlChar extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.g {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlChar';\n    length = this.config.length;\n    enumValues = this.config.enum;\n    getSQLType() {\n        return this.length === undefined ? `char` : `char(${this.length})`;\n    }\n}\nfunction char(name, config = {}) {\n    return new MySqlCharBuilder(name, config);\n}\n\nclass MySqlCustomColumnBuilder extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.f {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlCustomColumnBuilder';\n    constructor(name, fieldConfig, customTypeParams) {\n        super(name, 'custom', 'MySqlCustomColumn');\n        this.config.fieldConfig = fieldConfig;\n        this.config.customTypeParams = customTypeParams;\n    }\n    /** @internal */\n    build(table) {\n        return new MySqlCustomColumn(table, this.config);\n    }\n}\nclass MySqlCustomColumn extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.g {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlCustomColumn';\n    sqlName;\n    mapTo;\n    mapFrom;\n    constructor(table, config) {\n        super(table, config);\n        this.sqlName = config.customTypeParams.dataType(config.fieldConfig);\n        this.mapTo = config.customTypeParams.toDriver;\n        this.mapFrom = config.customTypeParams.fromDriver;\n    }\n    getSQLType() {\n        return this.sqlName;\n    }\n    mapFromDriverValue(value) {\n        return typeof this.mapFrom === 'function' ? this.mapFrom(value) : value;\n    }\n    mapToDriverValue(value) {\n        return typeof this.mapTo === 'function' ? this.mapTo(value) : value;\n    }\n}\n/**\n * Custom mysql database data type generator\n */\nfunction customType(customTypeParams) {\n    return (dbName, fieldConfig) => {\n        return new MySqlCustomColumnBuilder(dbName, fieldConfig, customTypeParams);\n    };\n}\n\nclass MySqlDateBuilder extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.f {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlDateBuilder';\n    constructor(name) {\n        super(name, 'date', 'MySqlDate');\n    }\n    /** @internal */\n    build(table) {\n        return new MySqlDate(table, this.config);\n    }\n}\nclass MySqlDate extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.g {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlDate';\n    constructor(table, config) {\n        super(table, config);\n    }\n    getSQLType() {\n        return `date`;\n    }\n    mapFromDriverValue(value) {\n        return new Date(value);\n    }\n}\nclass MySqlDateStringBuilder extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.f {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlDateStringBuilder';\n    constructor(name) {\n        super(name, 'string', 'MySqlDateString');\n    }\n    /** @internal */\n    build(table) {\n        return new MySqlDateString(table, this.config);\n    }\n}\nclass MySqlDateString extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.g {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlDateString';\n    constructor(table, config) {\n        super(table, config);\n    }\n    getSQLType() {\n        return `date`;\n    }\n}\nfunction date(name, config = {}) {\n    if (config.mode === 'string') {\n        return new MySqlDateStringBuilder(name);\n    }\n    return new MySqlDateBuilder(name);\n}\n\nclass MySqlDateTimeBuilder extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.f {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlDateTimeBuilder';\n    constructor(name, config) {\n        super(name, 'date', 'MySqlDateTime');\n        this.config.fsp = config?.fsp;\n    }\n    /** @internal */\n    build(table) {\n        return new MySqlDateTime(table, this.config);\n    }\n}\nclass MySqlDateTime extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.g {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlDateTime';\n    fsp;\n    constructor(table, config) {\n        super(table, config);\n        this.fsp = config.fsp;\n    }\n    getSQLType() {\n        const precision = this.fsp === undefined ? '' : `(${this.fsp})`;\n        return `datetime${precision}`;\n    }\n    mapToDriverValue(value) {\n        return value.toISOString().replace('T', ' ').replace('Z', '');\n    }\n    mapFromDriverValue(value) {\n        return new Date(value.replace(' ', 'T') + 'Z');\n    }\n}\nclass MySqlDateTimeStringBuilder extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.f {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlDateTimeStringBuilder';\n    constructor(name, config) {\n        super(name, 'string', 'MySqlDateTimeString');\n        this.config.fsp = config?.fsp;\n    }\n    /** @internal */\n    build(table) {\n        return new MySqlDateTimeString(table, this.config);\n    }\n}\nclass MySqlDateTimeString extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.g {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlDateTimeString';\n    fsp;\n    constructor(table, config) {\n        super(table, config);\n        this.fsp = config.fsp;\n    }\n    getSQLType() {\n        const precision = this.fsp === undefined ? '' : `(${this.fsp})`;\n        return `datetime${precision}`;\n    }\n}\nfunction datetime(name, config = {}) {\n    if (config.mode === 'string') {\n        return new MySqlDateTimeStringBuilder(name, config);\n    }\n    return new MySqlDateTimeBuilder(name, config);\n}\n\nclass MySqlDecimalBuilder extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.d {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlDecimalBuilder';\n    constructor(name, precision, scale) {\n        super(name, 'string', 'MySqlDecimal');\n        this.config.precision = precision;\n        this.config.scale = scale;\n    }\n    /** @internal */\n    build(table) {\n        return new MySqlDecimal(table, this.config);\n    }\n}\nclass MySqlDecimal extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.e {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlDecimal';\n    precision = this.config.precision;\n    scale = this.config.scale;\n    getSQLType() {\n        if (this.precision !== undefined && this.scale !== undefined) {\n            return `decimal(${this.precision},${this.scale})`;\n        }\n        else if (this.precision === undefined) {\n            return 'decimal';\n        }\n        else {\n            return `decimal(${this.precision})`;\n        }\n    }\n}\nfunction decimal(name, config = {}) {\n    return new MySqlDecimalBuilder(name, config.precision, config.scale);\n}\n\nclass MySqlDoubleBuilder extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.d {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlDoubleBuilder';\n    constructor(name, config) {\n        super(name, 'number', 'MySqlDouble');\n        this.config.precision = config?.precision;\n        this.config.scale = config?.scale;\n    }\n    /** @internal */\n    build(table) {\n        return new MySqlDouble(table, this.config);\n    }\n}\nclass MySqlDouble extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.e {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlDouble';\n    precision = this.config.precision;\n    scale = this.config.scale;\n    getSQLType() {\n        if (this.precision !== undefined && this.scale !== undefined) {\n            return `double(${this.precision},${this.scale})`;\n        }\n        else if (this.precision === undefined) {\n            return 'double';\n        }\n        else {\n            return `double(${this.precision})`;\n        }\n    }\n}\nfunction double(name, config) {\n    return new MySqlDoubleBuilder(name, config);\n}\n\nclass MySqlEnumColumnBuilder extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.f {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlEnumColumnBuilder';\n    constructor(name, values) {\n        super(name, 'string', 'MySqlEnumColumn');\n        this.config.enumValues = values;\n    }\n    /** @internal */\n    build(table) {\n        return new MySqlEnumColumn(table, this.config);\n    }\n}\nclass MySqlEnumColumn extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.g {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlEnumColumn';\n    enumValues = this.config.enumValues;\n    getSQLType() {\n        return `enum(${this.enumValues.map((value) => `'${value}'`).join(',')})`;\n    }\n}\nfunction mysqlEnum(name, values) {\n    if (values.length === 0) {\n        throw new Error(`You have an empty array for \"${name}\" enum values`);\n    }\n    return new MySqlEnumColumnBuilder(name, values);\n}\n\nclass MySqlFloatBuilder extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.d {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlFloatBuilder';\n    constructor(name) {\n        super(name, 'number', 'MySqlFloat');\n    }\n    /** @internal */\n    build(table) {\n        return new MySqlFloat(table, this.config);\n    }\n}\nclass MySqlFloat extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.e {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlFloat';\n    getSQLType() {\n        return 'float';\n    }\n}\nfunction float(name) {\n    return new MySqlFloatBuilder(name);\n}\n\nclass MySqlIntBuilder extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.d {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlIntBuilder';\n    constructor(name) {\n        super(name, 'number', 'MySqlInt');\n    }\n    /** @internal */\n    build(table) {\n        return new MySqlInt(table, this.config);\n    }\n}\nclass MySqlInt extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.e {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlInt';\n    getSQLType() {\n        return 'int';\n    }\n    mapFromDriverValue(value) {\n        if (typeof value === 'string') {\n            return Number(value);\n        }\n        return value;\n    }\n}\nfunction int(name) {\n    return new MySqlIntBuilder(name);\n}\n\nclass MySqlJsonBuilder extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.f {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlJsonBuilder';\n    constructor(name) {\n        super(name, 'json', 'MySqlJson');\n    }\n    /** @internal */\n    build(table) {\n        return new MySqlJson(table, this.config);\n    }\n}\nclass MySqlJson extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.g {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlJson';\n    getSQLType() {\n        return 'json';\n    }\n    mapToDriverValue(value) {\n        return JSON.stringify(value);\n    }\n}\nfunction json(name) {\n    return new MySqlJsonBuilder(name);\n}\n\nclass MySqlMediumIntBuilder extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.d {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlMediumIntBuilder';\n    constructor(name) {\n        super(name, 'number', 'MySqlMediumInt');\n    }\n    /** @internal */\n    build(table) {\n        return new MySqlMediumInt(table, this.config);\n    }\n}\nclass MySqlMediumInt extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.e {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlMediumInt';\n    getSQLType() {\n        return 'mediumint';\n    }\n    mapFromDriverValue(value) {\n        if (typeof value === 'string') {\n            return Number(value);\n        }\n        return value;\n    }\n}\nfunction mediumint(name) {\n    return new MySqlMediumIntBuilder(name);\n}\n\nclass MySqlRealBuilder extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.d {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlRealBuilder';\n    constructor(name, config) {\n        super(name, 'number', 'MySqlReal');\n        this.config.precision = config?.precision;\n        this.config.scale = config?.scale;\n    }\n    /** @internal */\n    build(table) {\n        return new MySqlReal(table, this.config);\n    }\n}\nclass MySqlReal extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.e {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlReal';\n    precision = this.config.precision;\n    scale = this.config.scale;\n    getSQLType() {\n        if (this.precision !== undefined && this.scale !== undefined) {\n            return `real(${this.precision}, ${this.scale})`;\n        }\n        else if (this.precision === undefined) {\n            return 'real';\n        }\n        else {\n            return `real(${this.precision})`;\n        }\n    }\n}\nfunction real(name, config = {}) {\n    return new MySqlRealBuilder(name, config);\n}\n\nclass MySqlSerialBuilder extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.d {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlSerialBuilder';\n    constructor(name) {\n        super(name, 'number', 'MySqlSerial');\n        this.config.hasDefault = true;\n        this.config.autoIncrement = true;\n    }\n    /** @internal */\n    build(table) {\n        return new MySqlSerial(table, this.config);\n    }\n}\nclass MySqlSerial extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.e {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlSerial';\n    getSQLType() {\n        return 'serial';\n    }\n    mapFromDriverValue(value) {\n        if (typeof value === 'string') {\n            return Number(value);\n        }\n        return value;\n    }\n}\nfunction serial(name) {\n    return new MySqlSerialBuilder(name);\n}\n\nclass MySqlSmallIntBuilder extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.d {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlSmallIntBuilder';\n    constructor(name) {\n        super(name, 'number', 'MySqlSmallInt');\n    }\n    /** @internal */\n    build(table) {\n        return new MySqlSmallInt(table, this.config);\n    }\n}\nclass MySqlSmallInt extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.e {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlSmallInt';\n    getSQLType() {\n        return 'smallint';\n    }\n    mapFromDriverValue(value) {\n        if (typeof value === 'string') {\n            return Number(value);\n        }\n        return value;\n    }\n}\nfunction smallint(name) {\n    return new MySqlSmallIntBuilder(name);\n}\n\nclass MySqlTextBuilder extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.f {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlTextBuilder';\n    constructor(name, textType, config) {\n        super(name, 'string', 'MySqlText');\n        this.config.textType = textType;\n        this.config.enumValues = config.enum;\n    }\n    /** @internal */\n    build(table) {\n        return new MySqlText(table, this.config);\n    }\n}\nclass MySqlText extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.g {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlText';\n    textType = this.config.textType;\n    enumValues = this.config.enumValues;\n    getSQLType() {\n        return this.textType;\n    }\n}\nfunction text(name, config = {}) {\n    return new MySqlTextBuilder(name, 'text', config);\n}\nfunction tinytext(name, config = {}) {\n    return new MySqlTextBuilder(name, 'tinytext', config);\n}\nfunction mediumtext(name, config = {}) {\n    return new MySqlTextBuilder(name, 'mediumtext', config);\n}\nfunction longtext(name, config = {}) {\n    return new MySqlTextBuilder(name, 'longtext', config);\n}\n\nclass MySqlTimeBuilder extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.f {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlTimeBuilder';\n    constructor(name, config) {\n        super(name, 'string', 'MySqlTime');\n        this.config.fsp = config?.fsp;\n    }\n    /** @internal */\n    build(table) {\n        return new MySqlTime(table, this.config);\n    }\n}\nclass MySqlTime extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.g {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlTime';\n    fsp = this.config.fsp;\n    getSQLType() {\n        const precision = this.fsp === undefined ? '' : `(${this.fsp})`;\n        return `time${precision}`;\n    }\n}\nfunction time(name, config) {\n    return new MySqlTimeBuilder(name, config);\n}\n\nclass MySqlDateColumnBaseBuilder extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.f {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlDateColumnBuilder';\n    defaultNow() {\n        return this.default((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.s) `(now())`);\n    }\n    // \"on update now\" also adds an implicit default value to the column - https://dev.mysql.com/doc/refman/8.0/en/timestamp-initialization.html\n    onUpdateNow() {\n        this.config.hasOnUpdateNow = true;\n        this.config.hasDefault = true;\n        return this;\n    }\n}\nclass MySqlDateBaseColumn extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.g {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlDateColumn';\n    hasOnUpdateNow = this.config.hasOnUpdateNow;\n}\n\nclass MySqlTimestampBuilder extends MySqlDateColumnBaseBuilder {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlTimestampBuilder';\n    constructor(name, config) {\n        super(name, 'date', 'MySqlTimestamp');\n        this.config.fsp = config?.fsp;\n    }\n    /** @internal */\n    build(table) {\n        return new MySqlTimestamp(table, this.config);\n    }\n}\nclass MySqlTimestamp extends MySqlDateBaseColumn {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlTimestamp';\n    fsp = this.config.fsp;\n    getSQLType() {\n        const precision = this.fsp === undefined ? '' : `(${this.fsp})`;\n        return `timestamp${precision}`;\n    }\n    mapFromDriverValue(value) {\n        return new Date(value + '+0000');\n    }\n    mapToDriverValue(value) {\n        return value.toISOString().slice(0, -1).replace('T', ' ');\n    }\n}\nclass MySqlTimestampStringBuilder extends MySqlDateColumnBaseBuilder {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlTimestampStringBuilder';\n    constructor(name, config) {\n        super(name, 'string', 'MySqlTimestampString');\n        this.config.fsp = config?.fsp;\n    }\n    /** @internal */\n    build(table) {\n        return new MySqlTimestampString(table, this.config);\n    }\n}\nclass MySqlTimestampString extends MySqlDateBaseColumn {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlTimestampString';\n    fsp = this.config.fsp;\n    getSQLType() {\n        const precision = this.fsp === undefined ? '' : `(${this.fsp})`;\n        return `timestamp${precision}`;\n    }\n}\nfunction timestamp(name, config = {}) {\n    if (config.mode === 'string') {\n        return new MySqlTimestampStringBuilder(name, config);\n    }\n    return new MySqlTimestampBuilder(name, config);\n}\n\nclass MySqlTinyIntBuilder extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.d {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlTinyIntBuilder';\n    constructor(name) {\n        super(name, 'number', 'MySqlTinyInt');\n    }\n    /** @internal */\n    build(table) {\n        return new MySqlTinyInt(table, this.config);\n    }\n}\nclass MySqlTinyInt extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.e {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlTinyInt';\n    getSQLType() {\n        return 'tinyint';\n    }\n    mapFromDriverValue(value) {\n        if (typeof value === 'string') {\n            return Number(value);\n        }\n        return value;\n    }\n}\nfunction tinyint(name) {\n    return new MySqlTinyIntBuilder(name);\n}\n\nclass MySqlVarBinaryBuilder extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.f {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlVarBinaryBuilder';\n    /** @internal */\n    constructor(name, config) {\n        super(name, 'string', 'MySqlVarBinary');\n        this.config.length = config?.length;\n    }\n    /** @internal */\n    build(table) {\n        return new MySqlVarBinary(table, this.config);\n    }\n}\nclass MySqlVarBinary extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.g {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlVarBinary';\n    length = this.config.length;\n    getSQLType() {\n        return this.length === undefined ? `varbinary` : `varbinary(${this.length})`;\n    }\n}\nfunction varbinary(name, options) {\n    return new MySqlVarBinaryBuilder(name, options);\n}\n\nclass MySqlVarCharBuilder extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.f {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlVarCharBuilder';\n    /** @internal */\n    constructor(name, config) {\n        super(name, 'string', 'MySqlVarChar');\n        this.config.length = config.length;\n        this.config.enum = config.enum;\n    }\n    /** @internal */\n    build(table) {\n        return new MySqlVarChar(table, this.config);\n    }\n}\nclass MySqlVarChar extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.g {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlVarChar';\n    length = this.config.length;\n    enumValues = this.config.enum;\n    getSQLType() {\n        return this.length === undefined ? `varchar` : `varchar(${this.length})`;\n    }\n}\nfunction varchar(name, config) {\n    return new MySqlVarCharBuilder(name, config);\n}\n\nclass MySqlYearBuilder extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.f {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlYearBuilder';\n    constructor(name) {\n        super(name, 'number', 'MySqlYear');\n    }\n    /** @internal */\n    build(table) {\n        return new MySqlYear(table, this.config);\n    }\n}\nclass MySqlYear extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.g {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlYear';\n    getSQLType() {\n        return `year`;\n    }\n}\nfunction year(name) {\n    return new MySqlYearBuilder(name);\n}\n\nfunction alias(table, alias) {\n    return new Proxy(table, new _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.n(alias, false));\n}\n\nclass CheckBuilder {\n    name;\n    value;\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlCheckBuilder';\n    brand;\n    constructor(name, value) {\n        this.name = name;\n        this.value = value;\n    }\n    /** @internal */\n    build(table) {\n        return new Check(table, this);\n    }\n}\nclass Check {\n    table;\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlCheck';\n    name;\n    value;\n    constructor(table, builder) {\n        this.table = table;\n        this.name = builder.name;\n        this.value = builder.value;\n    }\n}\nfunction check(name, value) {\n    return new CheckBuilder(name, value);\n}\n\nclass IndexBuilderOn {\n    name;\n    unique;\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlIndexBuilderOn';\n    constructor(name, unique) {\n        this.name = name;\n        this.unique = unique;\n    }\n    on(...columns) {\n        return new IndexBuilder(this.name, columns, this.unique);\n    }\n}\nclass IndexBuilder {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlIndexBuilder';\n    /** @internal */\n    config;\n    constructor(name, columns, unique) {\n        this.config = {\n            name,\n            columns,\n            unique,\n        };\n    }\n    using(using) {\n        this.config.using = using;\n        return this;\n    }\n    algorythm(algorythm) {\n        this.config.algorythm = algorythm;\n        return this;\n    }\n    lock(lock) {\n        this.config.lock = lock;\n        return this;\n    }\n    /** @internal */\n    build(table) {\n        return new Index(this.config, table);\n    }\n}\nclass Index {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlIndex';\n    config;\n    constructor(config, table) {\n        this.config = { ...config, table };\n    }\n}\nfunction index(name) {\n    return new IndexBuilderOn(name, false);\n}\nfunction uniqueIndex(name) {\n    return new IndexBuilderOn(name, true);\n}\n\nfunction primaryKey(...columns) {\n    return new PrimaryKeyBuilder(columns);\n}\nclass PrimaryKeyBuilder {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlPrimaryKeyBuilder';\n    /** @internal */\n    columns;\n    constructor(columns) {\n        this.columns = columns;\n    }\n    /** @internal */\n    build(table) {\n        return new PrimaryKey(table, this.columns);\n    }\n}\nclass PrimaryKey {\n    table;\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlPrimaryKey';\n    columns;\n    constructor(table, columns) {\n        this.table = table;\n        this.columns = columns;\n    }\n    getName() {\n        return `${this.table[_view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.h.Symbol.Name]}_${this.columns.map((column) => column.name).join('_')}_pk`;\n    }\n}\n\nclass MySqlSchema {\n    schemaName;\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.e] = 'MySqlSchema';\n    constructor(schemaName) {\n        this.schemaName = schemaName;\n    }\n    table = (name, columns, extraConfig) => {\n        return (0,_view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.m)(name, columns, extraConfig, this.schemaName);\n    };\n    view = ((name, columns) => {\n        return (0,_view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(name, columns, this.schemaName);\n    });\n}\n/** @deprecated - use `instanceof MySqlSchema` */\nfunction isMySqlSchema(obj) {\n    return (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.i)(obj, MySqlSchema);\n}\n/**\n * Create a MySQL schema.\n * https://dev.mysql.com/doc/refman/8.0/en/create-database.html\n *\n * @param name mysql use schema name\n * @returns MySQL schema\n */\nfunction mysqlDatabase(name) {\n    return new MySqlSchema(name);\n}\n/**\n * @see mysqlDatabase\n */\nconst mysqlSchema = mysqlDatabase;\n\nfunction getTableConfig(table) {\n    const columns = Object.values(table[_view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.h.Symbol.Columns]);\n    const indexes = [];\n    const checks = [];\n    const primaryKeys = [];\n    const uniqueConstraints = [];\n    const foreignKeys = Object.values(table[_view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.h.Symbol.InlineForeignKeys]);\n    const name = table[_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.T.Symbol.Name];\n    const schema = table[_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.T.Symbol.Schema];\n    const baseName = table[_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.T.Symbol.BaseName];\n    const extraConfigBuilder = table[_view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.h.Symbol.ExtraConfigBuilder];\n    if (extraConfigBuilder !== undefined) {\n        const extraConfig = extraConfigBuilder(table[_view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.h.Symbol.Columns]);\n        for (const builder of Object.values(extraConfig)) {\n            if ((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.i)(builder, IndexBuilder)) {\n                indexes.push(builder.build(table));\n            }\n            else if ((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.i)(builder, CheckBuilder)) {\n                checks.push(builder.build(table));\n            }\n            else if ((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.i)(builder, _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.U)) {\n                uniqueConstraints.push(builder.build(table));\n            }\n            else if ((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.i)(builder, PrimaryKeyBuilder)) {\n                primaryKeys.push(builder.build(table));\n            }\n            else if ((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.i)(builder, _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.F)) {\n                foreignKeys.push(builder.build(table));\n            }\n        }\n    }\n    return {\n        columns,\n        indexes,\n        foreignKeys,\n        checks,\n        primaryKeys,\n        uniqueConstraints,\n        name,\n        schema,\n        baseName,\n    };\n}\nfunction getViewConfig(view) {\n    return {\n        ...view[_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_1__.V],\n        ...view[_view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_0__.j],\n    };\n}\n\n\n//# sourceMappingURL=index.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvZHJpenpsZS1vcm0vbXlzcWwtY29yZS9pbmRleC5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUF5STtBQUN1SztBQUM4VTs7QUFFOW5CLG1DQUFtQyxpREFBbUM7QUFDdEUsWUFBWSxrREFBVTtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLGlEQUE0QjtBQUN4RCxZQUFZLGtEQUFVO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUNBQW1DLGlEQUFtQztBQUN0RSxZQUFZLGtEQUFVO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsaURBQTRCO0FBQ3hELFlBQVksa0RBQVU7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxpQ0FBaUMsaURBQWtCO0FBQ25ELFlBQVksa0RBQVU7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCLGlEQUFXO0FBQ3JDLFlBQVksa0RBQVU7QUFDdEI7QUFDQTtBQUNBLGdFQUFnRSxZQUFZO0FBQzVFO0FBQ0E7QUFDQSxpQ0FBaUM7QUFDakM7QUFDQTs7QUFFQSxrQ0FBa0MsaURBQWtCO0FBQ3BELFlBQVksa0RBQVU7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixpREFBVztBQUN0QyxZQUFZLGtEQUFVO0FBQ3RC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QUFnQixrREFBYztBQUM5QixnQkFBZ0IsaURBQWU7QUFDL0I7QUFDQTs7QUFFc29EO0FBQ3RvRCIsInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxFZGdhciBKIFJvamFzIExcXGRldlxcY2FwcmVzLXdlYlxcbm9kZV9tb2R1bGVzXFxkcml6emxlLW9ybVxcbXlzcWwtY29yZVxcaW5kZXgubWpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGUgYXMgZW50aXR5S2luZCwgcyBhcyBzcWwsIG4gYXMgVGFibGVBbGlhc1Byb3h5SGFuZGxlciwgaSBhcyBpcywgVCBhcyBUYWJsZSwgViBhcyBWaWV3QmFzZUNvbmZpZyB9IGZyb20gJy4uL2FsaWFzLWNmOGUwM2NkLm1qcyc7XG5pbXBvcnQgeyBkIGFzIE15U3FsQ29sdW1uQnVpbGRlcldpdGhBdXRvSW5jcmVtZW50LCBlIGFzIE15U3FsQ29sdW1uV2l0aEF1dG9JbmNyZW1lbnQsIGYgYXMgTXlTcWxDb2x1bW5CdWlsZGVyLCBnIGFzIE15U3FsQ29sdW1uLCBoIGFzIE15U3FsVGFibGUsIG0gYXMgbXlzcWxUYWJsZVdpdGhTY2hlbWEsIGkgYXMgbXlzcWxWaWV3V2l0aFNjaGVtYSwgVSBhcyBVbmlxdWVDb25zdHJhaW50QnVpbGRlciwgRiBhcyBGb3JlaWduS2V5QnVpbGRlciwgaiBhcyBNeVNxbFZpZXdDb25maWcgfSBmcm9tICcuLi92aWV3LTIzODk4ZjIxLm1qcyc7XG5leHBvcnQgeyBrIGFzIEZvcmVpZ25LZXksIEkgYXMgSW5saW5lRm9yZWlnbktleXMsIEMgYXMgTWFudWFsVmlld0J1aWxkZXIsIGIgYXMgTXlTcWxEYXRhYmFzZSwgbiBhcyBNeVNxbERlbGV0ZSwgYyBhcyBNeVNxbERpYWxlY3QsIHAgYXMgTXlTcWxJbnNlcnQsIG8gYXMgTXlTcWxJbnNlcnRCdWlsZGVyLCBzIGFzIE15U3FsU2VsZWN0LCBxIGFzIE15U3FsU2VsZWN0QnVpbGRlciwgciBhcyBNeVNxbFNlbGVjdFF1ZXJ5QnVpbGRlciwgTSBhcyBNeVNxbFNlc3Npb24sIGEgYXMgTXlTcWxUcmFuc2FjdGlvbiwgdSBhcyBNeVNxbFVwZGF0ZSwgdCBhcyBNeVNxbFVwZGF0ZUJ1aWxkZXIsIEUgYXMgTXlTcWxWaWV3LCBEIGFzIE15U3FsVmlld0Jhc2UsIFAgYXMgUHJlcGFyZWRRdWVyeSwgUSBhcyBRdWVyeUJ1aWxkZXIsIEEgYXMgVW5pcXVlQ29uc3RyYWludCwgeiBhcyBVbmlxdWVPbkNvbnN0cmFpbnRCdWlsZGVyLCBCIGFzIFZpZXdCdWlsZGVyLCBWIGFzIFZpZXdCdWlsZGVyQ29yZSwgbCBhcyBmb3JlaWduS2V5LCB2IGFzIG15c3FsVGFibGUsIHcgYXMgbXlzcWxUYWJsZUNyZWF0b3IsIEcgYXMgbXlzcWxWaWV3LCB4IGFzIHVuaXF1ZSwgeSBhcyB1bmlxdWVLZXlOYW1lIH0gZnJvbSAnLi4vdmlldy0yMzg5OGYyMS5tanMnO1xuXG5jbGFzcyBNeVNxbEJpZ0ludDUzQnVpbGRlciBleHRlbmRzIE15U3FsQ29sdW1uQnVpbGRlcldpdGhBdXRvSW5jcmVtZW50IHtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ015U3FsQmlnSW50NTNCdWlsZGVyJztcbiAgICBjb25zdHJ1Y3RvcihuYW1lKSB7XG4gICAgICAgIHN1cGVyKG5hbWUsICdudW1iZXInLCAnTXlTcWxCaWdJbnQ1MycpO1xuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgYnVpbGQodGFibGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBNeVNxbEJpZ0ludDUzKHRhYmxlLCB0aGlzLmNvbmZpZyk7XG4gICAgfVxufVxuY2xhc3MgTXlTcWxCaWdJbnQ1MyBleHRlbmRzIE15U3FsQ29sdW1uV2l0aEF1dG9JbmNyZW1lbnQge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnTXlTcWxCaWdJbnQ1Myc7XG4gICAgZ2V0U1FMVHlwZSgpIHtcbiAgICAgICAgcmV0dXJuICdiaWdpbnQnO1xuICAgIH1cbiAgICBtYXBGcm9tRHJpdmVyVmFsdWUodmFsdWUpIHtcbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gTnVtYmVyKHZhbHVlKTtcbiAgICB9XG59XG5jbGFzcyBNeVNxbEJpZ0ludDY0QnVpbGRlciBleHRlbmRzIE15U3FsQ29sdW1uQnVpbGRlcldpdGhBdXRvSW5jcmVtZW50IHtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ015U3FsQmlnSW50NjRCdWlsZGVyJztcbiAgICBjb25zdHJ1Y3RvcihuYW1lKSB7XG4gICAgICAgIHN1cGVyKG5hbWUsICdiaWdpbnQnLCAnTXlTcWxCaWdJbnQ2NCcpO1xuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgYnVpbGQodGFibGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBNeVNxbEJpZ0ludDY0KHRhYmxlLCB0aGlzLmNvbmZpZyk7XG4gICAgfVxufVxuY2xhc3MgTXlTcWxCaWdJbnQ2NCBleHRlbmRzIE15U3FsQ29sdW1uV2l0aEF1dG9JbmNyZW1lbnQge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnTXlTcWxCaWdJbnQ2NCc7XG4gICAgZ2V0U1FMVHlwZSgpIHtcbiAgICAgICAgcmV0dXJuICdiaWdpbnQnO1xuICAgIH1cbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgdW5pY29ybi9wcmVmZXItbmF0aXZlLWNvZXJjaW9uLWZ1bmN0aW9uc1xuICAgIG1hcEZyb21Ecml2ZXJWYWx1ZSh2YWx1ZSkge1xuICAgICAgICByZXR1cm4gQmlnSW50KHZhbHVlKTtcbiAgICB9XG59XG5mdW5jdGlvbiBiaWdpbnQobmFtZSwgY29uZmlnKSB7XG4gICAgaWYgKGNvbmZpZy5tb2RlID09PSAnbnVtYmVyJykge1xuICAgICAgICByZXR1cm4gbmV3IE15U3FsQmlnSW50NTNCdWlsZGVyKG5hbWUpO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IE15U3FsQmlnSW50NjRCdWlsZGVyKG5hbWUpO1xufVxuXG5jbGFzcyBNeVNxbEJpbmFyeUJ1aWxkZXIgZXh0ZW5kcyBNeVNxbENvbHVtbkJ1aWxkZXIge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnTXlTcWxCaW5hcnlCdWlsZGVyJztcbiAgICBjb25zdHJ1Y3RvcihuYW1lLCBsZW5ndGgpIHtcbiAgICAgICAgc3VwZXIobmFtZSwgJ3N0cmluZycsICdNeVNxbEJpbmFyeScpO1xuICAgICAgICB0aGlzLmNvbmZpZy5sZW5ndGggPSBsZW5ndGg7XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBidWlsZCh0YWJsZSkge1xuICAgICAgICByZXR1cm4gbmV3IE15U3FsQmluYXJ5KHRhYmxlLCB0aGlzLmNvbmZpZyk7XG4gICAgfVxufVxuY2xhc3MgTXlTcWxCaW5hcnkgZXh0ZW5kcyBNeVNxbENvbHVtbiB7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdNeVNxbEJpbmFyeSc7XG4gICAgbGVuZ3RoID0gdGhpcy5jb25maWcubGVuZ3RoO1xuICAgIGdldFNRTFR5cGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmxlbmd0aCA9PT0gdW5kZWZpbmVkID8gYGJpbmFyeWAgOiBgYmluYXJ5KCR7dGhpcy5sZW5ndGh9KWA7XG4gICAgfVxufVxuZnVuY3Rpb24gYmluYXJ5KG5hbWUsIGNvbmZpZyA9IHt9KSB7XG4gICAgcmV0dXJuIG5ldyBNeVNxbEJpbmFyeUJ1aWxkZXIobmFtZSwgY29uZmlnLmxlbmd0aCk7XG59XG5cbmNsYXNzIE15U3FsQm9vbGVhbkJ1aWxkZXIgZXh0ZW5kcyBNeVNxbENvbHVtbkJ1aWxkZXIge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnTXlTcWxCb29sZWFuQnVpbGRlcic7XG4gICAgY29uc3RydWN0b3IobmFtZSkge1xuICAgICAgICBzdXBlcihuYW1lLCAnYm9vbGVhbicsICdNeVNxbEJvb2xlYW4nKTtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGJ1aWxkKHRhYmxlKSB7XG4gICAgICAgIHJldHVybiBuZXcgTXlTcWxCb29sZWFuKHRhYmxlLCB0aGlzLmNvbmZpZyk7XG4gICAgfVxufVxuY2xhc3MgTXlTcWxCb29sZWFuIGV4dGVuZHMgTXlTcWxDb2x1bW4ge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnTXlTcWxCb29sZWFuJztcbiAgICBnZXRTUUxUeXBlKCkge1xuICAgICAgICByZXR1cm4gJ2Jvb2xlYW4nO1xuICAgIH1cbiAgICBtYXBGcm9tRHJpdmVyVmFsdWUodmFsdWUpIHtcbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHZhbHVlID09PSAxO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGJvb2xlYW4obmFtZSkge1xuICAgIHJldHVybiBuZXcgTXlTcWxCb29sZWFuQnVpbGRlcihuYW1lKTtcbn1cblxuY2xhc3MgTXlTcWxDaGFyQnVpbGRlciBleHRlbmRzIE15U3FsQ29sdW1uQnVpbGRlciB7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdNeVNxbENoYXJCdWlsZGVyJztcbiAgICBjb25zdHJ1Y3RvcihuYW1lLCBjb25maWcpIHtcbiAgICAgICAgc3VwZXIobmFtZSwgJ3N0cmluZycsICdNeVNxbENoYXInKTtcbiAgICAgICAgdGhpcy5jb25maWcubGVuZ3RoID0gY29uZmlnLmxlbmd0aDtcbiAgICAgICAgdGhpcy5jb25maWcuZW51bSA9IGNvbmZpZy5lbnVtO1xuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgYnVpbGQodGFibGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBNeVNxbENoYXIodGFibGUsIHRoaXMuY29uZmlnKTtcbiAgICB9XG59XG5jbGFzcyBNeVNxbENoYXIgZXh0ZW5kcyBNeVNxbENvbHVtbiB7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdNeVNxbENoYXInO1xuICAgIGxlbmd0aCA9IHRoaXMuY29uZmlnLmxlbmd0aDtcbiAgICBlbnVtVmFsdWVzID0gdGhpcy5jb25maWcuZW51bTtcbiAgICBnZXRTUUxUeXBlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5sZW5ndGggPT09IHVuZGVmaW5lZCA/IGBjaGFyYCA6IGBjaGFyKCR7dGhpcy5sZW5ndGh9KWA7XG4gICAgfVxufVxuZnVuY3Rpb24gY2hhcihuYW1lLCBjb25maWcgPSB7fSkge1xuICAgIHJldHVybiBuZXcgTXlTcWxDaGFyQnVpbGRlcihuYW1lLCBjb25maWcpO1xufVxuXG5jbGFzcyBNeVNxbEN1c3RvbUNvbHVtbkJ1aWxkZXIgZXh0ZW5kcyBNeVNxbENvbHVtbkJ1aWxkZXIge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnTXlTcWxDdXN0b21Db2x1bW5CdWlsZGVyJztcbiAgICBjb25zdHJ1Y3RvcihuYW1lLCBmaWVsZENvbmZpZywgY3VzdG9tVHlwZVBhcmFtcykge1xuICAgICAgICBzdXBlcihuYW1lLCAnY3VzdG9tJywgJ015U3FsQ3VzdG9tQ29sdW1uJyk7XG4gICAgICAgIHRoaXMuY29uZmlnLmZpZWxkQ29uZmlnID0gZmllbGRDb25maWc7XG4gICAgICAgIHRoaXMuY29uZmlnLmN1c3RvbVR5cGVQYXJhbXMgPSBjdXN0b21UeXBlUGFyYW1zO1xuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgYnVpbGQodGFibGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBNeVNxbEN1c3RvbUNvbHVtbih0YWJsZSwgdGhpcy5jb25maWcpO1xuICAgIH1cbn1cbmNsYXNzIE15U3FsQ3VzdG9tQ29sdW1uIGV4dGVuZHMgTXlTcWxDb2x1bW4ge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnTXlTcWxDdXN0b21Db2x1bW4nO1xuICAgIHNxbE5hbWU7XG4gICAgbWFwVG87XG4gICAgbWFwRnJvbTtcbiAgICBjb25zdHJ1Y3Rvcih0YWJsZSwgY29uZmlnKSB7XG4gICAgICAgIHN1cGVyKHRhYmxlLCBjb25maWcpO1xuICAgICAgICB0aGlzLnNxbE5hbWUgPSBjb25maWcuY3VzdG9tVHlwZVBhcmFtcy5kYXRhVHlwZShjb25maWcuZmllbGRDb25maWcpO1xuICAgICAgICB0aGlzLm1hcFRvID0gY29uZmlnLmN1c3RvbVR5cGVQYXJhbXMudG9Ecml2ZXI7XG4gICAgICAgIHRoaXMubWFwRnJvbSA9IGNvbmZpZy5jdXN0b21UeXBlUGFyYW1zLmZyb21Ecml2ZXI7XG4gICAgfVxuICAgIGdldFNRTFR5cGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNxbE5hbWU7XG4gICAgfVxuICAgIG1hcEZyb21Ecml2ZXJWYWx1ZSh2YWx1ZSkge1xuICAgICAgICByZXR1cm4gdHlwZW9mIHRoaXMubWFwRnJvbSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMubWFwRnJvbSh2YWx1ZSkgOiB2YWx1ZTtcbiAgICB9XG4gICAgbWFwVG9Ecml2ZXJWYWx1ZSh2YWx1ZSkge1xuICAgICAgICByZXR1cm4gdHlwZW9mIHRoaXMubWFwVG8gPT09ICdmdW5jdGlvbicgPyB0aGlzLm1hcFRvKHZhbHVlKSA6IHZhbHVlO1xuICAgIH1cbn1cbi8qKlxuICogQ3VzdG9tIG15c3FsIGRhdGFiYXNlIGRhdGEgdHlwZSBnZW5lcmF0b3JcbiAqL1xuZnVuY3Rpb24gY3VzdG9tVHlwZShjdXN0b21UeXBlUGFyYW1zKSB7XG4gICAgcmV0dXJuIChkYk5hbWUsIGZpZWxkQ29uZmlnKSA9PiB7XG4gICAgICAgIHJldHVybiBuZXcgTXlTcWxDdXN0b21Db2x1bW5CdWlsZGVyKGRiTmFtZSwgZmllbGRDb25maWcsIGN1c3RvbVR5cGVQYXJhbXMpO1xuICAgIH07XG59XG5cbmNsYXNzIE15U3FsRGF0ZUJ1aWxkZXIgZXh0ZW5kcyBNeVNxbENvbHVtbkJ1aWxkZXIge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnTXlTcWxEYXRlQnVpbGRlcic7XG4gICAgY29uc3RydWN0b3IobmFtZSkge1xuICAgICAgICBzdXBlcihuYW1lLCAnZGF0ZScsICdNeVNxbERhdGUnKTtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGJ1aWxkKHRhYmxlKSB7XG4gICAgICAgIHJldHVybiBuZXcgTXlTcWxEYXRlKHRhYmxlLCB0aGlzLmNvbmZpZyk7XG4gICAgfVxufVxuY2xhc3MgTXlTcWxEYXRlIGV4dGVuZHMgTXlTcWxDb2x1bW4ge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnTXlTcWxEYXRlJztcbiAgICBjb25zdHJ1Y3Rvcih0YWJsZSwgY29uZmlnKSB7XG4gICAgICAgIHN1cGVyKHRhYmxlLCBjb25maWcpO1xuICAgIH1cbiAgICBnZXRTUUxUeXBlKCkge1xuICAgICAgICByZXR1cm4gYGRhdGVgO1xuICAgIH1cbiAgICBtYXBGcm9tRHJpdmVyVmFsdWUodmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKHZhbHVlKTtcbiAgICB9XG59XG5jbGFzcyBNeVNxbERhdGVTdHJpbmdCdWlsZGVyIGV4dGVuZHMgTXlTcWxDb2x1bW5CdWlsZGVyIHtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ015U3FsRGF0ZVN0cmluZ0J1aWxkZXInO1xuICAgIGNvbnN0cnVjdG9yKG5hbWUpIHtcbiAgICAgICAgc3VwZXIobmFtZSwgJ3N0cmluZycsICdNeVNxbERhdGVTdHJpbmcnKTtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGJ1aWxkKHRhYmxlKSB7XG4gICAgICAgIHJldHVybiBuZXcgTXlTcWxEYXRlU3RyaW5nKHRhYmxlLCB0aGlzLmNvbmZpZyk7XG4gICAgfVxufVxuY2xhc3MgTXlTcWxEYXRlU3RyaW5nIGV4dGVuZHMgTXlTcWxDb2x1bW4ge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnTXlTcWxEYXRlU3RyaW5nJztcbiAgICBjb25zdHJ1Y3Rvcih0YWJsZSwgY29uZmlnKSB7XG4gICAgICAgIHN1cGVyKHRhYmxlLCBjb25maWcpO1xuICAgIH1cbiAgICBnZXRTUUxUeXBlKCkge1xuICAgICAgICByZXR1cm4gYGRhdGVgO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGRhdGUobmFtZSwgY29uZmlnID0ge30pIHtcbiAgICBpZiAoY29uZmlnLm1vZGUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIHJldHVybiBuZXcgTXlTcWxEYXRlU3RyaW5nQnVpbGRlcihuYW1lKTtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBNeVNxbERhdGVCdWlsZGVyKG5hbWUpO1xufVxuXG5jbGFzcyBNeVNxbERhdGVUaW1lQnVpbGRlciBleHRlbmRzIE15U3FsQ29sdW1uQnVpbGRlciB7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdNeVNxbERhdGVUaW1lQnVpbGRlcic7XG4gICAgY29uc3RydWN0b3IobmFtZSwgY29uZmlnKSB7XG4gICAgICAgIHN1cGVyKG5hbWUsICdkYXRlJywgJ015U3FsRGF0ZVRpbWUnKTtcbiAgICAgICAgdGhpcy5jb25maWcuZnNwID0gY29uZmlnPy5mc3A7XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBidWlsZCh0YWJsZSkge1xuICAgICAgICByZXR1cm4gbmV3IE15U3FsRGF0ZVRpbWUodGFibGUsIHRoaXMuY29uZmlnKTtcbiAgICB9XG59XG5jbGFzcyBNeVNxbERhdGVUaW1lIGV4dGVuZHMgTXlTcWxDb2x1bW4ge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnTXlTcWxEYXRlVGltZSc7XG4gICAgZnNwO1xuICAgIGNvbnN0cnVjdG9yKHRhYmxlLCBjb25maWcpIHtcbiAgICAgICAgc3VwZXIodGFibGUsIGNvbmZpZyk7XG4gICAgICAgIHRoaXMuZnNwID0gY29uZmlnLmZzcDtcbiAgICB9XG4gICAgZ2V0U1FMVHlwZSgpIHtcbiAgICAgICAgY29uc3QgcHJlY2lzaW9uID0gdGhpcy5mc3AgPT09IHVuZGVmaW5lZCA/ICcnIDogYCgke3RoaXMuZnNwfSlgO1xuICAgICAgICByZXR1cm4gYGRhdGV0aW1lJHtwcmVjaXNpb259YDtcbiAgICB9XG4gICAgbWFwVG9Ecml2ZXJWYWx1ZSh2YWx1ZSkge1xuICAgICAgICByZXR1cm4gdmFsdWUudG9JU09TdHJpbmcoKS5yZXBsYWNlKCdUJywgJyAnKS5yZXBsYWNlKCdaJywgJycpO1xuICAgIH1cbiAgICBtYXBGcm9tRHJpdmVyVmFsdWUodmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKHZhbHVlLnJlcGxhY2UoJyAnLCAnVCcpICsgJ1onKTtcbiAgICB9XG59XG5jbGFzcyBNeVNxbERhdGVUaW1lU3RyaW5nQnVpbGRlciBleHRlbmRzIE15U3FsQ29sdW1uQnVpbGRlciB7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdNeVNxbERhdGVUaW1lU3RyaW5nQnVpbGRlcic7XG4gICAgY29uc3RydWN0b3IobmFtZSwgY29uZmlnKSB7XG4gICAgICAgIHN1cGVyKG5hbWUsICdzdHJpbmcnLCAnTXlTcWxEYXRlVGltZVN0cmluZycpO1xuICAgICAgICB0aGlzLmNvbmZpZy5mc3AgPSBjb25maWc/LmZzcDtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGJ1aWxkKHRhYmxlKSB7XG4gICAgICAgIHJldHVybiBuZXcgTXlTcWxEYXRlVGltZVN0cmluZyh0YWJsZSwgdGhpcy5jb25maWcpO1xuICAgIH1cbn1cbmNsYXNzIE15U3FsRGF0ZVRpbWVTdHJpbmcgZXh0ZW5kcyBNeVNxbENvbHVtbiB7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdNeVNxbERhdGVUaW1lU3RyaW5nJztcbiAgICBmc3A7XG4gICAgY29uc3RydWN0b3IodGFibGUsIGNvbmZpZykge1xuICAgICAgICBzdXBlcih0YWJsZSwgY29uZmlnKTtcbiAgICAgICAgdGhpcy5mc3AgPSBjb25maWcuZnNwO1xuICAgIH1cbiAgICBnZXRTUUxUeXBlKCkge1xuICAgICAgICBjb25zdCBwcmVjaXNpb24gPSB0aGlzLmZzcCA9PT0gdW5kZWZpbmVkID8gJycgOiBgKCR7dGhpcy5mc3B9KWA7XG4gICAgICAgIHJldHVybiBgZGF0ZXRpbWUke3ByZWNpc2lvbn1gO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGRhdGV0aW1lKG5hbWUsIGNvbmZpZyA9IHt9KSB7XG4gICAgaWYgKGNvbmZpZy5tb2RlID09PSAnc3RyaW5nJykge1xuICAgICAgICByZXR1cm4gbmV3IE15U3FsRGF0ZVRpbWVTdHJpbmdCdWlsZGVyKG5hbWUsIGNvbmZpZyk7XG4gICAgfVxuICAgIHJldHVybiBuZXcgTXlTcWxEYXRlVGltZUJ1aWxkZXIobmFtZSwgY29uZmlnKTtcbn1cblxuY2xhc3MgTXlTcWxEZWNpbWFsQnVpbGRlciBleHRlbmRzIE15U3FsQ29sdW1uQnVpbGRlcldpdGhBdXRvSW5jcmVtZW50IHtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ015U3FsRGVjaW1hbEJ1aWxkZXInO1xuICAgIGNvbnN0cnVjdG9yKG5hbWUsIHByZWNpc2lvbiwgc2NhbGUpIHtcbiAgICAgICAgc3VwZXIobmFtZSwgJ3N0cmluZycsICdNeVNxbERlY2ltYWwnKTtcbiAgICAgICAgdGhpcy5jb25maWcucHJlY2lzaW9uID0gcHJlY2lzaW9uO1xuICAgICAgICB0aGlzLmNvbmZpZy5zY2FsZSA9IHNjYWxlO1xuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgYnVpbGQodGFibGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBNeVNxbERlY2ltYWwodGFibGUsIHRoaXMuY29uZmlnKTtcbiAgICB9XG59XG5jbGFzcyBNeVNxbERlY2ltYWwgZXh0ZW5kcyBNeVNxbENvbHVtbldpdGhBdXRvSW5jcmVtZW50IHtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ015U3FsRGVjaW1hbCc7XG4gICAgcHJlY2lzaW9uID0gdGhpcy5jb25maWcucHJlY2lzaW9uO1xuICAgIHNjYWxlID0gdGhpcy5jb25maWcuc2NhbGU7XG4gICAgZ2V0U1FMVHlwZSgpIHtcbiAgICAgICAgaWYgKHRoaXMucHJlY2lzaW9uICE9PSB1bmRlZmluZWQgJiYgdGhpcy5zY2FsZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm4gYGRlY2ltYWwoJHt0aGlzLnByZWNpc2lvbn0sJHt0aGlzLnNjYWxlfSlgO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMucHJlY2lzaW9uID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybiAnZGVjaW1hbCc7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gYGRlY2ltYWwoJHt0aGlzLnByZWNpc2lvbn0pYDtcbiAgICAgICAgfVxuICAgIH1cbn1cbmZ1bmN0aW9uIGRlY2ltYWwobmFtZSwgY29uZmlnID0ge30pIHtcbiAgICByZXR1cm4gbmV3IE15U3FsRGVjaW1hbEJ1aWxkZXIobmFtZSwgY29uZmlnLnByZWNpc2lvbiwgY29uZmlnLnNjYWxlKTtcbn1cblxuY2xhc3MgTXlTcWxEb3VibGVCdWlsZGVyIGV4dGVuZHMgTXlTcWxDb2x1bW5CdWlsZGVyV2l0aEF1dG9JbmNyZW1lbnQge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnTXlTcWxEb3VibGVCdWlsZGVyJztcbiAgICBjb25zdHJ1Y3RvcihuYW1lLCBjb25maWcpIHtcbiAgICAgICAgc3VwZXIobmFtZSwgJ251bWJlcicsICdNeVNxbERvdWJsZScpO1xuICAgICAgICB0aGlzLmNvbmZpZy5wcmVjaXNpb24gPSBjb25maWc/LnByZWNpc2lvbjtcbiAgICAgICAgdGhpcy5jb25maWcuc2NhbGUgPSBjb25maWc/LnNjYWxlO1xuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgYnVpbGQodGFibGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBNeVNxbERvdWJsZSh0YWJsZSwgdGhpcy5jb25maWcpO1xuICAgIH1cbn1cbmNsYXNzIE15U3FsRG91YmxlIGV4dGVuZHMgTXlTcWxDb2x1bW5XaXRoQXV0b0luY3JlbWVudCB7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdNeVNxbERvdWJsZSc7XG4gICAgcHJlY2lzaW9uID0gdGhpcy5jb25maWcucHJlY2lzaW9uO1xuICAgIHNjYWxlID0gdGhpcy5jb25maWcuc2NhbGU7XG4gICAgZ2V0U1FMVHlwZSgpIHtcbiAgICAgICAgaWYgKHRoaXMucHJlY2lzaW9uICE9PSB1bmRlZmluZWQgJiYgdGhpcy5zY2FsZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm4gYGRvdWJsZSgke3RoaXMucHJlY2lzaW9ufSwke3RoaXMuc2NhbGV9KWA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy5wcmVjaXNpb24gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuICdkb3VibGUnO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGBkb3VibGUoJHt0aGlzLnByZWNpc2lvbn0pYDtcbiAgICAgICAgfVxuICAgIH1cbn1cbmZ1bmN0aW9uIGRvdWJsZShuYW1lLCBjb25maWcpIHtcbiAgICByZXR1cm4gbmV3IE15U3FsRG91YmxlQnVpbGRlcihuYW1lLCBjb25maWcpO1xufVxuXG5jbGFzcyBNeVNxbEVudW1Db2x1bW5CdWlsZGVyIGV4dGVuZHMgTXlTcWxDb2x1bW5CdWlsZGVyIHtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ015U3FsRW51bUNvbHVtbkJ1aWxkZXInO1xuICAgIGNvbnN0cnVjdG9yKG5hbWUsIHZhbHVlcykge1xuICAgICAgICBzdXBlcihuYW1lLCAnc3RyaW5nJywgJ015U3FsRW51bUNvbHVtbicpO1xuICAgICAgICB0aGlzLmNvbmZpZy5lbnVtVmFsdWVzID0gdmFsdWVzO1xuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgYnVpbGQodGFibGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBNeVNxbEVudW1Db2x1bW4odGFibGUsIHRoaXMuY29uZmlnKTtcbiAgICB9XG59XG5jbGFzcyBNeVNxbEVudW1Db2x1bW4gZXh0ZW5kcyBNeVNxbENvbHVtbiB7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdNeVNxbEVudW1Db2x1bW4nO1xuICAgIGVudW1WYWx1ZXMgPSB0aGlzLmNvbmZpZy5lbnVtVmFsdWVzO1xuICAgIGdldFNRTFR5cGUoKSB7XG4gICAgICAgIHJldHVybiBgZW51bSgke3RoaXMuZW51bVZhbHVlcy5tYXAoKHZhbHVlKSA9PiBgJyR7dmFsdWV9J2ApLmpvaW4oJywnKX0pYDtcbiAgICB9XG59XG5mdW5jdGlvbiBteXNxbEVudW0obmFtZSwgdmFsdWVzKSB7XG4gICAgaWYgKHZhbHVlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBZb3UgaGF2ZSBhbiBlbXB0eSBhcnJheSBmb3IgXCIke25hbWV9XCIgZW51bSB2YWx1ZXNgKTtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBNeVNxbEVudW1Db2x1bW5CdWlsZGVyKG5hbWUsIHZhbHVlcyk7XG59XG5cbmNsYXNzIE15U3FsRmxvYXRCdWlsZGVyIGV4dGVuZHMgTXlTcWxDb2x1bW5CdWlsZGVyV2l0aEF1dG9JbmNyZW1lbnQge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnTXlTcWxGbG9hdEJ1aWxkZXInO1xuICAgIGNvbnN0cnVjdG9yKG5hbWUpIHtcbiAgICAgICAgc3VwZXIobmFtZSwgJ251bWJlcicsICdNeVNxbEZsb2F0Jyk7XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBidWlsZCh0YWJsZSkge1xuICAgICAgICByZXR1cm4gbmV3IE15U3FsRmxvYXQodGFibGUsIHRoaXMuY29uZmlnKTtcbiAgICB9XG59XG5jbGFzcyBNeVNxbEZsb2F0IGV4dGVuZHMgTXlTcWxDb2x1bW5XaXRoQXV0b0luY3JlbWVudCB7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdNeVNxbEZsb2F0JztcbiAgICBnZXRTUUxUeXBlKCkge1xuICAgICAgICByZXR1cm4gJ2Zsb2F0JztcbiAgICB9XG59XG5mdW5jdGlvbiBmbG9hdChuYW1lKSB7XG4gICAgcmV0dXJuIG5ldyBNeVNxbEZsb2F0QnVpbGRlcihuYW1lKTtcbn1cblxuY2xhc3MgTXlTcWxJbnRCdWlsZGVyIGV4dGVuZHMgTXlTcWxDb2x1bW5CdWlsZGVyV2l0aEF1dG9JbmNyZW1lbnQge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnTXlTcWxJbnRCdWlsZGVyJztcbiAgICBjb25zdHJ1Y3RvcihuYW1lKSB7XG4gICAgICAgIHN1cGVyKG5hbWUsICdudW1iZXInLCAnTXlTcWxJbnQnKTtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGJ1aWxkKHRhYmxlKSB7XG4gICAgICAgIHJldHVybiBuZXcgTXlTcWxJbnQodGFibGUsIHRoaXMuY29uZmlnKTtcbiAgICB9XG59XG5jbGFzcyBNeVNxbEludCBleHRlbmRzIE15U3FsQ29sdW1uV2l0aEF1dG9JbmNyZW1lbnQge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnTXlTcWxJbnQnO1xuICAgIGdldFNRTFR5cGUoKSB7XG4gICAgICAgIHJldHVybiAnaW50JztcbiAgICB9XG4gICAgbWFwRnJvbURyaXZlclZhbHVlKHZhbHVlKSB7XG4gICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICByZXR1cm4gTnVtYmVyKHZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgfVxufVxuZnVuY3Rpb24gaW50KG5hbWUpIHtcbiAgICByZXR1cm4gbmV3IE15U3FsSW50QnVpbGRlcihuYW1lKTtcbn1cblxuY2xhc3MgTXlTcWxKc29uQnVpbGRlciBleHRlbmRzIE15U3FsQ29sdW1uQnVpbGRlciB7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdNeVNxbEpzb25CdWlsZGVyJztcbiAgICBjb25zdHJ1Y3RvcihuYW1lKSB7XG4gICAgICAgIHN1cGVyKG5hbWUsICdqc29uJywgJ015U3FsSnNvbicpO1xuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgYnVpbGQodGFibGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBNeVNxbEpzb24odGFibGUsIHRoaXMuY29uZmlnKTtcbiAgICB9XG59XG5jbGFzcyBNeVNxbEpzb24gZXh0ZW5kcyBNeVNxbENvbHVtbiB7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdNeVNxbEpzb24nO1xuICAgIGdldFNRTFR5cGUoKSB7XG4gICAgICAgIHJldHVybiAnanNvbic7XG4gICAgfVxuICAgIG1hcFRvRHJpdmVyVmFsdWUodmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHZhbHVlKTtcbiAgICB9XG59XG5mdW5jdGlvbiBqc29uKG5hbWUpIHtcbiAgICByZXR1cm4gbmV3IE15U3FsSnNvbkJ1aWxkZXIobmFtZSk7XG59XG5cbmNsYXNzIE15U3FsTWVkaXVtSW50QnVpbGRlciBleHRlbmRzIE15U3FsQ29sdW1uQnVpbGRlcldpdGhBdXRvSW5jcmVtZW50IHtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ015U3FsTWVkaXVtSW50QnVpbGRlcic7XG4gICAgY29uc3RydWN0b3IobmFtZSkge1xuICAgICAgICBzdXBlcihuYW1lLCAnbnVtYmVyJywgJ015U3FsTWVkaXVtSW50Jyk7XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBidWlsZCh0YWJsZSkge1xuICAgICAgICByZXR1cm4gbmV3IE15U3FsTWVkaXVtSW50KHRhYmxlLCB0aGlzLmNvbmZpZyk7XG4gICAgfVxufVxuY2xhc3MgTXlTcWxNZWRpdW1JbnQgZXh0ZW5kcyBNeVNxbENvbHVtbldpdGhBdXRvSW5jcmVtZW50IHtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ015U3FsTWVkaXVtSW50JztcbiAgICBnZXRTUUxUeXBlKCkge1xuICAgICAgICByZXR1cm4gJ21lZGl1bWludCc7XG4gICAgfVxuICAgIG1hcEZyb21Ecml2ZXJWYWx1ZSh2YWx1ZSkge1xuICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgcmV0dXJuIE51bWJlcih2YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH1cbn1cbmZ1bmN0aW9uIG1lZGl1bWludChuYW1lKSB7XG4gICAgcmV0dXJuIG5ldyBNeVNxbE1lZGl1bUludEJ1aWxkZXIobmFtZSk7XG59XG5cbmNsYXNzIE15U3FsUmVhbEJ1aWxkZXIgZXh0ZW5kcyBNeVNxbENvbHVtbkJ1aWxkZXJXaXRoQXV0b0luY3JlbWVudCB7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdNeVNxbFJlYWxCdWlsZGVyJztcbiAgICBjb25zdHJ1Y3RvcihuYW1lLCBjb25maWcpIHtcbiAgICAgICAgc3VwZXIobmFtZSwgJ251bWJlcicsICdNeVNxbFJlYWwnKTtcbiAgICAgICAgdGhpcy5jb25maWcucHJlY2lzaW9uID0gY29uZmlnPy5wcmVjaXNpb247XG4gICAgICAgIHRoaXMuY29uZmlnLnNjYWxlID0gY29uZmlnPy5zY2FsZTtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGJ1aWxkKHRhYmxlKSB7XG4gICAgICAgIHJldHVybiBuZXcgTXlTcWxSZWFsKHRhYmxlLCB0aGlzLmNvbmZpZyk7XG4gICAgfVxufVxuY2xhc3MgTXlTcWxSZWFsIGV4dGVuZHMgTXlTcWxDb2x1bW5XaXRoQXV0b0luY3JlbWVudCB7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdNeVNxbFJlYWwnO1xuICAgIHByZWNpc2lvbiA9IHRoaXMuY29uZmlnLnByZWNpc2lvbjtcbiAgICBzY2FsZSA9IHRoaXMuY29uZmlnLnNjYWxlO1xuICAgIGdldFNRTFR5cGUoKSB7XG4gICAgICAgIGlmICh0aGlzLnByZWNpc2lvbiAhPT0gdW5kZWZpbmVkICYmIHRoaXMuc2NhbGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIGByZWFsKCR7dGhpcy5wcmVjaXNpb259LCAke3RoaXMuc2NhbGV9KWA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy5wcmVjaXNpb24gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuICdyZWFsJztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBgcmVhbCgke3RoaXMucHJlY2lzaW9ufSlgO1xuICAgICAgICB9XG4gICAgfVxufVxuZnVuY3Rpb24gcmVhbChuYW1lLCBjb25maWcgPSB7fSkge1xuICAgIHJldHVybiBuZXcgTXlTcWxSZWFsQnVpbGRlcihuYW1lLCBjb25maWcpO1xufVxuXG5jbGFzcyBNeVNxbFNlcmlhbEJ1aWxkZXIgZXh0ZW5kcyBNeVNxbENvbHVtbkJ1aWxkZXJXaXRoQXV0b0luY3JlbWVudCB7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdNeVNxbFNlcmlhbEJ1aWxkZXInO1xuICAgIGNvbnN0cnVjdG9yKG5hbWUpIHtcbiAgICAgICAgc3VwZXIobmFtZSwgJ251bWJlcicsICdNeVNxbFNlcmlhbCcpO1xuICAgICAgICB0aGlzLmNvbmZpZy5oYXNEZWZhdWx0ID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5jb25maWcuYXV0b0luY3JlbWVudCA9IHRydWU7XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBidWlsZCh0YWJsZSkge1xuICAgICAgICByZXR1cm4gbmV3IE15U3FsU2VyaWFsKHRhYmxlLCB0aGlzLmNvbmZpZyk7XG4gICAgfVxufVxuY2xhc3MgTXlTcWxTZXJpYWwgZXh0ZW5kcyBNeVNxbENvbHVtbldpdGhBdXRvSW5jcmVtZW50IHtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ015U3FsU2VyaWFsJztcbiAgICBnZXRTUUxUeXBlKCkge1xuICAgICAgICByZXR1cm4gJ3NlcmlhbCc7XG4gICAgfVxuICAgIG1hcEZyb21Ecml2ZXJWYWx1ZSh2YWx1ZSkge1xuICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgcmV0dXJuIE51bWJlcih2YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHNlcmlhbChuYW1lKSB7XG4gICAgcmV0dXJuIG5ldyBNeVNxbFNlcmlhbEJ1aWxkZXIobmFtZSk7XG59XG5cbmNsYXNzIE15U3FsU21hbGxJbnRCdWlsZGVyIGV4dGVuZHMgTXlTcWxDb2x1bW5CdWlsZGVyV2l0aEF1dG9JbmNyZW1lbnQge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnTXlTcWxTbWFsbEludEJ1aWxkZXInO1xuICAgIGNvbnN0cnVjdG9yKG5hbWUpIHtcbiAgICAgICAgc3VwZXIobmFtZSwgJ251bWJlcicsICdNeVNxbFNtYWxsSW50Jyk7XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBidWlsZCh0YWJsZSkge1xuICAgICAgICByZXR1cm4gbmV3IE15U3FsU21hbGxJbnQodGFibGUsIHRoaXMuY29uZmlnKTtcbiAgICB9XG59XG5jbGFzcyBNeVNxbFNtYWxsSW50IGV4dGVuZHMgTXlTcWxDb2x1bW5XaXRoQXV0b0luY3JlbWVudCB7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdNeVNxbFNtYWxsSW50JztcbiAgICBnZXRTUUxUeXBlKCkge1xuICAgICAgICByZXR1cm4gJ3NtYWxsaW50JztcbiAgICB9XG4gICAgbWFwRnJvbURyaXZlclZhbHVlKHZhbHVlKSB7XG4gICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICByZXR1cm4gTnVtYmVyKHZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgfVxufVxuZnVuY3Rpb24gc21hbGxpbnQobmFtZSkge1xuICAgIHJldHVybiBuZXcgTXlTcWxTbWFsbEludEJ1aWxkZXIobmFtZSk7XG59XG5cbmNsYXNzIE15U3FsVGV4dEJ1aWxkZXIgZXh0ZW5kcyBNeVNxbENvbHVtbkJ1aWxkZXIge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnTXlTcWxUZXh0QnVpbGRlcic7XG4gICAgY29uc3RydWN0b3IobmFtZSwgdGV4dFR5cGUsIGNvbmZpZykge1xuICAgICAgICBzdXBlcihuYW1lLCAnc3RyaW5nJywgJ015U3FsVGV4dCcpO1xuICAgICAgICB0aGlzLmNvbmZpZy50ZXh0VHlwZSA9IHRleHRUeXBlO1xuICAgICAgICB0aGlzLmNvbmZpZy5lbnVtVmFsdWVzID0gY29uZmlnLmVudW07XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBidWlsZCh0YWJsZSkge1xuICAgICAgICByZXR1cm4gbmV3IE15U3FsVGV4dCh0YWJsZSwgdGhpcy5jb25maWcpO1xuICAgIH1cbn1cbmNsYXNzIE15U3FsVGV4dCBleHRlbmRzIE15U3FsQ29sdW1uIHtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ015U3FsVGV4dCc7XG4gICAgdGV4dFR5cGUgPSB0aGlzLmNvbmZpZy50ZXh0VHlwZTtcbiAgICBlbnVtVmFsdWVzID0gdGhpcy5jb25maWcuZW51bVZhbHVlcztcbiAgICBnZXRTUUxUeXBlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy50ZXh0VHlwZTtcbiAgICB9XG59XG5mdW5jdGlvbiB0ZXh0KG5hbWUsIGNvbmZpZyA9IHt9KSB7XG4gICAgcmV0dXJuIG5ldyBNeVNxbFRleHRCdWlsZGVyKG5hbWUsICd0ZXh0JywgY29uZmlnKTtcbn1cbmZ1bmN0aW9uIHRpbnl0ZXh0KG5hbWUsIGNvbmZpZyA9IHt9KSB7XG4gICAgcmV0dXJuIG5ldyBNeVNxbFRleHRCdWlsZGVyKG5hbWUsICd0aW55dGV4dCcsIGNvbmZpZyk7XG59XG5mdW5jdGlvbiBtZWRpdW10ZXh0KG5hbWUsIGNvbmZpZyA9IHt9KSB7XG4gICAgcmV0dXJuIG5ldyBNeVNxbFRleHRCdWlsZGVyKG5hbWUsICdtZWRpdW10ZXh0JywgY29uZmlnKTtcbn1cbmZ1bmN0aW9uIGxvbmd0ZXh0KG5hbWUsIGNvbmZpZyA9IHt9KSB7XG4gICAgcmV0dXJuIG5ldyBNeVNxbFRleHRCdWlsZGVyKG5hbWUsICdsb25ndGV4dCcsIGNvbmZpZyk7XG59XG5cbmNsYXNzIE15U3FsVGltZUJ1aWxkZXIgZXh0ZW5kcyBNeVNxbENvbHVtbkJ1aWxkZXIge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnTXlTcWxUaW1lQnVpbGRlcic7XG4gICAgY29uc3RydWN0b3IobmFtZSwgY29uZmlnKSB7XG4gICAgICAgIHN1cGVyKG5hbWUsICdzdHJpbmcnLCAnTXlTcWxUaW1lJyk7XG4gICAgICAgIHRoaXMuY29uZmlnLmZzcCA9IGNvbmZpZz8uZnNwO1xuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgYnVpbGQodGFibGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBNeVNxbFRpbWUodGFibGUsIHRoaXMuY29uZmlnKTtcbiAgICB9XG59XG5jbGFzcyBNeVNxbFRpbWUgZXh0ZW5kcyBNeVNxbENvbHVtbiB7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdNeVNxbFRpbWUnO1xuICAgIGZzcCA9IHRoaXMuY29uZmlnLmZzcDtcbiAgICBnZXRTUUxUeXBlKCkge1xuICAgICAgICBjb25zdCBwcmVjaXNpb24gPSB0aGlzLmZzcCA9PT0gdW5kZWZpbmVkID8gJycgOiBgKCR7dGhpcy5mc3B9KWA7XG4gICAgICAgIHJldHVybiBgdGltZSR7cHJlY2lzaW9ufWA7XG4gICAgfVxufVxuZnVuY3Rpb24gdGltZShuYW1lLCBjb25maWcpIHtcbiAgICByZXR1cm4gbmV3IE15U3FsVGltZUJ1aWxkZXIobmFtZSwgY29uZmlnKTtcbn1cblxuY2xhc3MgTXlTcWxEYXRlQ29sdW1uQmFzZUJ1aWxkZXIgZXh0ZW5kcyBNeVNxbENvbHVtbkJ1aWxkZXIge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnTXlTcWxEYXRlQ29sdW1uQnVpbGRlcic7XG4gICAgZGVmYXVsdE5vdygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGVmYXVsdChzcWwgYChub3coKSlgKTtcbiAgICB9XG4gICAgLy8gXCJvbiB1cGRhdGUgbm93XCIgYWxzbyBhZGRzIGFuIGltcGxpY2l0IGRlZmF1bHQgdmFsdWUgdG8gdGhlIGNvbHVtbiAtIGh0dHBzOi8vZGV2Lm15c3FsLmNvbS9kb2MvcmVmbWFuLzguMC9lbi90aW1lc3RhbXAtaW5pdGlhbGl6YXRpb24uaHRtbFxuICAgIG9uVXBkYXRlTm93KCkge1xuICAgICAgICB0aGlzLmNvbmZpZy5oYXNPblVwZGF0ZU5vdyA9IHRydWU7XG4gICAgICAgIHRoaXMuY29uZmlnLmhhc0RlZmF1bHQgPSB0cnVlO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG59XG5jbGFzcyBNeVNxbERhdGVCYXNlQ29sdW1uIGV4dGVuZHMgTXlTcWxDb2x1bW4ge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnTXlTcWxEYXRlQ29sdW1uJztcbiAgICBoYXNPblVwZGF0ZU5vdyA9IHRoaXMuY29uZmlnLmhhc09uVXBkYXRlTm93O1xufVxuXG5jbGFzcyBNeVNxbFRpbWVzdGFtcEJ1aWxkZXIgZXh0ZW5kcyBNeVNxbERhdGVDb2x1bW5CYXNlQnVpbGRlciB7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdNeVNxbFRpbWVzdGFtcEJ1aWxkZXInO1xuICAgIGNvbnN0cnVjdG9yKG5hbWUsIGNvbmZpZykge1xuICAgICAgICBzdXBlcihuYW1lLCAnZGF0ZScsICdNeVNxbFRpbWVzdGFtcCcpO1xuICAgICAgICB0aGlzLmNvbmZpZy5mc3AgPSBjb25maWc/LmZzcDtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGJ1aWxkKHRhYmxlKSB7XG4gICAgICAgIHJldHVybiBuZXcgTXlTcWxUaW1lc3RhbXAodGFibGUsIHRoaXMuY29uZmlnKTtcbiAgICB9XG59XG5jbGFzcyBNeVNxbFRpbWVzdGFtcCBleHRlbmRzIE15U3FsRGF0ZUJhc2VDb2x1bW4ge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnTXlTcWxUaW1lc3RhbXAnO1xuICAgIGZzcCA9IHRoaXMuY29uZmlnLmZzcDtcbiAgICBnZXRTUUxUeXBlKCkge1xuICAgICAgICBjb25zdCBwcmVjaXNpb24gPSB0aGlzLmZzcCA9PT0gdW5kZWZpbmVkID8gJycgOiBgKCR7dGhpcy5mc3B9KWA7XG4gICAgICAgIHJldHVybiBgdGltZXN0YW1wJHtwcmVjaXNpb259YDtcbiAgICB9XG4gICAgbWFwRnJvbURyaXZlclZhbHVlKHZhbHVlKSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0ZSh2YWx1ZSArICcrMDAwMCcpO1xuICAgIH1cbiAgICBtYXBUb0RyaXZlclZhbHVlKHZhbHVlKSB7XG4gICAgICAgIHJldHVybiB2YWx1ZS50b0lTT1N0cmluZygpLnNsaWNlKDAsIC0xKS5yZXBsYWNlKCdUJywgJyAnKTtcbiAgICB9XG59XG5jbGFzcyBNeVNxbFRpbWVzdGFtcFN0cmluZ0J1aWxkZXIgZXh0ZW5kcyBNeVNxbERhdGVDb2x1bW5CYXNlQnVpbGRlciB7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdNeVNxbFRpbWVzdGFtcFN0cmluZ0J1aWxkZXInO1xuICAgIGNvbnN0cnVjdG9yKG5hbWUsIGNvbmZpZykge1xuICAgICAgICBzdXBlcihuYW1lLCAnc3RyaW5nJywgJ015U3FsVGltZXN0YW1wU3RyaW5nJyk7XG4gICAgICAgIHRoaXMuY29uZmlnLmZzcCA9IGNvbmZpZz8uZnNwO1xuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgYnVpbGQodGFibGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBNeVNxbFRpbWVzdGFtcFN0cmluZyh0YWJsZSwgdGhpcy5jb25maWcpO1xuICAgIH1cbn1cbmNsYXNzIE15U3FsVGltZXN0YW1wU3RyaW5nIGV4dGVuZHMgTXlTcWxEYXRlQmFzZUNvbHVtbiB7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdNeVNxbFRpbWVzdGFtcFN0cmluZyc7XG4gICAgZnNwID0gdGhpcy5jb25maWcuZnNwO1xuICAgIGdldFNRTFR5cGUoKSB7XG4gICAgICAgIGNvbnN0IHByZWNpc2lvbiA9IHRoaXMuZnNwID09PSB1bmRlZmluZWQgPyAnJyA6IGAoJHt0aGlzLmZzcH0pYDtcbiAgICAgICAgcmV0dXJuIGB0aW1lc3RhbXAke3ByZWNpc2lvbn1gO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHRpbWVzdGFtcChuYW1lLCBjb25maWcgPSB7fSkge1xuICAgIGlmIChjb25maWcubW9kZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBNeVNxbFRpbWVzdGFtcFN0cmluZ0J1aWxkZXIobmFtZSwgY29uZmlnKTtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBNeVNxbFRpbWVzdGFtcEJ1aWxkZXIobmFtZSwgY29uZmlnKTtcbn1cblxuY2xhc3MgTXlTcWxUaW55SW50QnVpbGRlciBleHRlbmRzIE15U3FsQ29sdW1uQnVpbGRlcldpdGhBdXRvSW5jcmVtZW50IHtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ015U3FsVGlueUludEJ1aWxkZXInO1xuICAgIGNvbnN0cnVjdG9yKG5hbWUpIHtcbiAgICAgICAgc3VwZXIobmFtZSwgJ251bWJlcicsICdNeVNxbFRpbnlJbnQnKTtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGJ1aWxkKHRhYmxlKSB7XG4gICAgICAgIHJldHVybiBuZXcgTXlTcWxUaW55SW50KHRhYmxlLCB0aGlzLmNvbmZpZyk7XG4gICAgfVxufVxuY2xhc3MgTXlTcWxUaW55SW50IGV4dGVuZHMgTXlTcWxDb2x1bW5XaXRoQXV0b0luY3JlbWVudCB7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdNeVNxbFRpbnlJbnQnO1xuICAgIGdldFNRTFR5cGUoKSB7XG4gICAgICAgIHJldHVybiAndGlueWludCc7XG4gICAgfVxuICAgIG1hcEZyb21Ecml2ZXJWYWx1ZSh2YWx1ZSkge1xuICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgcmV0dXJuIE51bWJlcih2YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHRpbnlpbnQobmFtZSkge1xuICAgIHJldHVybiBuZXcgTXlTcWxUaW55SW50QnVpbGRlcihuYW1lKTtcbn1cblxuY2xhc3MgTXlTcWxWYXJCaW5hcnlCdWlsZGVyIGV4dGVuZHMgTXlTcWxDb2x1bW5CdWlsZGVyIHtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ015U3FsVmFyQmluYXJ5QnVpbGRlcic7XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGNvbnN0cnVjdG9yKG5hbWUsIGNvbmZpZykge1xuICAgICAgICBzdXBlcihuYW1lLCAnc3RyaW5nJywgJ015U3FsVmFyQmluYXJ5Jyk7XG4gICAgICAgIHRoaXMuY29uZmlnLmxlbmd0aCA9IGNvbmZpZz8ubGVuZ3RoO1xuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgYnVpbGQodGFibGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBNeVNxbFZhckJpbmFyeSh0YWJsZSwgdGhpcy5jb25maWcpO1xuICAgIH1cbn1cbmNsYXNzIE15U3FsVmFyQmluYXJ5IGV4dGVuZHMgTXlTcWxDb2x1bW4ge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnTXlTcWxWYXJCaW5hcnknO1xuICAgIGxlbmd0aCA9IHRoaXMuY29uZmlnLmxlbmd0aDtcbiAgICBnZXRTUUxUeXBlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5sZW5ndGggPT09IHVuZGVmaW5lZCA/IGB2YXJiaW5hcnlgIDogYHZhcmJpbmFyeSgke3RoaXMubGVuZ3RofSlgO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHZhcmJpbmFyeShuYW1lLCBvcHRpb25zKSB7XG4gICAgcmV0dXJuIG5ldyBNeVNxbFZhckJpbmFyeUJ1aWxkZXIobmFtZSwgb3B0aW9ucyk7XG59XG5cbmNsYXNzIE15U3FsVmFyQ2hhckJ1aWxkZXIgZXh0ZW5kcyBNeVNxbENvbHVtbkJ1aWxkZXIge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnTXlTcWxWYXJDaGFyQnVpbGRlcic7XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGNvbnN0cnVjdG9yKG5hbWUsIGNvbmZpZykge1xuICAgICAgICBzdXBlcihuYW1lLCAnc3RyaW5nJywgJ015U3FsVmFyQ2hhcicpO1xuICAgICAgICB0aGlzLmNvbmZpZy5sZW5ndGggPSBjb25maWcubGVuZ3RoO1xuICAgICAgICB0aGlzLmNvbmZpZy5lbnVtID0gY29uZmlnLmVudW07XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBidWlsZCh0YWJsZSkge1xuICAgICAgICByZXR1cm4gbmV3IE15U3FsVmFyQ2hhcih0YWJsZSwgdGhpcy5jb25maWcpO1xuICAgIH1cbn1cbmNsYXNzIE15U3FsVmFyQ2hhciBleHRlbmRzIE15U3FsQ29sdW1uIHtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ015U3FsVmFyQ2hhcic7XG4gICAgbGVuZ3RoID0gdGhpcy5jb25maWcubGVuZ3RoO1xuICAgIGVudW1WYWx1ZXMgPSB0aGlzLmNvbmZpZy5lbnVtO1xuICAgIGdldFNRTFR5cGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmxlbmd0aCA9PT0gdW5kZWZpbmVkID8gYHZhcmNoYXJgIDogYHZhcmNoYXIoJHt0aGlzLmxlbmd0aH0pYDtcbiAgICB9XG59XG5mdW5jdGlvbiB2YXJjaGFyKG5hbWUsIGNvbmZpZykge1xuICAgIHJldHVybiBuZXcgTXlTcWxWYXJDaGFyQnVpbGRlcihuYW1lLCBjb25maWcpO1xufVxuXG5jbGFzcyBNeVNxbFllYXJCdWlsZGVyIGV4dGVuZHMgTXlTcWxDb2x1bW5CdWlsZGVyIHtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ015U3FsWWVhckJ1aWxkZXInO1xuICAgIGNvbnN0cnVjdG9yKG5hbWUpIHtcbiAgICAgICAgc3VwZXIobmFtZSwgJ251bWJlcicsICdNeVNxbFllYXInKTtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGJ1aWxkKHRhYmxlKSB7XG4gICAgICAgIHJldHVybiBuZXcgTXlTcWxZZWFyKHRhYmxlLCB0aGlzLmNvbmZpZyk7XG4gICAgfVxufVxuY2xhc3MgTXlTcWxZZWFyIGV4dGVuZHMgTXlTcWxDb2x1bW4ge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnTXlTcWxZZWFyJztcbiAgICBnZXRTUUxUeXBlKCkge1xuICAgICAgICByZXR1cm4gYHllYXJgO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHllYXIobmFtZSkge1xuICAgIHJldHVybiBuZXcgTXlTcWxZZWFyQnVpbGRlcihuYW1lKTtcbn1cblxuZnVuY3Rpb24gYWxpYXModGFibGUsIGFsaWFzKSB7XG4gICAgcmV0dXJuIG5ldyBQcm94eSh0YWJsZSwgbmV3IFRhYmxlQWxpYXNQcm94eUhhbmRsZXIoYWxpYXMsIGZhbHNlKSk7XG59XG5cbmNsYXNzIENoZWNrQnVpbGRlciB7XG4gICAgbmFtZTtcbiAgICB2YWx1ZTtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ015U3FsQ2hlY2tCdWlsZGVyJztcbiAgICBicmFuZDtcbiAgICBjb25zdHJ1Y3RvcihuYW1lLCB2YWx1ZSkge1xuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBidWlsZCh0YWJsZSkge1xuICAgICAgICByZXR1cm4gbmV3IENoZWNrKHRhYmxlLCB0aGlzKTtcbiAgICB9XG59XG5jbGFzcyBDaGVjayB7XG4gICAgdGFibGU7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdNeVNxbENoZWNrJztcbiAgICBuYW1lO1xuICAgIHZhbHVlO1xuICAgIGNvbnN0cnVjdG9yKHRhYmxlLCBidWlsZGVyKSB7XG4gICAgICAgIHRoaXMudGFibGUgPSB0YWJsZTtcbiAgICAgICAgdGhpcy5uYW1lID0gYnVpbGRlci5uYW1lO1xuICAgICAgICB0aGlzLnZhbHVlID0gYnVpbGRlci52YWx1ZTtcbiAgICB9XG59XG5mdW5jdGlvbiBjaGVjayhuYW1lLCB2YWx1ZSkge1xuICAgIHJldHVybiBuZXcgQ2hlY2tCdWlsZGVyKG5hbWUsIHZhbHVlKTtcbn1cblxuY2xhc3MgSW5kZXhCdWlsZGVyT24ge1xuICAgIG5hbWU7XG4gICAgdW5pcXVlO1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnTXlTcWxJbmRleEJ1aWxkZXJPbic7XG4gICAgY29uc3RydWN0b3IobmFtZSwgdW5pcXVlKSB7XG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgIHRoaXMudW5pcXVlID0gdW5pcXVlO1xuICAgIH1cbiAgICBvbiguLi5jb2x1bW5zKSB7XG4gICAgICAgIHJldHVybiBuZXcgSW5kZXhCdWlsZGVyKHRoaXMubmFtZSwgY29sdW1ucywgdGhpcy51bmlxdWUpO1xuICAgIH1cbn1cbmNsYXNzIEluZGV4QnVpbGRlciB7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdNeVNxbEluZGV4QnVpbGRlcic7XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGNvbmZpZztcbiAgICBjb25zdHJ1Y3RvcihuYW1lLCBjb2x1bW5zLCB1bmlxdWUpIHtcbiAgICAgICAgdGhpcy5jb25maWcgPSB7XG4gICAgICAgICAgICBuYW1lLFxuICAgICAgICAgICAgY29sdW1ucyxcbiAgICAgICAgICAgIHVuaXF1ZSxcbiAgICAgICAgfTtcbiAgICB9XG4gICAgdXNpbmcodXNpbmcpIHtcbiAgICAgICAgdGhpcy5jb25maWcudXNpbmcgPSB1c2luZztcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIGFsZ29yeXRobShhbGdvcnl0aG0pIHtcbiAgICAgICAgdGhpcy5jb25maWcuYWxnb3J5dGhtID0gYWxnb3J5dGhtO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgbG9jayhsb2NrKSB7XG4gICAgICAgIHRoaXMuY29uZmlnLmxvY2sgPSBsb2NrO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGJ1aWxkKHRhYmxlKSB7XG4gICAgICAgIHJldHVybiBuZXcgSW5kZXgodGhpcy5jb25maWcsIHRhYmxlKTtcbiAgICB9XG59XG5jbGFzcyBJbmRleCB7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdNeVNxbEluZGV4JztcbiAgICBjb25maWc7XG4gICAgY29uc3RydWN0b3IoY29uZmlnLCB0YWJsZSkge1xuICAgICAgICB0aGlzLmNvbmZpZyA9IHsgLi4uY29uZmlnLCB0YWJsZSB9O1xuICAgIH1cbn1cbmZ1bmN0aW9uIGluZGV4KG5hbWUpIHtcbiAgICByZXR1cm4gbmV3IEluZGV4QnVpbGRlck9uKG5hbWUsIGZhbHNlKTtcbn1cbmZ1bmN0aW9uIHVuaXF1ZUluZGV4KG5hbWUpIHtcbiAgICByZXR1cm4gbmV3IEluZGV4QnVpbGRlck9uKG5hbWUsIHRydWUpO1xufVxuXG5mdW5jdGlvbiBwcmltYXJ5S2V5KC4uLmNvbHVtbnMpIHtcbiAgICByZXR1cm4gbmV3IFByaW1hcnlLZXlCdWlsZGVyKGNvbHVtbnMpO1xufVxuY2xhc3MgUHJpbWFyeUtleUJ1aWxkZXIge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnTXlTcWxQcmltYXJ5S2V5QnVpbGRlcic7XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGNvbHVtbnM7XG4gICAgY29uc3RydWN0b3IoY29sdW1ucykge1xuICAgICAgICB0aGlzLmNvbHVtbnMgPSBjb2x1bW5zO1xuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgYnVpbGQodGFibGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcmltYXJ5S2V5KHRhYmxlLCB0aGlzLmNvbHVtbnMpO1xuICAgIH1cbn1cbmNsYXNzIFByaW1hcnlLZXkge1xuICAgIHRhYmxlO1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnTXlTcWxQcmltYXJ5S2V5JztcbiAgICBjb2x1bW5zO1xuICAgIGNvbnN0cnVjdG9yKHRhYmxlLCBjb2x1bW5zKSB7XG4gICAgICAgIHRoaXMudGFibGUgPSB0YWJsZTtcbiAgICAgICAgdGhpcy5jb2x1bW5zID0gY29sdW1ucztcbiAgICB9XG4gICAgZ2V0TmFtZSgpIHtcbiAgICAgICAgcmV0dXJuIGAke3RoaXMudGFibGVbTXlTcWxUYWJsZS5TeW1ib2wuTmFtZV19XyR7dGhpcy5jb2x1bW5zLm1hcCgoY29sdW1uKSA9PiBjb2x1bW4ubmFtZSkuam9pbignXycpfV9wa2A7XG4gICAgfVxufVxuXG5jbGFzcyBNeVNxbFNjaGVtYSB7XG4gICAgc2NoZW1hTmFtZTtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ015U3FsU2NoZW1hJztcbiAgICBjb25zdHJ1Y3RvcihzY2hlbWFOYW1lKSB7XG4gICAgICAgIHRoaXMuc2NoZW1hTmFtZSA9IHNjaGVtYU5hbWU7XG4gICAgfVxuICAgIHRhYmxlID0gKG5hbWUsIGNvbHVtbnMsIGV4dHJhQ29uZmlnKSA9PiB7XG4gICAgICAgIHJldHVybiBteXNxbFRhYmxlV2l0aFNjaGVtYShuYW1lLCBjb2x1bW5zLCBleHRyYUNvbmZpZywgdGhpcy5zY2hlbWFOYW1lKTtcbiAgICB9O1xuICAgIHZpZXcgPSAoKG5hbWUsIGNvbHVtbnMpID0+IHtcbiAgICAgICAgcmV0dXJuIG15c3FsVmlld1dpdGhTY2hlbWEobmFtZSwgY29sdW1ucywgdGhpcy5zY2hlbWFOYW1lKTtcbiAgICB9KTtcbn1cbi8qKiBAZGVwcmVjYXRlZCAtIHVzZSBgaW5zdGFuY2VvZiBNeVNxbFNjaGVtYWAgKi9cbmZ1bmN0aW9uIGlzTXlTcWxTY2hlbWEob2JqKSB7XG4gICAgcmV0dXJuIGlzKG9iaiwgTXlTcWxTY2hlbWEpO1xufVxuLyoqXG4gKiBDcmVhdGUgYSBNeVNRTCBzY2hlbWEuXG4gKiBodHRwczovL2Rldi5teXNxbC5jb20vZG9jL3JlZm1hbi84LjAvZW4vY3JlYXRlLWRhdGFiYXNlLmh0bWxcbiAqXG4gKiBAcGFyYW0gbmFtZSBteXNxbCB1c2Ugc2NoZW1hIG5hbWVcbiAqIEByZXR1cm5zIE15U1FMIHNjaGVtYVxuICovXG5mdW5jdGlvbiBteXNxbERhdGFiYXNlKG5hbWUpIHtcbiAgICByZXR1cm4gbmV3IE15U3FsU2NoZW1hKG5hbWUpO1xufVxuLyoqXG4gKiBAc2VlIG15c3FsRGF0YWJhc2VcbiAqL1xuY29uc3QgbXlzcWxTY2hlbWEgPSBteXNxbERhdGFiYXNlO1xuXG5mdW5jdGlvbiBnZXRUYWJsZUNvbmZpZyh0YWJsZSkge1xuICAgIGNvbnN0IGNvbHVtbnMgPSBPYmplY3QudmFsdWVzKHRhYmxlW015U3FsVGFibGUuU3ltYm9sLkNvbHVtbnNdKTtcbiAgICBjb25zdCBpbmRleGVzID0gW107XG4gICAgY29uc3QgY2hlY2tzID0gW107XG4gICAgY29uc3QgcHJpbWFyeUtleXMgPSBbXTtcbiAgICBjb25zdCB1bmlxdWVDb25zdHJhaW50cyA9IFtdO1xuICAgIGNvbnN0IGZvcmVpZ25LZXlzID0gT2JqZWN0LnZhbHVlcyh0YWJsZVtNeVNxbFRhYmxlLlN5bWJvbC5JbmxpbmVGb3JlaWduS2V5c10pO1xuICAgIGNvbnN0IG5hbWUgPSB0YWJsZVtUYWJsZS5TeW1ib2wuTmFtZV07XG4gICAgY29uc3Qgc2NoZW1hID0gdGFibGVbVGFibGUuU3ltYm9sLlNjaGVtYV07XG4gICAgY29uc3QgYmFzZU5hbWUgPSB0YWJsZVtUYWJsZS5TeW1ib2wuQmFzZU5hbWVdO1xuICAgIGNvbnN0IGV4dHJhQ29uZmlnQnVpbGRlciA9IHRhYmxlW015U3FsVGFibGUuU3ltYm9sLkV4dHJhQ29uZmlnQnVpbGRlcl07XG4gICAgaWYgKGV4dHJhQ29uZmlnQnVpbGRlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGNvbnN0IGV4dHJhQ29uZmlnID0gZXh0cmFDb25maWdCdWlsZGVyKHRhYmxlW015U3FsVGFibGUuU3ltYm9sLkNvbHVtbnNdKTtcbiAgICAgICAgZm9yIChjb25zdCBidWlsZGVyIG9mIE9iamVjdC52YWx1ZXMoZXh0cmFDb25maWcpKSB7XG4gICAgICAgICAgICBpZiAoaXMoYnVpbGRlciwgSW5kZXhCdWlsZGVyKSkge1xuICAgICAgICAgICAgICAgIGluZGV4ZXMucHVzaChidWlsZGVyLmJ1aWxkKHRhYmxlKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChpcyhidWlsZGVyLCBDaGVja0J1aWxkZXIpKSB7XG4gICAgICAgICAgICAgICAgY2hlY2tzLnB1c2goYnVpbGRlci5idWlsZCh0YWJsZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoaXMoYnVpbGRlciwgVW5pcXVlQ29uc3RyYWludEJ1aWxkZXIpKSB7XG4gICAgICAgICAgICAgICAgdW5pcXVlQ29uc3RyYWludHMucHVzaChidWlsZGVyLmJ1aWxkKHRhYmxlKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChpcyhidWlsZGVyLCBQcmltYXJ5S2V5QnVpbGRlcikpIHtcbiAgICAgICAgICAgICAgICBwcmltYXJ5S2V5cy5wdXNoKGJ1aWxkZXIuYnVpbGQodGFibGUpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGlzKGJ1aWxkZXIsIEZvcmVpZ25LZXlCdWlsZGVyKSkge1xuICAgICAgICAgICAgICAgIGZvcmVpZ25LZXlzLnB1c2goYnVpbGRlci5idWlsZCh0YWJsZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICAgIGNvbHVtbnMsXG4gICAgICAgIGluZGV4ZXMsXG4gICAgICAgIGZvcmVpZ25LZXlzLFxuICAgICAgICBjaGVja3MsXG4gICAgICAgIHByaW1hcnlLZXlzLFxuICAgICAgICB1bmlxdWVDb25zdHJhaW50cyxcbiAgICAgICAgbmFtZSxcbiAgICAgICAgc2NoZW1hLFxuICAgICAgICBiYXNlTmFtZSxcbiAgICB9O1xufVxuZnVuY3Rpb24gZ2V0Vmlld0NvbmZpZyh2aWV3KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgLi4udmlld1tWaWV3QmFzZUNvbmZpZ10sXG4gICAgICAgIC4uLnZpZXdbTXlTcWxWaWV3Q29uZmlnXSxcbiAgICB9O1xufVxuXG5leHBvcnQgeyBDaGVjaywgQ2hlY2tCdWlsZGVyLCBGb3JlaWduS2V5QnVpbGRlciwgSW5kZXgsIEluZGV4QnVpbGRlciwgSW5kZXhCdWlsZGVyT24sIE15U3FsQmlnSW50NTMsIE15U3FsQmlnSW50NTNCdWlsZGVyLCBNeVNxbEJpZ0ludDY0LCBNeVNxbEJpZ0ludDY0QnVpbGRlciwgTXlTcWxCaW5hcnksIE15U3FsQmluYXJ5QnVpbGRlciwgTXlTcWxCb29sZWFuLCBNeVNxbEJvb2xlYW5CdWlsZGVyLCBNeVNxbENoYXIsIE15U3FsQ2hhckJ1aWxkZXIsIE15U3FsQ29sdW1uLCBNeVNxbENvbHVtbkJ1aWxkZXIsIE15U3FsQ29sdW1uQnVpbGRlcldpdGhBdXRvSW5jcmVtZW50LCBNeVNxbENvbHVtbldpdGhBdXRvSW5jcmVtZW50LCBNeVNxbEN1c3RvbUNvbHVtbiwgTXlTcWxDdXN0b21Db2x1bW5CdWlsZGVyLCBNeVNxbERhdGUsIE15U3FsRGF0ZUJ1aWxkZXIsIE15U3FsRGF0ZVN0cmluZywgTXlTcWxEYXRlU3RyaW5nQnVpbGRlciwgTXlTcWxEYXRlVGltZSwgTXlTcWxEYXRlVGltZUJ1aWxkZXIsIE15U3FsRGF0ZVRpbWVTdHJpbmcsIE15U3FsRGF0ZVRpbWVTdHJpbmdCdWlsZGVyLCBNeVNxbERlY2ltYWwsIE15U3FsRGVjaW1hbEJ1aWxkZXIsIE15U3FsRG91YmxlLCBNeVNxbERvdWJsZUJ1aWxkZXIsIE15U3FsRW51bUNvbHVtbiwgTXlTcWxFbnVtQ29sdW1uQnVpbGRlciwgTXlTcWxGbG9hdCwgTXlTcWxGbG9hdEJ1aWxkZXIsIE15U3FsSW50LCBNeVNxbEludEJ1aWxkZXIsIE15U3FsSnNvbiwgTXlTcWxKc29uQnVpbGRlciwgTXlTcWxNZWRpdW1JbnQsIE15U3FsTWVkaXVtSW50QnVpbGRlciwgTXlTcWxSZWFsLCBNeVNxbFJlYWxCdWlsZGVyLCBNeVNxbFNjaGVtYSwgTXlTcWxTZXJpYWwsIE15U3FsU2VyaWFsQnVpbGRlciwgTXlTcWxTbWFsbEludCwgTXlTcWxTbWFsbEludEJ1aWxkZXIsIE15U3FsVGFibGUsIE15U3FsVGV4dCwgTXlTcWxUZXh0QnVpbGRlciwgTXlTcWxUaW1lLCBNeVNxbFRpbWVCdWlsZGVyLCBNeVNxbFRpbWVzdGFtcCwgTXlTcWxUaW1lc3RhbXBCdWlsZGVyLCBNeVNxbFRpbWVzdGFtcFN0cmluZywgTXlTcWxUaW1lc3RhbXBTdHJpbmdCdWlsZGVyLCBNeVNxbFRpbnlJbnQsIE15U3FsVGlueUludEJ1aWxkZXIsIE15U3FsVmFyQmluYXJ5LCBNeVNxbFZhckJpbmFyeUJ1aWxkZXIsIE15U3FsVmFyQ2hhciwgTXlTcWxWYXJDaGFyQnVpbGRlciwgTXlTcWxWaWV3Q29uZmlnLCBNeVNxbFllYXIsIE15U3FsWWVhckJ1aWxkZXIsIFByaW1hcnlLZXksIFByaW1hcnlLZXlCdWlsZGVyLCBVbmlxdWVDb25zdHJhaW50QnVpbGRlciwgYWxpYXMsIGJpZ2ludCwgYmluYXJ5LCBib29sZWFuLCBjaGFyLCBjaGVjaywgY3VzdG9tVHlwZSwgZGF0ZSwgZGF0ZXRpbWUsIGRlY2ltYWwsIGRvdWJsZSwgZmxvYXQsIGdldFRhYmxlQ29uZmlnLCBnZXRWaWV3Q29uZmlnLCBpbmRleCwgaW50LCBpc015U3FsU2NoZW1hLCBqc29uLCBsb25ndGV4dCwgbWVkaXVtaW50LCBtZWRpdW10ZXh0LCBteXNxbERhdGFiYXNlLCBteXNxbEVudW0sIG15c3FsU2NoZW1hLCBteXNxbFRhYmxlV2l0aFNjaGVtYSwgbXlzcWxWaWV3V2l0aFNjaGVtYSwgcHJpbWFyeUtleSwgcmVhbCwgc2VyaWFsLCBzbWFsbGludCwgdGV4dCwgdGltZSwgdGltZXN0YW1wLCB0aW55aW50LCB0aW55dGV4dCwgdW5pcXVlSW5kZXgsIHZhcmJpbmFyeSwgdmFyY2hhciwgeWVhciB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXgubWpzLm1hcFxuIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/drizzle-orm/mysql-core/index.mjs\n");

/***/ }),

/***/ "(rsc)/./node_modules/drizzle-orm/mysql2/index.mjs":
/*!***************************************************!*\
  !*** ./node_modules/drizzle-orm/mysql2/index.mjs ***!
  \***************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   MySql2Driver: () => (/* binding */ MySql2Driver),\n/* harmony export */   MySql2PreparedQuery: () => (/* binding */ MySql2PreparedQuery),\n/* harmony export */   MySql2Session: () => (/* binding */ MySql2Session),\n/* harmony export */   MySql2Transaction: () => (/* binding */ MySql2Transaction),\n/* harmony export */   MySqlDatabase: () => (/* reexport safe */ _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_3__.b),\n/* harmony export */   drizzle: () => (/* binding */ drizzle)\n/* harmony export */ });\n/* harmony import */ var mysql2__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mysql2 */ \"(rsc)/./node_modules/mysql2/index.js\");\n/* harmony import */ var _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../alias-cf8e03cd.mjs */ \"(rsc)/./node_modules/drizzle-orm/alias-cf8e03cd.mjs\");\n/* harmony import */ var _index_mjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../index.mjs */ \"(rsc)/./node_modules/drizzle-orm/index.mjs\");\n/* harmony import */ var _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../view-23898f21.mjs */ \"(rsc)/./node_modules/drizzle-orm/view-23898f21.mjs\");\n/* harmony import */ var mysql2_promise__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! mysql2/promise */ \"(rsc)/./node_modules/mysql2/promise.js\");\n/* harmony import */ var node_events__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! node:events */ \"node:events\");\n\n\n\n\n\n\n\nclass MySql2PreparedQuery extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_3__.P {\n    client;\n    params;\n    logger;\n    fields;\n    customResultMapper;\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_4__.e] = 'MySql2PreparedQuery';\n    rawQuery;\n    query;\n    constructor(client, queryString, params, logger, fields, customResultMapper) {\n        super();\n        this.client = client;\n        this.params = params;\n        this.logger = logger;\n        this.fields = fields;\n        this.customResultMapper = customResultMapper;\n        this.rawQuery = {\n            sql: queryString,\n            // rowsAsArray: true,\n            typeCast: function (field, next) {\n                if (field.type === 'TIMESTAMP' || field.type === 'DATETIME' || field.type === 'DATE') {\n                    return field.string();\n                }\n                return next();\n            },\n        };\n        this.query = {\n            sql: queryString,\n            rowsAsArray: true,\n            typeCast: function (field, next) {\n                if (field.type === 'TIMESTAMP' || field.type === 'DATETIME' || field.type === 'DATE') {\n                    return field.string();\n                }\n                return next();\n            },\n        };\n    }\n    async execute(placeholderValues = {}) {\n        const params = (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_4__.f)(this.params, placeholderValues);\n        this.logger.logQuery(this.rawQuery.sql, params);\n        const { fields, client, rawQuery, query, joinsNotNullableMap, customResultMapper } = this;\n        if (!fields && !customResultMapper) {\n            return client.query(rawQuery, params);\n        }\n        const result = await client.query(query, params);\n        const rows = result[0];\n        if (customResultMapper) {\n            return customResultMapper(rows);\n        }\n        return rows.map((row) => (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_4__.m)(fields, row, joinsNotNullableMap));\n    }\n    async *iterator(placeholderValues = {}) {\n        const params = (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_4__.f)(this.params, placeholderValues);\n        const conn = (isPool(this.client) ? await this.client.getConnection() : this.client).connection;\n        const { fields, query, rawQuery, joinsNotNullableMap, client, customResultMapper } = this;\n        const hasRowsMapper = Boolean(fields || customResultMapper);\n        const driverQuery = hasRowsMapper ? conn.query(query, params) : conn.query(rawQuery, params);\n        const stream = driverQuery.stream();\n        function dataListener() {\n            stream.pause();\n        }\n        stream.on('data', dataListener);\n        try {\n            const onEnd = (0,node_events__WEBPACK_IMPORTED_MODULE_2__.once)(stream, 'end');\n            const onError = (0,node_events__WEBPACK_IMPORTED_MODULE_2__.once)(stream, 'error');\n            while (true) {\n                stream.resume();\n                const row = await Promise.race([onEnd, onError, new Promise((resolve) => stream.once('data', resolve))]);\n                if (row === undefined || (Array.isArray(row) && row.length === 0)) {\n                    break;\n                }\n                else if (row instanceof Error) { // eslint-disable-line no-instanceof/no-instanceof\n                    throw row;\n                }\n                else {\n                    if (hasRowsMapper) {\n                        if (customResultMapper) {\n                            const mappedRow = customResultMapper([row]);\n                            yield (Array.isArray(mappedRow) ? mappedRow[0] : mappedRow);\n                        }\n                        else {\n                            yield (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_4__.m)(fields, row, joinsNotNullableMap);\n                        }\n                    }\n                    else {\n                        yield row;\n                    }\n                }\n            }\n        }\n        finally {\n            stream.off('data', dataListener);\n            if (isPool(client)) {\n                conn.end();\n            }\n        }\n    }\n}\nclass MySql2Session extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_3__.M {\n    client;\n    schema;\n    options;\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_4__.e] = 'MySql2Session';\n    logger;\n    mode;\n    constructor(client, dialect, schema, options) {\n        super(dialect);\n        this.client = client;\n        this.schema = schema;\n        this.options = options;\n        this.logger = options.logger ?? new _index_mjs__WEBPACK_IMPORTED_MODULE_5__.NoopLogger();\n        this.mode = options.mode;\n    }\n    prepareQuery(query, fields, customResultMapper) {\n        return new MySql2PreparedQuery(this.client, query.sql, query.params, this.logger, fields, customResultMapper);\n    }\n    /**\n     * @internal\n     * What is its purpose?\n     */\n    async query(query, params) {\n        this.logger.logQuery(query, params);\n        const result = await this.client.query({\n            sql: query,\n            values: params,\n            rowsAsArray: true,\n            typeCast: function (field, next) {\n                if (field.type === 'TIMESTAMP' || field.type === 'DATETIME' || field.type === 'DATE') {\n                    return field.string();\n                }\n                return next();\n            },\n        });\n        return result;\n    }\n    all(query) {\n        const querySql = this.dialect.sqlToQuery(query);\n        this.logger.logQuery(querySql.sql, querySql.params);\n        return this.client.execute(querySql.sql, querySql.params).then((result) => result[0]);\n    }\n    async transaction(transaction, config) {\n        const session = isPool(this.client)\n            ? new MySql2Session(await this.client.getConnection(), this.dialect, this.schema, this.options)\n            : this;\n        const tx = new MySql2Transaction(this.dialect, session, this.schema, 0, this.mode);\n        if (config) {\n            const setTransactionConfigSql = this.getSetTransactionSQL(config);\n            if (setTransactionConfigSql) {\n                await tx.execute(setTransactionConfigSql);\n            }\n            const startTransactionSql = this.getStartTransactionSQL(config);\n            await (startTransactionSql ? tx.execute(startTransactionSql) : tx.execute((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_4__.s) `begin`));\n        }\n        else {\n            await tx.execute((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_4__.s) `begin`);\n        }\n        try {\n            const result = await transaction(tx);\n            await tx.execute((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_4__.s) `commit`);\n            return result;\n        }\n        catch (err) {\n            await tx.execute((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_4__.s) `rollback`);\n            throw err;\n        }\n        finally {\n            if (isPool(this.client)) {\n                session.client.release();\n            }\n        }\n    }\n}\nclass MySql2Transaction extends _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_3__.a {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_4__.e] = 'MySql2Transaction';\n    async transaction(transaction) {\n        const savepointName = `sp${this.nestedIndex + 1}`;\n        const tx = new MySql2Transaction(this.dialect, this.session, this.schema, this.nestedIndex + 1, this.mode);\n        await tx.execute(_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_4__.s.raw(`savepoint ${savepointName}`));\n        try {\n            const result = await transaction(tx);\n            await tx.execute(_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_4__.s.raw(`release savepoint ${savepointName}`));\n            return result;\n        }\n        catch (err) {\n            await tx.execute(_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_4__.s.raw(`rollback to savepoint ${savepointName}`));\n            throw err;\n        }\n    }\n}\nfunction isPool(client) {\n    return 'getConnection' in client;\n}\n\nclass MySql2Driver {\n    client;\n    dialect;\n    options;\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_4__.e] = 'MySql2Driver';\n    constructor(client, dialect, options = {}) {\n        this.client = client;\n        this.dialect = dialect;\n        this.options = options;\n    }\n    createSession(schema, mode) {\n        return new MySql2Session(this.client, this.dialect, schema, { logger: this.options.logger, mode });\n    }\n}\nfunction drizzle(client, config = {}) {\n    const dialect = new _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_3__.c();\n    let logger;\n    if (config.logger === true) {\n        logger = new _index_mjs__WEBPACK_IMPORTED_MODULE_5__.DefaultLogger();\n    }\n    else if (config.logger !== false) {\n        logger = config.logger;\n    }\n    if (isCallbackClient(client)) {\n        client = client.promise();\n    }\n    let schema;\n    if (config.schema) {\n        if (config.mode === undefined) {\n            throw new _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_4__.D('You need to specify \"mode\": \"planetscale\" or \"default\" when providing a schema. Read more: https://orm.drizzle.team/docs/rqb#modes');\n        }\n        const tablesConfig = (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_4__.a)(config.schema, _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_4__.c);\n        schema = {\n            fullSchema: config.schema,\n            schema: tablesConfig.tables,\n            tableNamesMap: tablesConfig.tableNamesMap,\n        };\n    }\n    const mode = config.mode ?? 'default';\n    const driver = new MySql2Driver(client, dialect, { logger });\n    const session = driver.createSession(schema, mode);\n    return new _view_23898f21_mjs__WEBPACK_IMPORTED_MODULE_3__.b(dialect, session, schema, mode);\n}\nfunction isCallbackClient(client) {\n    return typeof client.promise === 'function';\n}\n\n\n//# sourceMappingURL=index.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvZHJpenpsZS1vcm0vbXlzcWwyL2luZGV4Lm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBZ0I7QUFDcUw7QUFDNUk7QUFDa0Y7QUFDbkg7QUFDVzs7QUFFbkMsa0NBQWtDLGlEQUFhO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLGtEQUFVO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSx3Q0FBd0M7QUFDeEMsdUJBQXVCLHNEQUFnQjtBQUN2QztBQUNBLGdCQUFnQiwyRUFBMkU7QUFDM0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQyxzREFBWTtBQUM3QztBQUNBLDBDQUEwQztBQUMxQyx1QkFBdUIsc0RBQWdCO0FBQ3ZDO0FBQ0EsZ0JBQWdCLDJFQUEyRTtBQUMzRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCLGlEQUFJO0FBQzlCLDRCQUE0QixpREFBSTtBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpREFBaUQ7QUFDakQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDLHNEQUFZO0FBQzlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLGlEQUFZO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBLFlBQVksa0RBQVU7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0Q0FBNEMsa0RBQVU7QUFDdEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0ZBQXNGLHNEQUFHO0FBQ3pGO0FBQ0E7QUFDQSw2QkFBNkIsc0RBQUc7QUFDaEM7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCLHNEQUFHO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QixzREFBRztBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0MsaURBQWdCO0FBQ2hELFlBQVksa0RBQVU7QUFDdEI7QUFDQSxtQ0FBbUMscUJBQXFCO0FBQ3hEO0FBQ0EseUJBQXlCLGtEQUFHLGtCQUFrQixjQUFjO0FBQzVEO0FBQ0E7QUFDQSw2QkFBNkIsa0RBQUcsMEJBQTBCLGNBQWM7QUFDeEU7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCLGtEQUFHLDhCQUE4QixjQUFjO0FBQzVFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxrREFBVTtBQUN0Qiw2Q0FBNkM7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNFQUFzRSxtQ0FBbUM7QUFDekc7QUFDQTtBQUNBLG9DQUFvQztBQUNwQyx3QkFBd0IsaURBQVk7QUFDcEM7QUFDQTtBQUNBLHFCQUFxQixxREFBYTtBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQixrREFBWTtBQUNsQztBQUNBLDZCQUE2QixzREFBNkIsZ0JBQWdCLGtEQUEyQjtBQUNyRztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVEQUF1RCxRQUFRO0FBQy9EO0FBQ0EsZUFBZSxpREFBYTtBQUM1QjtBQUNBO0FBQ0E7QUFDQTs7QUFFdUc7QUFDdkciLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcRWRnYXIgSiBSb2phcyBMXFxkZXZcXGNhcHJlcy13ZWJcXG5vZGVfbW9kdWxlc1xcZHJpenpsZS1vcm1cXG15c3FsMlxcaW5kZXgubWpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAnbXlzcWwyJztcbmltcG9ydCB7IGUgYXMgZW50aXR5S2luZCwgZiBhcyBmaWxsUGxhY2Vob2xkZXJzLCBtIGFzIG1hcFJlc3VsdFJvdywgcyBhcyBzcWwsIEQgYXMgRHJpenpsZUVycm9yLCBhIGFzIGV4dHJhY3RUYWJsZXNSZWxhdGlvbmFsQ29uZmlnLCBjIGFzIGNyZWF0ZVRhYmxlUmVsYXRpb25zSGVscGVycyB9IGZyb20gJy4uL2FsaWFzLWNmOGUwM2NkLm1qcyc7XG5pbXBvcnQgeyBOb29wTG9nZ2VyLCBEZWZhdWx0TG9nZ2VyIH0gZnJvbSAnLi4vaW5kZXgubWpzJztcbmltcG9ydCB7IFAgYXMgUHJlcGFyZWRRdWVyeSwgTSBhcyBNeVNxbFNlc3Npb24sIGEgYXMgTXlTcWxUcmFuc2FjdGlvbiwgYiBhcyBNeVNxbERhdGFiYXNlLCBjIGFzIE15U3FsRGlhbGVjdCB9IGZyb20gJy4uL3ZpZXctMjM4OThmMjEubWpzJztcbmltcG9ydCAnbXlzcWwyL3Byb21pc2UnO1xuaW1wb3J0IHsgb25jZSB9IGZyb20gJ25vZGU6ZXZlbnRzJztcblxuY2xhc3MgTXlTcWwyUHJlcGFyZWRRdWVyeSBleHRlbmRzIFByZXBhcmVkUXVlcnkge1xuICAgIGNsaWVudDtcbiAgICBwYXJhbXM7XG4gICAgbG9nZ2VyO1xuICAgIGZpZWxkcztcbiAgICBjdXN0b21SZXN1bHRNYXBwZXI7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdNeVNxbDJQcmVwYXJlZFF1ZXJ5JztcbiAgICByYXdRdWVyeTtcbiAgICBxdWVyeTtcbiAgICBjb25zdHJ1Y3RvcihjbGllbnQsIHF1ZXJ5U3RyaW5nLCBwYXJhbXMsIGxvZ2dlciwgZmllbGRzLCBjdXN0b21SZXN1bHRNYXBwZXIpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5jbGllbnQgPSBjbGllbnQ7XG4gICAgICAgIHRoaXMucGFyYW1zID0gcGFyYW1zO1xuICAgICAgICB0aGlzLmxvZ2dlciA9IGxvZ2dlcjtcbiAgICAgICAgdGhpcy5maWVsZHMgPSBmaWVsZHM7XG4gICAgICAgIHRoaXMuY3VzdG9tUmVzdWx0TWFwcGVyID0gY3VzdG9tUmVzdWx0TWFwcGVyO1xuICAgICAgICB0aGlzLnJhd1F1ZXJ5ID0ge1xuICAgICAgICAgICAgc3FsOiBxdWVyeVN0cmluZyxcbiAgICAgICAgICAgIC8vIHJvd3NBc0FycmF5OiB0cnVlLFxuICAgICAgICAgICAgdHlwZUNhc3Q6IGZ1bmN0aW9uIChmaWVsZCwgbmV4dCkge1xuICAgICAgICAgICAgICAgIGlmIChmaWVsZC50eXBlID09PSAnVElNRVNUQU1QJyB8fCBmaWVsZC50eXBlID09PSAnREFURVRJTUUnIHx8IGZpZWxkLnR5cGUgPT09ICdEQVRFJykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmllbGQuc3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBuZXh0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLnF1ZXJ5ID0ge1xuICAgICAgICAgICAgc3FsOiBxdWVyeVN0cmluZyxcbiAgICAgICAgICAgIHJvd3NBc0FycmF5OiB0cnVlLFxuICAgICAgICAgICAgdHlwZUNhc3Q6IGZ1bmN0aW9uIChmaWVsZCwgbmV4dCkge1xuICAgICAgICAgICAgICAgIGlmIChmaWVsZC50eXBlID09PSAnVElNRVNUQU1QJyB8fCBmaWVsZC50eXBlID09PSAnREFURVRJTUUnIHx8IGZpZWxkLnR5cGUgPT09ICdEQVRFJykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmllbGQuc3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBuZXh0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9O1xuICAgIH1cbiAgICBhc3luYyBleGVjdXRlKHBsYWNlaG9sZGVyVmFsdWVzID0ge30pIHtcbiAgICAgICAgY29uc3QgcGFyYW1zID0gZmlsbFBsYWNlaG9sZGVycyh0aGlzLnBhcmFtcywgcGxhY2Vob2xkZXJWYWx1ZXMpO1xuICAgICAgICB0aGlzLmxvZ2dlci5sb2dRdWVyeSh0aGlzLnJhd1F1ZXJ5LnNxbCwgcGFyYW1zKTtcbiAgICAgICAgY29uc3QgeyBmaWVsZHMsIGNsaWVudCwgcmF3UXVlcnksIHF1ZXJ5LCBqb2luc05vdE51bGxhYmxlTWFwLCBjdXN0b21SZXN1bHRNYXBwZXIgfSA9IHRoaXM7XG4gICAgICAgIGlmICghZmllbGRzICYmICFjdXN0b21SZXN1bHRNYXBwZXIpIHtcbiAgICAgICAgICAgIHJldHVybiBjbGllbnQucXVlcnkocmF3UXVlcnksIHBhcmFtcyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY2xpZW50LnF1ZXJ5KHF1ZXJ5LCBwYXJhbXMpO1xuICAgICAgICBjb25zdCByb3dzID0gcmVzdWx0WzBdO1xuICAgICAgICBpZiAoY3VzdG9tUmVzdWx0TWFwcGVyKSB7XG4gICAgICAgICAgICByZXR1cm4gY3VzdG9tUmVzdWx0TWFwcGVyKHJvd3MpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByb3dzLm1hcCgocm93KSA9PiBtYXBSZXN1bHRSb3coZmllbGRzLCByb3csIGpvaW5zTm90TnVsbGFibGVNYXApKTtcbiAgICB9XG4gICAgYXN5bmMgKml0ZXJhdG9yKHBsYWNlaG9sZGVyVmFsdWVzID0ge30pIHtcbiAgICAgICAgY29uc3QgcGFyYW1zID0gZmlsbFBsYWNlaG9sZGVycyh0aGlzLnBhcmFtcywgcGxhY2Vob2xkZXJWYWx1ZXMpO1xuICAgICAgICBjb25zdCBjb25uID0gKGlzUG9vbCh0aGlzLmNsaWVudCkgPyBhd2FpdCB0aGlzLmNsaWVudC5nZXRDb25uZWN0aW9uKCkgOiB0aGlzLmNsaWVudCkuY29ubmVjdGlvbjtcbiAgICAgICAgY29uc3QgeyBmaWVsZHMsIHF1ZXJ5LCByYXdRdWVyeSwgam9pbnNOb3ROdWxsYWJsZU1hcCwgY2xpZW50LCBjdXN0b21SZXN1bHRNYXBwZXIgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IGhhc1Jvd3NNYXBwZXIgPSBCb29sZWFuKGZpZWxkcyB8fCBjdXN0b21SZXN1bHRNYXBwZXIpO1xuICAgICAgICBjb25zdCBkcml2ZXJRdWVyeSA9IGhhc1Jvd3NNYXBwZXIgPyBjb25uLnF1ZXJ5KHF1ZXJ5LCBwYXJhbXMpIDogY29ubi5xdWVyeShyYXdRdWVyeSwgcGFyYW1zKTtcbiAgICAgICAgY29uc3Qgc3RyZWFtID0gZHJpdmVyUXVlcnkuc3RyZWFtKCk7XG4gICAgICAgIGZ1bmN0aW9uIGRhdGFMaXN0ZW5lcigpIHtcbiAgICAgICAgICAgIHN0cmVhbS5wYXVzZSgpO1xuICAgICAgICB9XG4gICAgICAgIHN0cmVhbS5vbignZGF0YScsIGRhdGFMaXN0ZW5lcik7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBvbkVuZCA9IG9uY2Uoc3RyZWFtLCAnZW5kJyk7XG4gICAgICAgICAgICBjb25zdCBvbkVycm9yID0gb25jZShzdHJlYW0sICdlcnJvcicpO1xuICAgICAgICAgICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgICAgICAgICBzdHJlYW0ucmVzdW1lKCk7XG4gICAgICAgICAgICAgICAgY29uc3Qgcm93ID0gYXdhaXQgUHJvbWlzZS5yYWNlKFtvbkVuZCwgb25FcnJvciwgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHN0cmVhbS5vbmNlKCdkYXRhJywgcmVzb2x2ZSkpXSk7XG4gICAgICAgICAgICAgICAgaWYgKHJvdyA9PT0gdW5kZWZpbmVkIHx8IChBcnJheS5pc0FycmF5KHJvdykgJiYgcm93Lmxlbmd0aCA9PT0gMCkpIHtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJvdyBpbnN0YW5jZW9mIEVycm9yKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8taW5zdGFuY2VvZi9uby1pbnN0YW5jZW9mXG4gICAgICAgICAgICAgICAgICAgIHRocm93IHJvdztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChoYXNSb3dzTWFwcGVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VzdG9tUmVzdWx0TWFwcGVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbWFwcGVkUm93ID0gY3VzdG9tUmVzdWx0TWFwcGVyKFtyb3ddKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5aWVsZCAoQXJyYXkuaXNBcnJheShtYXBwZWRSb3cpID8gbWFwcGVkUm93WzBdIDogbWFwcGVkUm93KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHlpZWxkIG1hcFJlc3VsdFJvdyhmaWVsZHMsIHJvdywgam9pbnNOb3ROdWxsYWJsZU1hcCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB5aWVsZCByb3c7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZmluYWxseSB7XG4gICAgICAgICAgICBzdHJlYW0ub2ZmKCdkYXRhJywgZGF0YUxpc3RlbmVyKTtcbiAgICAgICAgICAgIGlmIChpc1Bvb2woY2xpZW50KSkge1xuICAgICAgICAgICAgICAgIGNvbm4uZW5kKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG5jbGFzcyBNeVNxbDJTZXNzaW9uIGV4dGVuZHMgTXlTcWxTZXNzaW9uIHtcbiAgICBjbGllbnQ7XG4gICAgc2NoZW1hO1xuICAgIG9wdGlvbnM7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdNeVNxbDJTZXNzaW9uJztcbiAgICBsb2dnZXI7XG4gICAgbW9kZTtcbiAgICBjb25zdHJ1Y3RvcihjbGllbnQsIGRpYWxlY3QsIHNjaGVtYSwgb3B0aW9ucykge1xuICAgICAgICBzdXBlcihkaWFsZWN0KTtcbiAgICAgICAgdGhpcy5jbGllbnQgPSBjbGllbnQ7XG4gICAgICAgIHRoaXMuc2NoZW1hID0gc2NoZW1hO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgICAgICB0aGlzLmxvZ2dlciA9IG9wdGlvbnMubG9nZ2VyID8/IG5ldyBOb29wTG9nZ2VyKCk7XG4gICAgICAgIHRoaXMubW9kZSA9IG9wdGlvbnMubW9kZTtcbiAgICB9XG4gICAgcHJlcGFyZVF1ZXJ5KHF1ZXJ5LCBmaWVsZHMsIGN1c3RvbVJlc3VsdE1hcHBlcikge1xuICAgICAgICByZXR1cm4gbmV3IE15U3FsMlByZXBhcmVkUXVlcnkodGhpcy5jbGllbnQsIHF1ZXJ5LnNxbCwgcXVlcnkucGFyYW1zLCB0aGlzLmxvZ2dlciwgZmllbGRzLCBjdXN0b21SZXN1bHRNYXBwZXIpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKiBXaGF0IGlzIGl0cyBwdXJwb3NlP1xuICAgICAqL1xuICAgIGFzeW5jIHF1ZXJ5KHF1ZXJ5LCBwYXJhbXMpIHtcbiAgICAgICAgdGhpcy5sb2dnZXIubG9nUXVlcnkocXVlcnksIHBhcmFtcyk7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuY2xpZW50LnF1ZXJ5KHtcbiAgICAgICAgICAgIHNxbDogcXVlcnksXG4gICAgICAgICAgICB2YWx1ZXM6IHBhcmFtcyxcbiAgICAgICAgICAgIHJvd3NBc0FycmF5OiB0cnVlLFxuICAgICAgICAgICAgdHlwZUNhc3Q6IGZ1bmN0aW9uIChmaWVsZCwgbmV4dCkge1xuICAgICAgICAgICAgICAgIGlmIChmaWVsZC50eXBlID09PSAnVElNRVNUQU1QJyB8fCBmaWVsZC50eXBlID09PSAnREFURVRJTUUnIHx8IGZpZWxkLnR5cGUgPT09ICdEQVRFJykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmllbGQuc3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBuZXh0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG4gICAgYWxsKHF1ZXJ5KSB7XG4gICAgICAgIGNvbnN0IHF1ZXJ5U3FsID0gdGhpcy5kaWFsZWN0LnNxbFRvUXVlcnkocXVlcnkpO1xuICAgICAgICB0aGlzLmxvZ2dlci5sb2dRdWVyeShxdWVyeVNxbC5zcWwsIHF1ZXJ5U3FsLnBhcmFtcyk7XG4gICAgICAgIHJldHVybiB0aGlzLmNsaWVudC5leGVjdXRlKHF1ZXJ5U3FsLnNxbCwgcXVlcnlTcWwucGFyYW1zKS50aGVuKChyZXN1bHQpID0+IHJlc3VsdFswXSk7XG4gICAgfVxuICAgIGFzeW5jIHRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uLCBjb25maWcpIHtcbiAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IGlzUG9vbCh0aGlzLmNsaWVudClcbiAgICAgICAgICAgID8gbmV3IE15U3FsMlNlc3Npb24oYXdhaXQgdGhpcy5jbGllbnQuZ2V0Q29ubmVjdGlvbigpLCB0aGlzLmRpYWxlY3QsIHRoaXMuc2NoZW1hLCB0aGlzLm9wdGlvbnMpXG4gICAgICAgICAgICA6IHRoaXM7XG4gICAgICAgIGNvbnN0IHR4ID0gbmV3IE15U3FsMlRyYW5zYWN0aW9uKHRoaXMuZGlhbGVjdCwgc2Vzc2lvbiwgdGhpcy5zY2hlbWEsIDAsIHRoaXMubW9kZSk7XG4gICAgICAgIGlmIChjb25maWcpIHtcbiAgICAgICAgICAgIGNvbnN0IHNldFRyYW5zYWN0aW9uQ29uZmlnU3FsID0gdGhpcy5nZXRTZXRUcmFuc2FjdGlvblNRTChjb25maWcpO1xuICAgICAgICAgICAgaWYgKHNldFRyYW5zYWN0aW9uQ29uZmlnU3FsKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdHguZXhlY3V0ZShzZXRUcmFuc2FjdGlvbkNvbmZpZ1NxbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBzdGFydFRyYW5zYWN0aW9uU3FsID0gdGhpcy5nZXRTdGFydFRyYW5zYWN0aW9uU1FMKGNvbmZpZyk7XG4gICAgICAgICAgICBhd2FpdCAoc3RhcnRUcmFuc2FjdGlvblNxbCA/IHR4LmV4ZWN1dGUoc3RhcnRUcmFuc2FjdGlvblNxbCkgOiB0eC5leGVjdXRlKHNxbCBgYmVnaW5gKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBhd2FpdCB0eC5leGVjdXRlKHNxbCBgYmVnaW5gKTtcbiAgICAgICAgfVxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdHJhbnNhY3Rpb24odHgpO1xuICAgICAgICAgICAgYXdhaXQgdHguZXhlY3V0ZShzcWwgYGNvbW1pdGApO1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICBhd2FpdCB0eC5leGVjdXRlKHNxbCBgcm9sbGJhY2tgKTtcbiAgICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgfVxuICAgICAgICBmaW5hbGx5IHtcbiAgICAgICAgICAgIGlmIChpc1Bvb2wodGhpcy5jbGllbnQpKSB7XG4gICAgICAgICAgICAgICAgc2Vzc2lvbi5jbGllbnQucmVsZWFzZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuY2xhc3MgTXlTcWwyVHJhbnNhY3Rpb24gZXh0ZW5kcyBNeVNxbFRyYW5zYWN0aW9uIHtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ015U3FsMlRyYW5zYWN0aW9uJztcbiAgICBhc3luYyB0cmFuc2FjdGlvbih0cmFuc2FjdGlvbikge1xuICAgICAgICBjb25zdCBzYXZlcG9pbnROYW1lID0gYHNwJHt0aGlzLm5lc3RlZEluZGV4ICsgMX1gO1xuICAgICAgICBjb25zdCB0eCA9IG5ldyBNeVNxbDJUcmFuc2FjdGlvbih0aGlzLmRpYWxlY3QsIHRoaXMuc2Vzc2lvbiwgdGhpcy5zY2hlbWEsIHRoaXMubmVzdGVkSW5kZXggKyAxLCB0aGlzLm1vZGUpO1xuICAgICAgICBhd2FpdCB0eC5leGVjdXRlKHNxbC5yYXcoYHNhdmVwb2ludCAke3NhdmVwb2ludE5hbWV9YCkpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdHJhbnNhY3Rpb24odHgpO1xuICAgICAgICAgICAgYXdhaXQgdHguZXhlY3V0ZShzcWwucmF3KGByZWxlYXNlIHNhdmVwb2ludCAke3NhdmVwb2ludE5hbWV9YCkpO1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICBhd2FpdCB0eC5leGVjdXRlKHNxbC5yYXcoYHJvbGxiYWNrIHRvIHNhdmVwb2ludCAke3NhdmVwb2ludE5hbWV9YCkpO1xuICAgICAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgICB9XG4gICAgfVxufVxuZnVuY3Rpb24gaXNQb29sKGNsaWVudCkge1xuICAgIHJldHVybiAnZ2V0Q29ubmVjdGlvbicgaW4gY2xpZW50O1xufVxuXG5jbGFzcyBNeVNxbDJEcml2ZXIge1xuICAgIGNsaWVudDtcbiAgICBkaWFsZWN0O1xuICAgIG9wdGlvbnM7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdNeVNxbDJEcml2ZXInO1xuICAgIGNvbnN0cnVjdG9yKGNsaWVudCwgZGlhbGVjdCwgb3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIHRoaXMuY2xpZW50ID0gY2xpZW50O1xuICAgICAgICB0aGlzLmRpYWxlY3QgPSBkaWFsZWN0O1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgIH1cbiAgICBjcmVhdGVTZXNzaW9uKHNjaGVtYSwgbW9kZSkge1xuICAgICAgICByZXR1cm4gbmV3IE15U3FsMlNlc3Npb24odGhpcy5jbGllbnQsIHRoaXMuZGlhbGVjdCwgc2NoZW1hLCB7IGxvZ2dlcjogdGhpcy5vcHRpb25zLmxvZ2dlciwgbW9kZSB9KTtcbiAgICB9XG59XG5mdW5jdGlvbiBkcml6emxlKGNsaWVudCwgY29uZmlnID0ge30pIHtcbiAgICBjb25zdCBkaWFsZWN0ID0gbmV3IE15U3FsRGlhbGVjdCgpO1xuICAgIGxldCBsb2dnZXI7XG4gICAgaWYgKGNvbmZpZy5sb2dnZXIgPT09IHRydWUpIHtcbiAgICAgICAgbG9nZ2VyID0gbmV3IERlZmF1bHRMb2dnZXIoKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoY29uZmlnLmxvZ2dlciAhPT0gZmFsc2UpIHtcbiAgICAgICAgbG9nZ2VyID0gY29uZmlnLmxvZ2dlcjtcbiAgICB9XG4gICAgaWYgKGlzQ2FsbGJhY2tDbGllbnQoY2xpZW50KSkge1xuICAgICAgICBjbGllbnQgPSBjbGllbnQucHJvbWlzZSgpO1xuICAgIH1cbiAgICBsZXQgc2NoZW1hO1xuICAgIGlmIChjb25maWcuc2NoZW1hKSB7XG4gICAgICAgIGlmIChjb25maWcubW9kZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRHJpenpsZUVycm9yKCdZb3UgbmVlZCB0byBzcGVjaWZ5IFwibW9kZVwiOiBcInBsYW5ldHNjYWxlXCIgb3IgXCJkZWZhdWx0XCIgd2hlbiBwcm92aWRpbmcgYSBzY2hlbWEuIFJlYWQgbW9yZTogaHR0cHM6Ly9vcm0uZHJpenpsZS50ZWFtL2RvY3MvcnFiI21vZGVzJyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdGFibGVzQ29uZmlnID0gZXh0cmFjdFRhYmxlc1JlbGF0aW9uYWxDb25maWcoY29uZmlnLnNjaGVtYSwgY3JlYXRlVGFibGVSZWxhdGlvbnNIZWxwZXJzKTtcbiAgICAgICAgc2NoZW1hID0ge1xuICAgICAgICAgICAgZnVsbFNjaGVtYTogY29uZmlnLnNjaGVtYSxcbiAgICAgICAgICAgIHNjaGVtYTogdGFibGVzQ29uZmlnLnRhYmxlcyxcbiAgICAgICAgICAgIHRhYmxlTmFtZXNNYXA6IHRhYmxlc0NvbmZpZy50YWJsZU5hbWVzTWFwLFxuICAgICAgICB9O1xuICAgIH1cbiAgICBjb25zdCBtb2RlID0gY29uZmlnLm1vZGUgPz8gJ2RlZmF1bHQnO1xuICAgIGNvbnN0IGRyaXZlciA9IG5ldyBNeVNxbDJEcml2ZXIoY2xpZW50LCBkaWFsZWN0LCB7IGxvZ2dlciB9KTtcbiAgICBjb25zdCBzZXNzaW9uID0gZHJpdmVyLmNyZWF0ZVNlc3Npb24oc2NoZW1hLCBtb2RlKTtcbiAgICByZXR1cm4gbmV3IE15U3FsRGF0YWJhc2UoZGlhbGVjdCwgc2Vzc2lvbiwgc2NoZW1hLCBtb2RlKTtcbn1cbmZ1bmN0aW9uIGlzQ2FsbGJhY2tDbGllbnQoY2xpZW50KSB7XG4gICAgcmV0dXJuIHR5cGVvZiBjbGllbnQucHJvbWlzZSA9PT0gJ2Z1bmN0aW9uJztcbn1cblxuZXhwb3J0IHsgTXlTcWwyRHJpdmVyLCBNeVNxbDJQcmVwYXJlZFF1ZXJ5LCBNeVNxbDJTZXNzaW9uLCBNeVNxbDJUcmFuc2FjdGlvbiwgTXlTcWxEYXRhYmFzZSwgZHJpenpsZSB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXgubWpzLm1hcFxuIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/drizzle-orm/mysql2/index.mjs\n");

/***/ }),

/***/ "(rsc)/./node_modules/drizzle-orm/view-23898f21.mjs":
/*!****************************************************!*\
  !*** ./node_modules/drizzle-orm/view-23898f21.mjs ***!
  \****************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   A: () => (/* binding */ UniqueConstraint),\n/* harmony export */   B: () => (/* binding */ ViewBuilder),\n/* harmony export */   C: () => (/* binding */ ManualViewBuilder),\n/* harmony export */   D: () => (/* binding */ MySqlViewBase),\n/* harmony export */   E: () => (/* binding */ MySqlView),\n/* harmony export */   F: () => (/* binding */ ForeignKeyBuilder),\n/* harmony export */   G: () => (/* binding */ mysqlView),\n/* harmony export */   I: () => (/* binding */ InlineForeignKeys),\n/* harmony export */   M: () => (/* binding */ MySqlSession),\n/* harmony export */   P: () => (/* binding */ PreparedQuery),\n/* harmony export */   Q: () => (/* binding */ QueryBuilder),\n/* harmony export */   U: () => (/* binding */ UniqueConstraintBuilder),\n/* harmony export */   V: () => (/* binding */ ViewBuilderCore),\n/* harmony export */   a: () => (/* binding */ MySqlTransaction),\n/* harmony export */   b: () => (/* binding */ MySqlDatabase),\n/* harmony export */   c: () => (/* binding */ MySqlDialect),\n/* harmony export */   d: () => (/* binding */ MySqlColumnBuilderWithAutoIncrement),\n/* harmony export */   e: () => (/* binding */ MySqlColumnWithAutoIncrement),\n/* harmony export */   f: () => (/* binding */ MySqlColumnBuilder),\n/* harmony export */   g: () => (/* binding */ MySqlColumn),\n/* harmony export */   h: () => (/* binding */ MySqlTable),\n/* harmony export */   i: () => (/* binding */ mysqlViewWithSchema),\n/* harmony export */   j: () => (/* binding */ MySqlViewConfig),\n/* harmony export */   k: () => (/* binding */ ForeignKey),\n/* harmony export */   l: () => (/* binding */ foreignKey),\n/* harmony export */   m: () => (/* binding */ mysqlTableWithSchema),\n/* harmony export */   n: () => (/* binding */ MySqlDelete),\n/* harmony export */   o: () => (/* binding */ MySqlInsertBuilder),\n/* harmony export */   p: () => (/* binding */ MySqlInsert),\n/* harmony export */   q: () => (/* binding */ MySqlSelectBuilder),\n/* harmony export */   r: () => (/* binding */ MySqlSelectQueryBuilder),\n/* harmony export */   s: () => (/* binding */ MySqlSelect),\n/* harmony export */   t: () => (/* binding */ MySqlUpdateBuilder),\n/* harmony export */   u: () => (/* binding */ MySqlUpdate),\n/* harmony export */   v: () => (/* binding */ mysqlTable),\n/* harmony export */   w: () => (/* binding */ mysqlTableCreator),\n/* harmony export */   x: () => (/* binding */ unique),\n/* harmony export */   y: () => (/* binding */ uniqueKeyName),\n/* harmony export */   z: () => (/* binding */ UniqueOnConstraintBuilder)\n/* harmony export */ });\n/* harmony import */ var _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./alias-cf8e03cd.mjs */ \"(rsc)/./node_modules/drizzle-orm/alias-cf8e03cd.mjs\");\n\n\n/** @internal */\nconst InlineForeignKeys = Symbol.for('drizzle:MySqlInlineForeignKeys');\nclass MySqlTable extends _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.T {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.e] = 'MySqlTable';\n    /** @internal */\n    static Symbol = Object.assign({}, _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.T.Symbol, {\n        InlineForeignKeys: InlineForeignKeys,\n    });\n    /** @internal */\n    [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.T.Symbol.Columns];\n    /** @internal */\n    [InlineForeignKeys] = [];\n    /** @internal */\n    [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.T.Symbol.ExtraConfigBuilder] = undefined;\n}\nfunction mysqlTableWithSchema(name, columns, extraConfig, schema, baseName = name) {\n    const rawTable = new MySqlTable(name, schema, baseName);\n    const builtColumns = Object.fromEntries(Object.entries(columns).map(([name, colBuilderBase]) => {\n        const colBuilder = colBuilderBase;\n        const column = colBuilder.build(rawTable);\n        rawTable[InlineForeignKeys].push(...colBuilder.buildForeignKeys(column, rawTable));\n        return [name, column];\n    }));\n    const table = Object.assign(rawTable, builtColumns);\n    table[_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.T.Symbol.Columns] = builtColumns;\n    if (extraConfig) {\n        table[MySqlTable.Symbol.ExtraConfigBuilder] = extraConfig;\n    }\n    return table;\n}\nconst mysqlTable = (name, columns, extraConfig) => {\n    return mysqlTableWithSchema(name, columns, extraConfig, undefined, name);\n};\nfunction mysqlTableCreator(customizeTableName) {\n    return (name, columns, extraConfig) => {\n        return mysqlTableWithSchema(customizeTableName(name), columns, extraConfig, undefined, name);\n    };\n}\n\nclass ForeignKeyBuilder {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.e] = 'MySqlForeignKeyBuilder';\n    /** @internal */\n    reference;\n    /** @internal */\n    _onUpdate;\n    /** @internal */\n    _onDelete;\n    constructor(config, actions) {\n        this.reference = () => {\n            const { columns, foreignColumns } = config();\n            return { columns, foreignTable: foreignColumns[0].table, foreignColumns };\n        };\n        if (actions) {\n            this._onUpdate = actions.onUpdate;\n            this._onDelete = actions.onDelete;\n        }\n    }\n    onUpdate(action) {\n        this._onUpdate = action;\n        return this;\n    }\n    onDelete(action) {\n        this._onDelete = action;\n        return this;\n    }\n    /** @internal */\n    build(table) {\n        return new ForeignKey(table, this);\n    }\n}\nclass ForeignKey {\n    table;\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.e] = 'MySqlForeignKey';\n    reference;\n    onUpdate;\n    onDelete;\n    constructor(table, builder) {\n        this.table = table;\n        this.reference = builder.reference;\n        this.onUpdate = builder._onUpdate;\n        this.onDelete = builder._onDelete;\n    }\n    getName() {\n        const { columns, foreignColumns } = this.reference();\n        const columnNames = columns.map((column) => column.name);\n        const foreignColumnNames = foreignColumns.map((column) => column.name);\n        const chunks = [\n            this.table[MySqlTable.Symbol.Name],\n            ...columnNames,\n            foreignColumns[0].table[MySqlTable.Symbol.Name],\n            ...foreignColumnNames,\n        ];\n        return `${chunks.join('_')}_fk`;\n    }\n}\nfunction foreignKey(config) {\n    function mappedConfig() {\n        const { columns, foreignColumns } = config;\n        return {\n            columns,\n            foreignColumns,\n        };\n    }\n    return new ForeignKeyBuilder(mappedConfig);\n}\n\nfunction unique(name) {\n    return new UniqueOnConstraintBuilder(name);\n}\nfunction uniqueKeyName(table, columns) {\n    return `${table[MySqlTable.Symbol.Name]}_${columns.join('_')}_unique`;\n}\nclass UniqueConstraintBuilder {\n    name;\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.e] = 'MySqlUniqueConstraintBuilder';\n    /** @internal */\n    columns;\n    constructor(columns, name) {\n        this.name = name;\n        this.columns = columns;\n    }\n    /** @internal */\n    build(table) {\n        return new UniqueConstraint(table, this.columns, this.name);\n    }\n}\nclass UniqueOnConstraintBuilder {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.e] = 'MySqlUniqueOnConstraintBuilder';\n    /** @internal */\n    name;\n    constructor(name) {\n        this.name = name;\n    }\n    on(...columns) {\n        return new UniqueConstraintBuilder(columns, this.name);\n    }\n}\nclass UniqueConstraint {\n    table;\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.e] = 'MySqlUniqueConstraint';\n    columns;\n    name;\n    nullsNotDistinct = false;\n    constructor(table, columns, name) {\n        this.table = table;\n        this.columns = columns;\n        this.name = name ?? uniqueKeyName(this.table, this.columns.map((column) => column.name));\n    }\n    getName() {\n        return this.name;\n    }\n}\n\nclass MySqlColumnBuilder extends _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.C {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.e] = 'MySqlColumnBuilder';\n    foreignKeyConfigs = [];\n    references(ref, actions = {}) {\n        this.foreignKeyConfigs.push({ ref, actions });\n        return this;\n    }\n    unique(name) {\n        this.config.isUnique = true;\n        this.config.uniqueName = name;\n        return this;\n    }\n    /** @internal */\n    buildForeignKeys(column, table) {\n        return this.foreignKeyConfigs.map(({ ref, actions }) => {\n            return ((ref, actions) => {\n                const builder = new ForeignKeyBuilder(() => {\n                    const foreignColumn = ref();\n                    return { columns: [column], foreignColumns: [foreignColumn] };\n                });\n                if (actions.onUpdate) {\n                    builder.onUpdate(actions.onUpdate);\n                }\n                if (actions.onDelete) {\n                    builder.onDelete(actions.onDelete);\n                }\n                return builder.build(table);\n            })(ref, actions);\n        });\n    }\n}\n// To understand how to use `MySqlColumn` and `AnyMySqlColumn`, see `Column` and `AnyColumn` documentation.\nclass MySqlColumn extends _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.p {\n    table;\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.e] = 'MySqlColumn';\n    constructor(table, config) {\n        if (!config.uniqueName) {\n            config.uniqueName = uniqueKeyName(table, [config.name]);\n        }\n        super(table, config);\n        this.table = table;\n    }\n}\nclass MySqlColumnBuilderWithAutoIncrement extends MySqlColumnBuilder {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.e] = 'MySqlColumnBuilderWithAutoIncrement';\n    constructor(name, dataType, columnType) {\n        super(name, dataType, columnType);\n        this.config.autoIncrement = false;\n    }\n    autoincrement() {\n        this.config.autoIncrement = true;\n        this.config.hasDefault = true;\n        return this;\n    }\n}\nclass MySqlColumnWithAutoIncrement extends MySqlColumn {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.e] = 'MySqlColumnWithAutoIncrement';\n    autoIncrement = this.config.autoIncrement;\n}\n\nclass MySqlDelete extends _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.Q {\n    table;\n    session;\n    dialect;\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.e] = 'MySqlDelete';\n    config;\n    constructor(table, session, dialect) {\n        super();\n        this.table = table;\n        this.session = session;\n        this.dialect = dialect;\n        this.config = { table };\n    }\n    where(where) {\n        this.config.where = where;\n        return this;\n    }\n    /** @internal */\n    getSQL() {\n        return this.dialect.buildDeleteQuery(this.config);\n    }\n    toSQL() {\n        const { typings: _typings, ...rest } = this.dialect.sqlToQuery(this.getSQL());\n        return rest;\n    }\n    prepare() {\n        return this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()), this.config.returning);\n    }\n    execute = (placeholderValues) => {\n        return this.prepare().execute(placeholderValues);\n    };\n    createIterator = () => {\n        const self = this;\n        return async function* (placeholderValues) {\n            yield* self.prepare().iterator(placeholderValues);\n        };\n    };\n    iterator = this.createIterator();\n}\n\nclass MySqlInsertBuilder {\n    table;\n    session;\n    dialect;\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.e] = 'MySqlInsertBuilder';\n    shouldIgnore = false;\n    constructor(table, session, dialect) {\n        this.table = table;\n        this.session = session;\n        this.dialect = dialect;\n    }\n    ignore() {\n        this.shouldIgnore = true;\n        return this;\n    }\n    values(values) {\n        values = Array.isArray(values) ? values : [values];\n        if (values.length === 0) {\n            throw new Error('values() must be called with at least one value');\n        }\n        const mappedValues = values.map((entry) => {\n            const result = {};\n            const cols = this.table[_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.T.Symbol.Columns];\n            for (const colKey of Object.keys(entry)) {\n                const colValue = entry[colKey];\n                result[colKey] = (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(colValue, _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.S) ? colValue : new _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.b(colValue, cols[colKey]);\n            }\n            return result;\n        });\n        return new MySqlInsert(this.table, mappedValues, this.shouldIgnore, this.session, this.dialect);\n    }\n}\nclass MySqlInsert extends _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.Q {\n    session;\n    dialect;\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.e] = 'MySqlInsert';\n    config;\n    constructor(table, values, ignore, session, dialect) {\n        super();\n        this.session = session;\n        this.dialect = dialect;\n        this.config = { table, values, ignore };\n    }\n    onDuplicateKeyUpdate(config) {\n        const setSql = this.dialect.buildUpdateSet(this.config.table, (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.d)(this.config.table, config.set));\n        this.config.onConflict = (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) `update ${setSql}`;\n        return this;\n    }\n    /** @internal */\n    getSQL() {\n        return this.dialect.buildInsertQuery(this.config);\n    }\n    toSQL() {\n        const { typings: _typings, ...rest } = this.dialect.sqlToQuery(this.getSQL());\n        return rest;\n    }\n    prepare() {\n        return this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()), undefined);\n    }\n    execute = (placeholderValues) => {\n        return this.prepare().execute(placeholderValues);\n    };\n    createIterator = () => {\n        const self = this;\n        return async function* (placeholderValues) {\n            yield* self.prepare().iterator(placeholderValues);\n        };\n    };\n    iterator = this.createIterator();\n}\n\n// TODO find out how to use all/values. Seems like I need those functions\n// Build project\n// copy runtime tests to be sure it's working\n// Add mysql to drizzle-kit\n// Add Planetscale Driver and create example repo\nclass MySqlDialect {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.e] = 'MySqlDialect';\n    async migrate(migrations, session, config) {\n        const migrationsTable = config.migrationsTable ?? '__drizzle_migrations';\n        const migrationTableCreate = (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) `\n\t\t\tcreate table if not exists ${_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.identifier(migrationsTable)} (\n\t\t\t\tid serial primary key,\n\t\t\t\thash text not null,\n\t\t\t\tcreated_at bigint\n\t\t\t)\n\t\t`;\n        await session.execute(migrationTableCreate);\n        const dbMigrations = await session.all((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) `select id, hash, created_at from ${_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.identifier(migrationsTable)} order by created_at desc limit 1`);\n        const lastDbMigration = dbMigrations[0];\n        await session.transaction(async (tx) => {\n            for (const migration of migrations) {\n                if (!lastDbMigration\n                    || Number(lastDbMigration.created_at) < migration.folderMillis) {\n                    for (const stmt of migration.sql) {\n                        await tx.execute(_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.raw(stmt));\n                    }\n                    await tx.execute((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) `insert into ${_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.identifier(migrationsTable)} (\\`hash\\`, \\`created_at\\`) values(${migration.hash}, ${migration.folderMillis})`);\n                }\n            }\n        });\n    }\n    escapeName(name) {\n        return `\\`${name}\\``;\n    }\n    escapeParam(_num) {\n        return `?`;\n    }\n    escapeString(str) {\n        return `'${str.replace(/'/g, \"''\")}'`;\n    }\n    buildDeleteQuery({ table, where, returning }) {\n        const returningSql = returning\n            ? (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) ` returning ${this.buildSelection(returning, { isSingleTable: true })}`\n            : undefined;\n        const whereSql = where ? (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) ` where ${where}` : undefined;\n        return (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) `delete from ${table}${whereSql}${returningSql}`;\n    }\n    buildUpdateSet(table, set) {\n        const setEntries = Object.entries(set);\n        const setSize = setEntries.length;\n        return _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.join(setEntries\n            .flatMap(([colName, value], i) => {\n            const col = table[_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.T.Symbol.Columns][colName];\n            const res = (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) `${_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.identifier(col.name)} = ${value}`;\n            if (i < setSize - 1) {\n                return [res, _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.raw(', ')];\n            }\n            return [res];\n        }));\n    }\n    buildUpdateQuery({ table, set, where, returning }) {\n        const setSql = this.buildUpdateSet(table, set);\n        const returningSql = returning\n            ? (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) ` returning ${this.buildSelection(returning, { isSingleTable: true })}`\n            : undefined;\n        const whereSql = where ? (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) ` where ${where}` : undefined;\n        return (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) `update ${table} set ${setSql}${whereSql}${returningSql}`;\n    }\n    /**\n     * Builds selection SQL with provided fields/expressions\n     *\n     * Examples:\n     *\n     * `select <selection> from`\n     *\n     * `insert ... returning <selection>`\n     *\n     * If `isSingleTable` is true, then columns won't be prefixed with table name\n     */\n    buildSelection(fields, { isSingleTable = false } = {}) {\n        const columnsLen = fields.length;\n        const chunks = fields\n            .flatMap(({ field }, i) => {\n            const chunk = [];\n            if ((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(field, _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.S.Aliased) && field.isSelectionField) {\n                chunk.push(_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.identifier(field.fieldAlias));\n            }\n            else if ((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(field, _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.S.Aliased) || (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(field, _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.S)) {\n                const query = (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(field, _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.S.Aliased) ? field.sql : field;\n                if (isSingleTable) {\n                    chunk.push(new _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.S(query.queryChunks.map((c) => {\n                        if ((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(c, MySqlColumn)) {\n                            return _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.identifier(c.name);\n                        }\n                        return c;\n                    })));\n                }\n                else {\n                    chunk.push(query);\n                }\n                if ((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(field, _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.S.Aliased)) {\n                    chunk.push((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) ` as ${_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.identifier(field.fieldAlias)}`);\n                }\n            }\n            else if ((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(field, _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.p)) {\n                if (isSingleTable) {\n                    chunk.push(_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.identifier(field.name));\n                }\n                else {\n                    chunk.push(field);\n                }\n            }\n            if (i < columnsLen - 1) {\n                chunk.push((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) `, `);\n            }\n            return chunk;\n        });\n        return _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.join(chunks);\n    }\n    buildSelectQuery({ withList, fields, fieldsFlat, where, having, table, joins, orderBy, groupBy, limit, offset, lockingClause, distinct, }) {\n        const fieldsList = fieldsFlat ?? (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.o)(fields);\n        for (const f of fieldsList) {\n            if ((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(f.field, _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.p)\n                && (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.q)(f.field.table)\n                    !== ((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(table, _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.r)\n                        ? table[_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.u].alias\n                        : (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(table, MySqlViewBase)\n                            ? table[_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.V].name\n                            : (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(table, _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.S)\n                                ? undefined\n                                : (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.q)(table))\n                && !((table) => joins?.some(({ alias }) => alias === (table[_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.T.Symbol.IsAlias] ? (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.q)(table) : table[_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.T.Symbol.BaseName])))(f.field.table)) {\n                const tableName = (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.q)(f.field.table);\n                throw new Error(`Your \"${f.path.join('->')}\" field references a column \"${tableName}\".\"${f.field.name}\", but the table \"${tableName}\" is not part of the query! Did you forget to join it?`);\n            }\n        }\n        const isSingleTable = !joins || joins.length === 0;\n        let withSql;\n        if (withList?.length) {\n            const withSqlChunks = [(0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) `with `];\n            for (const [i, w] of withList.entries()) {\n                withSqlChunks.push((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) `${_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.identifier(w[_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.u].alias)} as (${w[_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.u].sql})`);\n                if (i < withList.length - 1) {\n                    withSqlChunks.push((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) `, `);\n                }\n            }\n            withSqlChunks.push((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) ` `);\n            withSql = _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.join(withSqlChunks);\n        }\n        const distinctSql = distinct ? (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) ` distinct` : undefined;\n        const selection = this.buildSelection(fieldsList, { isSingleTable });\n        const tableSql = (() => {\n            if ((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(table, _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.T) && table[_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.T.Symbol.OriginalName] !== table[_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.T.Symbol.Name]) {\n                return (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) `${_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.identifier(table[_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.T.Symbol.OriginalName])} ${_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.identifier(table[_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.T.Symbol.Name])}`;\n            }\n            return table;\n        })();\n        const joinsArray = [];\n        if (joins) {\n            for (const [index, joinMeta] of joins.entries()) {\n                if (index === 0) {\n                    joinsArray.push((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) ` `);\n                }\n                const table = joinMeta.table;\n                const lateralSql = joinMeta.lateral ? (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) ` lateral` : undefined;\n                if ((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(table, MySqlTable)) {\n                    const tableName = table[MySqlTable.Symbol.Name];\n                    const tableSchema = table[MySqlTable.Symbol.Schema];\n                    const origTableName = table[MySqlTable.Symbol.OriginalName];\n                    const alias = tableName === origTableName ? undefined : joinMeta.alias;\n                    joinsArray.push((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) `${_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.raw(joinMeta.joinType)} join${lateralSql} ${tableSchema ? (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) `${_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.identifier(tableSchema)}.` : undefined}${_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.identifier(origTableName)}${alias && (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) ` ${_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.identifier(alias)}`} on ${joinMeta.on}`);\n                }\n                else if ((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(table, _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.v)) {\n                    const viewName = table[_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.V].name;\n                    const viewSchema = table[_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.V].schema;\n                    const origViewName = table[_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.V].originalName;\n                    const alias = viewName === origViewName ? undefined : joinMeta.alias;\n                    joinsArray.push((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) `${_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.raw(joinMeta.joinType)} join${lateralSql} ${viewSchema ? (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) `${_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.identifier(viewSchema)}.` : undefined}${_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.identifier(origViewName)}${alias && (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) ` ${_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.identifier(alias)}`} on ${joinMeta.on}`);\n                }\n                else {\n                    joinsArray.push((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) `${_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.raw(joinMeta.joinType)} join${lateralSql} ${table} on ${joinMeta.on}`);\n                }\n                if (index < joins.length - 1) {\n                    joinsArray.push((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) ` `);\n                }\n            }\n        }\n        const joinsSql = _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.join(joinsArray);\n        const whereSql = where ? (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) ` where ${where}` : undefined;\n        const havingSql = having ? (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) ` having ${having}` : undefined;\n        let orderBySql;\n        if (orderBy && orderBy.length > 0) {\n            orderBySql = (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) ` order by ${_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.join(orderBy, (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) `, `)}`;\n        }\n        let groupBySql;\n        if (groupBy && groupBy.length > 0) {\n            groupBySql = (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) ` group by ${_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.join(groupBy, (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) `, `)}`;\n        }\n        const limitSql = limit ? (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) ` limit ${limit}` : undefined;\n        const offsetSql = offset ? (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) ` offset ${offset}` : undefined;\n        let lockingClausesSql;\n        if (lockingClause) {\n            const { config, strength } = lockingClause;\n            lockingClausesSql = (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) ` for ${_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.raw(strength)}`;\n            if (config.noWait) {\n                lockingClausesSql.append((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) ` no wait`);\n            }\n            else if (config.skipLocked) {\n                lockingClausesSql.append((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) ` skip locked`);\n            }\n        }\n        return (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) `${withSql}select${distinctSql} ${selection} from ${tableSql}${joinsSql}${whereSql}${groupBySql}${havingSql}${orderBySql}${limitSql}${offsetSql}${lockingClausesSql}`;\n    }\n    buildInsertQuery({ table, values, ignore, onConflict }) {\n        // const isSingleValue = values.length === 1;\n        const valuesSqlList = [];\n        const columns = table[_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.T.Symbol.Columns];\n        const colEntries = Object.entries(columns);\n        const insertOrder = colEntries.map(([, column]) => _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.identifier(column.name));\n        for (const [valueIndex, value] of values.entries()) {\n            const valueList = [];\n            for (const [fieldName, col] of colEntries) {\n                const colValue = value[fieldName];\n                if (colValue === undefined || ((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(colValue, _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.b) && colValue.value === undefined)) {\n                    // eslint-disable-next-line unicorn/no-negated-condition\n                    if (col.defaultFn !== undefined) {\n                        const defaultFnResult = col.defaultFn();\n                        const defaultValue = (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(defaultFnResult, _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.S) ? defaultFnResult : _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.param(defaultFnResult, col);\n                        valueList.push(defaultValue);\n                    }\n                    else {\n                        valueList.push((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) `default`);\n                    }\n                }\n                else {\n                    valueList.push(colValue);\n                }\n            }\n            valuesSqlList.push(valueList);\n            if (valueIndex < values.length - 1) {\n                valuesSqlList.push((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) `, `);\n            }\n        }\n        const valuesSql = _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.join(valuesSqlList);\n        const ignoreSql = ignore ? (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) ` ignore` : undefined;\n        const onConflictSql = onConflict ? (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) ` on duplicate key ${onConflict}` : undefined;\n        return (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) `insert${ignoreSql} into ${table} ${insertOrder} values ${valuesSql}${onConflictSql}`;\n    }\n    sqlToQuery(sql) {\n        return sql.toQuery({\n            escapeName: this.escapeName,\n            escapeParam: this.escapeParam,\n            escapeString: this.escapeString,\n        });\n    }\n    buildRelationalQuery({ fullSchema, schema, tableNamesMap, table, tableConfig, queryConfig: config, tableAlias, nestedQueryRelation, joinOn, }) {\n        let selection = [];\n        let limit, offset, orderBy, where;\n        const joins = [];\n        if (config === true) {\n            const selectionEntries = Object.entries(tableConfig.columns);\n            selection = selectionEntries.map(([key, value]) => ({\n                dbKey: value.name,\n                tsKey: key,\n                field: (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.w)(value, tableAlias),\n                relationTableTsKey: undefined,\n                isJson: false,\n                selection: [],\n            }));\n        }\n        else {\n            const aliasedColumns = Object.fromEntries(Object.entries(tableConfig.columns).map(([key, value]) => [key, (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.w)(value, tableAlias)]));\n            if (config.where) {\n                const whereSql = typeof config.where === 'function'\n                    ? config.where(aliasedColumns, (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.x)())\n                    : config.where;\n                where = whereSql && (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.y)(whereSql, tableAlias);\n            }\n            const fieldsSelection = [];\n            let selectedColumns = [];\n            // Figure out which columns to select\n            if (config.columns) {\n                let isIncludeMode = false;\n                for (const [field, value] of Object.entries(config.columns)) {\n                    if (value === undefined) {\n                        continue;\n                    }\n                    if (field in tableConfig.columns) {\n                        if (!isIncludeMode && value === true) {\n                            isIncludeMode = true;\n                        }\n                        selectedColumns.push(field);\n                    }\n                }\n                if (selectedColumns.length > 0) {\n                    selectedColumns = isIncludeMode\n                        ? selectedColumns.filter((c) => config.columns?.[c] === true)\n                        : Object.keys(tableConfig.columns).filter((key) => !selectedColumns.includes(key));\n                }\n            }\n            else {\n                // Select all columns if selection is not specified\n                selectedColumns = Object.keys(tableConfig.columns);\n            }\n            for (const field of selectedColumns) {\n                const column = tableConfig.columns[field];\n                fieldsSelection.push({ tsKey: field, value: column });\n            }\n            let selectedRelations = [];\n            // Figure out which relations to select\n            if (config.with) {\n                selectedRelations = Object.entries(config.with)\n                    .filter((entry) => !!entry[1])\n                    .map(([tsKey, queryConfig]) => ({ tsKey, queryConfig, relation: tableConfig.relations[tsKey] }));\n            }\n            let extras;\n            // Figure out which extras to select\n            if (config.extras) {\n                extras = typeof config.extras === 'function'\n                    ? config.extras(aliasedColumns, { sql: _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s })\n                    : config.extras;\n                for (const [tsKey, value] of Object.entries(extras)) {\n                    fieldsSelection.push({\n                        tsKey,\n                        value: (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.z)(value, tableAlias),\n                    });\n                }\n            }\n            // Transform `fieldsSelection` into `selection`\n            // `fieldsSelection` shouldn't be used after this point\n            for (const { tsKey, value } of fieldsSelection) {\n                selection.push({\n                    dbKey: (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(value, _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.S.Aliased) ? value.fieldAlias : tableConfig.columns[tsKey].name,\n                    tsKey,\n                    field: (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(value, _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.p) ? (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.w)(value, tableAlias) : value,\n                    relationTableTsKey: undefined,\n                    isJson: false,\n                    selection: [],\n                });\n            }\n            let orderByOrig = typeof config.orderBy === 'function'\n                ? config.orderBy(aliasedColumns, (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.A)())\n                : config.orderBy ?? [];\n            if (!Array.isArray(orderByOrig)) {\n                orderByOrig = [orderByOrig];\n            }\n            orderBy = orderByOrig.map((orderByValue) => {\n                if ((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(orderByValue, _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.p)) {\n                    return (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.w)(orderByValue, tableAlias);\n                }\n                return (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.y)(orderByValue, tableAlias);\n            });\n            limit = config.limit;\n            offset = config.offset;\n            // Process all relations\n            for (const { tsKey: selectedRelationTsKey, queryConfig: selectedRelationConfigValue, relation, } of selectedRelations) {\n                const normalizedRelation = (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.B)(schema, tableNamesMap, relation);\n                const relationTableName = relation.referencedTable[_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.T.Symbol.Name];\n                const relationTableTsName = tableNamesMap[relationTableName];\n                const relationTableAlias = `${tableAlias}_${selectedRelationTsKey}`;\n                const joinOn = (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.E)(...normalizedRelation.fields.map((field, i) => (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.F)((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.w)(normalizedRelation.references[i], relationTableAlias), (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.w)(field, tableAlias))));\n                const builtRelation = this.buildRelationalQuery({\n                    fullSchema,\n                    schema,\n                    tableNamesMap,\n                    table: fullSchema[relationTableTsName],\n                    tableConfig: schema[relationTableTsName],\n                    queryConfig: (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(relation, _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.O)\n                        ? (selectedRelationConfigValue === true\n                            ? { limit: 1 }\n                            : { ...selectedRelationConfigValue, limit: 1 })\n                        : selectedRelationConfigValue,\n                    tableAlias: relationTableAlias,\n                    joinOn,\n                    nestedQueryRelation: relation,\n                });\n                const field = (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) `${_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.identifier(relationTableAlias)}.${_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.identifier('data')}`.as(selectedRelationTsKey);\n                joins.push({\n                    on: (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) `true`,\n                    table: new _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.r(builtRelation.sql, {}, relationTableAlias),\n                    alias: relationTableAlias,\n                    joinType: 'left',\n                    lateral: true,\n                });\n                selection.push({\n                    dbKey: selectedRelationTsKey,\n                    tsKey: selectedRelationTsKey,\n                    field,\n                    relationTableTsKey: relationTableTsName,\n                    isJson: true,\n                    selection: builtRelation.selection,\n                });\n            }\n        }\n        if (selection.length === 0) {\n            throw new _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.D(`No fields selected for table \"${tableConfig.tsName}\" (\"${tableAlias}\")`);\n        }\n        let result;\n        where = (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.E)(joinOn, where);\n        if (nestedQueryRelation) {\n            let field = (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) `json_array(${_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.join(selection.map(({ field, tsKey, isJson }) => isJson\n                ? (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) `${_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.identifier(`${tableAlias}_${tsKey}`)}.${_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.identifier('data')}`\n                : (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(field, _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.S.Aliased)\n                    ? field.sql\n                    : field), (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) `, `)})`;\n            if ((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(nestedQueryRelation, _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.M)) {\n                field = (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) `coalesce(json_arrayagg(${field}), json_array())`;\n            }\n            const nestedSelection = [{\n                    dbKey: 'data',\n                    tsKey: 'data',\n                    field: field.as('data'),\n                    isJson: true,\n                    relationTableTsKey: tableConfig.tsName,\n                    selection,\n                }];\n            const needsSubquery = limit !== undefined || offset !== undefined || (orderBy?.length ?? 0) > 0;\n            if (needsSubquery) {\n                result = this.buildSelectQuery({\n                    table: (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.G)(table, tableAlias),\n                    fields: {},\n                    fieldsFlat: [\n                        {\n                            path: [],\n                            field: _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.raw('*'),\n                        },\n                        ...(((orderBy?.length ?? 0) > 0)\n                            ? [{\n                                    path: [],\n                                    field: (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) `row_number() over (order by ${_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.join(orderBy, (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) `, `)})`,\n                                }]\n                            : []),\n                    ],\n                    where,\n                    limit,\n                    offset,\n                });\n                where = undefined;\n                limit = undefined;\n                offset = undefined;\n                orderBy = undefined;\n            }\n            else {\n                result = (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.G)(table, tableAlias);\n            }\n            result = this.buildSelectQuery({\n                table: (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(result, MySqlTable) ? result : new _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.r(result, {}, tableAlias),\n                fields: {},\n                fieldsFlat: nestedSelection.map(({ field }) => ({\n                    path: [],\n                    field: (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(field, _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.p) ? (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.w)(field, tableAlias) : field,\n                })),\n                joins,\n                where,\n                limit,\n                offset,\n                orderBy,\n            });\n        }\n        else {\n            result = this.buildSelectQuery({\n                table: (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.G)(table, tableAlias),\n                fields: {},\n                fieldsFlat: selection.map(({ field }) => ({\n                    path: [],\n                    field: (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(field, _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.p) ? (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.w)(field, tableAlias) : field,\n                })),\n                joins,\n                where,\n                limit,\n                offset,\n                orderBy,\n            });\n        }\n        return {\n            tableTsKey: tableConfig.tsName,\n            sql: result,\n            selection,\n        };\n    }\n    buildRelationalQueryWithoutLateralSubqueries({ fullSchema, schema, tableNamesMap, table, tableConfig, queryConfig: config, tableAlias, nestedQueryRelation, joinOn, }) {\n        let selection = [];\n        let limit, offset, orderBy = [], where;\n        if (config === true) {\n            const selectionEntries = Object.entries(tableConfig.columns);\n            selection = selectionEntries.map(([key, value]) => ({\n                dbKey: value.name,\n                tsKey: key,\n                field: (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.w)(value, tableAlias),\n                relationTableTsKey: undefined,\n                isJson: false,\n                selection: [],\n            }));\n        }\n        else {\n            const aliasedColumns = Object.fromEntries(Object.entries(tableConfig.columns).map(([key, value]) => [key, (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.w)(value, tableAlias)]));\n            if (config.where) {\n                const whereSql = typeof config.where === 'function'\n                    ? config.where(aliasedColumns, (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.x)())\n                    : config.where;\n                where = whereSql && (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.y)(whereSql, tableAlias);\n            }\n            const fieldsSelection = [];\n            let selectedColumns = [];\n            // Figure out which columns to select\n            if (config.columns) {\n                let isIncludeMode = false;\n                for (const [field, value] of Object.entries(config.columns)) {\n                    if (value === undefined) {\n                        continue;\n                    }\n                    if (field in tableConfig.columns) {\n                        if (!isIncludeMode && value === true) {\n                            isIncludeMode = true;\n                        }\n                        selectedColumns.push(field);\n                    }\n                }\n                if (selectedColumns.length > 0) {\n                    selectedColumns = isIncludeMode\n                        ? selectedColumns.filter((c) => config.columns?.[c] === true)\n                        : Object.keys(tableConfig.columns).filter((key) => !selectedColumns.includes(key));\n                }\n            }\n            else {\n                // Select all columns if selection is not specified\n                selectedColumns = Object.keys(tableConfig.columns);\n            }\n            for (const field of selectedColumns) {\n                const column = tableConfig.columns[field];\n                fieldsSelection.push({ tsKey: field, value: column });\n            }\n            let selectedRelations = [];\n            // Figure out which relations to select\n            if (config.with) {\n                selectedRelations = Object.entries(config.with)\n                    .filter((entry) => !!entry[1])\n                    .map(([tsKey, queryConfig]) => ({ tsKey, queryConfig, relation: tableConfig.relations[tsKey] }));\n            }\n            let extras;\n            // Figure out which extras to select\n            if (config.extras) {\n                extras = typeof config.extras === 'function'\n                    ? config.extras(aliasedColumns, { sql: _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s })\n                    : config.extras;\n                for (const [tsKey, value] of Object.entries(extras)) {\n                    fieldsSelection.push({\n                        tsKey,\n                        value: (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.z)(value, tableAlias),\n                    });\n                }\n            }\n            // Transform `fieldsSelection` into `selection`\n            // `fieldsSelection` shouldn't be used after this point\n            for (const { tsKey, value } of fieldsSelection) {\n                selection.push({\n                    dbKey: (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(value, _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.S.Aliased) ? value.fieldAlias : tableConfig.columns[tsKey].name,\n                    tsKey,\n                    field: (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(value, _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.p) ? (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.w)(value, tableAlias) : value,\n                    relationTableTsKey: undefined,\n                    isJson: false,\n                    selection: [],\n                });\n            }\n            let orderByOrig = typeof config.orderBy === 'function'\n                ? config.orderBy(aliasedColumns, (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.A)())\n                : config.orderBy ?? [];\n            if (!Array.isArray(orderByOrig)) {\n                orderByOrig = [orderByOrig];\n            }\n            orderBy = orderByOrig.map((orderByValue) => {\n                if ((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(orderByValue, _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.p)) {\n                    return (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.w)(orderByValue, tableAlias);\n                }\n                return (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.y)(orderByValue, tableAlias);\n            });\n            limit = config.limit;\n            offset = config.offset;\n            // Process all relations\n            for (const { tsKey: selectedRelationTsKey, queryConfig: selectedRelationConfigValue, relation, } of selectedRelations) {\n                const normalizedRelation = (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.B)(schema, tableNamesMap, relation);\n                const relationTableName = relation.referencedTable[_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.T.Symbol.Name];\n                const relationTableTsName = tableNamesMap[relationTableName];\n                const relationTableAlias = `${tableAlias}_${selectedRelationTsKey}`;\n                const joinOn = (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.E)(...normalizedRelation.fields.map((field, i) => (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.F)((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.w)(normalizedRelation.references[i], relationTableAlias), (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.w)(field, tableAlias))));\n                const builtRelation = this.buildRelationalQueryWithoutLateralSubqueries({\n                    fullSchema,\n                    schema,\n                    tableNamesMap,\n                    table: fullSchema[relationTableTsName],\n                    tableConfig: schema[relationTableTsName],\n                    queryConfig: (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(relation, _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.O)\n                        ? (selectedRelationConfigValue === true\n                            ? { limit: 1 }\n                            : { ...selectedRelationConfigValue, limit: 1 })\n                        : selectedRelationConfigValue,\n                    tableAlias: relationTableAlias,\n                    joinOn,\n                    nestedQueryRelation: relation,\n                });\n                let fieldSql = (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) `(${builtRelation.sql})`;\n                if ((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(relation, _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.M)) {\n                    fieldSql = (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) `coalesce(${fieldSql}, json_array())`;\n                }\n                const field = fieldSql.as(selectedRelationTsKey);\n                selection.push({\n                    dbKey: selectedRelationTsKey,\n                    tsKey: selectedRelationTsKey,\n                    field,\n                    relationTableTsKey: relationTableTsName,\n                    isJson: true,\n                    selection: builtRelation.selection,\n                });\n            }\n        }\n        if (selection.length === 0) {\n            throw new _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.D(`No fields selected for table \"${tableConfig.tsName}\" (\"${tableAlias}\"). You need to have at least one item in \"columns\", \"with\" or \"extras\". If you need to select all columns, omit the \"columns\" key or set it to undefined.`);\n        }\n        let result;\n        where = (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.E)(joinOn, where);\n        if (nestedQueryRelation) {\n            let field = (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) `json_array(${_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.join(selection.map(({ field }) => (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(field, MySqlColumn) ? _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.identifier(field.name) : (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(field, _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.S.Aliased) ? field.sql : field), (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) `, `)})`;\n            if ((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(nestedQueryRelation, _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.M)) {\n                field = (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) `json_arrayagg(${field})`;\n            }\n            const nestedSelection = [{\n                    dbKey: 'data',\n                    tsKey: 'data',\n                    field,\n                    isJson: true,\n                    relationTableTsKey: tableConfig.tsName,\n                    selection,\n                }];\n            const needsSubquery = limit !== undefined || offset !== undefined || orderBy.length > 0;\n            if (needsSubquery) {\n                result = this.buildSelectQuery({\n                    table: (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.G)(table, tableAlias),\n                    fields: {},\n                    fieldsFlat: [\n                        {\n                            path: [],\n                            field: _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.raw('*'),\n                        },\n                        ...(orderBy.length > 0)\n                            ? [{\n                                    path: [],\n                                    field: (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) `row_number() over (order by ${_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.join(orderBy, (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s) `, `)})`,\n                                }]\n                            : [],\n                    ],\n                    where,\n                    limit,\n                    offset,\n                });\n                where = undefined;\n                limit = undefined;\n                offset = undefined;\n                orderBy = undefined;\n            }\n            else {\n                result = (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.G)(table, tableAlias);\n            }\n            result = this.buildSelectQuery({\n                table: (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(result, MySqlTable) ? result : new _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.r(result, {}, tableAlias),\n                fields: {},\n                fieldsFlat: nestedSelection.map(({ field }) => ({\n                    path: [],\n                    field: (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(field, _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.p) ? (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.w)(field, tableAlias) : field,\n                })),\n                where,\n                limit,\n                offset,\n                orderBy,\n            });\n        }\n        else {\n            result = this.buildSelectQuery({\n                table: (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.G)(table, tableAlias),\n                fields: {},\n                fieldsFlat: selection.map(({ field }) => ({\n                    path: [],\n                    field: (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(field, _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.p) ? (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.w)(field, tableAlias) : field,\n                })),\n                where,\n                limit,\n                offset,\n                orderBy,\n            });\n        }\n        return {\n            tableTsKey: tableConfig.tsName,\n            sql: result,\n            selection,\n        };\n    }\n}\n\nclass MySqlSelectBuilder {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.e] = 'MySqlSelectBuilder';\n    fields;\n    session;\n    dialect;\n    withList = [];\n    distinct;\n    constructor(config) {\n        this.fields = config.fields;\n        this.session = config.session;\n        this.dialect = config.dialect;\n        if (config.withList) {\n            this.withList = config.withList;\n        }\n        this.distinct = config.distinct;\n    }\n    from(source) {\n        const isPartialSelect = !!this.fields;\n        let fields;\n        if (this.fields) {\n            fields = this.fields;\n        }\n        else if ((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(source, _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.r)) {\n            // This is required to use the proxy handler to get the correct field values from the subquery\n            fields = Object.fromEntries(Object.keys(source[_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.u].selection).map((key) => [key, source[key]]));\n        }\n        else if ((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(source, MySqlViewBase)) {\n            fields = source[_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.V].selectedFields;\n        }\n        else if ((0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(source, _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.S)) {\n            fields = {};\n        }\n        else {\n            fields = (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.I)(source);\n        }\n        return new MySqlSelect({\n            table: source,\n            fields,\n            isPartialSelect,\n            session: this.session,\n            dialect: this.dialect,\n            withList: this.withList,\n            distinct: this.distinct,\n        });\n    }\n}\nclass MySqlSelectQueryBuilder extends _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.J {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.e] = 'MySqlSelectQueryBuilder';\n    _;\n    config;\n    joinsNotNullableMap;\n    tableName;\n    isPartialSelect;\n    /** @internal */\n    session;\n    dialect;\n    constructor({ table, fields, isPartialSelect, session, dialect, withList, distinct }) {\n        super();\n        this.config = {\n            withList,\n            table,\n            fields: { ...fields },\n            distinct,\n        };\n        this.isPartialSelect = isPartialSelect;\n        this.session = session;\n        this.dialect = dialect;\n        this._ = {\n            selectedFields: fields,\n        };\n        this.tableName = (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.K)(table);\n        this.joinsNotNullableMap = typeof this.tableName === 'string' ? { [this.tableName]: true } : {};\n    }\n    createJoin(joinType) {\n        return (table, on) => {\n            const baseTableName = this.tableName;\n            const tableName = (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.K)(table);\n            if (typeof tableName === 'string' && this.config.joins?.some((join) => join.alias === tableName)) {\n                throw new Error(`Alias \"${tableName}\" is already used in this query`);\n            }\n            if (!this.isPartialSelect) {\n                // If this is the first join and this is not a partial select and we're not selecting from raw SQL, \"move\" the fields from the main table to the nested object\n                if (Object.keys(this.joinsNotNullableMap).length === 1 && typeof baseTableName === 'string') {\n                    this.config.fields = {\n                        [baseTableName]: this.config.fields,\n                    };\n                }\n                if (typeof tableName === 'string' && !(0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(table, _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.S)) {\n                    const selection = (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(table, _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.r)\n                        ? table[_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.u].selection\n                        : (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.i)(table, _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.v)\n                            ? table[_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.V].selectedFields\n                            : table[_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.T.Symbol.Columns];\n                    this.config.fields[tableName] = selection;\n                }\n            }\n            if (typeof on === 'function') {\n                on = on(new Proxy(this.config.fields, new _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.j({ sqlAliasedBehavior: 'sql', sqlBehavior: 'sql' })));\n            }\n            if (!this.config.joins) {\n                this.config.joins = [];\n            }\n            this.config.joins.push({ on, table, joinType, alias: tableName });\n            if (typeof tableName === 'string') {\n                switch (joinType) {\n                    case 'left': {\n                        this.joinsNotNullableMap[tableName] = false;\n                        break;\n                    }\n                    case 'right': {\n                        this.joinsNotNullableMap = Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([key]) => [key, false]));\n                        this.joinsNotNullableMap[tableName] = true;\n                        break;\n                    }\n                    case 'inner': {\n                        this.joinsNotNullableMap[tableName] = true;\n                        break;\n                    }\n                    case 'full': {\n                        this.joinsNotNullableMap = Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([key]) => [key, false]));\n                        this.joinsNotNullableMap[tableName] = false;\n                        break;\n                    }\n                }\n            }\n            return this;\n        };\n    }\n    leftJoin = this.createJoin('left');\n    rightJoin = this.createJoin('right');\n    innerJoin = this.createJoin('inner');\n    fullJoin = this.createJoin('full');\n    where(where) {\n        if (typeof where === 'function') {\n            where = where(new Proxy(this.config.fields, new _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.j({ sqlAliasedBehavior: 'sql', sqlBehavior: 'sql' })));\n        }\n        this.config.where = where;\n        return this;\n    }\n    having(having) {\n        if (typeof having === 'function') {\n            having = having(new Proxy(this.config.fields, new _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.j({ sqlAliasedBehavior: 'sql', sqlBehavior: 'sql' })));\n        }\n        this.config.having = having;\n        return this;\n    }\n    groupBy(...columns) {\n        if (typeof columns[0] === 'function') {\n            const groupBy = columns[0](new Proxy(this.config.fields, new _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.j({ sqlAliasedBehavior: 'alias', sqlBehavior: 'sql' })));\n            this.config.groupBy = Array.isArray(groupBy) ? groupBy : [groupBy];\n        }\n        else {\n            this.config.groupBy = columns;\n        }\n        return this;\n    }\n    orderBy(...columns) {\n        if (typeof columns[0] === 'function') {\n            const orderBy = columns[0](new Proxy(this.config.fields, new _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.j({ sqlAliasedBehavior: 'alias', sqlBehavior: 'sql' })));\n            this.config.orderBy = Array.isArray(orderBy) ? orderBy : [orderBy];\n        }\n        else {\n            this.config.orderBy = columns;\n        }\n        return this;\n    }\n    limit(limit) {\n        this.config.limit = limit;\n        return this;\n    }\n    offset(offset) {\n        this.config.offset = offset;\n        return this;\n    }\n    for(strength, config = {}) {\n        this.config.lockingClause = { strength, config };\n        return this;\n    }\n    /** @internal */\n    getSQL() {\n        return this.dialect.buildSelectQuery(this.config);\n    }\n    toSQL() {\n        const { typings: _typings, ...rest } = this.dialect.sqlToQuery(this.getSQL());\n        return rest;\n    }\n    as(alias) {\n        return new Proxy(new _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.r(this.getSQL(), this.config.fields, alias), new _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.j({ alias, sqlAliasedBehavior: 'alias', sqlBehavior: 'error' }));\n    }\n}\nclass MySqlSelect extends MySqlSelectQueryBuilder {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.e] = 'MySqlSelect';\n    prepare() {\n        if (!this.session) {\n            throw new Error('Cannot execute a query on a query builder. Please use a database instance instead.');\n        }\n        const fieldsList = (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.o)(this.config.fields);\n        const query = this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()), fieldsList);\n        query.joinsNotNullableMap = this.joinsNotNullableMap;\n        return query;\n    }\n    execute = ((placeholderValues) => {\n        return this.prepare().execute(placeholderValues);\n    });\n    createIterator = () => {\n        const self = this;\n        return async function* (placeholderValues) {\n            yield* self.prepare().iterator(placeholderValues);\n        };\n    };\n    iterator = this.createIterator();\n}\n(0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.H)(MySqlSelect, [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.Q]);\n\nclass QueryBuilder {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.e] = 'MySqlQueryBuilder';\n    dialect;\n    $with(alias) {\n        const queryBuilder = this;\n        return {\n            as(qb) {\n                if (typeof qb === 'function') {\n                    qb = qb(queryBuilder);\n                }\n                return new Proxy(new _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.W(qb.getSQL(), qb.getSelectedFields(), alias, true), new _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.j({ alias, sqlAliasedBehavior: 'alias', sqlBehavior: 'error' }));\n            },\n        };\n    }\n    with(...queries) {\n        const self = this;\n        function select(fields) {\n            return new MySqlSelectBuilder({\n                fields: fields ?? undefined,\n                session: undefined,\n                dialect: self.getDialect(),\n                withList: queries,\n            });\n        }\n        function selectDistinct(fields) {\n            return new MySqlSelectBuilder({\n                fields: fields ?? undefined,\n                session: undefined,\n                dialect: self.getDialect(),\n                withList: queries,\n                distinct: true,\n            });\n        }\n        return { select, selectDistinct };\n    }\n    select(fields) {\n        return new MySqlSelectBuilder({ fields: fields ?? undefined, session: undefined, dialect: this.getDialect() });\n    }\n    selectDistinct(fields) {\n        return new MySqlSelectBuilder({\n            fields: fields ?? undefined,\n            session: undefined,\n            dialect: this.getDialect(),\n            distinct: true,\n        });\n    }\n    // Lazy load dialect to avoid circular dependency\n    getDialect() {\n        if (!this.dialect) {\n            this.dialect = new MySqlDialect();\n        }\n        return this.dialect;\n    }\n}\n\nclass RelationalQueryBuilder {\n    fullSchema;\n    schema;\n    tableNamesMap;\n    table;\n    tableConfig;\n    dialect;\n    session;\n    mode;\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.e] = 'MySqlRelationalQueryBuilder';\n    constructor(fullSchema, schema, tableNamesMap, table, tableConfig, dialect, session, mode) {\n        this.fullSchema = fullSchema;\n        this.schema = schema;\n        this.tableNamesMap = tableNamesMap;\n        this.table = table;\n        this.tableConfig = tableConfig;\n        this.dialect = dialect;\n        this.session = session;\n        this.mode = mode;\n    }\n    findMany(config) {\n        return new MySqlRelationalQuery(this.fullSchema, this.schema, this.tableNamesMap, this.table, this.tableConfig, this.dialect, this.session, config ? config : {}, 'many', this.mode);\n    }\n    findFirst(config) {\n        return new MySqlRelationalQuery(this.fullSchema, this.schema, this.tableNamesMap, this.table, this.tableConfig, this.dialect, this.session, config ? { ...config, limit: 1 } : { limit: 1 }, 'first', this.mode);\n    }\n}\nclass MySqlRelationalQuery extends _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.Q {\n    fullSchema;\n    schema;\n    tableNamesMap;\n    table;\n    tableConfig;\n    dialect;\n    session;\n    config;\n    queryMode;\n    mode;\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.e] = 'MySqlRelationalQuery';\n    constructor(fullSchema, schema, tableNamesMap, table, tableConfig, dialect, session, config, queryMode, mode) {\n        super();\n        this.fullSchema = fullSchema;\n        this.schema = schema;\n        this.tableNamesMap = tableNamesMap;\n        this.table = table;\n        this.tableConfig = tableConfig;\n        this.dialect = dialect;\n        this.session = session;\n        this.config = config;\n        this.queryMode = queryMode;\n        this.mode = mode;\n    }\n    prepare() {\n        const { query, builtQuery } = this._toSQL();\n        return this.session.prepareQuery(builtQuery, undefined, (rawRows) => {\n            const rows = rawRows.map((row) => (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.g)(this.schema, this.tableConfig, row, query.selection));\n            if (this.queryMode === 'first') {\n                return rows[0];\n            }\n            return rows;\n        });\n    }\n    _toSQL() {\n        const query = this.mode === 'planetscale'\n            ? this.dialect.buildRelationalQueryWithoutLateralSubqueries({\n                fullSchema: this.fullSchema,\n                schema: this.schema,\n                tableNamesMap: this.tableNamesMap,\n                table: this.table,\n                tableConfig: this.tableConfig,\n                queryConfig: this.config,\n                tableAlias: this.tableConfig.tsName,\n            })\n            : this.dialect.buildRelationalQuery({\n                fullSchema: this.fullSchema,\n                schema: this.schema,\n                tableNamesMap: this.tableNamesMap,\n                table: this.table,\n                tableConfig: this.tableConfig,\n                queryConfig: this.config,\n                tableAlias: this.tableConfig.tsName,\n            });\n        const builtQuery = this.dialect.sqlToQuery(query.sql);\n        return { builtQuery, query };\n    }\n    toSQL() {\n        return this._toSQL().builtQuery;\n    }\n    execute() {\n        return this.prepare().execute();\n    }\n}\n\nclass MySqlDatabase {\n    dialect;\n    session;\n    mode;\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.e] = 'MySqlDatabase';\n    query;\n    constructor(\n    /** @internal */\n    dialect, \n    /** @internal */\n    session, schema, mode) {\n        this.dialect = dialect;\n        this.session = session;\n        this.mode = mode;\n        this._ = schema\n            ? { schema: schema.schema, tableNamesMap: schema.tableNamesMap }\n            : { schema: undefined, tableNamesMap: {} };\n        this.query = {};\n        if (this._.schema) {\n            for (const [tableName, columns] of Object.entries(this._.schema)) {\n                this.query[tableName] =\n                    new RelationalQueryBuilder(schema.fullSchema, this._.schema, this._.tableNamesMap, schema.fullSchema[tableName], columns, dialect, session, this.mode);\n            }\n        }\n    }\n    $with(alias) {\n        return {\n            as(qb) {\n                if (typeof qb === 'function') {\n                    qb = qb(new QueryBuilder());\n                }\n                return new Proxy(new _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.W(qb.getSQL(), qb.getSelectedFields(), alias, true), new _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.j({ alias, sqlAliasedBehavior: 'alias', sqlBehavior: 'error' }));\n            },\n        };\n    }\n    with(...queries) {\n        const self = this;\n        function select(fields) {\n            return new MySqlSelectBuilder({\n                fields: fields ?? undefined,\n                session: self.session,\n                dialect: self.dialect,\n                withList: queries,\n            });\n        }\n        function selectDistinct(fields) {\n            return new MySqlSelectBuilder({\n                fields: fields ?? undefined,\n                session: self.session,\n                dialect: self.dialect,\n                withList: queries,\n                distinct: true,\n            });\n        }\n        return { select, selectDistinct };\n    }\n    select(fields) {\n        return new MySqlSelectBuilder({ fields: fields ?? undefined, session: this.session, dialect: this.dialect });\n    }\n    selectDistinct(fields) {\n        return new MySqlSelectBuilder({\n            fields: fields ?? undefined,\n            session: this.session,\n            dialect: this.dialect,\n            distinct: true,\n        });\n    }\n    update(table) {\n        return new MySqlUpdateBuilder(table, this.session, this.dialect);\n    }\n    insert(table) {\n        return new MySqlInsertBuilder(table, this.session, this.dialect);\n    }\n    delete(table) {\n        return new MySqlDelete(table, this.session, this.dialect);\n    }\n    execute(query) {\n        return this.session.execute(query.getSQL());\n    }\n    transaction(transaction, config) {\n        return this.session.transaction(transaction, config);\n    }\n}\n\nclass PreparedQuery {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.e] = 'MySqlPreparedQuery';\n    /** @internal */\n    joinsNotNullableMap;\n}\nclass MySqlSession {\n    dialect;\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.e] = 'MySqlSession';\n    constructor(dialect) {\n        this.dialect = dialect;\n    }\n    execute(query) {\n        return this.prepareQuery(this.dialect.sqlToQuery(query), undefined).execute();\n    }\n    getSetTransactionSQL(config) {\n        const parts = [];\n        if (config.isolationLevel) {\n            parts.push(`isolation level ${config.isolationLevel}`);\n        }\n        return parts.length ? _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.join(['set transaction ', parts.join(' ')]) : undefined;\n    }\n    getStartTransactionSQL(config) {\n        const parts = [];\n        if (config.withConsistentSnapshot) {\n            parts.push('with consistent snapshot');\n        }\n        if (config.accessMode) {\n            parts.push(config.accessMode);\n        }\n        return parts.length ? _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.s.join(['start transaction ', parts.join(' ')]) : undefined;\n    }\n}\nclass MySqlTransaction extends MySqlDatabase {\n    schema;\n    nestedIndex;\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.e] = 'MySqlTransaction';\n    constructor(dialect, session, schema, nestedIndex, mode) {\n        super(dialect, session, schema, mode);\n        this.schema = schema;\n        this.nestedIndex = nestedIndex;\n    }\n    rollback() {\n        throw new _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.l();\n    }\n}\n\nclass MySqlUpdateBuilder {\n    table;\n    session;\n    dialect;\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.e] = 'MySqlUpdateBuilder';\n    constructor(table, session, dialect) {\n        this.table = table;\n        this.session = session;\n        this.dialect = dialect;\n    }\n    set(values) {\n        return new MySqlUpdate(this.table, (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.d)(this.table, values), this.session, this.dialect);\n    }\n}\nclass MySqlUpdate extends _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.Q {\n    session;\n    dialect;\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.e] = 'MySqlUpdate';\n    config;\n    constructor(table, set, session, dialect) {\n        super();\n        this.session = session;\n        this.dialect = dialect;\n        this.config = { set, table };\n    }\n    where(where) {\n        this.config.where = where;\n        return this;\n    }\n    /** @internal */\n    getSQL() {\n        return this.dialect.buildUpdateQuery(this.config);\n    }\n    toSQL() {\n        const { typings: _typings, ...rest } = this.dialect.sqlToQuery(this.getSQL());\n        return rest;\n    }\n    prepare() {\n        return this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()), this.config.returning);\n    }\n    execute = (placeholderValues) => {\n        return this.prepare().execute(placeholderValues);\n    };\n    createIterator = () => {\n        const self = this;\n        return async function* (placeholderValues) {\n            yield* self.prepare().iterator(placeholderValues);\n        };\n    };\n    iterator = this.createIterator();\n}\n\nclass ViewBuilderCore {\n    name;\n    schema;\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.e] = 'MySqlViewBuilder';\n    constructor(name, schema) {\n        this.name = name;\n        this.schema = schema;\n    }\n    config = {};\n    algorithm(algorithm) {\n        this.config.algorithm = algorithm;\n        return this;\n    }\n    definer(definer) {\n        this.config.definer = definer;\n        return this;\n    }\n    sqlSecurity(sqlSecurity) {\n        this.config.sqlSecurity = sqlSecurity;\n        return this;\n    }\n    withCheckOption(withCheckOption) {\n        this.config.withCheckOption = withCheckOption ?? 'cascaded';\n        return this;\n    }\n}\nclass ViewBuilder extends ViewBuilderCore {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.e] = 'MySqlViewBuilder';\n    as(qb) {\n        if (typeof qb === 'function') {\n            qb = qb(new QueryBuilder());\n        }\n        const selectionProxy = new _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.j({\n            alias: this.name,\n            sqlBehavior: 'error',\n            sqlAliasedBehavior: 'alias',\n            replaceOriginalName: true,\n        });\n        const aliasedSelection = new Proxy(qb.getSelectedFields(), selectionProxy);\n        return new Proxy(new MySqlView({\n            mysqlConfig: this.config,\n            config: {\n                name: this.name,\n                schema: this.schema,\n                selectedFields: aliasedSelection,\n                query: qb.getSQL().inlineParams(),\n            },\n        }), selectionProxy);\n    }\n}\nclass ManualViewBuilder extends ViewBuilderCore {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.e] = 'MySqlManualViewBuilder';\n    columns;\n    constructor(name, columns, schema) {\n        super(name, schema);\n        this.columns = (0,_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.I)(mysqlTable(name, columns));\n    }\n    existing() {\n        return new Proxy(new MySqlView({\n            mysqlConfig: undefined,\n            config: {\n                name: this.name,\n                schema: this.schema,\n                selectedFields: this.columns,\n                query: undefined,\n            },\n        }), new _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.j({\n            alias: this.name,\n            sqlBehavior: 'error',\n            sqlAliasedBehavior: 'alias',\n            replaceOriginalName: true,\n        }));\n    }\n    as(query) {\n        return new Proxy(new MySqlView({\n            mysqlConfig: this.config,\n            config: {\n                name: this.name,\n                schema: this.schema,\n                selectedFields: this.columns,\n                query: query.inlineParams(),\n            },\n        }), new _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.j({\n            alias: this.name,\n            sqlBehavior: 'error',\n            sqlAliasedBehavior: 'alias',\n            replaceOriginalName: true,\n        }));\n    }\n}\nclass MySqlViewBase extends _alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.v {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.e] = 'MySqlViewBase';\n}\nconst MySqlViewConfig = Symbol.for('drizzle:MySqlViewConfig');\nclass MySqlView extends MySqlViewBase {\n    static [_alias_cf8e03cd_mjs__WEBPACK_IMPORTED_MODULE_0__.e] = 'MySqlView';\n    [MySqlViewConfig];\n    constructor({ mysqlConfig, config }) {\n        super(config);\n        this[MySqlViewConfig] = mysqlConfig;\n    }\n}\n/** @internal */\nfunction mysqlViewWithSchema(name, selection, schema) {\n    if (selection) {\n        return new ManualViewBuilder(name, selection, schema);\n    }\n    return new ViewBuilder(name, schema);\n}\nfunction mysqlView(name, selection) {\n    return mysqlViewWithSchema(name, selection, undefined);\n}\n\n\n//# sourceMappingURL=view-23898f21.mjs.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvZHJpenpsZS1vcm0vdmlldy0yMzg5OGYyMS5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUE2c0I7O0FBRTdzQjtBQUNBO0FBQ0EseUJBQXlCLGtEQUFLO0FBQzlCLFlBQVksa0RBQVU7QUFDdEI7QUFDQSxvQ0FBb0MsRUFBRSxrREFBSztBQUMzQztBQUNBLEtBQUs7QUFDTDtBQUNBLEtBQUssa0RBQUs7QUFDVjtBQUNBO0FBQ0E7QUFDQSxLQUFLLGtEQUFLO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLFVBQVUsa0RBQUs7QUFDZjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLFlBQVksa0RBQVU7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQiwwQkFBMEI7QUFDOUMscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksa0RBQVU7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsMEJBQTBCO0FBQzFDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsaUJBQWlCO0FBQ25DO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLDBCQUEwQjtBQUMxQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMsOEJBQThCLEdBQUcsa0JBQWtCO0FBQ2pFO0FBQ0E7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Q0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsWUFBWSxrREFBVTtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxrREFBVTtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQyxrREFBcUI7QUFDeEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsWUFBWSxrREFBVTtBQUN0QjtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsc0RBQWU7QUFDdEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVMsT0FBTyxrREFBcUI7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVMsT0FBTyxrREFBcUI7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLDRCQUE0QixrREFBSTtBQUNoQyxZQUFZLGtEQUFVO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBLFlBQVksa0RBQVU7QUFDdEI7QUFDQSxrQkFBa0IscUJBQXFCO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRTQyQjtBQUM1MkIiLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcRWRnYXIgSiBSb2phcyBMXFxkZXZcXGNhcHJlcy13ZWJcXG5vZGVfbW9kdWxlc1xcZHJpenpsZS1vcm1cXHZpZXctMjM4OThmMjEubWpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFQgYXMgVGFibGUsIGUgYXMgZW50aXR5S2luZCwgQyBhcyBDb2x1bW5CdWlsZGVyLCBwIGFzIENvbHVtbiwgUSBhcyBRdWVyeVByb21pc2UsIGkgYXMgaXMsIFMgYXMgU1FMLCBiIGFzIFBhcmFtLCBkIGFzIG1hcFVwZGF0ZVNldCwgcyBhcyBzcWwsIG8gYXMgb3JkZXJTZWxlY3RlZEZpZWxkcywgcSBhcyBnZXRUYWJsZU5hbWUsIHIgYXMgU3VicXVlcnksIHUgYXMgU3VicXVlcnlDb25maWcsIFYgYXMgVmlld0Jhc2VDb25maWcsIHYgYXMgVmlldywgdyBhcyBhbGlhc2VkVGFibGVDb2x1bW4sIHggYXMgZ2V0T3BlcmF0b3JzLCB5IGFzIG1hcENvbHVtbnNJblNRTFRvQWxpYXMsIHogYXMgbWFwQ29sdW1uc0luQWxpYXNlZFNRTFRvQWxpYXMsIEEgYXMgZ2V0T3JkZXJCeU9wZXJhdG9ycywgQiBhcyBub3JtYWxpemVSZWxhdGlvbiwgRSBhcyBhbmQsIEYgYXMgZXEsIE8gYXMgT25lLCBEIGFzIERyaXp6bGVFcnJvciwgTSBhcyBNYW55LCBHIGFzIGFsaWFzZWRUYWJsZSwgSCBhcyBhcHBseU1peGlucywgSSBhcyBnZXRUYWJsZUNvbHVtbnMsIEogYXMgVHlwZWRRdWVyeUJ1aWxkZXIsIEsgYXMgZ2V0VGFibGVMaWtlTmFtZSwgaiBhcyBTZWxlY3Rpb25Qcm94eUhhbmRsZXIsIFcgYXMgV2l0aFN1YnF1ZXJ5LCBnIGFzIG1hcFJlbGF0aW9uYWxSb3csIGwgYXMgVHJhbnNhY3Rpb25Sb2xsYmFja0Vycm9yIH0gZnJvbSAnLi9hbGlhcy1jZjhlMDNjZC5tanMnO1xuXG4vKiogQGludGVybmFsICovXG5jb25zdCBJbmxpbmVGb3JlaWduS2V5cyA9IFN5bWJvbC5mb3IoJ2RyaXp6bGU6TXlTcWxJbmxpbmVGb3JlaWduS2V5cycpO1xuY2xhc3MgTXlTcWxUYWJsZSBleHRlbmRzIFRhYmxlIHtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ015U3FsVGFibGUnO1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBzdGF0aWMgU3ltYm9sID0gT2JqZWN0LmFzc2lnbih7fSwgVGFibGUuU3ltYm9sLCB7XG4gICAgICAgIElubGluZUZvcmVpZ25LZXlzOiBJbmxpbmVGb3JlaWduS2V5cyxcbiAgICB9KTtcbiAgICAvKiogQGludGVybmFsICovXG4gICAgW1RhYmxlLlN5bWJvbC5Db2x1bW5zXTtcbiAgICAvKiogQGludGVybmFsICovXG4gICAgW0lubGluZUZvcmVpZ25LZXlzXSA9IFtdO1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBbVGFibGUuU3ltYm9sLkV4dHJhQ29uZmlnQnVpbGRlcl0gPSB1bmRlZmluZWQ7XG59XG5mdW5jdGlvbiBteXNxbFRhYmxlV2l0aFNjaGVtYShuYW1lLCBjb2x1bW5zLCBleHRyYUNvbmZpZywgc2NoZW1hLCBiYXNlTmFtZSA9IG5hbWUpIHtcbiAgICBjb25zdCByYXdUYWJsZSA9IG5ldyBNeVNxbFRhYmxlKG5hbWUsIHNjaGVtYSwgYmFzZU5hbWUpO1xuICAgIGNvbnN0IGJ1aWx0Q29sdW1ucyA9IE9iamVjdC5mcm9tRW50cmllcyhPYmplY3QuZW50cmllcyhjb2x1bW5zKS5tYXAoKFtuYW1lLCBjb2xCdWlsZGVyQmFzZV0pID0+IHtcbiAgICAgICAgY29uc3QgY29sQnVpbGRlciA9IGNvbEJ1aWxkZXJCYXNlO1xuICAgICAgICBjb25zdCBjb2x1bW4gPSBjb2xCdWlsZGVyLmJ1aWxkKHJhd1RhYmxlKTtcbiAgICAgICAgcmF3VGFibGVbSW5saW5lRm9yZWlnbktleXNdLnB1c2goLi4uY29sQnVpbGRlci5idWlsZEZvcmVpZ25LZXlzKGNvbHVtbiwgcmF3VGFibGUpKTtcbiAgICAgICAgcmV0dXJuIFtuYW1lLCBjb2x1bW5dO1xuICAgIH0pKTtcbiAgICBjb25zdCB0YWJsZSA9IE9iamVjdC5hc3NpZ24ocmF3VGFibGUsIGJ1aWx0Q29sdW1ucyk7XG4gICAgdGFibGVbVGFibGUuU3ltYm9sLkNvbHVtbnNdID0gYnVpbHRDb2x1bW5zO1xuICAgIGlmIChleHRyYUNvbmZpZykge1xuICAgICAgICB0YWJsZVtNeVNxbFRhYmxlLlN5bWJvbC5FeHRyYUNvbmZpZ0J1aWxkZXJdID0gZXh0cmFDb25maWc7XG4gICAgfVxuICAgIHJldHVybiB0YWJsZTtcbn1cbmNvbnN0IG15c3FsVGFibGUgPSAobmFtZSwgY29sdW1ucywgZXh0cmFDb25maWcpID0+IHtcbiAgICByZXR1cm4gbXlzcWxUYWJsZVdpdGhTY2hlbWEobmFtZSwgY29sdW1ucywgZXh0cmFDb25maWcsIHVuZGVmaW5lZCwgbmFtZSk7XG59O1xuZnVuY3Rpb24gbXlzcWxUYWJsZUNyZWF0b3IoY3VzdG9taXplVGFibGVOYW1lKSB7XG4gICAgcmV0dXJuIChuYW1lLCBjb2x1bW5zLCBleHRyYUNvbmZpZykgPT4ge1xuICAgICAgICByZXR1cm4gbXlzcWxUYWJsZVdpdGhTY2hlbWEoY3VzdG9taXplVGFibGVOYW1lKG5hbWUpLCBjb2x1bW5zLCBleHRyYUNvbmZpZywgdW5kZWZpbmVkLCBuYW1lKTtcbiAgICB9O1xufVxuXG5jbGFzcyBGb3JlaWduS2V5QnVpbGRlciB7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdNeVNxbEZvcmVpZ25LZXlCdWlsZGVyJztcbiAgICAvKiogQGludGVybmFsICovXG4gICAgcmVmZXJlbmNlO1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBfb25VcGRhdGU7XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIF9vbkRlbGV0ZTtcbiAgICBjb25zdHJ1Y3Rvcihjb25maWcsIGFjdGlvbnMpIHtcbiAgICAgICAgdGhpcy5yZWZlcmVuY2UgPSAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IGNvbHVtbnMsIGZvcmVpZ25Db2x1bW5zIH0gPSBjb25maWcoKTtcbiAgICAgICAgICAgIHJldHVybiB7IGNvbHVtbnMsIGZvcmVpZ25UYWJsZTogZm9yZWlnbkNvbHVtbnNbMF0udGFibGUsIGZvcmVpZ25Db2x1bW5zIH07XG4gICAgICAgIH07XG4gICAgICAgIGlmIChhY3Rpb25zKSB7XG4gICAgICAgICAgICB0aGlzLl9vblVwZGF0ZSA9IGFjdGlvbnMub25VcGRhdGU7XG4gICAgICAgICAgICB0aGlzLl9vbkRlbGV0ZSA9IGFjdGlvbnMub25EZWxldGU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgb25VcGRhdGUoYWN0aW9uKSB7XG4gICAgICAgIHRoaXMuX29uVXBkYXRlID0gYWN0aW9uO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgb25EZWxldGUoYWN0aW9uKSB7XG4gICAgICAgIHRoaXMuX29uRGVsZXRlID0gYWN0aW9uO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGJ1aWxkKHRhYmxlKSB7XG4gICAgICAgIHJldHVybiBuZXcgRm9yZWlnbktleSh0YWJsZSwgdGhpcyk7XG4gICAgfVxufVxuY2xhc3MgRm9yZWlnbktleSB7XG4gICAgdGFibGU7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdNeVNxbEZvcmVpZ25LZXknO1xuICAgIHJlZmVyZW5jZTtcbiAgICBvblVwZGF0ZTtcbiAgICBvbkRlbGV0ZTtcbiAgICBjb25zdHJ1Y3Rvcih0YWJsZSwgYnVpbGRlcikge1xuICAgICAgICB0aGlzLnRhYmxlID0gdGFibGU7XG4gICAgICAgIHRoaXMucmVmZXJlbmNlID0gYnVpbGRlci5yZWZlcmVuY2U7XG4gICAgICAgIHRoaXMub25VcGRhdGUgPSBidWlsZGVyLl9vblVwZGF0ZTtcbiAgICAgICAgdGhpcy5vbkRlbGV0ZSA9IGJ1aWxkZXIuX29uRGVsZXRlO1xuICAgIH1cbiAgICBnZXROYW1lKCkge1xuICAgICAgICBjb25zdCB7IGNvbHVtbnMsIGZvcmVpZ25Db2x1bW5zIH0gPSB0aGlzLnJlZmVyZW5jZSgpO1xuICAgICAgICBjb25zdCBjb2x1bW5OYW1lcyA9IGNvbHVtbnMubWFwKChjb2x1bW4pID0+IGNvbHVtbi5uYW1lKTtcbiAgICAgICAgY29uc3QgZm9yZWlnbkNvbHVtbk5hbWVzID0gZm9yZWlnbkNvbHVtbnMubWFwKChjb2x1bW4pID0+IGNvbHVtbi5uYW1lKTtcbiAgICAgICAgY29uc3QgY2h1bmtzID0gW1xuICAgICAgICAgICAgdGhpcy50YWJsZVtNeVNxbFRhYmxlLlN5bWJvbC5OYW1lXSxcbiAgICAgICAgICAgIC4uLmNvbHVtbk5hbWVzLFxuICAgICAgICAgICAgZm9yZWlnbkNvbHVtbnNbMF0udGFibGVbTXlTcWxUYWJsZS5TeW1ib2wuTmFtZV0sXG4gICAgICAgICAgICAuLi5mb3JlaWduQ29sdW1uTmFtZXMsXG4gICAgICAgIF07XG4gICAgICAgIHJldHVybiBgJHtjaHVua3Muam9pbignXycpfV9ma2A7XG4gICAgfVxufVxuZnVuY3Rpb24gZm9yZWlnbktleShjb25maWcpIHtcbiAgICBmdW5jdGlvbiBtYXBwZWRDb25maWcoKSB7XG4gICAgICAgIGNvbnN0IHsgY29sdW1ucywgZm9yZWlnbkNvbHVtbnMgfSA9IGNvbmZpZztcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGNvbHVtbnMsXG4gICAgICAgICAgICBmb3JlaWduQ29sdW1ucyxcbiAgICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBGb3JlaWduS2V5QnVpbGRlcihtYXBwZWRDb25maWcpO1xufVxuXG5mdW5jdGlvbiB1bmlxdWUobmFtZSkge1xuICAgIHJldHVybiBuZXcgVW5pcXVlT25Db25zdHJhaW50QnVpbGRlcihuYW1lKTtcbn1cbmZ1bmN0aW9uIHVuaXF1ZUtleU5hbWUodGFibGUsIGNvbHVtbnMpIHtcbiAgICByZXR1cm4gYCR7dGFibGVbTXlTcWxUYWJsZS5TeW1ib2wuTmFtZV19XyR7Y29sdW1ucy5qb2luKCdfJyl9X3VuaXF1ZWA7XG59XG5jbGFzcyBVbmlxdWVDb25zdHJhaW50QnVpbGRlciB7XG4gICAgbmFtZTtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ015U3FsVW5pcXVlQ29uc3RyYWludEJ1aWxkZXInO1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBjb2x1bW5zO1xuICAgIGNvbnN0cnVjdG9yKGNvbHVtbnMsIG5hbWUpIHtcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgdGhpcy5jb2x1bW5zID0gY29sdW1ucztcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGJ1aWxkKHRhYmxlKSB7XG4gICAgICAgIHJldHVybiBuZXcgVW5pcXVlQ29uc3RyYWludCh0YWJsZSwgdGhpcy5jb2x1bW5zLCB0aGlzLm5hbWUpO1xuICAgIH1cbn1cbmNsYXNzIFVuaXF1ZU9uQ29uc3RyYWludEJ1aWxkZXIge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnTXlTcWxVbmlxdWVPbkNvbnN0cmFpbnRCdWlsZGVyJztcbiAgICAvKiogQGludGVybmFsICovXG4gICAgbmFtZTtcbiAgICBjb25zdHJ1Y3RvcihuYW1lKSB7XG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgfVxuICAgIG9uKC4uLmNvbHVtbnMpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBVbmlxdWVDb25zdHJhaW50QnVpbGRlcihjb2x1bW5zLCB0aGlzLm5hbWUpO1xuICAgIH1cbn1cbmNsYXNzIFVuaXF1ZUNvbnN0cmFpbnQge1xuICAgIHRhYmxlO1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnTXlTcWxVbmlxdWVDb25zdHJhaW50JztcbiAgICBjb2x1bW5zO1xuICAgIG5hbWU7XG4gICAgbnVsbHNOb3REaXN0aW5jdCA9IGZhbHNlO1xuICAgIGNvbnN0cnVjdG9yKHRhYmxlLCBjb2x1bW5zLCBuYW1lKSB7XG4gICAgICAgIHRoaXMudGFibGUgPSB0YWJsZTtcbiAgICAgICAgdGhpcy5jb2x1bW5zID0gY29sdW1ucztcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZSA/PyB1bmlxdWVLZXlOYW1lKHRoaXMudGFibGUsIHRoaXMuY29sdW1ucy5tYXAoKGNvbHVtbikgPT4gY29sdW1uLm5hbWUpKTtcbiAgICB9XG4gICAgZ2V0TmFtZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubmFtZTtcbiAgICB9XG59XG5cbmNsYXNzIE15U3FsQ29sdW1uQnVpbGRlciBleHRlbmRzIENvbHVtbkJ1aWxkZXIge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnTXlTcWxDb2x1bW5CdWlsZGVyJztcbiAgICBmb3JlaWduS2V5Q29uZmlncyA9IFtdO1xuICAgIHJlZmVyZW5jZXMocmVmLCBhY3Rpb25zID0ge30pIHtcbiAgICAgICAgdGhpcy5mb3JlaWduS2V5Q29uZmlncy5wdXNoKHsgcmVmLCBhY3Rpb25zIH0pO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgdW5pcXVlKG5hbWUpIHtcbiAgICAgICAgdGhpcy5jb25maWcuaXNVbmlxdWUgPSB0cnVlO1xuICAgICAgICB0aGlzLmNvbmZpZy51bmlxdWVOYW1lID0gbmFtZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBidWlsZEZvcmVpZ25LZXlzKGNvbHVtbiwgdGFibGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZm9yZWlnbktleUNvbmZpZ3MubWFwKCh7IHJlZiwgYWN0aW9ucyB9KSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gKChyZWYsIGFjdGlvbnMpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBidWlsZGVyID0gbmV3IEZvcmVpZ25LZXlCdWlsZGVyKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZm9yZWlnbkNvbHVtbiA9IHJlZigpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4geyBjb2x1bW5zOiBbY29sdW1uXSwgZm9yZWlnbkNvbHVtbnM6IFtmb3JlaWduQ29sdW1uXSB9O1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlmIChhY3Rpb25zLm9uVXBkYXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIGJ1aWxkZXIub25VcGRhdGUoYWN0aW9ucy5vblVwZGF0ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChhY3Rpb25zLm9uRGVsZXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIGJ1aWxkZXIub25EZWxldGUoYWN0aW9ucy5vbkRlbGV0ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBidWlsZGVyLmJ1aWxkKHRhYmxlKTtcbiAgICAgICAgICAgIH0pKHJlZiwgYWN0aW9ucyk7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbi8vIFRvIHVuZGVyc3RhbmQgaG93IHRvIHVzZSBgTXlTcWxDb2x1bW5gIGFuZCBgQW55TXlTcWxDb2x1bW5gLCBzZWUgYENvbHVtbmAgYW5kIGBBbnlDb2x1bW5gIGRvY3VtZW50YXRpb24uXG5jbGFzcyBNeVNxbENvbHVtbiBleHRlbmRzIENvbHVtbiB7XG4gICAgdGFibGU7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdNeVNxbENvbHVtbic7XG4gICAgY29uc3RydWN0b3IodGFibGUsIGNvbmZpZykge1xuICAgICAgICBpZiAoIWNvbmZpZy51bmlxdWVOYW1lKSB7XG4gICAgICAgICAgICBjb25maWcudW5pcXVlTmFtZSA9IHVuaXF1ZUtleU5hbWUodGFibGUsIFtjb25maWcubmFtZV0pO1xuICAgICAgICB9XG4gICAgICAgIHN1cGVyKHRhYmxlLCBjb25maWcpO1xuICAgICAgICB0aGlzLnRhYmxlID0gdGFibGU7XG4gICAgfVxufVxuY2xhc3MgTXlTcWxDb2x1bW5CdWlsZGVyV2l0aEF1dG9JbmNyZW1lbnQgZXh0ZW5kcyBNeVNxbENvbHVtbkJ1aWxkZXIge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnTXlTcWxDb2x1bW5CdWlsZGVyV2l0aEF1dG9JbmNyZW1lbnQnO1xuICAgIGNvbnN0cnVjdG9yKG5hbWUsIGRhdGFUeXBlLCBjb2x1bW5UeXBlKSB7XG4gICAgICAgIHN1cGVyKG5hbWUsIGRhdGFUeXBlLCBjb2x1bW5UeXBlKTtcbiAgICAgICAgdGhpcy5jb25maWcuYXV0b0luY3JlbWVudCA9IGZhbHNlO1xuICAgIH1cbiAgICBhdXRvaW5jcmVtZW50KCkge1xuICAgICAgICB0aGlzLmNvbmZpZy5hdXRvSW5jcmVtZW50ID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5jb25maWcuaGFzRGVmYXVsdCA9IHRydWU7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbn1cbmNsYXNzIE15U3FsQ29sdW1uV2l0aEF1dG9JbmNyZW1lbnQgZXh0ZW5kcyBNeVNxbENvbHVtbiB7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdNeVNxbENvbHVtbldpdGhBdXRvSW5jcmVtZW50JztcbiAgICBhdXRvSW5jcmVtZW50ID0gdGhpcy5jb25maWcuYXV0b0luY3JlbWVudDtcbn1cblxuY2xhc3MgTXlTcWxEZWxldGUgZXh0ZW5kcyBRdWVyeVByb21pc2Uge1xuICAgIHRhYmxlO1xuICAgIHNlc3Npb247XG4gICAgZGlhbGVjdDtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ015U3FsRGVsZXRlJztcbiAgICBjb25maWc7XG4gICAgY29uc3RydWN0b3IodGFibGUsIHNlc3Npb24sIGRpYWxlY3QpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy50YWJsZSA9IHRhYmxlO1xuICAgICAgICB0aGlzLnNlc3Npb24gPSBzZXNzaW9uO1xuICAgICAgICB0aGlzLmRpYWxlY3QgPSBkaWFsZWN0O1xuICAgICAgICB0aGlzLmNvbmZpZyA9IHsgdGFibGUgfTtcbiAgICB9XG4gICAgd2hlcmUod2hlcmUpIHtcbiAgICAgICAgdGhpcy5jb25maWcud2hlcmUgPSB3aGVyZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBnZXRTUUwoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRpYWxlY3QuYnVpbGREZWxldGVRdWVyeSh0aGlzLmNvbmZpZyk7XG4gICAgfVxuICAgIHRvU1FMKCkge1xuICAgICAgICBjb25zdCB7IHR5cGluZ3M6IF90eXBpbmdzLCAuLi5yZXN0IH0gPSB0aGlzLmRpYWxlY3Quc3FsVG9RdWVyeSh0aGlzLmdldFNRTCgpKTtcbiAgICAgICAgcmV0dXJuIHJlc3Q7XG4gICAgfVxuICAgIHByZXBhcmUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlc3Npb24ucHJlcGFyZVF1ZXJ5KHRoaXMuZGlhbGVjdC5zcWxUb1F1ZXJ5KHRoaXMuZ2V0U1FMKCkpLCB0aGlzLmNvbmZpZy5yZXR1cm5pbmcpO1xuICAgIH1cbiAgICBleGVjdXRlID0gKHBsYWNlaG9sZGVyVmFsdWVzKSA9PiB7XG4gICAgICAgIHJldHVybiB0aGlzLnByZXBhcmUoKS5leGVjdXRlKHBsYWNlaG9sZGVyVmFsdWVzKTtcbiAgICB9O1xuICAgIGNyZWF0ZUl0ZXJhdG9yID0gKCkgPT4ge1xuICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcbiAgICAgICAgcmV0dXJuIGFzeW5jIGZ1bmN0aW9uKiAocGxhY2Vob2xkZXJWYWx1ZXMpIHtcbiAgICAgICAgICAgIHlpZWxkKiBzZWxmLnByZXBhcmUoKS5pdGVyYXRvcihwbGFjZWhvbGRlclZhbHVlcyk7XG4gICAgICAgIH07XG4gICAgfTtcbiAgICBpdGVyYXRvciA9IHRoaXMuY3JlYXRlSXRlcmF0b3IoKTtcbn1cblxuY2xhc3MgTXlTcWxJbnNlcnRCdWlsZGVyIHtcbiAgICB0YWJsZTtcbiAgICBzZXNzaW9uO1xuICAgIGRpYWxlY3Q7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdNeVNxbEluc2VydEJ1aWxkZXInO1xuICAgIHNob3VsZElnbm9yZSA9IGZhbHNlO1xuICAgIGNvbnN0cnVjdG9yKHRhYmxlLCBzZXNzaW9uLCBkaWFsZWN0KSB7XG4gICAgICAgIHRoaXMudGFibGUgPSB0YWJsZTtcbiAgICAgICAgdGhpcy5zZXNzaW9uID0gc2Vzc2lvbjtcbiAgICAgICAgdGhpcy5kaWFsZWN0ID0gZGlhbGVjdDtcbiAgICB9XG4gICAgaWdub3JlKCkge1xuICAgICAgICB0aGlzLnNob3VsZElnbm9yZSA9IHRydWU7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICB2YWx1ZXModmFsdWVzKSB7XG4gICAgICAgIHZhbHVlcyA9IEFycmF5LmlzQXJyYXkodmFsdWVzKSA/IHZhbHVlcyA6IFt2YWx1ZXNdO1xuICAgICAgICBpZiAodmFsdWVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCd2YWx1ZXMoKSBtdXN0IGJlIGNhbGxlZCB3aXRoIGF0IGxlYXN0IG9uZSB2YWx1ZScpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG1hcHBlZFZhbHVlcyA9IHZhbHVlcy5tYXAoKGVudHJ5KSA9PiB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSB7fTtcbiAgICAgICAgICAgIGNvbnN0IGNvbHMgPSB0aGlzLnRhYmxlW1RhYmxlLlN5bWJvbC5Db2x1bW5zXTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgY29sS2V5IG9mIE9iamVjdC5rZXlzKGVudHJ5KSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvbFZhbHVlID0gZW50cnlbY29sS2V5XTtcbiAgICAgICAgICAgICAgICByZXN1bHRbY29sS2V5XSA9IGlzKGNvbFZhbHVlLCBTUUwpID8gY29sVmFsdWUgOiBuZXcgUGFyYW0oY29sVmFsdWUsIGNvbHNbY29sS2V5XSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIG5ldyBNeVNxbEluc2VydCh0aGlzLnRhYmxlLCBtYXBwZWRWYWx1ZXMsIHRoaXMuc2hvdWxkSWdub3JlLCB0aGlzLnNlc3Npb24sIHRoaXMuZGlhbGVjdCk7XG4gICAgfVxufVxuY2xhc3MgTXlTcWxJbnNlcnQgZXh0ZW5kcyBRdWVyeVByb21pc2Uge1xuICAgIHNlc3Npb247XG4gICAgZGlhbGVjdDtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ015U3FsSW5zZXJ0JztcbiAgICBjb25maWc7XG4gICAgY29uc3RydWN0b3IodGFibGUsIHZhbHVlcywgaWdub3JlLCBzZXNzaW9uLCBkaWFsZWN0KSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMuc2Vzc2lvbiA9IHNlc3Npb247XG4gICAgICAgIHRoaXMuZGlhbGVjdCA9IGRpYWxlY3Q7XG4gICAgICAgIHRoaXMuY29uZmlnID0geyB0YWJsZSwgdmFsdWVzLCBpZ25vcmUgfTtcbiAgICB9XG4gICAgb25EdXBsaWNhdGVLZXlVcGRhdGUoY29uZmlnKSB7XG4gICAgICAgIGNvbnN0IHNldFNxbCA9IHRoaXMuZGlhbGVjdC5idWlsZFVwZGF0ZVNldCh0aGlzLmNvbmZpZy50YWJsZSwgbWFwVXBkYXRlU2V0KHRoaXMuY29uZmlnLnRhYmxlLCBjb25maWcuc2V0KSk7XG4gICAgICAgIHRoaXMuY29uZmlnLm9uQ29uZmxpY3QgPSBzcWwgYHVwZGF0ZSAke3NldFNxbH1gO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGdldFNRTCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGlhbGVjdC5idWlsZEluc2VydFF1ZXJ5KHRoaXMuY29uZmlnKTtcbiAgICB9XG4gICAgdG9TUUwoKSB7XG4gICAgICAgIGNvbnN0IHsgdHlwaW5nczogX3R5cGluZ3MsIC4uLnJlc3QgfSA9IHRoaXMuZGlhbGVjdC5zcWxUb1F1ZXJ5KHRoaXMuZ2V0U1FMKCkpO1xuICAgICAgICByZXR1cm4gcmVzdDtcbiAgICB9XG4gICAgcHJlcGFyZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2Vzc2lvbi5wcmVwYXJlUXVlcnkodGhpcy5kaWFsZWN0LnNxbFRvUXVlcnkodGhpcy5nZXRTUUwoKSksIHVuZGVmaW5lZCk7XG4gICAgfVxuICAgIGV4ZWN1dGUgPSAocGxhY2Vob2xkZXJWYWx1ZXMpID0+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMucHJlcGFyZSgpLmV4ZWN1dGUocGxhY2Vob2xkZXJWYWx1ZXMpO1xuICAgIH07XG4gICAgY3JlYXRlSXRlcmF0b3IgPSAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuICAgICAgICByZXR1cm4gYXN5bmMgZnVuY3Rpb24qIChwbGFjZWhvbGRlclZhbHVlcykge1xuICAgICAgICAgICAgeWllbGQqIHNlbGYucHJlcGFyZSgpLml0ZXJhdG9yKHBsYWNlaG9sZGVyVmFsdWVzKTtcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIGl0ZXJhdG9yID0gdGhpcy5jcmVhdGVJdGVyYXRvcigpO1xufVxuXG4vLyBUT0RPIGZpbmQgb3V0IGhvdyB0byB1c2UgYWxsL3ZhbHVlcy4gU2VlbXMgbGlrZSBJIG5lZWQgdGhvc2UgZnVuY3Rpb25zXG4vLyBCdWlsZCBwcm9qZWN0XG4vLyBjb3B5IHJ1bnRpbWUgdGVzdHMgdG8gYmUgc3VyZSBpdCdzIHdvcmtpbmdcbi8vIEFkZCBteXNxbCB0byBkcml6emxlLWtpdFxuLy8gQWRkIFBsYW5ldHNjYWxlIERyaXZlciBhbmQgY3JlYXRlIGV4YW1wbGUgcmVwb1xuY2xhc3MgTXlTcWxEaWFsZWN0IHtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ015U3FsRGlhbGVjdCc7XG4gICAgYXN5bmMgbWlncmF0ZShtaWdyYXRpb25zLCBzZXNzaW9uLCBjb25maWcpIHtcbiAgICAgICAgY29uc3QgbWlncmF0aW9uc1RhYmxlID0gY29uZmlnLm1pZ3JhdGlvbnNUYWJsZSA/PyAnX19kcml6emxlX21pZ3JhdGlvbnMnO1xuICAgICAgICBjb25zdCBtaWdyYXRpb25UYWJsZUNyZWF0ZSA9IHNxbCBgXG5cdFx0XHRjcmVhdGUgdGFibGUgaWYgbm90IGV4aXN0cyAke3NxbC5pZGVudGlmaWVyKG1pZ3JhdGlvbnNUYWJsZSl9IChcblx0XHRcdFx0aWQgc2VyaWFsIHByaW1hcnkga2V5LFxuXHRcdFx0XHRoYXNoIHRleHQgbm90IG51bGwsXG5cdFx0XHRcdGNyZWF0ZWRfYXQgYmlnaW50XG5cdFx0XHQpXG5cdFx0YDtcbiAgICAgICAgYXdhaXQgc2Vzc2lvbi5leGVjdXRlKG1pZ3JhdGlvblRhYmxlQ3JlYXRlKTtcbiAgICAgICAgY29uc3QgZGJNaWdyYXRpb25zID0gYXdhaXQgc2Vzc2lvbi5hbGwoc3FsIGBzZWxlY3QgaWQsIGhhc2gsIGNyZWF0ZWRfYXQgZnJvbSAke3NxbC5pZGVudGlmaWVyKG1pZ3JhdGlvbnNUYWJsZSl9IG9yZGVyIGJ5IGNyZWF0ZWRfYXQgZGVzYyBsaW1pdCAxYCk7XG4gICAgICAgIGNvbnN0IGxhc3REYk1pZ3JhdGlvbiA9IGRiTWlncmF0aW9uc1swXTtcbiAgICAgICAgYXdhaXQgc2Vzc2lvbi50cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgICAgIGZvciAoY29uc3QgbWlncmF0aW9uIG9mIG1pZ3JhdGlvbnMpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWxhc3REYk1pZ3JhdGlvblxuICAgICAgICAgICAgICAgICAgICB8fCBOdW1iZXIobGFzdERiTWlncmF0aW9uLmNyZWF0ZWRfYXQpIDwgbWlncmF0aW9uLmZvbGRlck1pbGxpcykge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHN0bXQgb2YgbWlncmF0aW9uLnNxbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdHguZXhlY3V0ZShzcWwucmF3KHN0bXQpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0eC5leGVjdXRlKHNxbCBgaW5zZXJ0IGludG8gJHtzcWwuaWRlbnRpZmllcihtaWdyYXRpb25zVGFibGUpfSAoXFxgaGFzaFxcYCwgXFxgY3JlYXRlZF9hdFxcYCkgdmFsdWVzKCR7bWlncmF0aW9uLmhhc2h9LCAke21pZ3JhdGlvbi5mb2xkZXJNaWxsaXN9KWApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGVzY2FwZU5hbWUobmFtZSkge1xuICAgICAgICByZXR1cm4gYFxcYCR7bmFtZX1cXGBgO1xuICAgIH1cbiAgICBlc2NhcGVQYXJhbShfbnVtKSB7XG4gICAgICAgIHJldHVybiBgP2A7XG4gICAgfVxuICAgIGVzY2FwZVN0cmluZyhzdHIpIHtcbiAgICAgICAgcmV0dXJuIGAnJHtzdHIucmVwbGFjZSgvJy9nLCBcIicnXCIpfSdgO1xuICAgIH1cbiAgICBidWlsZERlbGV0ZVF1ZXJ5KHsgdGFibGUsIHdoZXJlLCByZXR1cm5pbmcgfSkge1xuICAgICAgICBjb25zdCByZXR1cm5pbmdTcWwgPSByZXR1cm5pbmdcbiAgICAgICAgICAgID8gc3FsIGAgcmV0dXJuaW5nICR7dGhpcy5idWlsZFNlbGVjdGlvbihyZXR1cm5pbmcsIHsgaXNTaW5nbGVUYWJsZTogdHJ1ZSB9KX1gXG4gICAgICAgICAgICA6IHVuZGVmaW5lZDtcbiAgICAgICAgY29uc3Qgd2hlcmVTcWwgPSB3aGVyZSA/IHNxbCBgIHdoZXJlICR7d2hlcmV9YCA6IHVuZGVmaW5lZDtcbiAgICAgICAgcmV0dXJuIHNxbCBgZGVsZXRlIGZyb20gJHt0YWJsZX0ke3doZXJlU3FsfSR7cmV0dXJuaW5nU3FsfWA7XG4gICAgfVxuICAgIGJ1aWxkVXBkYXRlU2V0KHRhYmxlLCBzZXQpIHtcbiAgICAgICAgY29uc3Qgc2V0RW50cmllcyA9IE9iamVjdC5lbnRyaWVzKHNldCk7XG4gICAgICAgIGNvbnN0IHNldFNpemUgPSBzZXRFbnRyaWVzLmxlbmd0aDtcbiAgICAgICAgcmV0dXJuIHNxbC5qb2luKHNldEVudHJpZXNcbiAgICAgICAgICAgIC5mbGF0TWFwKChbY29sTmFtZSwgdmFsdWVdLCBpKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjb2wgPSB0YWJsZVtUYWJsZS5TeW1ib2wuQ29sdW1uc11bY29sTmFtZV07XG4gICAgICAgICAgICBjb25zdCByZXMgPSBzcWwgYCR7c3FsLmlkZW50aWZpZXIoY29sLm5hbWUpfSA9ICR7dmFsdWV9YDtcbiAgICAgICAgICAgIGlmIChpIDwgc2V0U2l6ZSAtIDEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gW3Jlcywgc3FsLnJhdygnLCAnKV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gW3Jlc107XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgYnVpbGRVcGRhdGVRdWVyeSh7IHRhYmxlLCBzZXQsIHdoZXJlLCByZXR1cm5pbmcgfSkge1xuICAgICAgICBjb25zdCBzZXRTcWwgPSB0aGlzLmJ1aWxkVXBkYXRlU2V0KHRhYmxlLCBzZXQpO1xuICAgICAgICBjb25zdCByZXR1cm5pbmdTcWwgPSByZXR1cm5pbmdcbiAgICAgICAgICAgID8gc3FsIGAgcmV0dXJuaW5nICR7dGhpcy5idWlsZFNlbGVjdGlvbihyZXR1cm5pbmcsIHsgaXNTaW5nbGVUYWJsZTogdHJ1ZSB9KX1gXG4gICAgICAgICAgICA6IHVuZGVmaW5lZDtcbiAgICAgICAgY29uc3Qgd2hlcmVTcWwgPSB3aGVyZSA/IHNxbCBgIHdoZXJlICR7d2hlcmV9YCA6IHVuZGVmaW5lZDtcbiAgICAgICAgcmV0dXJuIHNxbCBgdXBkYXRlICR7dGFibGV9IHNldCAke3NldFNxbH0ke3doZXJlU3FsfSR7cmV0dXJuaW5nU3FsfWA7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEJ1aWxkcyBzZWxlY3Rpb24gU1FMIHdpdGggcHJvdmlkZWQgZmllbGRzL2V4cHJlc3Npb25zXG4gICAgICpcbiAgICAgKiBFeGFtcGxlczpcbiAgICAgKlxuICAgICAqIGBzZWxlY3QgPHNlbGVjdGlvbj4gZnJvbWBcbiAgICAgKlxuICAgICAqIGBpbnNlcnQgLi4uIHJldHVybmluZyA8c2VsZWN0aW9uPmBcbiAgICAgKlxuICAgICAqIElmIGBpc1NpbmdsZVRhYmxlYCBpcyB0cnVlLCB0aGVuIGNvbHVtbnMgd29uJ3QgYmUgcHJlZml4ZWQgd2l0aCB0YWJsZSBuYW1lXG4gICAgICovXG4gICAgYnVpbGRTZWxlY3Rpb24oZmllbGRzLCB7IGlzU2luZ2xlVGFibGUgPSBmYWxzZSB9ID0ge30pIHtcbiAgICAgICAgY29uc3QgY29sdW1uc0xlbiA9IGZpZWxkcy5sZW5ndGg7XG4gICAgICAgIGNvbnN0IGNodW5rcyA9IGZpZWxkc1xuICAgICAgICAgICAgLmZsYXRNYXAoKHsgZmllbGQgfSwgaSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY2h1bmsgPSBbXTtcbiAgICAgICAgICAgIGlmIChpcyhmaWVsZCwgU1FMLkFsaWFzZWQpICYmIGZpZWxkLmlzU2VsZWN0aW9uRmllbGQpIHtcbiAgICAgICAgICAgICAgICBjaHVuay5wdXNoKHNxbC5pZGVudGlmaWVyKGZpZWxkLmZpZWxkQWxpYXMpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGlzKGZpZWxkLCBTUUwuQWxpYXNlZCkgfHwgaXMoZmllbGQsIFNRTCkpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBxdWVyeSA9IGlzKGZpZWxkLCBTUUwuQWxpYXNlZCkgPyBmaWVsZC5zcWwgOiBmaWVsZDtcbiAgICAgICAgICAgICAgICBpZiAoaXNTaW5nbGVUYWJsZSkge1xuICAgICAgICAgICAgICAgICAgICBjaHVuay5wdXNoKG5ldyBTUUwocXVlcnkucXVlcnlDaHVua3MubWFwKChjKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXMoYywgTXlTcWxDb2x1bW4pKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNxbC5pZGVudGlmaWVyKGMubmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYztcbiAgICAgICAgICAgICAgICAgICAgfSkpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNodW5rLnB1c2gocXVlcnkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoaXMoZmllbGQsIFNRTC5BbGlhc2VkKSkge1xuICAgICAgICAgICAgICAgICAgICBjaHVuay5wdXNoKHNxbCBgIGFzICR7c3FsLmlkZW50aWZpZXIoZmllbGQuZmllbGRBbGlhcyl9YCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoaXMoZmllbGQsIENvbHVtbikpIHtcbiAgICAgICAgICAgICAgICBpZiAoaXNTaW5nbGVUYWJsZSkge1xuICAgICAgICAgICAgICAgICAgICBjaHVuay5wdXNoKHNxbC5pZGVudGlmaWVyKGZpZWxkLm5hbWUpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNodW5rLnB1c2goZmllbGQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpIDwgY29sdW1uc0xlbiAtIDEpIHtcbiAgICAgICAgICAgICAgICBjaHVuay5wdXNoKHNxbCBgLCBgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBjaHVuaztcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBzcWwuam9pbihjaHVua3MpO1xuICAgIH1cbiAgICBidWlsZFNlbGVjdFF1ZXJ5KHsgd2l0aExpc3QsIGZpZWxkcywgZmllbGRzRmxhdCwgd2hlcmUsIGhhdmluZywgdGFibGUsIGpvaW5zLCBvcmRlckJ5LCBncm91cEJ5LCBsaW1pdCwgb2Zmc2V0LCBsb2NraW5nQ2xhdXNlLCBkaXN0aW5jdCwgfSkge1xuICAgICAgICBjb25zdCBmaWVsZHNMaXN0ID0gZmllbGRzRmxhdCA/PyBvcmRlclNlbGVjdGVkRmllbGRzKGZpZWxkcyk7XG4gICAgICAgIGZvciAoY29uc3QgZiBvZiBmaWVsZHNMaXN0KSB7XG4gICAgICAgICAgICBpZiAoaXMoZi5maWVsZCwgQ29sdW1uKVxuICAgICAgICAgICAgICAgICYmIGdldFRhYmxlTmFtZShmLmZpZWxkLnRhYmxlKVxuICAgICAgICAgICAgICAgICAgICAhPT0gKGlzKHRhYmxlLCBTdWJxdWVyeSlcbiAgICAgICAgICAgICAgICAgICAgICAgID8gdGFibGVbU3VicXVlcnlDb25maWddLmFsaWFzXG4gICAgICAgICAgICAgICAgICAgICAgICA6IGlzKHRhYmxlLCBNeVNxbFZpZXdCYXNlKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gdGFibGVbVmlld0Jhc2VDb25maWddLm5hbWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IGlzKHRhYmxlLCBTUUwpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gdW5kZWZpbmVkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogZ2V0VGFibGVOYW1lKHRhYmxlKSlcbiAgICAgICAgICAgICAgICAmJiAhKCh0YWJsZSkgPT4gam9pbnM/LnNvbWUoKHsgYWxpYXMgfSkgPT4gYWxpYXMgPT09ICh0YWJsZVtUYWJsZS5TeW1ib2wuSXNBbGlhc10gPyBnZXRUYWJsZU5hbWUodGFibGUpIDogdGFibGVbVGFibGUuU3ltYm9sLkJhc2VOYW1lXSkpKShmLmZpZWxkLnRhYmxlKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRhYmxlTmFtZSA9IGdldFRhYmxlTmFtZShmLmZpZWxkLnRhYmxlKTtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFlvdXIgXCIke2YucGF0aC5qb2luKCctPicpfVwiIGZpZWxkIHJlZmVyZW5jZXMgYSBjb2x1bW4gXCIke3RhYmxlTmFtZX1cIi5cIiR7Zi5maWVsZC5uYW1lfVwiLCBidXQgdGhlIHRhYmxlIFwiJHt0YWJsZU5hbWV9XCIgaXMgbm90IHBhcnQgb2YgdGhlIHF1ZXJ5ISBEaWQgeW91IGZvcmdldCB0byBqb2luIGl0P2ApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGlzU2luZ2xlVGFibGUgPSAham9pbnMgfHwgam9pbnMubGVuZ3RoID09PSAwO1xuICAgICAgICBsZXQgd2l0aFNxbDtcbiAgICAgICAgaWYgKHdpdGhMaXN0Py5sZW5ndGgpIHtcbiAgICAgICAgICAgIGNvbnN0IHdpdGhTcWxDaHVua3MgPSBbc3FsIGB3aXRoIGBdO1xuICAgICAgICAgICAgZm9yIChjb25zdCBbaSwgd10gb2Ygd2l0aExpc3QuZW50cmllcygpKSB7XG4gICAgICAgICAgICAgICAgd2l0aFNxbENodW5rcy5wdXNoKHNxbCBgJHtzcWwuaWRlbnRpZmllcih3W1N1YnF1ZXJ5Q29uZmlnXS5hbGlhcyl9IGFzICgke3dbU3VicXVlcnlDb25maWddLnNxbH0pYCk7XG4gICAgICAgICAgICAgICAgaWYgKGkgPCB3aXRoTGlzdC5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIHdpdGhTcWxDaHVua3MucHVzaChzcWwgYCwgYCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgd2l0aFNxbENodW5rcy5wdXNoKHNxbCBgIGApO1xuICAgICAgICAgICAgd2l0aFNxbCA9IHNxbC5qb2luKHdpdGhTcWxDaHVua3MpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGRpc3RpbmN0U3FsID0gZGlzdGluY3QgPyBzcWwgYCBkaXN0aW5jdGAgOiB1bmRlZmluZWQ7XG4gICAgICAgIGNvbnN0IHNlbGVjdGlvbiA9IHRoaXMuYnVpbGRTZWxlY3Rpb24oZmllbGRzTGlzdCwgeyBpc1NpbmdsZVRhYmxlIH0pO1xuICAgICAgICBjb25zdCB0YWJsZVNxbCA9ICgoKSA9PiB7XG4gICAgICAgICAgICBpZiAoaXModGFibGUsIFRhYmxlKSAmJiB0YWJsZVtUYWJsZS5TeW1ib2wuT3JpZ2luYWxOYW1lXSAhPT0gdGFibGVbVGFibGUuU3ltYm9sLk5hbWVdKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNxbCBgJHtzcWwuaWRlbnRpZmllcih0YWJsZVtUYWJsZS5TeW1ib2wuT3JpZ2luYWxOYW1lXSl9ICR7c3FsLmlkZW50aWZpZXIodGFibGVbVGFibGUuU3ltYm9sLk5hbWVdKX1gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRhYmxlO1xuICAgICAgICB9KSgpO1xuICAgICAgICBjb25zdCBqb2luc0FycmF5ID0gW107XG4gICAgICAgIGlmIChqb2lucykge1xuICAgICAgICAgICAgZm9yIChjb25zdCBbaW5kZXgsIGpvaW5NZXRhXSBvZiBqb2lucy5lbnRyaWVzKCkpIHtcbiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgam9pbnNBcnJheS5wdXNoKHNxbCBgIGApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCB0YWJsZSA9IGpvaW5NZXRhLnRhYmxlO1xuICAgICAgICAgICAgICAgIGNvbnN0IGxhdGVyYWxTcWwgPSBqb2luTWV0YS5sYXRlcmFsID8gc3FsIGAgbGF0ZXJhbGAgOiB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgaWYgKGlzKHRhYmxlLCBNeVNxbFRhYmxlKSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB0YWJsZU5hbWUgPSB0YWJsZVtNeVNxbFRhYmxlLlN5bWJvbC5OYW1lXTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGFibGVTY2hlbWEgPSB0YWJsZVtNeVNxbFRhYmxlLlN5bWJvbC5TY2hlbWFdO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBvcmlnVGFibGVOYW1lID0gdGFibGVbTXlTcWxUYWJsZS5TeW1ib2wuT3JpZ2luYWxOYW1lXTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYWxpYXMgPSB0YWJsZU5hbWUgPT09IG9yaWdUYWJsZU5hbWUgPyB1bmRlZmluZWQgOiBqb2luTWV0YS5hbGlhcztcbiAgICAgICAgICAgICAgICAgICAgam9pbnNBcnJheS5wdXNoKHNxbCBgJHtzcWwucmF3KGpvaW5NZXRhLmpvaW5UeXBlKX0gam9pbiR7bGF0ZXJhbFNxbH0gJHt0YWJsZVNjaGVtYSA/IHNxbCBgJHtzcWwuaWRlbnRpZmllcih0YWJsZVNjaGVtYSl9LmAgOiB1bmRlZmluZWR9JHtzcWwuaWRlbnRpZmllcihvcmlnVGFibGVOYW1lKX0ke2FsaWFzICYmIHNxbCBgICR7c3FsLmlkZW50aWZpZXIoYWxpYXMpfWB9IG9uICR7am9pbk1ldGEub259YCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGlzKHRhYmxlLCBWaWV3KSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB2aWV3TmFtZSA9IHRhYmxlW1ZpZXdCYXNlQ29uZmlnXS5uYW1lO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB2aWV3U2NoZW1hID0gdGFibGVbVmlld0Jhc2VDb25maWddLnNjaGVtYTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3JpZ1ZpZXdOYW1lID0gdGFibGVbVmlld0Jhc2VDb25maWddLm9yaWdpbmFsTmFtZTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYWxpYXMgPSB2aWV3TmFtZSA9PT0gb3JpZ1ZpZXdOYW1lID8gdW5kZWZpbmVkIDogam9pbk1ldGEuYWxpYXM7XG4gICAgICAgICAgICAgICAgICAgIGpvaW5zQXJyYXkucHVzaChzcWwgYCR7c3FsLnJhdyhqb2luTWV0YS5qb2luVHlwZSl9IGpvaW4ke2xhdGVyYWxTcWx9ICR7dmlld1NjaGVtYSA/IHNxbCBgJHtzcWwuaWRlbnRpZmllcih2aWV3U2NoZW1hKX0uYCA6IHVuZGVmaW5lZH0ke3NxbC5pZGVudGlmaWVyKG9yaWdWaWV3TmFtZSl9JHthbGlhcyAmJiBzcWwgYCAke3NxbC5pZGVudGlmaWVyKGFsaWFzKX1gfSBvbiAke2pvaW5NZXRhLm9ufWApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgam9pbnNBcnJheS5wdXNoKHNxbCBgJHtzcWwucmF3KGpvaW5NZXRhLmpvaW5UeXBlKX0gam9pbiR7bGF0ZXJhbFNxbH0gJHt0YWJsZX0gb24gJHtqb2luTWV0YS5vbn1gKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGluZGV4IDwgam9pbnMubGVuZ3RoIC0gMSkge1xuICAgICAgICAgICAgICAgICAgICBqb2luc0FycmF5LnB1c2goc3FsIGAgYCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGpvaW5zU3FsID0gc3FsLmpvaW4oam9pbnNBcnJheSk7XG4gICAgICAgIGNvbnN0IHdoZXJlU3FsID0gd2hlcmUgPyBzcWwgYCB3aGVyZSAke3doZXJlfWAgOiB1bmRlZmluZWQ7XG4gICAgICAgIGNvbnN0IGhhdmluZ1NxbCA9IGhhdmluZyA/IHNxbCBgIGhhdmluZyAke2hhdmluZ31gIDogdW5kZWZpbmVkO1xuICAgICAgICBsZXQgb3JkZXJCeVNxbDtcbiAgICAgICAgaWYgKG9yZGVyQnkgJiYgb3JkZXJCeS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBvcmRlckJ5U3FsID0gc3FsIGAgb3JkZXIgYnkgJHtzcWwuam9pbihvcmRlckJ5LCBzcWwgYCwgYCl9YDtcbiAgICAgICAgfVxuICAgICAgICBsZXQgZ3JvdXBCeVNxbDtcbiAgICAgICAgaWYgKGdyb3VwQnkgJiYgZ3JvdXBCeS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBncm91cEJ5U3FsID0gc3FsIGAgZ3JvdXAgYnkgJHtzcWwuam9pbihncm91cEJ5LCBzcWwgYCwgYCl9YDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBsaW1pdFNxbCA9IGxpbWl0ID8gc3FsIGAgbGltaXQgJHtsaW1pdH1gIDogdW5kZWZpbmVkO1xuICAgICAgICBjb25zdCBvZmZzZXRTcWwgPSBvZmZzZXQgPyBzcWwgYCBvZmZzZXQgJHtvZmZzZXR9YCA6IHVuZGVmaW5lZDtcbiAgICAgICAgbGV0IGxvY2tpbmdDbGF1c2VzU3FsO1xuICAgICAgICBpZiAobG9ja2luZ0NsYXVzZSkge1xuICAgICAgICAgICAgY29uc3QgeyBjb25maWcsIHN0cmVuZ3RoIH0gPSBsb2NraW5nQ2xhdXNlO1xuICAgICAgICAgICAgbG9ja2luZ0NsYXVzZXNTcWwgPSBzcWwgYCBmb3IgJHtzcWwucmF3KHN0cmVuZ3RoKX1gO1xuICAgICAgICAgICAgaWYgKGNvbmZpZy5ub1dhaXQpIHtcbiAgICAgICAgICAgICAgICBsb2NraW5nQ2xhdXNlc1NxbC5hcHBlbmQoc3FsIGAgbm8gd2FpdGApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY29uZmlnLnNraXBMb2NrZWQpIHtcbiAgICAgICAgICAgICAgICBsb2NraW5nQ2xhdXNlc1NxbC5hcHBlbmQoc3FsIGAgc2tpcCBsb2NrZWRgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc3FsIGAke3dpdGhTcWx9c2VsZWN0JHtkaXN0aW5jdFNxbH0gJHtzZWxlY3Rpb259IGZyb20gJHt0YWJsZVNxbH0ke2pvaW5zU3FsfSR7d2hlcmVTcWx9JHtncm91cEJ5U3FsfSR7aGF2aW5nU3FsfSR7b3JkZXJCeVNxbH0ke2xpbWl0U3FsfSR7b2Zmc2V0U3FsfSR7bG9ja2luZ0NsYXVzZXNTcWx9YDtcbiAgICB9XG4gICAgYnVpbGRJbnNlcnRRdWVyeSh7IHRhYmxlLCB2YWx1ZXMsIGlnbm9yZSwgb25Db25mbGljdCB9KSB7XG4gICAgICAgIC8vIGNvbnN0IGlzU2luZ2xlVmFsdWUgPSB2YWx1ZXMubGVuZ3RoID09PSAxO1xuICAgICAgICBjb25zdCB2YWx1ZXNTcWxMaXN0ID0gW107XG4gICAgICAgIGNvbnN0IGNvbHVtbnMgPSB0YWJsZVtUYWJsZS5TeW1ib2wuQ29sdW1uc107XG4gICAgICAgIGNvbnN0IGNvbEVudHJpZXMgPSBPYmplY3QuZW50cmllcyhjb2x1bW5zKTtcbiAgICAgICAgY29uc3QgaW5zZXJ0T3JkZXIgPSBjb2xFbnRyaWVzLm1hcCgoWywgY29sdW1uXSkgPT4gc3FsLmlkZW50aWZpZXIoY29sdW1uLm5hbWUpKTtcbiAgICAgICAgZm9yIChjb25zdCBbdmFsdWVJbmRleCwgdmFsdWVdIG9mIHZhbHVlcy5lbnRyaWVzKCkpIHtcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlTGlzdCA9IFtdO1xuICAgICAgICAgICAgZm9yIChjb25zdCBbZmllbGROYW1lLCBjb2xdIG9mIGNvbEVudHJpZXMpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjb2xWYWx1ZSA9IHZhbHVlW2ZpZWxkTmFtZV07XG4gICAgICAgICAgICAgICAgaWYgKGNvbFZhbHVlID09PSB1bmRlZmluZWQgfHwgKGlzKGNvbFZhbHVlLCBQYXJhbSkgJiYgY29sVmFsdWUudmFsdWUgPT09IHVuZGVmaW5lZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHVuaWNvcm4vbm8tbmVnYXRlZC1jb25kaXRpb25cbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbC5kZWZhdWx0Rm4gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGVmYXVsdEZuUmVzdWx0ID0gY29sLmRlZmF1bHRGbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGVmYXVsdFZhbHVlID0gaXMoZGVmYXVsdEZuUmVzdWx0LCBTUUwpID8gZGVmYXVsdEZuUmVzdWx0IDogc3FsLnBhcmFtKGRlZmF1bHRGblJlc3VsdCwgY29sKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlTGlzdC5wdXNoKGRlZmF1bHRWYWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZUxpc3QucHVzaChzcWwgYGRlZmF1bHRgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVMaXN0LnB1c2goY29sVmFsdWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhbHVlc1NxbExpc3QucHVzaCh2YWx1ZUxpc3QpO1xuICAgICAgICAgICAgaWYgKHZhbHVlSW5kZXggPCB2YWx1ZXMubGVuZ3RoIC0gMSkge1xuICAgICAgICAgICAgICAgIHZhbHVlc1NxbExpc3QucHVzaChzcWwgYCwgYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdmFsdWVzU3FsID0gc3FsLmpvaW4odmFsdWVzU3FsTGlzdCk7XG4gICAgICAgIGNvbnN0IGlnbm9yZVNxbCA9IGlnbm9yZSA/IHNxbCBgIGlnbm9yZWAgOiB1bmRlZmluZWQ7XG4gICAgICAgIGNvbnN0IG9uQ29uZmxpY3RTcWwgPSBvbkNvbmZsaWN0ID8gc3FsIGAgb24gZHVwbGljYXRlIGtleSAke29uQ29uZmxpY3R9YCA6IHVuZGVmaW5lZDtcbiAgICAgICAgcmV0dXJuIHNxbCBgaW5zZXJ0JHtpZ25vcmVTcWx9IGludG8gJHt0YWJsZX0gJHtpbnNlcnRPcmRlcn0gdmFsdWVzICR7dmFsdWVzU3FsfSR7b25Db25mbGljdFNxbH1gO1xuICAgIH1cbiAgICBzcWxUb1F1ZXJ5KHNxbCkge1xuICAgICAgICByZXR1cm4gc3FsLnRvUXVlcnkoe1xuICAgICAgICAgICAgZXNjYXBlTmFtZTogdGhpcy5lc2NhcGVOYW1lLFxuICAgICAgICAgICAgZXNjYXBlUGFyYW06IHRoaXMuZXNjYXBlUGFyYW0sXG4gICAgICAgICAgICBlc2NhcGVTdHJpbmc6IHRoaXMuZXNjYXBlU3RyaW5nLFxuICAgICAgICB9KTtcbiAgICB9XG4gICAgYnVpbGRSZWxhdGlvbmFsUXVlcnkoeyBmdWxsU2NoZW1hLCBzY2hlbWEsIHRhYmxlTmFtZXNNYXAsIHRhYmxlLCB0YWJsZUNvbmZpZywgcXVlcnlDb25maWc6IGNvbmZpZywgdGFibGVBbGlhcywgbmVzdGVkUXVlcnlSZWxhdGlvbiwgam9pbk9uLCB9KSB7XG4gICAgICAgIGxldCBzZWxlY3Rpb24gPSBbXTtcbiAgICAgICAgbGV0IGxpbWl0LCBvZmZzZXQsIG9yZGVyQnksIHdoZXJlO1xuICAgICAgICBjb25zdCBqb2lucyA9IFtdO1xuICAgICAgICBpZiAoY29uZmlnID09PSB0cnVlKSB7XG4gICAgICAgICAgICBjb25zdCBzZWxlY3Rpb25FbnRyaWVzID0gT2JqZWN0LmVudHJpZXModGFibGVDb25maWcuY29sdW1ucyk7XG4gICAgICAgICAgICBzZWxlY3Rpb24gPSBzZWxlY3Rpb25FbnRyaWVzLm1hcCgoW2tleSwgdmFsdWVdKSA9PiAoe1xuICAgICAgICAgICAgICAgIGRiS2V5OiB2YWx1ZS5uYW1lLFxuICAgICAgICAgICAgICAgIHRzS2V5OiBrZXksXG4gICAgICAgICAgICAgICAgZmllbGQ6IGFsaWFzZWRUYWJsZUNvbHVtbih2YWx1ZSwgdGFibGVBbGlhcyksXG4gICAgICAgICAgICAgICAgcmVsYXRpb25UYWJsZVRzS2V5OiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgaXNKc29uOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBzZWxlY3Rpb246IFtdLFxuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgYWxpYXNlZENvbHVtbnMgPSBPYmplY3QuZnJvbUVudHJpZXMoT2JqZWN0LmVudHJpZXModGFibGVDb25maWcuY29sdW1ucykubWFwKChba2V5LCB2YWx1ZV0pID0+IFtrZXksIGFsaWFzZWRUYWJsZUNvbHVtbih2YWx1ZSwgdGFibGVBbGlhcyldKSk7XG4gICAgICAgICAgICBpZiAoY29uZmlnLndoZXJlKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgd2hlcmVTcWwgPSB0eXBlb2YgY29uZmlnLndoZXJlID09PSAnZnVuY3Rpb24nXG4gICAgICAgICAgICAgICAgICAgID8gY29uZmlnLndoZXJlKGFsaWFzZWRDb2x1bW5zLCBnZXRPcGVyYXRvcnMoKSlcbiAgICAgICAgICAgICAgICAgICAgOiBjb25maWcud2hlcmU7XG4gICAgICAgICAgICAgICAgd2hlcmUgPSB3aGVyZVNxbCAmJiBtYXBDb2x1bW5zSW5TUUxUb0FsaWFzKHdoZXJlU3FsLCB0YWJsZUFsaWFzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGZpZWxkc1NlbGVjdGlvbiA9IFtdO1xuICAgICAgICAgICAgbGV0IHNlbGVjdGVkQ29sdW1ucyA9IFtdO1xuICAgICAgICAgICAgLy8gRmlndXJlIG91dCB3aGljaCBjb2x1bW5zIHRvIHNlbGVjdFxuICAgICAgICAgICAgaWYgKGNvbmZpZy5jb2x1bW5zKSB7XG4gICAgICAgICAgICAgICAgbGV0IGlzSW5jbHVkZU1vZGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IFtmaWVsZCwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGNvbmZpZy5jb2x1bW5zKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpZWxkIGluIHRhYmxlQ29uZmlnLmNvbHVtbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaXNJbmNsdWRlTW9kZSAmJiB2YWx1ZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzSW5jbHVkZU1vZGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRDb2x1bW5zLnB1c2goZmllbGQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZENvbHVtbnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZENvbHVtbnMgPSBpc0luY2x1ZGVNb2RlXG4gICAgICAgICAgICAgICAgICAgICAgICA/IHNlbGVjdGVkQ29sdW1ucy5maWx0ZXIoKGMpID0+IGNvbmZpZy5jb2x1bW5zPy5bY10gPT09IHRydWUpXG4gICAgICAgICAgICAgICAgICAgICAgICA6IE9iamVjdC5rZXlzKHRhYmxlQ29uZmlnLmNvbHVtbnMpLmZpbHRlcigoa2V5KSA9PiAhc2VsZWN0ZWRDb2x1bW5zLmluY2x1ZGVzKGtleSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIFNlbGVjdCBhbGwgY29sdW1ucyBpZiBzZWxlY3Rpb24gaXMgbm90IHNwZWNpZmllZFxuICAgICAgICAgICAgICAgIHNlbGVjdGVkQ29sdW1ucyA9IE9iamVjdC5rZXlzKHRhYmxlQ29uZmlnLmNvbHVtbnMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yIChjb25zdCBmaWVsZCBvZiBzZWxlY3RlZENvbHVtbnMpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjb2x1bW4gPSB0YWJsZUNvbmZpZy5jb2x1bW5zW2ZpZWxkXTtcbiAgICAgICAgICAgICAgICBmaWVsZHNTZWxlY3Rpb24ucHVzaCh7IHRzS2V5OiBmaWVsZCwgdmFsdWU6IGNvbHVtbiB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCBzZWxlY3RlZFJlbGF0aW9ucyA9IFtdO1xuICAgICAgICAgICAgLy8gRmlndXJlIG91dCB3aGljaCByZWxhdGlvbnMgdG8gc2VsZWN0XG4gICAgICAgICAgICBpZiAoY29uZmlnLndpdGgpIHtcbiAgICAgICAgICAgICAgICBzZWxlY3RlZFJlbGF0aW9ucyA9IE9iamVjdC5lbnRyaWVzKGNvbmZpZy53aXRoKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKChlbnRyeSkgPT4gISFlbnRyeVsxXSlcbiAgICAgICAgICAgICAgICAgICAgLm1hcCgoW3RzS2V5LCBxdWVyeUNvbmZpZ10pID0+ICh7IHRzS2V5LCBxdWVyeUNvbmZpZywgcmVsYXRpb246IHRhYmxlQ29uZmlnLnJlbGF0aW9uc1t0c0tleV0gfSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IGV4dHJhcztcbiAgICAgICAgICAgIC8vIEZpZ3VyZSBvdXQgd2hpY2ggZXh0cmFzIHRvIHNlbGVjdFxuICAgICAgICAgICAgaWYgKGNvbmZpZy5leHRyYXMpIHtcbiAgICAgICAgICAgICAgICBleHRyYXMgPSB0eXBlb2YgY29uZmlnLmV4dHJhcyA9PT0gJ2Z1bmN0aW9uJ1xuICAgICAgICAgICAgICAgICAgICA/IGNvbmZpZy5leHRyYXMoYWxpYXNlZENvbHVtbnMsIHsgc3FsIH0pXG4gICAgICAgICAgICAgICAgICAgIDogY29uZmlnLmV4dHJhcztcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IFt0c0tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGV4dHJhcykpIHtcbiAgICAgICAgICAgICAgICAgICAgZmllbGRzU2VsZWN0aW9uLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgdHNLZXksXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogbWFwQ29sdW1uc0luQWxpYXNlZFNRTFRvQWxpYXModmFsdWUsIHRhYmxlQWxpYXMpLFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBUcmFuc2Zvcm0gYGZpZWxkc1NlbGVjdGlvbmAgaW50byBgc2VsZWN0aW9uYFxuICAgICAgICAgICAgLy8gYGZpZWxkc1NlbGVjdGlvbmAgc2hvdWxkbid0IGJlIHVzZWQgYWZ0ZXIgdGhpcyBwb2ludFxuICAgICAgICAgICAgZm9yIChjb25zdCB7IHRzS2V5LCB2YWx1ZSB9IG9mIGZpZWxkc1NlbGVjdGlvbikge1xuICAgICAgICAgICAgICAgIHNlbGVjdGlvbi5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgZGJLZXk6IGlzKHZhbHVlLCBTUUwuQWxpYXNlZCkgPyB2YWx1ZS5maWVsZEFsaWFzIDogdGFibGVDb25maWcuY29sdW1uc1t0c0tleV0ubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgdHNLZXksXG4gICAgICAgICAgICAgICAgICAgIGZpZWxkOiBpcyh2YWx1ZSwgQ29sdW1uKSA/IGFsaWFzZWRUYWJsZUNvbHVtbih2YWx1ZSwgdGFibGVBbGlhcykgOiB2YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgcmVsYXRpb25UYWJsZVRzS2V5OiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIGlzSnNvbjogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGlvbjogW10sXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgb3JkZXJCeU9yaWcgPSB0eXBlb2YgY29uZmlnLm9yZGVyQnkgPT09ICdmdW5jdGlvbidcbiAgICAgICAgICAgICAgICA/IGNvbmZpZy5vcmRlckJ5KGFsaWFzZWRDb2x1bW5zLCBnZXRPcmRlckJ5T3BlcmF0b3JzKCkpXG4gICAgICAgICAgICAgICAgOiBjb25maWcub3JkZXJCeSA/PyBbXTtcbiAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShvcmRlckJ5T3JpZykpIHtcbiAgICAgICAgICAgICAgICBvcmRlckJ5T3JpZyA9IFtvcmRlckJ5T3JpZ107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBvcmRlckJ5ID0gb3JkZXJCeU9yaWcubWFwKChvcmRlckJ5VmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoaXMob3JkZXJCeVZhbHVlLCBDb2x1bW4pKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhbGlhc2VkVGFibGVDb2x1bW4ob3JkZXJCeVZhbHVlLCB0YWJsZUFsaWFzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1hcENvbHVtbnNJblNRTFRvQWxpYXMob3JkZXJCeVZhbHVlLCB0YWJsZUFsaWFzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgbGltaXQgPSBjb25maWcubGltaXQ7XG4gICAgICAgICAgICBvZmZzZXQgPSBjb25maWcub2Zmc2V0O1xuICAgICAgICAgICAgLy8gUHJvY2VzcyBhbGwgcmVsYXRpb25zXG4gICAgICAgICAgICBmb3IgKGNvbnN0IHsgdHNLZXk6IHNlbGVjdGVkUmVsYXRpb25Uc0tleSwgcXVlcnlDb25maWc6IHNlbGVjdGVkUmVsYXRpb25Db25maWdWYWx1ZSwgcmVsYXRpb24sIH0gb2Ygc2VsZWN0ZWRSZWxhdGlvbnMpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBub3JtYWxpemVkUmVsYXRpb24gPSBub3JtYWxpemVSZWxhdGlvbihzY2hlbWEsIHRhYmxlTmFtZXNNYXAsIHJlbGF0aW9uKTtcbiAgICAgICAgICAgICAgICBjb25zdCByZWxhdGlvblRhYmxlTmFtZSA9IHJlbGF0aW9uLnJlZmVyZW5jZWRUYWJsZVtUYWJsZS5TeW1ib2wuTmFtZV07XG4gICAgICAgICAgICAgICAgY29uc3QgcmVsYXRpb25UYWJsZVRzTmFtZSA9IHRhYmxlTmFtZXNNYXBbcmVsYXRpb25UYWJsZU5hbWVdO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlbGF0aW9uVGFibGVBbGlhcyA9IGAke3RhYmxlQWxpYXN9XyR7c2VsZWN0ZWRSZWxhdGlvblRzS2V5fWA7XG4gICAgICAgICAgICAgICAgY29uc3Qgam9pbk9uID0gYW5kKC4uLm5vcm1hbGl6ZWRSZWxhdGlvbi5maWVsZHMubWFwKChmaWVsZCwgaSkgPT4gZXEoYWxpYXNlZFRhYmxlQ29sdW1uKG5vcm1hbGl6ZWRSZWxhdGlvbi5yZWZlcmVuY2VzW2ldLCByZWxhdGlvblRhYmxlQWxpYXMpLCBhbGlhc2VkVGFibGVDb2x1bW4oZmllbGQsIHRhYmxlQWxpYXMpKSkpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGJ1aWx0UmVsYXRpb24gPSB0aGlzLmJ1aWxkUmVsYXRpb25hbFF1ZXJ5KHtcbiAgICAgICAgICAgICAgICAgICAgZnVsbFNjaGVtYSxcbiAgICAgICAgICAgICAgICAgICAgc2NoZW1hLFxuICAgICAgICAgICAgICAgICAgICB0YWJsZU5hbWVzTWFwLFxuICAgICAgICAgICAgICAgICAgICB0YWJsZTogZnVsbFNjaGVtYVtyZWxhdGlvblRhYmxlVHNOYW1lXSxcbiAgICAgICAgICAgICAgICAgICAgdGFibGVDb25maWc6IHNjaGVtYVtyZWxhdGlvblRhYmxlVHNOYW1lXSxcbiAgICAgICAgICAgICAgICAgICAgcXVlcnlDb25maWc6IGlzKHJlbGF0aW9uLCBPbmUpXG4gICAgICAgICAgICAgICAgICAgICAgICA/IChzZWxlY3RlZFJlbGF0aW9uQ29uZmlnVmFsdWUgPT09IHRydWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IHsgbGltaXQ6IDEgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogeyAuLi5zZWxlY3RlZFJlbGF0aW9uQ29uZmlnVmFsdWUsIGxpbWl0OiAxIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICA6IHNlbGVjdGVkUmVsYXRpb25Db25maWdWYWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgdGFibGVBbGlhczogcmVsYXRpb25UYWJsZUFsaWFzLFxuICAgICAgICAgICAgICAgICAgICBqb2luT24sXG4gICAgICAgICAgICAgICAgICAgIG5lc3RlZFF1ZXJ5UmVsYXRpb246IHJlbGF0aW9uLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGNvbnN0IGZpZWxkID0gc3FsIGAke3NxbC5pZGVudGlmaWVyKHJlbGF0aW9uVGFibGVBbGlhcyl9LiR7c3FsLmlkZW50aWZpZXIoJ2RhdGEnKX1gLmFzKHNlbGVjdGVkUmVsYXRpb25Uc0tleSk7XG4gICAgICAgICAgICAgICAgam9pbnMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIG9uOiBzcWwgYHRydWVgLFxuICAgICAgICAgICAgICAgICAgICB0YWJsZTogbmV3IFN1YnF1ZXJ5KGJ1aWx0UmVsYXRpb24uc3FsLCB7fSwgcmVsYXRpb25UYWJsZUFsaWFzKSxcbiAgICAgICAgICAgICAgICAgICAgYWxpYXM6IHJlbGF0aW9uVGFibGVBbGlhcyxcbiAgICAgICAgICAgICAgICAgICAgam9pblR5cGU6ICdsZWZ0JyxcbiAgICAgICAgICAgICAgICAgICAgbGF0ZXJhbDogdHJ1ZSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBzZWxlY3Rpb24ucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIGRiS2V5OiBzZWxlY3RlZFJlbGF0aW9uVHNLZXksXG4gICAgICAgICAgICAgICAgICAgIHRzS2V5OiBzZWxlY3RlZFJlbGF0aW9uVHNLZXksXG4gICAgICAgICAgICAgICAgICAgIGZpZWxkLFxuICAgICAgICAgICAgICAgICAgICByZWxhdGlvblRhYmxlVHNLZXk6IHJlbGF0aW9uVGFibGVUc05hbWUsXG4gICAgICAgICAgICAgICAgICAgIGlzSnNvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0aW9uOiBidWlsdFJlbGF0aW9uLnNlbGVjdGlvbixcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoc2VsZWN0aW9uLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IERyaXp6bGVFcnJvcihgTm8gZmllbGRzIHNlbGVjdGVkIGZvciB0YWJsZSBcIiR7dGFibGVDb25maWcudHNOYW1lfVwiIChcIiR7dGFibGVBbGlhc31cIilgKTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgcmVzdWx0O1xuICAgICAgICB3aGVyZSA9IGFuZChqb2luT24sIHdoZXJlKTtcbiAgICAgICAgaWYgKG5lc3RlZFF1ZXJ5UmVsYXRpb24pIHtcbiAgICAgICAgICAgIGxldCBmaWVsZCA9IHNxbCBganNvbl9hcnJheSgke3NxbC5qb2luKHNlbGVjdGlvbi5tYXAoKHsgZmllbGQsIHRzS2V5LCBpc0pzb24gfSkgPT4gaXNKc29uXG4gICAgICAgICAgICAgICAgPyBzcWwgYCR7c3FsLmlkZW50aWZpZXIoYCR7dGFibGVBbGlhc31fJHt0c0tleX1gKX0uJHtzcWwuaWRlbnRpZmllcignZGF0YScpfWBcbiAgICAgICAgICAgICAgICA6IGlzKGZpZWxkLCBTUUwuQWxpYXNlZClcbiAgICAgICAgICAgICAgICAgICAgPyBmaWVsZC5zcWxcbiAgICAgICAgICAgICAgICAgICAgOiBmaWVsZCksIHNxbCBgLCBgKX0pYDtcbiAgICAgICAgICAgIGlmIChpcyhuZXN0ZWRRdWVyeVJlbGF0aW9uLCBNYW55KSkge1xuICAgICAgICAgICAgICAgIGZpZWxkID0gc3FsIGBjb2FsZXNjZShqc29uX2FycmF5YWdnKCR7ZmllbGR9KSwganNvbl9hcnJheSgpKWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBuZXN0ZWRTZWxlY3Rpb24gPSBbe1xuICAgICAgICAgICAgICAgICAgICBkYktleTogJ2RhdGEnLFxuICAgICAgICAgICAgICAgICAgICB0c0tleTogJ2RhdGEnLFxuICAgICAgICAgICAgICAgICAgICBmaWVsZDogZmllbGQuYXMoJ2RhdGEnKSxcbiAgICAgICAgICAgICAgICAgICAgaXNKc29uOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICByZWxhdGlvblRhYmxlVHNLZXk6IHRhYmxlQ29uZmlnLnRzTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0aW9uLFxuICAgICAgICAgICAgICAgIH1dO1xuICAgICAgICAgICAgY29uc3QgbmVlZHNTdWJxdWVyeSA9IGxpbWl0ICE9PSB1bmRlZmluZWQgfHwgb2Zmc2V0ICE9PSB1bmRlZmluZWQgfHwgKG9yZGVyQnk/Lmxlbmd0aCA/PyAwKSA+IDA7XG4gICAgICAgICAgICBpZiAobmVlZHNTdWJxdWVyeSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdCA9IHRoaXMuYnVpbGRTZWxlY3RRdWVyeSh7XG4gICAgICAgICAgICAgICAgICAgIHRhYmxlOiBhbGlhc2VkVGFibGUodGFibGUsIHRhYmxlQWxpYXMpLFxuICAgICAgICAgICAgICAgICAgICBmaWVsZHM6IHt9LFxuICAgICAgICAgICAgICAgICAgICBmaWVsZHNGbGF0OiBbXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogW10sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQ6IHNxbC5yYXcoJyonKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAuLi4oKChvcmRlckJ5Py5sZW5ndGggPz8gMCkgPiAwKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gW3tcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6IFtdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQ6IHNxbCBgcm93X251bWJlcigpIG92ZXIgKG9yZGVyIGJ5ICR7c3FsLmpvaW4ob3JkZXJCeSwgc3FsIGAsIGApfSlgLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogW10pLFxuICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICB3aGVyZSxcbiAgICAgICAgICAgICAgICAgICAgbGltaXQsXG4gICAgICAgICAgICAgICAgICAgIG9mZnNldCxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB3aGVyZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICBsaW1pdCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICBvZmZzZXQgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgb3JkZXJCeSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc3VsdCA9IGFsaWFzZWRUYWJsZSh0YWJsZSwgdGFibGVBbGlhcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXN1bHQgPSB0aGlzLmJ1aWxkU2VsZWN0UXVlcnkoe1xuICAgICAgICAgICAgICAgIHRhYmxlOiBpcyhyZXN1bHQsIE15U3FsVGFibGUpID8gcmVzdWx0IDogbmV3IFN1YnF1ZXJ5KHJlc3VsdCwge30sIHRhYmxlQWxpYXMpLFxuICAgICAgICAgICAgICAgIGZpZWxkczoge30sXG4gICAgICAgICAgICAgICAgZmllbGRzRmxhdDogbmVzdGVkU2VsZWN0aW9uLm1hcCgoeyBmaWVsZCB9KSA9PiAoe1xuICAgICAgICAgICAgICAgICAgICBwYXRoOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgZmllbGQ6IGlzKGZpZWxkLCBDb2x1bW4pID8gYWxpYXNlZFRhYmxlQ29sdW1uKGZpZWxkLCB0YWJsZUFsaWFzKSA6IGZpZWxkLFxuICAgICAgICAgICAgICAgIH0pKSxcbiAgICAgICAgICAgICAgICBqb2lucyxcbiAgICAgICAgICAgICAgICB3aGVyZSxcbiAgICAgICAgICAgICAgICBsaW1pdCxcbiAgICAgICAgICAgICAgICBvZmZzZXQsXG4gICAgICAgICAgICAgICAgb3JkZXJCeSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmVzdWx0ID0gdGhpcy5idWlsZFNlbGVjdFF1ZXJ5KHtcbiAgICAgICAgICAgICAgICB0YWJsZTogYWxpYXNlZFRhYmxlKHRhYmxlLCB0YWJsZUFsaWFzKSxcbiAgICAgICAgICAgICAgICBmaWVsZHM6IHt9LFxuICAgICAgICAgICAgICAgIGZpZWxkc0ZsYXQ6IHNlbGVjdGlvbi5tYXAoKHsgZmllbGQgfSkgPT4gKHtcbiAgICAgICAgICAgICAgICAgICAgcGF0aDogW10sXG4gICAgICAgICAgICAgICAgICAgIGZpZWxkOiBpcyhmaWVsZCwgQ29sdW1uKSA/IGFsaWFzZWRUYWJsZUNvbHVtbihmaWVsZCwgdGFibGVBbGlhcykgOiBmaWVsZCxcbiAgICAgICAgICAgICAgICB9KSksXG4gICAgICAgICAgICAgICAgam9pbnMsXG4gICAgICAgICAgICAgICAgd2hlcmUsXG4gICAgICAgICAgICAgICAgbGltaXQsXG4gICAgICAgICAgICAgICAgb2Zmc2V0LFxuICAgICAgICAgICAgICAgIG9yZGVyQnksXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdGFibGVUc0tleTogdGFibGVDb25maWcudHNOYW1lLFxuICAgICAgICAgICAgc3FsOiByZXN1bHQsXG4gICAgICAgICAgICBzZWxlY3Rpb24sXG4gICAgICAgIH07XG4gICAgfVxuICAgIGJ1aWxkUmVsYXRpb25hbFF1ZXJ5V2l0aG91dExhdGVyYWxTdWJxdWVyaWVzKHsgZnVsbFNjaGVtYSwgc2NoZW1hLCB0YWJsZU5hbWVzTWFwLCB0YWJsZSwgdGFibGVDb25maWcsIHF1ZXJ5Q29uZmlnOiBjb25maWcsIHRhYmxlQWxpYXMsIG5lc3RlZFF1ZXJ5UmVsYXRpb24sIGpvaW5PbiwgfSkge1xuICAgICAgICBsZXQgc2VsZWN0aW9uID0gW107XG4gICAgICAgIGxldCBsaW1pdCwgb2Zmc2V0LCBvcmRlckJ5ID0gW10sIHdoZXJlO1xuICAgICAgICBpZiAoY29uZmlnID09PSB0cnVlKSB7XG4gICAgICAgICAgICBjb25zdCBzZWxlY3Rpb25FbnRyaWVzID0gT2JqZWN0LmVudHJpZXModGFibGVDb25maWcuY29sdW1ucyk7XG4gICAgICAgICAgICBzZWxlY3Rpb24gPSBzZWxlY3Rpb25FbnRyaWVzLm1hcCgoW2tleSwgdmFsdWVdKSA9PiAoe1xuICAgICAgICAgICAgICAgIGRiS2V5OiB2YWx1ZS5uYW1lLFxuICAgICAgICAgICAgICAgIHRzS2V5OiBrZXksXG4gICAgICAgICAgICAgICAgZmllbGQ6IGFsaWFzZWRUYWJsZUNvbHVtbih2YWx1ZSwgdGFibGVBbGlhcyksXG4gICAgICAgICAgICAgICAgcmVsYXRpb25UYWJsZVRzS2V5OiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgaXNKc29uOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBzZWxlY3Rpb246IFtdLFxuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgYWxpYXNlZENvbHVtbnMgPSBPYmplY3QuZnJvbUVudHJpZXMoT2JqZWN0LmVudHJpZXModGFibGVDb25maWcuY29sdW1ucykubWFwKChba2V5LCB2YWx1ZV0pID0+IFtrZXksIGFsaWFzZWRUYWJsZUNvbHVtbih2YWx1ZSwgdGFibGVBbGlhcyldKSk7XG4gICAgICAgICAgICBpZiAoY29uZmlnLndoZXJlKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgd2hlcmVTcWwgPSB0eXBlb2YgY29uZmlnLndoZXJlID09PSAnZnVuY3Rpb24nXG4gICAgICAgICAgICAgICAgICAgID8gY29uZmlnLndoZXJlKGFsaWFzZWRDb2x1bW5zLCBnZXRPcGVyYXRvcnMoKSlcbiAgICAgICAgICAgICAgICAgICAgOiBjb25maWcud2hlcmU7XG4gICAgICAgICAgICAgICAgd2hlcmUgPSB3aGVyZVNxbCAmJiBtYXBDb2x1bW5zSW5TUUxUb0FsaWFzKHdoZXJlU3FsLCB0YWJsZUFsaWFzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGZpZWxkc1NlbGVjdGlvbiA9IFtdO1xuICAgICAgICAgICAgbGV0IHNlbGVjdGVkQ29sdW1ucyA9IFtdO1xuICAgICAgICAgICAgLy8gRmlndXJlIG91dCB3aGljaCBjb2x1bW5zIHRvIHNlbGVjdFxuICAgICAgICAgICAgaWYgKGNvbmZpZy5jb2x1bW5zKSB7XG4gICAgICAgICAgICAgICAgbGV0IGlzSW5jbHVkZU1vZGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IFtmaWVsZCwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGNvbmZpZy5jb2x1bW5zKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpZWxkIGluIHRhYmxlQ29uZmlnLmNvbHVtbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaXNJbmNsdWRlTW9kZSAmJiB2YWx1ZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzSW5jbHVkZU1vZGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRDb2x1bW5zLnB1c2goZmllbGQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZENvbHVtbnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZENvbHVtbnMgPSBpc0luY2x1ZGVNb2RlXG4gICAgICAgICAgICAgICAgICAgICAgICA/IHNlbGVjdGVkQ29sdW1ucy5maWx0ZXIoKGMpID0+IGNvbmZpZy5jb2x1bW5zPy5bY10gPT09IHRydWUpXG4gICAgICAgICAgICAgICAgICAgICAgICA6IE9iamVjdC5rZXlzKHRhYmxlQ29uZmlnLmNvbHVtbnMpLmZpbHRlcigoa2V5KSA9PiAhc2VsZWN0ZWRDb2x1bW5zLmluY2x1ZGVzKGtleSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIFNlbGVjdCBhbGwgY29sdW1ucyBpZiBzZWxlY3Rpb24gaXMgbm90IHNwZWNpZmllZFxuICAgICAgICAgICAgICAgIHNlbGVjdGVkQ29sdW1ucyA9IE9iamVjdC5rZXlzKHRhYmxlQ29uZmlnLmNvbHVtbnMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yIChjb25zdCBmaWVsZCBvZiBzZWxlY3RlZENvbHVtbnMpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjb2x1bW4gPSB0YWJsZUNvbmZpZy5jb2x1bW5zW2ZpZWxkXTtcbiAgICAgICAgICAgICAgICBmaWVsZHNTZWxlY3Rpb24ucHVzaCh7IHRzS2V5OiBmaWVsZCwgdmFsdWU6IGNvbHVtbiB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCBzZWxlY3RlZFJlbGF0aW9ucyA9IFtdO1xuICAgICAgICAgICAgLy8gRmlndXJlIG91dCB3aGljaCByZWxhdGlvbnMgdG8gc2VsZWN0XG4gICAgICAgICAgICBpZiAoY29uZmlnLndpdGgpIHtcbiAgICAgICAgICAgICAgICBzZWxlY3RlZFJlbGF0aW9ucyA9IE9iamVjdC5lbnRyaWVzKGNvbmZpZy53aXRoKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKChlbnRyeSkgPT4gISFlbnRyeVsxXSlcbiAgICAgICAgICAgICAgICAgICAgLm1hcCgoW3RzS2V5LCBxdWVyeUNvbmZpZ10pID0+ICh7IHRzS2V5LCBxdWVyeUNvbmZpZywgcmVsYXRpb246IHRhYmxlQ29uZmlnLnJlbGF0aW9uc1t0c0tleV0gfSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IGV4dHJhcztcbiAgICAgICAgICAgIC8vIEZpZ3VyZSBvdXQgd2hpY2ggZXh0cmFzIHRvIHNlbGVjdFxuICAgICAgICAgICAgaWYgKGNvbmZpZy5leHRyYXMpIHtcbiAgICAgICAgICAgICAgICBleHRyYXMgPSB0eXBlb2YgY29uZmlnLmV4dHJhcyA9PT0gJ2Z1bmN0aW9uJ1xuICAgICAgICAgICAgICAgICAgICA/IGNvbmZpZy5leHRyYXMoYWxpYXNlZENvbHVtbnMsIHsgc3FsIH0pXG4gICAgICAgICAgICAgICAgICAgIDogY29uZmlnLmV4dHJhcztcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IFt0c0tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGV4dHJhcykpIHtcbiAgICAgICAgICAgICAgICAgICAgZmllbGRzU2VsZWN0aW9uLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgdHNLZXksXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogbWFwQ29sdW1uc0luQWxpYXNlZFNRTFRvQWxpYXModmFsdWUsIHRhYmxlQWxpYXMpLFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBUcmFuc2Zvcm0gYGZpZWxkc1NlbGVjdGlvbmAgaW50byBgc2VsZWN0aW9uYFxuICAgICAgICAgICAgLy8gYGZpZWxkc1NlbGVjdGlvbmAgc2hvdWxkbid0IGJlIHVzZWQgYWZ0ZXIgdGhpcyBwb2ludFxuICAgICAgICAgICAgZm9yIChjb25zdCB7IHRzS2V5LCB2YWx1ZSB9IG9mIGZpZWxkc1NlbGVjdGlvbikge1xuICAgICAgICAgICAgICAgIHNlbGVjdGlvbi5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgZGJLZXk6IGlzKHZhbHVlLCBTUUwuQWxpYXNlZCkgPyB2YWx1ZS5maWVsZEFsaWFzIDogdGFibGVDb25maWcuY29sdW1uc1t0c0tleV0ubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgdHNLZXksXG4gICAgICAgICAgICAgICAgICAgIGZpZWxkOiBpcyh2YWx1ZSwgQ29sdW1uKSA/IGFsaWFzZWRUYWJsZUNvbHVtbih2YWx1ZSwgdGFibGVBbGlhcykgOiB2YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgcmVsYXRpb25UYWJsZVRzS2V5OiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIGlzSnNvbjogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGlvbjogW10sXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgb3JkZXJCeU9yaWcgPSB0eXBlb2YgY29uZmlnLm9yZGVyQnkgPT09ICdmdW5jdGlvbidcbiAgICAgICAgICAgICAgICA/IGNvbmZpZy5vcmRlckJ5KGFsaWFzZWRDb2x1bW5zLCBnZXRPcmRlckJ5T3BlcmF0b3JzKCkpXG4gICAgICAgICAgICAgICAgOiBjb25maWcub3JkZXJCeSA/PyBbXTtcbiAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShvcmRlckJ5T3JpZykpIHtcbiAgICAgICAgICAgICAgICBvcmRlckJ5T3JpZyA9IFtvcmRlckJ5T3JpZ107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBvcmRlckJ5ID0gb3JkZXJCeU9yaWcubWFwKChvcmRlckJ5VmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoaXMob3JkZXJCeVZhbHVlLCBDb2x1bW4pKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhbGlhc2VkVGFibGVDb2x1bW4ob3JkZXJCeVZhbHVlLCB0YWJsZUFsaWFzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1hcENvbHVtbnNJblNRTFRvQWxpYXMob3JkZXJCeVZhbHVlLCB0YWJsZUFsaWFzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgbGltaXQgPSBjb25maWcubGltaXQ7XG4gICAgICAgICAgICBvZmZzZXQgPSBjb25maWcub2Zmc2V0O1xuICAgICAgICAgICAgLy8gUHJvY2VzcyBhbGwgcmVsYXRpb25zXG4gICAgICAgICAgICBmb3IgKGNvbnN0IHsgdHNLZXk6IHNlbGVjdGVkUmVsYXRpb25Uc0tleSwgcXVlcnlDb25maWc6IHNlbGVjdGVkUmVsYXRpb25Db25maWdWYWx1ZSwgcmVsYXRpb24sIH0gb2Ygc2VsZWN0ZWRSZWxhdGlvbnMpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBub3JtYWxpemVkUmVsYXRpb24gPSBub3JtYWxpemVSZWxhdGlvbihzY2hlbWEsIHRhYmxlTmFtZXNNYXAsIHJlbGF0aW9uKTtcbiAgICAgICAgICAgICAgICBjb25zdCByZWxhdGlvblRhYmxlTmFtZSA9IHJlbGF0aW9uLnJlZmVyZW5jZWRUYWJsZVtUYWJsZS5TeW1ib2wuTmFtZV07XG4gICAgICAgICAgICAgICAgY29uc3QgcmVsYXRpb25UYWJsZVRzTmFtZSA9IHRhYmxlTmFtZXNNYXBbcmVsYXRpb25UYWJsZU5hbWVdO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlbGF0aW9uVGFibGVBbGlhcyA9IGAke3RhYmxlQWxpYXN9XyR7c2VsZWN0ZWRSZWxhdGlvblRzS2V5fWA7XG4gICAgICAgICAgICAgICAgY29uc3Qgam9pbk9uID0gYW5kKC4uLm5vcm1hbGl6ZWRSZWxhdGlvbi5maWVsZHMubWFwKChmaWVsZCwgaSkgPT4gZXEoYWxpYXNlZFRhYmxlQ29sdW1uKG5vcm1hbGl6ZWRSZWxhdGlvbi5yZWZlcmVuY2VzW2ldLCByZWxhdGlvblRhYmxlQWxpYXMpLCBhbGlhc2VkVGFibGVDb2x1bW4oZmllbGQsIHRhYmxlQWxpYXMpKSkpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGJ1aWx0UmVsYXRpb24gPSB0aGlzLmJ1aWxkUmVsYXRpb25hbFF1ZXJ5V2l0aG91dExhdGVyYWxTdWJxdWVyaWVzKHtcbiAgICAgICAgICAgICAgICAgICAgZnVsbFNjaGVtYSxcbiAgICAgICAgICAgICAgICAgICAgc2NoZW1hLFxuICAgICAgICAgICAgICAgICAgICB0YWJsZU5hbWVzTWFwLFxuICAgICAgICAgICAgICAgICAgICB0YWJsZTogZnVsbFNjaGVtYVtyZWxhdGlvblRhYmxlVHNOYW1lXSxcbiAgICAgICAgICAgICAgICAgICAgdGFibGVDb25maWc6IHNjaGVtYVtyZWxhdGlvblRhYmxlVHNOYW1lXSxcbiAgICAgICAgICAgICAgICAgICAgcXVlcnlDb25maWc6IGlzKHJlbGF0aW9uLCBPbmUpXG4gICAgICAgICAgICAgICAgICAgICAgICA/IChzZWxlY3RlZFJlbGF0aW9uQ29uZmlnVmFsdWUgPT09IHRydWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IHsgbGltaXQ6IDEgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogeyAuLi5zZWxlY3RlZFJlbGF0aW9uQ29uZmlnVmFsdWUsIGxpbWl0OiAxIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICA6IHNlbGVjdGVkUmVsYXRpb25Db25maWdWYWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgdGFibGVBbGlhczogcmVsYXRpb25UYWJsZUFsaWFzLFxuICAgICAgICAgICAgICAgICAgICBqb2luT24sXG4gICAgICAgICAgICAgICAgICAgIG5lc3RlZFF1ZXJ5UmVsYXRpb246IHJlbGF0aW9uLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGxldCBmaWVsZFNxbCA9IHNxbCBgKCR7YnVpbHRSZWxhdGlvbi5zcWx9KWA7XG4gICAgICAgICAgICAgICAgaWYgKGlzKHJlbGF0aW9uLCBNYW55KSkge1xuICAgICAgICAgICAgICAgICAgICBmaWVsZFNxbCA9IHNxbCBgY29hbGVzY2UoJHtmaWVsZFNxbH0sIGpzb25fYXJyYXkoKSlgO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCBmaWVsZCA9IGZpZWxkU3FsLmFzKHNlbGVjdGVkUmVsYXRpb25Uc0tleSk7XG4gICAgICAgICAgICAgICAgc2VsZWN0aW9uLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBkYktleTogc2VsZWN0ZWRSZWxhdGlvblRzS2V5LFxuICAgICAgICAgICAgICAgICAgICB0c0tleTogc2VsZWN0ZWRSZWxhdGlvblRzS2V5LFxuICAgICAgICAgICAgICAgICAgICBmaWVsZCxcbiAgICAgICAgICAgICAgICAgICAgcmVsYXRpb25UYWJsZVRzS2V5OiByZWxhdGlvblRhYmxlVHNOYW1lLFxuICAgICAgICAgICAgICAgICAgICBpc0pzb246IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGlvbjogYnVpbHRSZWxhdGlvbi5zZWxlY3Rpb24sXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNlbGVjdGlvbi5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBEcml6emxlRXJyb3IoYE5vIGZpZWxkcyBzZWxlY3RlZCBmb3IgdGFibGUgXCIke3RhYmxlQ29uZmlnLnRzTmFtZX1cIiAoXCIke3RhYmxlQWxpYXN9XCIpLiBZb3UgbmVlZCB0byBoYXZlIGF0IGxlYXN0IG9uZSBpdGVtIGluIFwiY29sdW1uc1wiLCBcIndpdGhcIiBvciBcImV4dHJhc1wiLiBJZiB5b3UgbmVlZCB0byBzZWxlY3QgYWxsIGNvbHVtbnMsIG9taXQgdGhlIFwiY29sdW1uc1wiIGtleSBvciBzZXQgaXQgdG8gdW5kZWZpbmVkLmApO1xuICAgICAgICB9XG4gICAgICAgIGxldCByZXN1bHQ7XG4gICAgICAgIHdoZXJlID0gYW5kKGpvaW5Pbiwgd2hlcmUpO1xuICAgICAgICBpZiAobmVzdGVkUXVlcnlSZWxhdGlvbikge1xuICAgICAgICAgICAgbGV0IGZpZWxkID0gc3FsIGBqc29uX2FycmF5KCR7c3FsLmpvaW4oc2VsZWN0aW9uLm1hcCgoeyBmaWVsZCB9KSA9PiBpcyhmaWVsZCwgTXlTcWxDb2x1bW4pID8gc3FsLmlkZW50aWZpZXIoZmllbGQubmFtZSkgOiBpcyhmaWVsZCwgU1FMLkFsaWFzZWQpID8gZmllbGQuc3FsIDogZmllbGQpLCBzcWwgYCwgYCl9KWA7XG4gICAgICAgICAgICBpZiAoaXMobmVzdGVkUXVlcnlSZWxhdGlvbiwgTWFueSkpIHtcbiAgICAgICAgICAgICAgICBmaWVsZCA9IHNxbCBganNvbl9hcnJheWFnZygke2ZpZWxkfSlgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgbmVzdGVkU2VsZWN0aW9uID0gW3tcbiAgICAgICAgICAgICAgICAgICAgZGJLZXk6ICdkYXRhJyxcbiAgICAgICAgICAgICAgICAgICAgdHNLZXk6ICdkYXRhJyxcbiAgICAgICAgICAgICAgICAgICAgZmllbGQsXG4gICAgICAgICAgICAgICAgICAgIGlzSnNvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgcmVsYXRpb25UYWJsZVRzS2V5OiB0YWJsZUNvbmZpZy50c05hbWUsXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGlvbixcbiAgICAgICAgICAgICAgICB9XTtcbiAgICAgICAgICAgIGNvbnN0IG5lZWRzU3VicXVlcnkgPSBsaW1pdCAhPT0gdW5kZWZpbmVkIHx8IG9mZnNldCAhPT0gdW5kZWZpbmVkIHx8IG9yZGVyQnkubGVuZ3RoID4gMDtcbiAgICAgICAgICAgIGlmIChuZWVkc1N1YnF1ZXJ5KSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gdGhpcy5idWlsZFNlbGVjdFF1ZXJ5KHtcbiAgICAgICAgICAgICAgICAgICAgdGFibGU6IGFsaWFzZWRUYWJsZSh0YWJsZSwgdGFibGVBbGlhcyksXG4gICAgICAgICAgICAgICAgICAgIGZpZWxkczoge30sXG4gICAgICAgICAgICAgICAgICAgIGZpZWxkc0ZsYXQ6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWVsZDogc3FsLnJhdygnKicpLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLihvcmRlckJ5Lmxlbmd0aCA+IDApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBbe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogW10sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWVsZDogc3FsIGByb3dfbnVtYmVyKCkgb3ZlciAob3JkZXIgYnkgJHtzcWwuam9pbihvcmRlckJ5LCBzcWwgYCwgYCl9KWAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1dXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgd2hlcmUsXG4gICAgICAgICAgICAgICAgICAgIGxpbWl0LFxuICAgICAgICAgICAgICAgICAgICBvZmZzZXQsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgd2hlcmUgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgbGltaXQgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgb2Zmc2V0ID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIG9yZGVyQnkgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBhbGlhc2VkVGFibGUodGFibGUsIHRhYmxlQWxpYXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmVzdWx0ID0gdGhpcy5idWlsZFNlbGVjdFF1ZXJ5KHtcbiAgICAgICAgICAgICAgICB0YWJsZTogaXMocmVzdWx0LCBNeVNxbFRhYmxlKSA/IHJlc3VsdCA6IG5ldyBTdWJxdWVyeShyZXN1bHQsIHt9LCB0YWJsZUFsaWFzKSxcbiAgICAgICAgICAgICAgICBmaWVsZHM6IHt9LFxuICAgICAgICAgICAgICAgIGZpZWxkc0ZsYXQ6IG5lc3RlZFNlbGVjdGlvbi5tYXAoKHsgZmllbGQgfSkgPT4gKHtcbiAgICAgICAgICAgICAgICAgICAgcGF0aDogW10sXG4gICAgICAgICAgICAgICAgICAgIGZpZWxkOiBpcyhmaWVsZCwgQ29sdW1uKSA/IGFsaWFzZWRUYWJsZUNvbHVtbihmaWVsZCwgdGFibGVBbGlhcykgOiBmaWVsZCxcbiAgICAgICAgICAgICAgICB9KSksXG4gICAgICAgICAgICAgICAgd2hlcmUsXG4gICAgICAgICAgICAgICAgbGltaXQsXG4gICAgICAgICAgICAgICAgb2Zmc2V0LFxuICAgICAgICAgICAgICAgIG9yZGVyQnksXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJlc3VsdCA9IHRoaXMuYnVpbGRTZWxlY3RRdWVyeSh7XG4gICAgICAgICAgICAgICAgdGFibGU6IGFsaWFzZWRUYWJsZSh0YWJsZSwgdGFibGVBbGlhcyksXG4gICAgICAgICAgICAgICAgZmllbGRzOiB7fSxcbiAgICAgICAgICAgICAgICBmaWVsZHNGbGF0OiBzZWxlY3Rpb24ubWFwKCh7IGZpZWxkIH0pID0+ICh7XG4gICAgICAgICAgICAgICAgICAgIHBhdGg6IFtdLFxuICAgICAgICAgICAgICAgICAgICBmaWVsZDogaXMoZmllbGQsIENvbHVtbikgPyBhbGlhc2VkVGFibGVDb2x1bW4oZmllbGQsIHRhYmxlQWxpYXMpIDogZmllbGQsXG4gICAgICAgICAgICAgICAgfSkpLFxuICAgICAgICAgICAgICAgIHdoZXJlLFxuICAgICAgICAgICAgICAgIGxpbWl0LFxuICAgICAgICAgICAgICAgIG9mZnNldCxcbiAgICAgICAgICAgICAgICBvcmRlckJ5LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHRhYmxlVHNLZXk6IHRhYmxlQ29uZmlnLnRzTmFtZSxcbiAgICAgICAgICAgIHNxbDogcmVzdWx0LFxuICAgICAgICAgICAgc2VsZWN0aW9uLFxuICAgICAgICB9O1xuICAgIH1cbn1cblxuY2xhc3MgTXlTcWxTZWxlY3RCdWlsZGVyIHtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ015U3FsU2VsZWN0QnVpbGRlcic7XG4gICAgZmllbGRzO1xuICAgIHNlc3Npb247XG4gICAgZGlhbGVjdDtcbiAgICB3aXRoTGlzdCA9IFtdO1xuICAgIGRpc3RpbmN0O1xuICAgIGNvbnN0cnVjdG9yKGNvbmZpZykge1xuICAgICAgICB0aGlzLmZpZWxkcyA9IGNvbmZpZy5maWVsZHM7XG4gICAgICAgIHRoaXMuc2Vzc2lvbiA9IGNvbmZpZy5zZXNzaW9uO1xuICAgICAgICB0aGlzLmRpYWxlY3QgPSBjb25maWcuZGlhbGVjdDtcbiAgICAgICAgaWYgKGNvbmZpZy53aXRoTGlzdCkge1xuICAgICAgICAgICAgdGhpcy53aXRoTGlzdCA9IGNvbmZpZy53aXRoTGlzdDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmRpc3RpbmN0ID0gY29uZmlnLmRpc3RpbmN0O1xuICAgIH1cbiAgICBmcm9tKHNvdXJjZSkge1xuICAgICAgICBjb25zdCBpc1BhcnRpYWxTZWxlY3QgPSAhIXRoaXMuZmllbGRzO1xuICAgICAgICBsZXQgZmllbGRzO1xuICAgICAgICBpZiAodGhpcy5maWVsZHMpIHtcbiAgICAgICAgICAgIGZpZWxkcyA9IHRoaXMuZmllbGRzO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGlzKHNvdXJjZSwgU3VicXVlcnkpKSB7XG4gICAgICAgICAgICAvLyBUaGlzIGlzIHJlcXVpcmVkIHRvIHVzZSB0aGUgcHJveHkgaGFuZGxlciB0byBnZXQgdGhlIGNvcnJlY3QgZmllbGQgdmFsdWVzIGZyb20gdGhlIHN1YnF1ZXJ5XG4gICAgICAgICAgICBmaWVsZHMgPSBPYmplY3QuZnJvbUVudHJpZXMoT2JqZWN0LmtleXMoc291cmNlW1N1YnF1ZXJ5Q29uZmlnXS5zZWxlY3Rpb24pLm1hcCgoa2V5KSA9PiBba2V5LCBzb3VyY2Vba2V5XV0pKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChpcyhzb3VyY2UsIE15U3FsVmlld0Jhc2UpKSB7XG4gICAgICAgICAgICBmaWVsZHMgPSBzb3VyY2VbVmlld0Jhc2VDb25maWddLnNlbGVjdGVkRmllbGRzO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGlzKHNvdXJjZSwgU1FMKSkge1xuICAgICAgICAgICAgZmllbGRzID0ge307XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBmaWVsZHMgPSBnZXRUYWJsZUNvbHVtbnMoc291cmNlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IE15U3FsU2VsZWN0KHtcbiAgICAgICAgICAgIHRhYmxlOiBzb3VyY2UsXG4gICAgICAgICAgICBmaWVsZHMsXG4gICAgICAgICAgICBpc1BhcnRpYWxTZWxlY3QsXG4gICAgICAgICAgICBzZXNzaW9uOiB0aGlzLnNlc3Npb24sXG4gICAgICAgICAgICBkaWFsZWN0OiB0aGlzLmRpYWxlY3QsXG4gICAgICAgICAgICB3aXRoTGlzdDogdGhpcy53aXRoTGlzdCxcbiAgICAgICAgICAgIGRpc3RpbmN0OiB0aGlzLmRpc3RpbmN0LFxuICAgICAgICB9KTtcbiAgICB9XG59XG5jbGFzcyBNeVNxbFNlbGVjdFF1ZXJ5QnVpbGRlciBleHRlbmRzIFR5cGVkUXVlcnlCdWlsZGVyIHtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ015U3FsU2VsZWN0UXVlcnlCdWlsZGVyJztcbiAgICBfO1xuICAgIGNvbmZpZztcbiAgICBqb2luc05vdE51bGxhYmxlTWFwO1xuICAgIHRhYmxlTmFtZTtcbiAgICBpc1BhcnRpYWxTZWxlY3Q7XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIHNlc3Npb247XG4gICAgZGlhbGVjdDtcbiAgICBjb25zdHJ1Y3Rvcih7IHRhYmxlLCBmaWVsZHMsIGlzUGFydGlhbFNlbGVjdCwgc2Vzc2lvbiwgZGlhbGVjdCwgd2l0aExpc3QsIGRpc3RpbmN0IH0pIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5jb25maWcgPSB7XG4gICAgICAgICAgICB3aXRoTGlzdCxcbiAgICAgICAgICAgIHRhYmxlLFxuICAgICAgICAgICAgZmllbGRzOiB7IC4uLmZpZWxkcyB9LFxuICAgICAgICAgICAgZGlzdGluY3QsXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaXNQYXJ0aWFsU2VsZWN0ID0gaXNQYXJ0aWFsU2VsZWN0O1xuICAgICAgICB0aGlzLnNlc3Npb24gPSBzZXNzaW9uO1xuICAgICAgICB0aGlzLmRpYWxlY3QgPSBkaWFsZWN0O1xuICAgICAgICB0aGlzLl8gPSB7XG4gICAgICAgICAgICBzZWxlY3RlZEZpZWxkczogZmllbGRzLFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLnRhYmxlTmFtZSA9IGdldFRhYmxlTGlrZU5hbWUodGFibGUpO1xuICAgICAgICB0aGlzLmpvaW5zTm90TnVsbGFibGVNYXAgPSB0eXBlb2YgdGhpcy50YWJsZU5hbWUgPT09ICdzdHJpbmcnID8geyBbdGhpcy50YWJsZU5hbWVdOiB0cnVlIH0gOiB7fTtcbiAgICB9XG4gICAgY3JlYXRlSm9pbihqb2luVHlwZSkge1xuICAgICAgICByZXR1cm4gKHRhYmxlLCBvbikgPT4ge1xuICAgICAgICAgICAgY29uc3QgYmFzZVRhYmxlTmFtZSA9IHRoaXMudGFibGVOYW1lO1xuICAgICAgICAgICAgY29uc3QgdGFibGVOYW1lID0gZ2V0VGFibGVMaWtlTmFtZSh0YWJsZSk7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHRhYmxlTmFtZSA9PT0gJ3N0cmluZycgJiYgdGhpcy5jb25maWcuam9pbnM/LnNvbWUoKGpvaW4pID0+IGpvaW4uYWxpYXMgPT09IHRhYmxlTmFtZSkpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEFsaWFzIFwiJHt0YWJsZU5hbWV9XCIgaXMgYWxyZWFkeSB1c2VkIGluIHRoaXMgcXVlcnlgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghdGhpcy5pc1BhcnRpYWxTZWxlY3QpIHtcbiAgICAgICAgICAgICAgICAvLyBJZiB0aGlzIGlzIHRoZSBmaXJzdCBqb2luIGFuZCB0aGlzIGlzIG5vdCBhIHBhcnRpYWwgc2VsZWN0IGFuZCB3ZSdyZSBub3Qgc2VsZWN0aW5nIGZyb20gcmF3IFNRTCwgXCJtb3ZlXCIgdGhlIGZpZWxkcyBmcm9tIHRoZSBtYWluIHRhYmxlIHRvIHRoZSBuZXN0ZWQgb2JqZWN0XG4gICAgICAgICAgICAgICAgaWYgKE9iamVjdC5rZXlzKHRoaXMuam9pbnNOb3ROdWxsYWJsZU1hcCkubGVuZ3RoID09PSAxICYmIHR5cGVvZiBiYXNlVGFibGVOYW1lID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5maWVsZHMgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBbYmFzZVRhYmxlTmFtZV06IHRoaXMuY29uZmlnLmZpZWxkcyxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB0YWJsZU5hbWUgPT09ICdzdHJpbmcnICYmICFpcyh0YWJsZSwgU1FMKSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3Rpb24gPSBpcyh0YWJsZSwgU3VicXVlcnkpXG4gICAgICAgICAgICAgICAgICAgICAgICA/IHRhYmxlW1N1YnF1ZXJ5Q29uZmlnXS5zZWxlY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgICAgIDogaXModGFibGUsIFZpZXcpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPyB0YWJsZVtWaWV3QmFzZUNvbmZpZ10uc2VsZWN0ZWRGaWVsZHNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IHRhYmxlW1RhYmxlLlN5bWJvbC5Db2x1bW5zXTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25maWcuZmllbGRzW3RhYmxlTmFtZV0gPSBzZWxlY3Rpb247XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHR5cGVvZiBvbiA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIG9uID0gb24obmV3IFByb3h5KHRoaXMuY29uZmlnLmZpZWxkcywgbmV3IFNlbGVjdGlvblByb3h5SGFuZGxlcih7IHNxbEFsaWFzZWRCZWhhdmlvcjogJ3NxbCcsIHNxbEJlaGF2aW9yOiAnc3FsJyB9KSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCF0aGlzLmNvbmZpZy5qb2lucykge1xuICAgICAgICAgICAgICAgIHRoaXMuY29uZmlnLmpvaW5zID0gW107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmNvbmZpZy5qb2lucy5wdXNoKHsgb24sIHRhYmxlLCBqb2luVHlwZSwgYWxpYXM6IHRhYmxlTmFtZSB9KTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdGFibGVOYW1lID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIHN3aXRjaCAoam9pblR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnbGVmdCc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuam9pbnNOb3ROdWxsYWJsZU1hcFt0YWJsZU5hbWVdID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjYXNlICdyaWdodCc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuam9pbnNOb3ROdWxsYWJsZU1hcCA9IE9iamVjdC5mcm9tRW50cmllcyhPYmplY3QuZW50cmllcyh0aGlzLmpvaW5zTm90TnVsbGFibGVNYXApLm1hcCgoW2tleV0pID0+IFtrZXksIGZhbHNlXSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5qb2luc05vdE51bGxhYmxlTWFwW3RhYmxlTmFtZV0gPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnaW5uZXInOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmpvaW5zTm90TnVsbGFibGVNYXBbdGFibGVOYW1lXSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjYXNlICdmdWxsJzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5qb2luc05vdE51bGxhYmxlTWFwID0gT2JqZWN0LmZyb21FbnRyaWVzKE9iamVjdC5lbnRyaWVzKHRoaXMuam9pbnNOb3ROdWxsYWJsZU1hcCkubWFwKChba2V5XSkgPT4gW2tleSwgZmFsc2VdKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmpvaW5zTm90TnVsbGFibGVNYXBbdGFibGVOYW1lXSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfTtcbiAgICB9XG4gICAgbGVmdEpvaW4gPSB0aGlzLmNyZWF0ZUpvaW4oJ2xlZnQnKTtcbiAgICByaWdodEpvaW4gPSB0aGlzLmNyZWF0ZUpvaW4oJ3JpZ2h0Jyk7XG4gICAgaW5uZXJKb2luID0gdGhpcy5jcmVhdGVKb2luKCdpbm5lcicpO1xuICAgIGZ1bGxKb2luID0gdGhpcy5jcmVhdGVKb2luKCdmdWxsJyk7XG4gICAgd2hlcmUod2hlcmUpIHtcbiAgICAgICAgaWYgKHR5cGVvZiB3aGVyZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgd2hlcmUgPSB3aGVyZShuZXcgUHJveHkodGhpcy5jb25maWcuZmllbGRzLCBuZXcgU2VsZWN0aW9uUHJveHlIYW5kbGVyKHsgc3FsQWxpYXNlZEJlaGF2aW9yOiAnc3FsJywgc3FsQmVoYXZpb3I6ICdzcWwnIH0pKSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jb25maWcud2hlcmUgPSB3aGVyZTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIGhhdmluZyhoYXZpbmcpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBoYXZpbmcgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIGhhdmluZyA9IGhhdmluZyhuZXcgUHJveHkodGhpcy5jb25maWcuZmllbGRzLCBuZXcgU2VsZWN0aW9uUHJveHlIYW5kbGVyKHsgc3FsQWxpYXNlZEJlaGF2aW9yOiAnc3FsJywgc3FsQmVoYXZpb3I6ICdzcWwnIH0pKSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jb25maWcuaGF2aW5nID0gaGF2aW5nO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgZ3JvdXBCeSguLi5jb2x1bW5zKSB7XG4gICAgICAgIGlmICh0eXBlb2YgY29sdW1uc1swXSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgY29uc3QgZ3JvdXBCeSA9IGNvbHVtbnNbMF0obmV3IFByb3h5KHRoaXMuY29uZmlnLmZpZWxkcywgbmV3IFNlbGVjdGlvblByb3h5SGFuZGxlcih7IHNxbEFsaWFzZWRCZWhhdmlvcjogJ2FsaWFzJywgc3FsQmVoYXZpb3I6ICdzcWwnIH0pKSk7XG4gICAgICAgICAgICB0aGlzLmNvbmZpZy5ncm91cEJ5ID0gQXJyYXkuaXNBcnJheShncm91cEJ5KSA/IGdyb3VwQnkgOiBbZ3JvdXBCeV07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmNvbmZpZy5ncm91cEJ5ID0gY29sdW1ucztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgb3JkZXJCeSguLi5jb2x1bW5zKSB7XG4gICAgICAgIGlmICh0eXBlb2YgY29sdW1uc1swXSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgY29uc3Qgb3JkZXJCeSA9IGNvbHVtbnNbMF0obmV3IFByb3h5KHRoaXMuY29uZmlnLmZpZWxkcywgbmV3IFNlbGVjdGlvblByb3h5SGFuZGxlcih7IHNxbEFsaWFzZWRCZWhhdmlvcjogJ2FsaWFzJywgc3FsQmVoYXZpb3I6ICdzcWwnIH0pKSk7XG4gICAgICAgICAgICB0aGlzLmNvbmZpZy5vcmRlckJ5ID0gQXJyYXkuaXNBcnJheShvcmRlckJ5KSA/IG9yZGVyQnkgOiBbb3JkZXJCeV07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmNvbmZpZy5vcmRlckJ5ID0gY29sdW1ucztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgbGltaXQobGltaXQpIHtcbiAgICAgICAgdGhpcy5jb25maWcubGltaXQgPSBsaW1pdDtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIG9mZnNldChvZmZzZXQpIHtcbiAgICAgICAgdGhpcy5jb25maWcub2Zmc2V0ID0gb2Zmc2V0O1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgZm9yKHN0cmVuZ3RoLCBjb25maWcgPSB7fSkge1xuICAgICAgICB0aGlzLmNvbmZpZy5sb2NraW5nQ2xhdXNlID0geyBzdHJlbmd0aCwgY29uZmlnIH07XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgZ2V0U1FMKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kaWFsZWN0LmJ1aWxkU2VsZWN0UXVlcnkodGhpcy5jb25maWcpO1xuICAgIH1cbiAgICB0b1NRTCgpIHtcbiAgICAgICAgY29uc3QgeyB0eXBpbmdzOiBfdHlwaW5ncywgLi4ucmVzdCB9ID0gdGhpcy5kaWFsZWN0LnNxbFRvUXVlcnkodGhpcy5nZXRTUUwoKSk7XG4gICAgICAgIHJldHVybiByZXN0O1xuICAgIH1cbiAgICBhcyhhbGlhcykge1xuICAgICAgICByZXR1cm4gbmV3IFByb3h5KG5ldyBTdWJxdWVyeSh0aGlzLmdldFNRTCgpLCB0aGlzLmNvbmZpZy5maWVsZHMsIGFsaWFzKSwgbmV3IFNlbGVjdGlvblByb3h5SGFuZGxlcih7IGFsaWFzLCBzcWxBbGlhc2VkQmVoYXZpb3I6ICdhbGlhcycsIHNxbEJlaGF2aW9yOiAnZXJyb3InIH0pKTtcbiAgICB9XG59XG5jbGFzcyBNeVNxbFNlbGVjdCBleHRlbmRzIE15U3FsU2VsZWN0UXVlcnlCdWlsZGVyIHtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ015U3FsU2VsZWN0JztcbiAgICBwcmVwYXJlKCkge1xuICAgICAgICBpZiAoIXRoaXMuc2Vzc2lvbikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgZXhlY3V0ZSBhIHF1ZXJ5IG9uIGEgcXVlcnkgYnVpbGRlci4gUGxlYXNlIHVzZSBhIGRhdGFiYXNlIGluc3RhbmNlIGluc3RlYWQuJyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZmllbGRzTGlzdCA9IG9yZGVyU2VsZWN0ZWRGaWVsZHModGhpcy5jb25maWcuZmllbGRzKTtcbiAgICAgICAgY29uc3QgcXVlcnkgPSB0aGlzLnNlc3Npb24ucHJlcGFyZVF1ZXJ5KHRoaXMuZGlhbGVjdC5zcWxUb1F1ZXJ5KHRoaXMuZ2V0U1FMKCkpLCBmaWVsZHNMaXN0KTtcbiAgICAgICAgcXVlcnkuam9pbnNOb3ROdWxsYWJsZU1hcCA9IHRoaXMuam9pbnNOb3ROdWxsYWJsZU1hcDtcbiAgICAgICAgcmV0dXJuIHF1ZXJ5O1xuICAgIH1cbiAgICBleGVjdXRlID0gKChwbGFjZWhvbGRlclZhbHVlcykgPT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5wcmVwYXJlKCkuZXhlY3V0ZShwbGFjZWhvbGRlclZhbHVlcyk7XG4gICAgfSk7XG4gICAgY3JlYXRlSXRlcmF0b3IgPSAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuICAgICAgICByZXR1cm4gYXN5bmMgZnVuY3Rpb24qIChwbGFjZWhvbGRlclZhbHVlcykge1xuICAgICAgICAgICAgeWllbGQqIHNlbGYucHJlcGFyZSgpLml0ZXJhdG9yKHBsYWNlaG9sZGVyVmFsdWVzKTtcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIGl0ZXJhdG9yID0gdGhpcy5jcmVhdGVJdGVyYXRvcigpO1xufVxuYXBwbHlNaXhpbnMoTXlTcWxTZWxlY3QsIFtRdWVyeVByb21pc2VdKTtcblxuY2xhc3MgUXVlcnlCdWlsZGVyIHtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ015U3FsUXVlcnlCdWlsZGVyJztcbiAgICBkaWFsZWN0O1xuICAgICR3aXRoKGFsaWFzKSB7XG4gICAgICAgIGNvbnN0IHF1ZXJ5QnVpbGRlciA9IHRoaXM7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBhcyhxYikge1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgcWIgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgcWIgPSBxYihxdWVyeUJ1aWxkZXIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb3h5KG5ldyBXaXRoU3VicXVlcnkocWIuZ2V0U1FMKCksIHFiLmdldFNlbGVjdGVkRmllbGRzKCksIGFsaWFzLCB0cnVlKSwgbmV3IFNlbGVjdGlvblByb3h5SGFuZGxlcih7IGFsaWFzLCBzcWxBbGlhc2VkQmVoYXZpb3I6ICdhbGlhcycsIHNxbEJlaGF2aW9yOiAnZXJyb3InIH0pKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH07XG4gICAgfVxuICAgIHdpdGgoLi4ucXVlcmllcykge1xuICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcbiAgICAgICAgZnVuY3Rpb24gc2VsZWN0KGZpZWxkcykge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBNeVNxbFNlbGVjdEJ1aWxkZXIoe1xuICAgICAgICAgICAgICAgIGZpZWxkczogZmllbGRzID8/IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICBzZXNzaW9uOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgZGlhbGVjdDogc2VsZi5nZXREaWFsZWN0KCksXG4gICAgICAgICAgICAgICAgd2l0aExpc3Q6IHF1ZXJpZXMsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBzZWxlY3REaXN0aW5jdChmaWVsZHMpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgTXlTcWxTZWxlY3RCdWlsZGVyKHtcbiAgICAgICAgICAgICAgICBmaWVsZHM6IGZpZWxkcyA/PyB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgc2Vzc2lvbjogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIGRpYWxlY3Q6IHNlbGYuZ2V0RGlhbGVjdCgpLFxuICAgICAgICAgICAgICAgIHdpdGhMaXN0OiBxdWVyaWVzLFxuICAgICAgICAgICAgICAgIGRpc3RpbmN0OiB0cnVlLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc2VsZWN0LCBzZWxlY3REaXN0aW5jdCB9O1xuICAgIH1cbiAgICBzZWxlY3QoZmllbGRzKSB7XG4gICAgICAgIHJldHVybiBuZXcgTXlTcWxTZWxlY3RCdWlsZGVyKHsgZmllbGRzOiBmaWVsZHMgPz8gdW5kZWZpbmVkLCBzZXNzaW9uOiB1bmRlZmluZWQsIGRpYWxlY3Q6IHRoaXMuZ2V0RGlhbGVjdCgpIH0pO1xuICAgIH1cbiAgICBzZWxlY3REaXN0aW5jdChmaWVsZHMpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBNeVNxbFNlbGVjdEJ1aWxkZXIoe1xuICAgICAgICAgICAgZmllbGRzOiBmaWVsZHMgPz8gdW5kZWZpbmVkLFxuICAgICAgICAgICAgc2Vzc2lvbjogdW5kZWZpbmVkLFxuICAgICAgICAgICAgZGlhbGVjdDogdGhpcy5nZXREaWFsZWN0KCksXG4gICAgICAgICAgICBkaXN0aW5jdDogdHJ1ZSxcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8vIExhenkgbG9hZCBkaWFsZWN0IHRvIGF2b2lkIGNpcmN1bGFyIGRlcGVuZGVuY3lcbiAgICBnZXREaWFsZWN0KCkge1xuICAgICAgICBpZiAoIXRoaXMuZGlhbGVjdCkge1xuICAgICAgICAgICAgdGhpcy5kaWFsZWN0ID0gbmV3IE15U3FsRGlhbGVjdCgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLmRpYWxlY3Q7XG4gICAgfVxufVxuXG5jbGFzcyBSZWxhdGlvbmFsUXVlcnlCdWlsZGVyIHtcbiAgICBmdWxsU2NoZW1hO1xuICAgIHNjaGVtYTtcbiAgICB0YWJsZU5hbWVzTWFwO1xuICAgIHRhYmxlO1xuICAgIHRhYmxlQ29uZmlnO1xuICAgIGRpYWxlY3Q7XG4gICAgc2Vzc2lvbjtcbiAgICBtb2RlO1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnTXlTcWxSZWxhdGlvbmFsUXVlcnlCdWlsZGVyJztcbiAgICBjb25zdHJ1Y3RvcihmdWxsU2NoZW1hLCBzY2hlbWEsIHRhYmxlTmFtZXNNYXAsIHRhYmxlLCB0YWJsZUNvbmZpZywgZGlhbGVjdCwgc2Vzc2lvbiwgbW9kZSkge1xuICAgICAgICB0aGlzLmZ1bGxTY2hlbWEgPSBmdWxsU2NoZW1hO1xuICAgICAgICB0aGlzLnNjaGVtYSA9IHNjaGVtYTtcbiAgICAgICAgdGhpcy50YWJsZU5hbWVzTWFwID0gdGFibGVOYW1lc01hcDtcbiAgICAgICAgdGhpcy50YWJsZSA9IHRhYmxlO1xuICAgICAgICB0aGlzLnRhYmxlQ29uZmlnID0gdGFibGVDb25maWc7XG4gICAgICAgIHRoaXMuZGlhbGVjdCA9IGRpYWxlY3Q7XG4gICAgICAgIHRoaXMuc2Vzc2lvbiA9IHNlc3Npb247XG4gICAgICAgIHRoaXMubW9kZSA9IG1vZGU7XG4gICAgfVxuICAgIGZpbmRNYW55KGNvbmZpZykge1xuICAgICAgICByZXR1cm4gbmV3IE15U3FsUmVsYXRpb25hbFF1ZXJ5KHRoaXMuZnVsbFNjaGVtYSwgdGhpcy5zY2hlbWEsIHRoaXMudGFibGVOYW1lc01hcCwgdGhpcy50YWJsZSwgdGhpcy50YWJsZUNvbmZpZywgdGhpcy5kaWFsZWN0LCB0aGlzLnNlc3Npb24sIGNvbmZpZyA/IGNvbmZpZyA6IHt9LCAnbWFueScsIHRoaXMubW9kZSk7XG4gICAgfVxuICAgIGZpbmRGaXJzdChjb25maWcpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBNeVNxbFJlbGF0aW9uYWxRdWVyeSh0aGlzLmZ1bGxTY2hlbWEsIHRoaXMuc2NoZW1hLCB0aGlzLnRhYmxlTmFtZXNNYXAsIHRoaXMudGFibGUsIHRoaXMudGFibGVDb25maWcsIHRoaXMuZGlhbGVjdCwgdGhpcy5zZXNzaW9uLCBjb25maWcgPyB7IC4uLmNvbmZpZywgbGltaXQ6IDEgfSA6IHsgbGltaXQ6IDEgfSwgJ2ZpcnN0JywgdGhpcy5tb2RlKTtcbiAgICB9XG59XG5jbGFzcyBNeVNxbFJlbGF0aW9uYWxRdWVyeSBleHRlbmRzIFF1ZXJ5UHJvbWlzZSB7XG4gICAgZnVsbFNjaGVtYTtcbiAgICBzY2hlbWE7XG4gICAgdGFibGVOYW1lc01hcDtcbiAgICB0YWJsZTtcbiAgICB0YWJsZUNvbmZpZztcbiAgICBkaWFsZWN0O1xuICAgIHNlc3Npb247XG4gICAgY29uZmlnO1xuICAgIHF1ZXJ5TW9kZTtcbiAgICBtb2RlO1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnTXlTcWxSZWxhdGlvbmFsUXVlcnknO1xuICAgIGNvbnN0cnVjdG9yKGZ1bGxTY2hlbWEsIHNjaGVtYSwgdGFibGVOYW1lc01hcCwgdGFibGUsIHRhYmxlQ29uZmlnLCBkaWFsZWN0LCBzZXNzaW9uLCBjb25maWcsIHF1ZXJ5TW9kZSwgbW9kZSkge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLmZ1bGxTY2hlbWEgPSBmdWxsU2NoZW1hO1xuICAgICAgICB0aGlzLnNjaGVtYSA9IHNjaGVtYTtcbiAgICAgICAgdGhpcy50YWJsZU5hbWVzTWFwID0gdGFibGVOYW1lc01hcDtcbiAgICAgICAgdGhpcy50YWJsZSA9IHRhYmxlO1xuICAgICAgICB0aGlzLnRhYmxlQ29uZmlnID0gdGFibGVDb25maWc7XG4gICAgICAgIHRoaXMuZGlhbGVjdCA9IGRpYWxlY3Q7XG4gICAgICAgIHRoaXMuc2Vzc2lvbiA9IHNlc3Npb247XG4gICAgICAgIHRoaXMuY29uZmlnID0gY29uZmlnO1xuICAgICAgICB0aGlzLnF1ZXJ5TW9kZSA9IHF1ZXJ5TW9kZTtcbiAgICAgICAgdGhpcy5tb2RlID0gbW9kZTtcbiAgICB9XG4gICAgcHJlcGFyZSgpIHtcbiAgICAgICAgY29uc3QgeyBxdWVyeSwgYnVpbHRRdWVyeSB9ID0gdGhpcy5fdG9TUUwoKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2Vzc2lvbi5wcmVwYXJlUXVlcnkoYnVpbHRRdWVyeSwgdW5kZWZpbmVkLCAocmF3Um93cykgPT4ge1xuICAgICAgICAgICAgY29uc3Qgcm93cyA9IHJhd1Jvd3MubWFwKChyb3cpID0+IG1hcFJlbGF0aW9uYWxSb3codGhpcy5zY2hlbWEsIHRoaXMudGFibGVDb25maWcsIHJvdywgcXVlcnkuc2VsZWN0aW9uKSk7XG4gICAgICAgICAgICBpZiAodGhpcy5xdWVyeU1vZGUgPT09ICdmaXJzdCcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcm93c1swXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiByb3dzO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgX3RvU1FMKCkge1xuICAgICAgICBjb25zdCBxdWVyeSA9IHRoaXMubW9kZSA9PT0gJ3BsYW5ldHNjYWxlJ1xuICAgICAgICAgICAgPyB0aGlzLmRpYWxlY3QuYnVpbGRSZWxhdGlvbmFsUXVlcnlXaXRob3V0TGF0ZXJhbFN1YnF1ZXJpZXMoe1xuICAgICAgICAgICAgICAgIGZ1bGxTY2hlbWE6IHRoaXMuZnVsbFNjaGVtYSxcbiAgICAgICAgICAgICAgICBzY2hlbWE6IHRoaXMuc2NoZW1hLFxuICAgICAgICAgICAgICAgIHRhYmxlTmFtZXNNYXA6IHRoaXMudGFibGVOYW1lc01hcCxcbiAgICAgICAgICAgICAgICB0YWJsZTogdGhpcy50YWJsZSxcbiAgICAgICAgICAgICAgICB0YWJsZUNvbmZpZzogdGhpcy50YWJsZUNvbmZpZyxcbiAgICAgICAgICAgICAgICBxdWVyeUNvbmZpZzogdGhpcy5jb25maWcsXG4gICAgICAgICAgICAgICAgdGFibGVBbGlhczogdGhpcy50YWJsZUNvbmZpZy50c05hbWUsXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgOiB0aGlzLmRpYWxlY3QuYnVpbGRSZWxhdGlvbmFsUXVlcnkoe1xuICAgICAgICAgICAgICAgIGZ1bGxTY2hlbWE6IHRoaXMuZnVsbFNjaGVtYSxcbiAgICAgICAgICAgICAgICBzY2hlbWE6IHRoaXMuc2NoZW1hLFxuICAgICAgICAgICAgICAgIHRhYmxlTmFtZXNNYXA6IHRoaXMudGFibGVOYW1lc01hcCxcbiAgICAgICAgICAgICAgICB0YWJsZTogdGhpcy50YWJsZSxcbiAgICAgICAgICAgICAgICB0YWJsZUNvbmZpZzogdGhpcy50YWJsZUNvbmZpZyxcbiAgICAgICAgICAgICAgICBxdWVyeUNvbmZpZzogdGhpcy5jb25maWcsXG4gICAgICAgICAgICAgICAgdGFibGVBbGlhczogdGhpcy50YWJsZUNvbmZpZy50c05hbWUsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgYnVpbHRRdWVyeSA9IHRoaXMuZGlhbGVjdC5zcWxUb1F1ZXJ5KHF1ZXJ5LnNxbCk7XG4gICAgICAgIHJldHVybiB7IGJ1aWx0UXVlcnksIHF1ZXJ5IH07XG4gICAgfVxuICAgIHRvU1FMKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fdG9TUUwoKS5idWlsdFF1ZXJ5O1xuICAgIH1cbiAgICBleGVjdXRlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wcmVwYXJlKCkuZXhlY3V0ZSgpO1xuICAgIH1cbn1cblxuY2xhc3MgTXlTcWxEYXRhYmFzZSB7XG4gICAgZGlhbGVjdDtcbiAgICBzZXNzaW9uO1xuICAgIG1vZGU7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdNeVNxbERhdGFiYXNlJztcbiAgICBxdWVyeTtcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAvKiogQGludGVybmFsICovXG4gICAgZGlhbGVjdCwgXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIHNlc3Npb24sIHNjaGVtYSwgbW9kZSkge1xuICAgICAgICB0aGlzLmRpYWxlY3QgPSBkaWFsZWN0O1xuICAgICAgICB0aGlzLnNlc3Npb24gPSBzZXNzaW9uO1xuICAgICAgICB0aGlzLm1vZGUgPSBtb2RlO1xuICAgICAgICB0aGlzLl8gPSBzY2hlbWFcbiAgICAgICAgICAgID8geyBzY2hlbWE6IHNjaGVtYS5zY2hlbWEsIHRhYmxlTmFtZXNNYXA6IHNjaGVtYS50YWJsZU5hbWVzTWFwIH1cbiAgICAgICAgICAgIDogeyBzY2hlbWE6IHVuZGVmaW5lZCwgdGFibGVOYW1lc01hcDoge30gfTtcbiAgICAgICAgdGhpcy5xdWVyeSA9IHt9O1xuICAgICAgICBpZiAodGhpcy5fLnNjaGVtYSkge1xuICAgICAgICAgICAgZm9yIChjb25zdCBbdGFibGVOYW1lLCBjb2x1bW5zXSBvZiBPYmplY3QuZW50cmllcyh0aGlzLl8uc2NoZW1hKSkge1xuICAgICAgICAgICAgICAgIHRoaXMucXVlcnlbdGFibGVOYW1lXSA9XG4gICAgICAgICAgICAgICAgICAgIG5ldyBSZWxhdGlvbmFsUXVlcnlCdWlsZGVyKHNjaGVtYS5mdWxsU2NoZW1hLCB0aGlzLl8uc2NoZW1hLCB0aGlzLl8udGFibGVOYW1lc01hcCwgc2NoZW1hLmZ1bGxTY2hlbWFbdGFibGVOYW1lXSwgY29sdW1ucywgZGlhbGVjdCwgc2Vzc2lvbiwgdGhpcy5tb2RlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAkd2l0aChhbGlhcykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgYXMocWIpIHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHFiID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgIHFiID0gcWIobmV3IFF1ZXJ5QnVpbGRlcigpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm94eShuZXcgV2l0aFN1YnF1ZXJ5KHFiLmdldFNRTCgpLCBxYi5nZXRTZWxlY3RlZEZpZWxkcygpLCBhbGlhcywgdHJ1ZSksIG5ldyBTZWxlY3Rpb25Qcm94eUhhbmRsZXIoeyBhbGlhcywgc3FsQWxpYXNlZEJlaGF2aW9yOiAnYWxpYXMnLCBzcWxCZWhhdmlvcjogJ2Vycm9yJyB9KSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9O1xuICAgIH1cbiAgICB3aXRoKC4uLnF1ZXJpZXMpIHtcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgICAgIGZ1bmN0aW9uIHNlbGVjdChmaWVsZHMpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgTXlTcWxTZWxlY3RCdWlsZGVyKHtcbiAgICAgICAgICAgICAgICBmaWVsZHM6IGZpZWxkcyA/PyB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgc2Vzc2lvbjogc2VsZi5zZXNzaW9uLFxuICAgICAgICAgICAgICAgIGRpYWxlY3Q6IHNlbGYuZGlhbGVjdCxcbiAgICAgICAgICAgICAgICB3aXRoTGlzdDogcXVlcmllcyxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIHNlbGVjdERpc3RpbmN0KGZpZWxkcykge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBNeVNxbFNlbGVjdEJ1aWxkZXIoe1xuICAgICAgICAgICAgICAgIGZpZWxkczogZmllbGRzID8/IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICBzZXNzaW9uOiBzZWxmLnNlc3Npb24sXG4gICAgICAgICAgICAgICAgZGlhbGVjdDogc2VsZi5kaWFsZWN0LFxuICAgICAgICAgICAgICAgIHdpdGhMaXN0OiBxdWVyaWVzLFxuICAgICAgICAgICAgICAgIGRpc3RpbmN0OiB0cnVlLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc2VsZWN0LCBzZWxlY3REaXN0aW5jdCB9O1xuICAgIH1cbiAgICBzZWxlY3QoZmllbGRzKSB7XG4gICAgICAgIHJldHVybiBuZXcgTXlTcWxTZWxlY3RCdWlsZGVyKHsgZmllbGRzOiBmaWVsZHMgPz8gdW5kZWZpbmVkLCBzZXNzaW9uOiB0aGlzLnNlc3Npb24sIGRpYWxlY3Q6IHRoaXMuZGlhbGVjdCB9KTtcbiAgICB9XG4gICAgc2VsZWN0RGlzdGluY3QoZmllbGRzKSB7XG4gICAgICAgIHJldHVybiBuZXcgTXlTcWxTZWxlY3RCdWlsZGVyKHtcbiAgICAgICAgICAgIGZpZWxkczogZmllbGRzID8/IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIHNlc3Npb246IHRoaXMuc2Vzc2lvbixcbiAgICAgICAgICAgIGRpYWxlY3Q6IHRoaXMuZGlhbGVjdCxcbiAgICAgICAgICAgIGRpc3RpbmN0OiB0cnVlLFxuICAgICAgICB9KTtcbiAgICB9XG4gICAgdXBkYXRlKHRhYmxlKSB7XG4gICAgICAgIHJldHVybiBuZXcgTXlTcWxVcGRhdGVCdWlsZGVyKHRhYmxlLCB0aGlzLnNlc3Npb24sIHRoaXMuZGlhbGVjdCk7XG4gICAgfVxuICAgIGluc2VydCh0YWJsZSkge1xuICAgICAgICByZXR1cm4gbmV3IE15U3FsSW5zZXJ0QnVpbGRlcih0YWJsZSwgdGhpcy5zZXNzaW9uLCB0aGlzLmRpYWxlY3QpO1xuICAgIH1cbiAgICBkZWxldGUodGFibGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBNeVNxbERlbGV0ZSh0YWJsZSwgdGhpcy5zZXNzaW9uLCB0aGlzLmRpYWxlY3QpO1xuICAgIH1cbiAgICBleGVjdXRlKHF1ZXJ5KSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlc3Npb24uZXhlY3V0ZShxdWVyeS5nZXRTUUwoKSk7XG4gICAgfVxuICAgIHRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uLCBjb25maWcpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2Vzc2lvbi50cmFuc2FjdGlvbih0cmFuc2FjdGlvbiwgY29uZmlnKTtcbiAgICB9XG59XG5cbmNsYXNzIFByZXBhcmVkUXVlcnkge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnTXlTcWxQcmVwYXJlZFF1ZXJ5JztcbiAgICAvKiogQGludGVybmFsICovXG4gICAgam9pbnNOb3ROdWxsYWJsZU1hcDtcbn1cbmNsYXNzIE15U3FsU2Vzc2lvbiB7XG4gICAgZGlhbGVjdDtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ015U3FsU2Vzc2lvbic7XG4gICAgY29uc3RydWN0b3IoZGlhbGVjdCkge1xuICAgICAgICB0aGlzLmRpYWxlY3QgPSBkaWFsZWN0O1xuICAgIH1cbiAgICBleGVjdXRlKHF1ZXJ5KSB7XG4gICAgICAgIHJldHVybiB0aGlzLnByZXBhcmVRdWVyeSh0aGlzLmRpYWxlY3Quc3FsVG9RdWVyeShxdWVyeSksIHVuZGVmaW5lZCkuZXhlY3V0ZSgpO1xuICAgIH1cbiAgICBnZXRTZXRUcmFuc2FjdGlvblNRTChjb25maWcpIHtcbiAgICAgICAgY29uc3QgcGFydHMgPSBbXTtcbiAgICAgICAgaWYgKGNvbmZpZy5pc29sYXRpb25MZXZlbCkge1xuICAgICAgICAgICAgcGFydHMucHVzaChgaXNvbGF0aW9uIGxldmVsICR7Y29uZmlnLmlzb2xhdGlvbkxldmVsfWApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwYXJ0cy5sZW5ndGggPyBzcWwuam9pbihbJ3NldCB0cmFuc2FjdGlvbiAnLCBwYXJ0cy5qb2luKCcgJyldKSA6IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgZ2V0U3RhcnRUcmFuc2FjdGlvblNRTChjb25maWcpIHtcbiAgICAgICAgY29uc3QgcGFydHMgPSBbXTtcbiAgICAgICAgaWYgKGNvbmZpZy53aXRoQ29uc2lzdGVudFNuYXBzaG90KSB7XG4gICAgICAgICAgICBwYXJ0cy5wdXNoKCd3aXRoIGNvbnNpc3RlbnQgc25hcHNob3QnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29uZmlnLmFjY2Vzc01vZGUpIHtcbiAgICAgICAgICAgIHBhcnRzLnB1c2goY29uZmlnLmFjY2Vzc01vZGUpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwYXJ0cy5sZW5ndGggPyBzcWwuam9pbihbJ3N0YXJ0IHRyYW5zYWN0aW9uICcsIHBhcnRzLmpvaW4oJyAnKV0pIDogdW5kZWZpbmVkO1xuICAgIH1cbn1cbmNsYXNzIE15U3FsVHJhbnNhY3Rpb24gZXh0ZW5kcyBNeVNxbERhdGFiYXNlIHtcbiAgICBzY2hlbWE7XG4gICAgbmVzdGVkSW5kZXg7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdNeVNxbFRyYW5zYWN0aW9uJztcbiAgICBjb25zdHJ1Y3RvcihkaWFsZWN0LCBzZXNzaW9uLCBzY2hlbWEsIG5lc3RlZEluZGV4LCBtb2RlKSB7XG4gICAgICAgIHN1cGVyKGRpYWxlY3QsIHNlc3Npb24sIHNjaGVtYSwgbW9kZSk7XG4gICAgICAgIHRoaXMuc2NoZW1hID0gc2NoZW1hO1xuICAgICAgICB0aGlzLm5lc3RlZEluZGV4ID0gbmVzdGVkSW5kZXg7XG4gICAgfVxuICAgIHJvbGxiYWNrKCkge1xuICAgICAgICB0aHJvdyBuZXcgVHJhbnNhY3Rpb25Sb2xsYmFja0Vycm9yKCk7XG4gICAgfVxufVxuXG5jbGFzcyBNeVNxbFVwZGF0ZUJ1aWxkZXIge1xuICAgIHRhYmxlO1xuICAgIHNlc3Npb247XG4gICAgZGlhbGVjdDtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ015U3FsVXBkYXRlQnVpbGRlcic7XG4gICAgY29uc3RydWN0b3IodGFibGUsIHNlc3Npb24sIGRpYWxlY3QpIHtcbiAgICAgICAgdGhpcy50YWJsZSA9IHRhYmxlO1xuICAgICAgICB0aGlzLnNlc3Npb24gPSBzZXNzaW9uO1xuICAgICAgICB0aGlzLmRpYWxlY3QgPSBkaWFsZWN0O1xuICAgIH1cbiAgICBzZXQodmFsdWVzKSB7XG4gICAgICAgIHJldHVybiBuZXcgTXlTcWxVcGRhdGUodGhpcy50YWJsZSwgbWFwVXBkYXRlU2V0KHRoaXMudGFibGUsIHZhbHVlcyksIHRoaXMuc2Vzc2lvbiwgdGhpcy5kaWFsZWN0KTtcbiAgICB9XG59XG5jbGFzcyBNeVNxbFVwZGF0ZSBleHRlbmRzIFF1ZXJ5UHJvbWlzZSB7XG4gICAgc2Vzc2lvbjtcbiAgICBkaWFsZWN0O1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnTXlTcWxVcGRhdGUnO1xuICAgIGNvbmZpZztcbiAgICBjb25zdHJ1Y3Rvcih0YWJsZSwgc2V0LCBzZXNzaW9uLCBkaWFsZWN0KSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMuc2Vzc2lvbiA9IHNlc3Npb247XG4gICAgICAgIHRoaXMuZGlhbGVjdCA9IGRpYWxlY3Q7XG4gICAgICAgIHRoaXMuY29uZmlnID0geyBzZXQsIHRhYmxlIH07XG4gICAgfVxuICAgIHdoZXJlKHdoZXJlKSB7XG4gICAgICAgIHRoaXMuY29uZmlnLndoZXJlID0gd2hlcmU7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgZ2V0U1FMKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kaWFsZWN0LmJ1aWxkVXBkYXRlUXVlcnkodGhpcy5jb25maWcpO1xuICAgIH1cbiAgICB0b1NRTCgpIHtcbiAgICAgICAgY29uc3QgeyB0eXBpbmdzOiBfdHlwaW5ncywgLi4ucmVzdCB9ID0gdGhpcy5kaWFsZWN0LnNxbFRvUXVlcnkodGhpcy5nZXRTUUwoKSk7XG4gICAgICAgIHJldHVybiByZXN0O1xuICAgIH1cbiAgICBwcmVwYXJlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zZXNzaW9uLnByZXBhcmVRdWVyeSh0aGlzLmRpYWxlY3Quc3FsVG9RdWVyeSh0aGlzLmdldFNRTCgpKSwgdGhpcy5jb25maWcucmV0dXJuaW5nKTtcbiAgICB9XG4gICAgZXhlY3V0ZSA9IChwbGFjZWhvbGRlclZhbHVlcykgPT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5wcmVwYXJlKCkuZXhlY3V0ZShwbGFjZWhvbGRlclZhbHVlcyk7XG4gICAgfTtcbiAgICBjcmVhdGVJdGVyYXRvciA9ICgpID0+IHtcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgICAgIHJldHVybiBhc3luYyBmdW5jdGlvbiogKHBsYWNlaG9sZGVyVmFsdWVzKSB7XG4gICAgICAgICAgICB5aWVsZCogc2VsZi5wcmVwYXJlKCkuaXRlcmF0b3IocGxhY2Vob2xkZXJWYWx1ZXMpO1xuICAgICAgICB9O1xuICAgIH07XG4gICAgaXRlcmF0b3IgPSB0aGlzLmNyZWF0ZUl0ZXJhdG9yKCk7XG59XG5cbmNsYXNzIFZpZXdCdWlsZGVyQ29yZSB7XG4gICAgbmFtZTtcbiAgICBzY2hlbWE7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdNeVNxbFZpZXdCdWlsZGVyJztcbiAgICBjb25zdHJ1Y3RvcihuYW1lLCBzY2hlbWEpIHtcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgdGhpcy5zY2hlbWEgPSBzY2hlbWE7XG4gICAgfVxuICAgIGNvbmZpZyA9IHt9O1xuICAgIGFsZ29yaXRobShhbGdvcml0aG0pIHtcbiAgICAgICAgdGhpcy5jb25maWcuYWxnb3JpdGhtID0gYWxnb3JpdGhtO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgZGVmaW5lcihkZWZpbmVyKSB7XG4gICAgICAgIHRoaXMuY29uZmlnLmRlZmluZXIgPSBkZWZpbmVyO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgc3FsU2VjdXJpdHkoc3FsU2VjdXJpdHkpIHtcbiAgICAgICAgdGhpcy5jb25maWcuc3FsU2VjdXJpdHkgPSBzcWxTZWN1cml0eTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIHdpdGhDaGVja09wdGlvbih3aXRoQ2hlY2tPcHRpb24pIHtcbiAgICAgICAgdGhpcy5jb25maWcud2l0aENoZWNrT3B0aW9uID0gd2l0aENoZWNrT3B0aW9uID8/ICdjYXNjYWRlZCc7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbn1cbmNsYXNzIFZpZXdCdWlsZGVyIGV4dGVuZHMgVmlld0J1aWxkZXJDb3JlIHtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ015U3FsVmlld0J1aWxkZXInO1xuICAgIGFzKHFiKSB7XG4gICAgICAgIGlmICh0eXBlb2YgcWIgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIHFiID0gcWIobmV3IFF1ZXJ5QnVpbGRlcigpKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzZWxlY3Rpb25Qcm94eSA9IG5ldyBTZWxlY3Rpb25Qcm94eUhhbmRsZXIoe1xuICAgICAgICAgICAgYWxpYXM6IHRoaXMubmFtZSxcbiAgICAgICAgICAgIHNxbEJlaGF2aW9yOiAnZXJyb3InLFxuICAgICAgICAgICAgc3FsQWxpYXNlZEJlaGF2aW9yOiAnYWxpYXMnLFxuICAgICAgICAgICAgcmVwbGFjZU9yaWdpbmFsTmFtZTogdHJ1ZSxcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IGFsaWFzZWRTZWxlY3Rpb24gPSBuZXcgUHJveHkocWIuZ2V0U2VsZWN0ZWRGaWVsZHMoKSwgc2VsZWN0aW9uUHJveHkpO1xuICAgICAgICByZXR1cm4gbmV3IFByb3h5KG5ldyBNeVNxbFZpZXcoe1xuICAgICAgICAgICAgbXlzcWxDb25maWc6IHRoaXMuY29uZmlnLFxuICAgICAgICAgICAgY29uZmlnOiB7XG4gICAgICAgICAgICAgICAgbmFtZTogdGhpcy5uYW1lLFxuICAgICAgICAgICAgICAgIHNjaGVtYTogdGhpcy5zY2hlbWEsXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRGaWVsZHM6IGFsaWFzZWRTZWxlY3Rpb24sXG4gICAgICAgICAgICAgICAgcXVlcnk6IHFiLmdldFNRTCgpLmlubGluZVBhcmFtcygpLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSksIHNlbGVjdGlvblByb3h5KTtcbiAgICB9XG59XG5jbGFzcyBNYW51YWxWaWV3QnVpbGRlciBleHRlbmRzIFZpZXdCdWlsZGVyQ29yZSB7XG4gICAgc3RhdGljIFtlbnRpdHlLaW5kXSA9ICdNeVNxbE1hbnVhbFZpZXdCdWlsZGVyJztcbiAgICBjb2x1bW5zO1xuICAgIGNvbnN0cnVjdG9yKG5hbWUsIGNvbHVtbnMsIHNjaGVtYSkge1xuICAgICAgICBzdXBlcihuYW1lLCBzY2hlbWEpO1xuICAgICAgICB0aGlzLmNvbHVtbnMgPSBnZXRUYWJsZUNvbHVtbnMobXlzcWxUYWJsZShuYW1lLCBjb2x1bW5zKSk7XG4gICAgfVxuICAgIGV4aXN0aW5nKCkge1xuICAgICAgICByZXR1cm4gbmV3IFByb3h5KG5ldyBNeVNxbFZpZXcoe1xuICAgICAgICAgICAgbXlzcWxDb25maWc6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIGNvbmZpZzoge1xuICAgICAgICAgICAgICAgIG5hbWU6IHRoaXMubmFtZSxcbiAgICAgICAgICAgICAgICBzY2hlbWE6IHRoaXMuc2NoZW1hLFxuICAgICAgICAgICAgICAgIHNlbGVjdGVkRmllbGRzOiB0aGlzLmNvbHVtbnMsXG4gICAgICAgICAgICAgICAgcXVlcnk6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pLCBuZXcgU2VsZWN0aW9uUHJveHlIYW5kbGVyKHtcbiAgICAgICAgICAgIGFsaWFzOiB0aGlzLm5hbWUsXG4gICAgICAgICAgICBzcWxCZWhhdmlvcjogJ2Vycm9yJyxcbiAgICAgICAgICAgIHNxbEFsaWFzZWRCZWhhdmlvcjogJ2FsaWFzJyxcbiAgICAgICAgICAgIHJlcGxhY2VPcmlnaW5hbE5hbWU6IHRydWUsXG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgYXMocXVlcnkpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm94eShuZXcgTXlTcWxWaWV3KHtcbiAgICAgICAgICAgIG15c3FsQ29uZmlnOiB0aGlzLmNvbmZpZyxcbiAgICAgICAgICAgIGNvbmZpZzoge1xuICAgICAgICAgICAgICAgIG5hbWU6IHRoaXMubmFtZSxcbiAgICAgICAgICAgICAgICBzY2hlbWE6IHRoaXMuc2NoZW1hLFxuICAgICAgICAgICAgICAgIHNlbGVjdGVkRmllbGRzOiB0aGlzLmNvbHVtbnMsXG4gICAgICAgICAgICAgICAgcXVlcnk6IHF1ZXJ5LmlubGluZVBhcmFtcygpLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSksIG5ldyBTZWxlY3Rpb25Qcm94eUhhbmRsZXIoe1xuICAgICAgICAgICAgYWxpYXM6IHRoaXMubmFtZSxcbiAgICAgICAgICAgIHNxbEJlaGF2aW9yOiAnZXJyb3InLFxuICAgICAgICAgICAgc3FsQWxpYXNlZEJlaGF2aW9yOiAnYWxpYXMnLFxuICAgICAgICAgICAgcmVwbGFjZU9yaWdpbmFsTmFtZTogdHJ1ZSxcbiAgICAgICAgfSkpO1xuICAgIH1cbn1cbmNsYXNzIE15U3FsVmlld0Jhc2UgZXh0ZW5kcyBWaWV3IHtcbiAgICBzdGF0aWMgW2VudGl0eUtpbmRdID0gJ015U3FsVmlld0Jhc2UnO1xufVxuY29uc3QgTXlTcWxWaWV3Q29uZmlnID0gU3ltYm9sLmZvcignZHJpenpsZTpNeVNxbFZpZXdDb25maWcnKTtcbmNsYXNzIE15U3FsVmlldyBleHRlbmRzIE15U3FsVmlld0Jhc2Uge1xuICAgIHN0YXRpYyBbZW50aXR5S2luZF0gPSAnTXlTcWxWaWV3JztcbiAgICBbTXlTcWxWaWV3Q29uZmlnXTtcbiAgICBjb25zdHJ1Y3Rvcih7IG15c3FsQ29uZmlnLCBjb25maWcgfSkge1xuICAgICAgICBzdXBlcihjb25maWcpO1xuICAgICAgICB0aGlzW015U3FsVmlld0NvbmZpZ10gPSBteXNxbENvbmZpZztcbiAgICB9XG59XG4vKiogQGludGVybmFsICovXG5mdW5jdGlvbiBteXNxbFZpZXdXaXRoU2NoZW1hKG5hbWUsIHNlbGVjdGlvbiwgc2NoZW1hKSB7XG4gICAgaWYgKHNlbGVjdGlvbikge1xuICAgICAgICByZXR1cm4gbmV3IE1hbnVhbFZpZXdCdWlsZGVyKG5hbWUsIHNlbGVjdGlvbiwgc2NoZW1hKTtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBWaWV3QnVpbGRlcihuYW1lLCBzY2hlbWEpO1xufVxuZnVuY3Rpb24gbXlzcWxWaWV3KG5hbWUsIHNlbGVjdGlvbikge1xuICAgIHJldHVybiBteXNxbFZpZXdXaXRoU2NoZW1hKG5hbWUsIHNlbGVjdGlvbiwgdW5kZWZpbmVkKTtcbn1cblxuZXhwb3J0IHsgVW5pcXVlQ29uc3RyYWludCBhcyBBLCBWaWV3QnVpbGRlciBhcyBCLCBNYW51YWxWaWV3QnVpbGRlciBhcyBDLCBNeVNxbFZpZXdCYXNlIGFzIEQsIE15U3FsVmlldyBhcyBFLCBGb3JlaWduS2V5QnVpbGRlciBhcyBGLCBteXNxbFZpZXcgYXMgRywgSW5saW5lRm9yZWlnbktleXMgYXMgSSwgTXlTcWxTZXNzaW9uIGFzIE0sIFByZXBhcmVkUXVlcnkgYXMgUCwgUXVlcnlCdWlsZGVyIGFzIFEsIFVuaXF1ZUNvbnN0cmFpbnRCdWlsZGVyIGFzIFUsIFZpZXdCdWlsZGVyQ29yZSBhcyBWLCBNeVNxbFRyYW5zYWN0aW9uIGFzIGEsIE15U3FsRGF0YWJhc2UgYXMgYiwgTXlTcWxEaWFsZWN0IGFzIGMsIE15U3FsQ29sdW1uQnVpbGRlcldpdGhBdXRvSW5jcmVtZW50IGFzIGQsIE15U3FsQ29sdW1uV2l0aEF1dG9JbmNyZW1lbnQgYXMgZSwgTXlTcWxDb2x1bW5CdWlsZGVyIGFzIGYsIE15U3FsQ29sdW1uIGFzIGcsIE15U3FsVGFibGUgYXMgaCwgbXlzcWxWaWV3V2l0aFNjaGVtYSBhcyBpLCBNeVNxbFZpZXdDb25maWcgYXMgaiwgRm9yZWlnbktleSBhcyBrLCBmb3JlaWduS2V5IGFzIGwsIG15c3FsVGFibGVXaXRoU2NoZW1hIGFzIG0sIE15U3FsRGVsZXRlIGFzIG4sIE15U3FsSW5zZXJ0QnVpbGRlciBhcyBvLCBNeVNxbEluc2VydCBhcyBwLCBNeVNxbFNlbGVjdEJ1aWxkZXIgYXMgcSwgTXlTcWxTZWxlY3RRdWVyeUJ1aWxkZXIgYXMgciwgTXlTcWxTZWxlY3QgYXMgcywgTXlTcWxVcGRhdGVCdWlsZGVyIGFzIHQsIE15U3FsVXBkYXRlIGFzIHUsIG15c3FsVGFibGUgYXMgdiwgbXlzcWxUYWJsZUNyZWF0b3IgYXMgdywgdW5pcXVlIGFzIHgsIHVuaXF1ZUtleU5hbWUgYXMgeSwgVW5pcXVlT25Db25zdHJhaW50QnVpbGRlciBhcyB6IH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD12aWV3LTIzODk4ZjIxLm1qcy5tYXBcbiJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/drizzle-orm/view-23898f21.mjs\n");

/***/ })

};
;